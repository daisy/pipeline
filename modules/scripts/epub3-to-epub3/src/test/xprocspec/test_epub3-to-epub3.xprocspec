<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns:x="http://www.daisy.org/ns/xprocspec"
               xmlns:px="http://www.daisy.org/ns/pipeline/xproc"
               xmlns:d="http://www.daisy.org/ns/pipeline/data"
               xmlns:c="http://www.w3.org/ns/xproc-step"
               xmlns:html="http://www.w3.org/1999/xhtml"
               xmlns:epub="http://www.idpf.org/2007/ops"
               xmlns:opf="http://www.idpf.org/2007/opf"
               xmlns:ssml="http://www.w3.org/2001/10/synthesis"
               script="../../main/resources/xml/epub3-to-epub3.convert.xpl">
	
	<x:scenario label="minimal">
		<x:call step="px:epub3-to-epub3">
			<x:option name="result-base" select="resolve-uri('result/')"/>
			<x:input port="epub.in.fileset">
				<x:document type="inline">
					<d:fileset>
						<d:file href="mimetype" media-type="text/plain" compression-method="stored"/>
						<d:file href="META-INF/container.xml" media-type="application/xml"/>
						<d:file href="EPUB/package.opf" media-type="application/oebps-package+xml"/>
						<d:file href="EPUB/nav.xhtml" media-type="application/xhtml+xml" role="nav"/>
						<d:file href="EPUB/cover.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="EPUB/front.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="EPUB/chapter.xhtml" media-type="application/xhtml+xml"/>
					</d:fileset>
				</x:document>
			</x:input>
			<x:input port="epub.in.in-memory">
				<x:document type="inline" xml:base="mimetype">
					<c:data content-type="text/plain">application/epub+zip</c:data>
				</x:document>
				<x:document type="inline" xml:base="META-INF/container.xml">
					<container xmlns="urn:oasis:names:tc:opendocument:xmlns:container" version="1.0">
						<rootfiles>
							<rootfile full-path="EPUB/package.opf" media-type="application/oebps-package+xml"/>
						</rootfiles>
					</container>
				</x:document>
				<x:document type="inline" xml:base="EPUB/package.opf">
					<package xmlns="http://www.idpf.org/2007/opf" version="3.0" xml:lang="en" unique-identifier="pub-id">
						<metadata xmlns:dc="http://purl.org/dc/elements/1.1/">
							<dc:title id="title">minimal</dc:title>
							<dc:identifier id="pub-id">id</dc:identifier>
							<meta refines="#pub-id" property="identifier-type" scheme="xsd:string">uuid</meta>
							<meta property="dcterms:modified">2020-03-06T12:00:00Z</meta>
							<dc:date>2020-03-06</dc:date>
							<dc:language>en</dc:language>
							<meta property="schema:accessibilityFeature">captions</meta>
						</metadata>
						<manifest>
							<item id="nav" href="nav.xhtml" properties="nav" media-type="application/xhtml+xml"/>
							<item id="cover" href="cover.xhtml" media-type="application/xhtml+xml"/>
							<item id="front" href="front.xhtml" media-type="application/xhtml+xml"/>
							<item id="chapter" href="chapter.xhtml" media-type="application/xhtml+xml"/>
						</manifest>
						<spine>
							<itemref idref="cover"/>
							<itemref idref="front"/>
							<itemref idref="chapter"/>
						</spine>
					</package>
				</x:document>
				<x:document type="inline" xml:base="EPUB/nav.xhtml">
					<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
						<head>
							<meta charset="UTF-8" />
							<title>minimal</title>
							<meta name="dc:identifier" content="id"/>
						</head>
						<body>
							<nav epub:type="toc">
								<h1>Table of contents</h1>
								<ol>
									<li>
										<a href="cover.xhtml#cover">
											Cover
										</a>
									</li>
									<li>
										<a href="front.xhtml#contents">
											List of contents
										</a>
									</li>
									<li>
										<a href="front.xhtml#preface">
											Preface
										</a>
									</li>
									<li>
										<a href="chapter.xhtml#chap_1">
											Chapter 1
										</a>
									</li>
								</ol>
							</nav>
							<nav epub:type="page-list" hidden="">
								<h1>List of pages</h1>
								<ol>
									<li><a href="front.xhtml#page_front_4">vi</a></li>
									<li><a href="front.xhtml#page_front_5">v</a></li>
									<li><a href="chapter.xhtml#page_5">5</a></li>
								</ol>
							</nav>
						</body>
					</html>
				</x:document>
				<x:document type="inline" xml:base="EPUB/cover.xhtml">
					<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
						<head>
							<meta charset="UTF-8" />
							<title>minimal</title>
							<meta name="dc:identifier" content="id"/>
							<link rel="next" href="front.xhtml" />
						</head>
						<body id="cover" epub:type="cover">
							<p>...</p>
						</body>
					</html>
				</x:document>
				<x:document type="inline" xml:base="EPUB/front.xhtml">
					<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
						<head>
							<meta charset="UTF-8" />
							<title>minimal</title>
							<meta name="dc:identifier" content="id"/>
							<link rel="prev" href="cover.xhtml"/>
							<link rel="next" href="chapter.xhtml"/>
						</head>
						<body id="front" epub:type="frontmatter">
							<h1 id="h_1">Title</h1>
							<p>...</p>
							<section id="contents">
								<h2 id="h_1_1">List of contents</h2>
								<table>...</table>
								<div id="page_front_4" class="page-front" epub:type="pagebreak" title="iv"/>
							</section>
							<section id="preface" aria-label="Preface">
								<p>...</p>
								<div id="page_front_5" class="page-front"/>
							</section>
						</body>
					</html>
				</x:document>
				<x:document type="inline" xml:base="EPUB/chapter.xhtml">
					<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" ssml:alphabet="ipa">
						<head>
							<meta charset="UTF-8"/>
							<title>minimal</title>
							<meta name="dc:identifier" content="id"/>
							<link rel="prev" href="front.xhtml"/>
						</head>
						<body id="chap_1" epub:type="bodymatter chapter">
							<h1 id="h_1">Chapter <span ssml:ph="wÊŒn">I</span></h1>
							<p>
								This paragraph contains
								<span id="page_5" class="page-normal" epub:type="pagebreak" title="5"/>
								a page break.
							</p>
							<figcaption id="caption_1">
								<strong>Illustration 1 A.</strong> This is an illustration.
							</figcaption>
							<p>
								This paragraph contains a note reference.<a epub:type="noteref"
								href="#note_1">*</a> This is the second sentence.
							</p>
							<p id="note_1">
								This is a note.
							</p>
							<ul>
								<li>
									<a href="DTB38216-007-preface.xhtml#p-1">
										<span class="lic">
											<strong>Preface to the First Edition</strong>
										</span>
										<span class="lic">
											<strong>xi</strong>
										</span>
									</a>
								</li>
							</ul>
						</body>
					</html>
				</x:document>
			</x:input>
			<x:option name="ensure-section-headings" select="'true'"/>
			<x:option name="braille" select="false()"/>
			<x:option name="braille-translator" select="''"/>
			<x:option name="stylesheet" select="''"/>
			<x:option name="apply-document-specific-stylesheets" select="false()"/>
			<x:option name="set-default-rendition-to-braille" select="false()"/>
		</x:call>
		<x:scenario label="tts">
			<x:call>
				<x:option name="tts" select="true()"/>
				<x:input port="tts-config">
					<x:document type="inline">
						<config>
							<voice engine="mock-tts" name="mock-en" lang="en" gender="male-adult"/>
							<!-- log can be found in "log" output -->
							<property key="log" value="true"/>
							<css>
								@namespace epub url(http://www.idpf.org/2007/ops);
								[epub|type~=pagebreak]::before {
									content: 'page ';
								}
								[epub|type~=pagebreak]:empty[title]::before {
									content: 'page ' attr(title);
								}
							</css>
						</config>
					</x:document>
				</x:input>
				<x:option name="temp-dir" select="concat($temp-dir,'minimal/tts/')"/>
			</x:call>
			<x:context label="epub.out.fileset port">
				<x:document type="port" port="epub.out.fileset"/>
			</x:context>
			<x:expect label="epub.out.fileset port" type="custom"
			          href="http://www.daisy.org/pipeline/modules/fileset-utils/library.xpl" step="x:fileset-compare">
				<x:document type="inline">
					<d:fileset>
						<d:file href="result/mimetype" media-type="text/plain" compression-method="stored"/>
						<d:file href="result/META-INF/container.xml" media-type="application/xml"/>
						<d:file href="result/EPUB/package.opf" media-type="application/oebps-package+xml" indent="true"/>
						<d:file href="result/EPUB/nav.xhtml" media-type="application/xhtml+xml" role="nav"/>
						<d:file href="result/EPUB/cover.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/front.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/chapter.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/mo/cover.smil" media-type="application/smil+xml"/>
						<d:file href="result/EPUB/mo/front.smil" media-type="application/smil+xml"/>
						<d:file href="result/EPUB/mo/chapter.smil" media-type="application/smil+xml"/>
						<d:file href="result/EPUB/audio/mock.mp3" media-type="audio/mpeg"
						        original-href="../../../target/generated-test-resources/mock.mp3"/>
					</d:fileset>
				</x:document>
			</x:expect>
			<x:expect label="mimetype is first entry" type="xpath" test="contains(/*/d:file[1]/@href,'mimetype')"/>
			<x:context label="package.opf">
				<x:document type="port" port="epub.out.in-memory" select="/*[base-uri()=resolve-uri('result/EPUB/package.opf')]"/>
			</x:context>
			<x:expect label="package.opf" type="custom"
			          href="http://www.daisy.org/pipeline/modules/epub-utils/library.xpl" step="x:epub3-compare-package-doc">
				<x:document type="inline">
					<package xmlns="http://www.idpf.org/2007/opf" version="3.0" unique-identifier="pub-id2" xml:lang="en">
						<metadata xmlns:dc="http://purl.org/dc/elements/1.1/">
							<dc:title id="title2">minimal</dc:title>
							<dc:identifier id="pub-id2">id</dc:identifier>
							<meta refines="#pub-id2" property="identifier-type" scheme="xsd:string">uuid</meta>
							<dc:language>en</dc:language>
							<meta property="dcterms:modified">2020-03-06T11:11:52Z</meta>
							<meta name="dcterms:modified" content="2020-03-06T11:11:52Z"/>
							<dc:date>2020-03-06</dc:date>
							<meta property="media:duration">00:00:24.46</meta>
							<meta name="media:duration" content="00:00:24.46"/>
							<meta property="schema:accessibilityFeature">captions</meta>
							<meta name="schema:accessibilityFeature" content="captions"/>
							<meta property="media:duration" refines="#item_1">00:00:01.223</meta>
							<meta property="media:duration" refines="#item_2">00:00:08.561</meta>
							<meta property="media:duration" refines="#item_3">00:00:14.676</meta>
						</metadata>
						<manifest>
							<item id="nav" href="nav.xhtml" properties="nav" media-type="application/xhtml+xml"/>
							<item id="cover" href="cover.xhtml" media-type="application/xhtml+xml" media-overlay="item_1"/>
							<item id="front" href="front.xhtml" media-type="application/xhtml+xml" media-overlay="item_2"/>
							<item id="chapter" href="chapter.xhtml" media-type="application/xhtml+xml" media-overlay="item_3"/>
							<item id="item_1" href="mo/cover.smil" media-type="application/smil+xml"/>
							<item id="item_2" href="mo/front.smil" media-type="application/smil+xml"/>
							<item id="item_3" href="mo/chapter.smil" media-type="application/smil+xml"/>
							<item id="item_4" href="audio/mock.mp3" media-type="audio/mpeg"/>
						</manifest>
						<spine>
							<itemref idref="cover"/>
							<itemref idref="front"/>
							<itemref idref="chapter"/>
						</spine>
					</package>
				</x:document>
			</x:expect>
			<x:context label="nav.xhtml">
				<x:document type="port" port="epub.out.in-memory" select="/*[base-uri()=resolve-uri('result/EPUB/nav.xhtml')]"/>
			</x:context>
			<x:expect label="nav.xhtml" type="compare">
				<x:document type="inline">
					<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
						<head>
							<meta charset="UTF-8"/>
							<title>minimal</title>
							<meta name="dc:identifier" content="id"/>
						</head>
						<body>
							<nav epub:type="toc">
								<h1>Table of contents</h1>
								<ol>
									<li> <a href="cover.xhtml#cover"> Cover </a> </li>
									<li> <a href="front.xhtml#contents"> List of contents </a> </li>
									<li> <a href="front.xhtml#preface"> Preface </a> </li>
									<li> <a href="chapter.xhtml#chap_1"> Chapter 1 </a> </li>
								</ol>
							</nav>
							<nav epub:type="page-list" hidden="">
								<h1>List of pages</h1>
								<ol>
									<li> <a href="front.xhtml#page_front_4"> vi </a> </li>
									<li> <a href="front.xhtml#page_front_5"> v </a> </li>
									<li> <a href="chapter.xhtml#page_5"> 5 </a> </li>
								</ol>
							</nav>
						</body>
					</html>
				</x:document>
			</x:expect>
			<x:context label="cover.xhtml">
				<x:document type="port" port="epub.out.in-memory" select="/*[base-uri()=resolve-uri('result/EPUB/cover.xhtml')]"/>
			</x:context>
			<x:expect label="cover.xhtml" type="compare">
				<x:document type="inline">
					<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
						<head>
							<meta charset="UTF-8"/>
							<title>minimal</title>
							<meta name="dc:identifier" content="id"/>
							<link rel="next" href="front.xhtml"/>
						</head>
						<body id="cover" epub:type="cover">
							<p>
								<span id="st1-1">...</span>
							</p>
						</body>
					</html>
				</x:document>
			</x:expect>
			<x:context label="front.xhtml">
				<x:document type="port" port="epub.out.in-memory" select="/*[base-uri()=resolve-uri('result/EPUB/front.xhtml')]"/>
			</x:context>
			<x:expect label="front.xhtml" type="compare">
				<x:document type="inline">
					<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
						<head>
							<meta charset="UTF-8"/>
							<title>minimal</title>
							<meta name="dc:identifier" content="id"/>
							<link rel="prev" href="cover.xhtml"/>
							<link rel="next" href="chapter.xhtml"/>
						</head>
						<body id="front" epub:type="frontmatter">
							<h1 id="h_1">
								<span id="st2-1">Title</span>
							</h1>
							<p>
								<span id="st2-2">...</span>
							</p>
							<section id="contents">
								<h2 id="h_1_1">
									<span id="st2-3">List of contents</span>
								</h2>
								<table>...</table>
								<div id="page_front_4" class="page-front" epub:type="pagebreak" title="iv">
									<span id="st2-4"/>
								</div>
							</section>
							<section id="preface" aria-labelledby="aria_label_1">
								<h1 id="aria_label_1">
									<span id="st2-5">Preface</span>
								</h1>
								<p>
									<span id="st2-6">...</span>
								</p>
								<div id="page_front_5" class="page-front" epub:type="pagebreak" title="v">
									<span id="st2-7"/>
								</div>
							</section>
						</body>
					</html>
				</x:document>
			</x:expect>
			<x:context label="chapter.xhtml">
				<x:document type="port" port="epub.out.in-memory" select="/*[base-uri()=resolve-uri('result/EPUB/chapter.xhtml')]"/>
			</x:context>
			<x:expect label="chapter.xhtml" type="compare">
				<x:document type="inline">
					<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" ssml:alphabet="ipa">
						<head>
							<meta charset="UTF-8"/>
							<title>minimal</title>
							<meta name="dc:identifier" content="id"/>
							<link rel="prev" href="front.xhtml"/>
						</head>
						<body id="chap_1" epub:type="bodymatter chapter">
							<h1 id="h_1">
								<span id="st3-1">Chapter <span ssml:ph="wÊŒn">I</span></span>
							</h1>
							<p>
								<span id="st3-2">
									<span id="i3st3-2-no-skippable">This paragraph contains</span>
									<span epub:type="pagebreak" title="5" id="page_5" class="page-normal"/>
									<span id="i3st3-2-page_5">a page break.</span>
								</span>
							</p>
							<figcaption id="caption_1">
								<strong>
									<span id="st3-3">Illustration 1 A.</span>
								</strong>
								<span id="st3-4">This is an illustration.</span>
							</figcaption>
							<p>
								<span id="st3-5">
									<span id="i3st3-5-no-skippable">This paragraph contains a note reference.</span>
									<a id="id_1" epub:type="noteref" href="#note_1">*</a>
									<span id="i3st3-5-id_1"> This is the second sentence.</span>
								</span>
							</p>
							<p id="note_1">
								<span id="st3-6">This is a note.</span>
							</p>
							<ul>
								<li>
									<a href="DTB38216-007-preface.xhtml#p-1">
										<span class="lic">
											<span id="st3-7">
												<strong>Preface to the First Edition</strong>
											</span>
										</span>
										<span id="st3-8"></span>
										<span class="lic">
											<span id="st3-9">
												<strong>xi</strong>
											</span>
										</span>
									</a>
								</li>
							</ul>
						</body>
					</html>
				</x:document>
			</x:expect>
			<x:context label="cover.smil">
				<x:document type="port" port="epub.out.in-memory" select="/*[base-uri()=resolve-uri('result/EPUB/mo/cover.smil')]"/>
			</x:context>
			<x:expect label="cover.smil" type="compare">
				<x:document type="inline">
					<smil xmlns="http://www.w3.org/ns/SMIL" version="3.0">
						<body epub:textref="../cover.xhtml#cover" epub:type="cover">
							<par>
								<text src="../cover.xhtml#st1-1"/>
								<audio src="../audio/mock.mp3" clipBegin="0:00:00.000" clipEnd="0:00:01.223"/>
							</par>
						</body>
					</smil>
				</x:document>
			</x:expect>
			<x:context label="front.smil">
				<x:document type="port" port="epub.out.in-memory" select="/*[base-uri()=resolve-uri('result/EPUB/mo/front.smil')]"/>
			</x:context>
			<x:expect label="front.smil" type="compare">
				<x:document type="inline">
					<smil xmlns="http://www.w3.org/ns/SMIL" version="3.0">
						<body epub:textref="../front.xhtml#front" epub:type="frontmatter">
							<seq epub:textref="../front.xhtml#h_1">
								<par>
									<text src="../front.xhtml#st2-1"/>
									<audio src="../audio/mock.mp3" clipBegin="0:00:00.000" clipEnd="0:00:01.223"/>
								</par>
							</seq>
							<par>
								<text src="../front.xhtml#st2-2"/>
								<audio src="../audio/mock.mp3" clipBegin="0:00:01.223" clipEnd="0:00:02.446"/>
							</par>
							<seq epub:textref="../front.xhtml#contents">
								<seq epub:textref="../front.xhtml#h_1_1">
									<par>
										<text src="../front.xhtml#st2-3"/>
										<audio src="../audio/mock.mp3" clipBegin="0:00:02.446" clipEnd="0:00:03.669"/>
									</par>
								</seq>
								<seq epub:textref="../front.xhtml#page_front_4" epub:type="pagebreak">
									<par>
										<text src="../front.xhtml#st2-4"/>
										<audio src="../audio/mock.mp3" clipBegin="0:00:00.000" clipEnd="0:00:01.223"/>
									</par>
								</seq>
							</seq>
							<seq epub:textref="../front.xhtml#preface">
								<seq epub:textref="../front.xhtml#aria_label_1">
									<par>
										<text src="../front.xhtml#st2-5"/>
										<audio src="../audio/mock.mp3" clipBegin="0:00:01.223" clipEnd="0:00:02.446"/>
									</par>
								</seq>
								<par>
									<text src="../front.xhtml#st2-6"/>
									<audio src="../audio/mock.mp3" clipBegin="0:00:02.446" clipEnd="0:00:03.669"/>
								</par>
								<seq epub:textref="../front.xhtml#page_front_5" epub:type="pagebreak">
									<par>
										<text src="../front.xhtml#st2-7"/>
										<audio src="../audio/mock.mp3" clipBegin="0:00:00.000" clipEnd="0:00:01.223"/>
									</par>
								</seq>
							</seq>
						</body>
					</smil>
				</x:document>
			</x:expect>
			<x:context label="chapter.smil">
				<x:document type="port" port="epub.out.in-memory" select="/*[base-uri()=resolve-uri('result/EPUB/mo/chapter.smil')]"/>
			</x:context>
			<x:expect label="chapter.smil" type="compare">
				<x:document type="inline">
					<smil xmlns="http://www.w3.org/ns/SMIL" version="3.0">
						<body epub:textref="../chapter.xhtml#chap_1" epub:type="bodymatter chapter">
							<seq epub:textref="../chapter.xhtml#h_1">
								<par>
									<text src="../chapter.xhtml#st3-1"/>
									<audio src="../audio/mock.mp3" clipBegin="0:00:00.000" clipEnd="0:00:01.223"/>
								</par>
							</seq>
							<seq epub:textref="../chapter.xhtml#st3-2">
								<par>
									<text src="../chapter.xhtml#i3st3-2-no-skippable"/>
									<audio src="../audio/mock.mp3" clipBegin="0:00:01.223" clipEnd="0:00:02.446"/>
								</par>
								<par epub:type="pagebreak">
									<text src="../chapter.xhtml#page_5"/>
									<audio src="../audio/mock.mp3" clipBegin="0:00:01.223" clipEnd="0:00:02.446"/>
								</par>
								<par>
									<text src="../chapter.xhtml#i3st3-2-page_5"/>
									<audio src="../audio/mock.mp3" clipBegin="0:00:02.446" clipEnd="0:00:03.669"/>
								</par>
							</seq>
							<seq epub:textref="../chapter.xhtml#caption_1">
								<par>
									<text src="../chapter.xhtml#st3-3"/>
									<audio src="../audio/mock.mp3" clipBegin="0:00:00.000" clipEnd="0:00:01.223"/>
								</par>
								<par>
									<text src="../chapter.xhtml#st3-4"/>
									<audio src="../audio/mock.mp3" clipBegin="0:00:01.223" clipEnd="0:00:02.446"/>
								</par>
							</seq>
							<seq epub:textref="../chapter.xhtml#st3-5">
								<par>
									<text src="../chapter.xhtml#i3st3-5-no-skippable"/>
									<audio src="../audio/mock.mp3" clipBegin="0:00:00.000" clipEnd="0:00:01.223"/>
								</par>
								<par epub:type="noteref">
									<text src="../chapter.xhtml#id_1"/>
									<audio src="../audio/mock.mp3" clipBegin="0:00:02.446" clipEnd="0:00:03.669"/>
								</par>
								<par>
									<text src="../chapter.xhtml#i3st3-5-id_1"/>
									<audio src="../audio/mock.mp3" clipBegin="0:00:01.223" clipEnd="0:00:02.446"/>
								</par>
							</seq>
							<seq epub:textref="../chapter.xhtml#note_1">
								<par>
									<text src="../chapter.xhtml#st3-6"/>
									<audio src="../audio/mock.mp3" clipBegin="0:00:00.000" clipEnd="0:00:01.223"/>
								</par>
							</seq>
							<par>
								<text src="../chapter.xhtml#st3-7"/>
								<audio src="../audio/mock.mp3" clipBegin="0:00:01.223" clipEnd="0:00:02.446"/>
							</par>
							<par>
								<text src="../chapter.xhtml#st3-9"/>
								<audio src="../audio/mock.mp3" clipBegin="0:00:00.000" clipEnd="0:00:01.223"/>
							</par>
						</body>
					</smil>
				</x:document>
			</x:expect>
		</x:scenario>
		<x:scenario label="ensure-pagenum-text">
			<x:call>
				<x:option name="ensure-pagenum-text" select="'hidden'"/>
				<x:option name="temp-dir" select="concat($temp-dir,'minimal/ensure-pagenum-text/')"/>
			</x:call>
			<x:context label="front.xhtml">
				<x:document type="port" port="epub.out.in-memory" select="/*[base-uri()=resolve-uri('result/EPUB/front.xhtml')]
				                                                          //html:div[@id='page_front_4']"/>
			</x:context>
			<x:expect label="front.xhtml" type="compare">
				<x:document type="inline" xmlns="http://www.w3.org/1999/xhtml">
					<div id="page_front_4" class="page-front" epub:type="pagebreak" title="iv"
					     style="visibility: hidden">
						<span id="st2-4">iv</span>
					</div>
				</x:document>
			</x:expect>
		</x:scenario>
		<x:scenario label="sentence-detection">
			<x:call>
				<x:option name="tts" select="false()"/>
				<x:option name="sentence-detection" select="true()"/>
				<x:option name="sentence-class" select="'sentence'"/>
				<x:option name="temp-dir" select="concat($temp-dir,'minimal/sentence-detection/')"/>
			</x:call>
			<x:context label="epub.out.fileset port">
				<x:document type="port" port="epub.out.fileset"/>
			</x:context>
			<x:expect label="epub.out.fileset port" type="custom"
			          href="http://www.daisy.org/pipeline/modules/fileset-utils/library.xpl" step="x:fileset-compare">
				<x:document type="inline">
					<d:fileset>
						<d:file href="result/mimetype" media-type="text/plain" compression-method="stored"/>
						<d:file href="result/META-INF/container.xml" media-type="application/xml"/>
						<d:file href="result/EPUB/package.opf" media-type="application/oebps-package+xml" indent="true"/>
						<d:file href="result/EPUB/nav.xhtml" media-type="application/xhtml+xml" role="nav"/>
						<d:file href="result/EPUB/cover.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/front.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/chapter.xhtml" media-type="application/xhtml+xml"/>
					</d:fileset>
				</x:document>
			</x:expect>
			<x:expect label="mimetype is first entry" type="xpath" test="contains(/*/d:file[1]/@href,'mimetype')"/>
			<x:context label="package.opf">
				<x:document type="port" port="epub.out.in-memory" select="/*[base-uri()=resolve-uri('result/EPUB/package.opf')]"/>
			</x:context>
			<x:expect label="package.opf" type="custom"
			          href="http://www.daisy.org/pipeline/modules/epub-utils/library.xpl" step="x:epub3-compare-package-doc">
				<x:document type="inline">
					<package xmlns="http://www.idpf.org/2007/opf" version="3.0" unique-identifier="pub-id" xml:lang="en">
						<metadata>
							<dc:title xmlns:dc="http://purl.org/dc/elements/1.1/" id="title">minimal</dc:title>
							<dc:identifier xmlns:dc="http://purl.org/dc/elements/1.1/" id="pub-id">id</dc:identifier>
							<meta refines="#pub-id" property="identifier-type" scheme="xsd:string">uuid</meta>
							<meta property="dcterms:modified">2020-03-06T12:00:00Z</meta>
							<dc:date xmlns:dc="http://purl.org/dc/elements/1.1/">2020-03-06</dc:date>
							<dc:language xmlns:dc="http://purl.org/dc/elements/1.1/">en</dc:language>
							<meta property="schema:accessibilityFeature">captions</meta>
						</metadata>
						<manifest>
							<item id="nav" href="nav.xhtml" properties="nav" media-type="application/xhtml+xml"/>
							<item id="cover" href="cover.xhtml" media-type="application/xhtml+xml"/>
							<item id="front" href="front.xhtml" media-type="application/xhtml+xml"/>
							<item id="chapter" href="chapter.xhtml" media-type="application/xhtml+xml"/>
						</manifest>
						<spine>
							<itemref idref="cover"/>
							<itemref idref="front"/>
							<itemref idref="chapter"/>
						</spine>
					</package>
				</x:document>
			</x:expect>
			<x:context label="nav.xhtml">
				<x:document type="port" port="epub.out.in-memory" select="/*[base-uri()=resolve-uri('result/EPUB/nav.xhtml')]"/>
			</x:context>
			<x:expect label="nav.xhtml" type="compare">
				<x:document type="inline">
					<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
						<head>
							<meta charset="UTF-8"/>
							<title>minimal</title>
							<meta name="dc:identifier" content="id"/>
						</head>
						<body>
							<nav epub:type="toc">
								<h1>Table of contents</h1>
								<ol>
									<li> <a href="cover.xhtml#cover"> Cover </a> </li>
									<li> <a href="front.xhtml#contents"> List of contents </a> </li>
									<li> <a href="front.xhtml#preface"> Preface </a> </li>
									<li> <a href="chapter.xhtml#chap_1"> Chapter 1 </a> </li>
								</ol>
							</nav>
							<nav epub:type="page-list" hidden="">
								<h1>List of pages</h1>
								<ol>
									<li> <a href="front.xhtml#page_front_4"> vi </a> </li>
									<li> <a href="front.xhtml#page_front_5"> v </a> </li>
									<li> <a href="chapter.xhtml#page_5"> 5 </a> </li>
								</ol>
							</nav>
						</body>
					</html>
				</x:document>
			</x:expect>
			<x:context label="chapter.xhtml">
				<x:document type="port" port="epub.out.in-memory" select="/*[base-uri()=resolve-uri('result/EPUB/chapter.xhtml')]"/>
			</x:context>
			<x:expect label="chapter.xhtml" type="compare">
				<x:document type="inline">
					<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" ssml:alphabet="ipa">
						<head>
							<meta charset="UTF-8"/>
							<title>minimal</title>
							<meta name="dc:identifier" content="id"/>
							<link rel="prev" href="front.xhtml"/>
						</head>
						<body id="chap_1" epub:type="bodymatter chapter">
							<h1 id="h_1">
								<span id="st3-1" class="sentence">Chapter <span ssml:ph="wÊŒn">I</span></span>
							</h1>
							<p>
								<span id="st3-2" class="sentence">
									<span id="i3st3-2-no-skippable">This paragraph contains</span>
									<span epub:type="pagebreak" title="5" id="page_5" class="page-normal"/>
									<span id="i3st3-2-page_5">a page break.</span>
								</span>
							</p>
							<figcaption id="caption_1">
								<strong>
									<span id="st3-3" class="sentence">Illustration 1 A.</span>
								</strong>
								<span id="st3-4" class="sentence">This is an illustration.</span>
							</figcaption>
							<p>
								<span id="st3-5" class="sentence">
									<span id="i3st3-5-no-skippable">This paragraph contains a note reference.</span>
									<a id="id_1" epub:type="noteref" href="#note_1">*</a>
									<span id="i3st3-5-id_1"> This is the second sentence.</span>
								</span>
							</p>
							<p id="note_1">
								<span id="st3-6" class="sentence">This is a note.</span>
							</p>
							<ul>
								<li>
									<a href="DTB38216-007-preface.xhtml#p-1">
										<span class="lic">
											<span id="st3-7" class="sentence">
												<strong>Preface to the First Edition</strong>
											</span>
										</span>
										<span id="st3-8" class="sentence"></span>
										<span class="lic">
											<span id="st3-9" class="sentence">
												<strong>xi</strong>
											</span>
										</span>
									</a>
								</li>
							</ul>
						</body>
					</html>
				</x:document>
			</x:expect>
		</x:scenario>
		<x:scenario label="inject-metadata">
			<x:call>
				<x:option name="tts" select="false()"/>
				<x:option name="sentence-detection" select="false()"/>
				<x:option name="update-lang-attributes" select="true()"/>
				<x:option name="update-identifier-in-content-docs" select="true()"/>
				<x:option name="update-title-in-content-docs" select="true()"/>
				<x:input port="metadata">
					<x:document xmlns="http://www.idpf.org/2007/opf" type="inline">
						<metadata xmlns:dc="http://purl.org/dc/elements/1.1/">
							<dc:identifier id="pub-id">new-id</dc:identifier>
							<meta refines="#title" property="title-type">main</meta> <!-- not valid -->
							<dc:creator id="creator">Bert</dc:creator>
							<meta refines="#creator" property="role" scheme="marc:relators">aut</meta>
							<meta property="schema:accessModeSufficient">textual,visual</meta>
							<meta property="schema:accessModeSufficient">textual</meta>
							<meta property="schema:accessibilityFeature">pageNavigation</meta>
							<dc:language>en-GB</dc:language>
						</metadata>
					</x:document>
				</x:input>
				<x:option name="temp-dir" select="concat($temp-dir,'minimal/inject-metadata/')"/>
			</x:call>
			<x:context label="epub.out.fileset port">
				<x:document type="port" port="epub.out.fileset"/>
			</x:context>
			<x:expect label="epub.out.fileset port" type="custom"
			          href="http://www.daisy.org/pipeline/modules/fileset-utils/library.xpl" step="x:fileset-compare">
				<x:document type="inline">
					<d:fileset>
						<d:file href="result/mimetype" media-type="text/plain" compression-method="stored"/>
						<d:file href="result/META-INF/container.xml" media-type="application/xml"/>
						<d:file href="result/EPUB/package.opf" media-type="application/oebps-package+xml" indent="true"/>
						<d:file href="result/EPUB/nav.xhtml" media-type="application/xhtml+xml" role="nav"/>
						<d:file href="result/EPUB/cover.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/front.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/chapter.xhtml" media-type="application/xhtml+xml"/>
					</d:fileset>
				</x:document>
			</x:expect>
			<x:context label="package.opf">
				<x:document type="port" port="epub.out.in-memory" select="/*[base-uri()=resolve-uri('result/EPUB/package.opf')]"/>
			</x:context>
			<x:expect label="package.opf" type="custom"
			          href="http://www.daisy.org/pipeline/modules/epub-utils/library.xpl" step="x:epub3-compare-package-doc">
				<x:document type="inline">
					<package xmlns="http://www.idpf.org/2007/opf" version="3.0" unique-identifier="pub-id" xml:lang="en-GB">
						<metadata xmlns:dc="http://purl.org/dc/elements/1.1/">
							<dc:title id="title2">minimal</dc:title>
							<dc:identifier id="pub-id">new-id</dc:identifier>
							<dc:language>en-GB</dc:language>
							<meta property="dcterms:modified">2021-02-01T16:03:09Z</meta>
							<meta name="dcterms:modified" content="2021-02-01T16:03:09Z"/>
							<dc:creator id="creator">Bert</dc:creator>
							<meta refines="#creator" property="role" scheme="marc:relators">aut</meta>
							<dc:date>2020-03-06</dc:date>
							<meta property="schema:accessModeSufficient">textual,visual</meta>
							<meta name="schema:accessModeSufficient" content="textual,visual"/>
							<meta property="schema:accessModeSufficient">textual</meta>
							<meta name="schema:accessModeSufficient" content="textual"/>
							<meta property="schema:accessibilityFeature">pageNavigation</meta>
							<meta name="schema:accessibilityFeature" content="pageNavigation"/>
						</metadata>
						<manifest>
							<item id="nav" href="nav.xhtml" properties="nav" media-type="application/xhtml+xml"/>
							<item id="cover" href="cover.xhtml" media-type="application/xhtml+xml"/>
							<item id="front" href="front.xhtml" media-type="application/xhtml+xml"/>
							<item id="chapter" href="chapter.xhtml" media-type="application/xhtml+xml"/>
						</manifest>
						<spine>
							<itemref idref="cover"/>
							<itemref idref="front"/>
							<itemref idref="chapter"/>
						</spine>
					</package>
				</x:document>
			</x:expect>
			<x:context label="cover.xhtml">
				<x:document type="port" port="epub.out.in-memory" select="/*[base-uri()=resolve-uri('result/EPUB/cover.xhtml')]"/>
			</x:context>
			<x:expect label="cover.xhtml" type="compare">
				<x:document type="inline">
					<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-GB" lang="en-GB">
						<head>
							<meta charset="UTF-8" />
							<title>minimal</title>
							<meta name="dc:identifier" content="new-id"/>
							<link rel="next" href="front.xhtml" />
						</head>
						<body id="cover" epub:type="cover">
							<p>...</p>
						</body>
					</html>
				</x:document>
			</x:expect>
		</x:scenario>
	</x:scenario>
	
	<x:scenario label="valentin">
		<x:call step="px:epub3-to-epub3">
			<x:input port="epub.in.fileset">
				<x:document type="inline">
					<d:fileset>
						<d:file href="../resources/valentin.epub!/mimetype" compression-method="stored"/>
						<d:file href="../resources/valentin.epub!/EPUB/C00000-1-cover.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="../resources/valentin.epub!/EPUB/package.opf" media-type="application/oebps-package+xml"/>
						<d:file href="../resources/valentin.epub!/EPUB/nav.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="../resources/valentin.epub!/EPUB/nav.ncx" media-type="application/x-dtbncx+xml"/>
						<d:file href="../resources/valentin.epub!/EPUB/C00000-9-footnotes.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="../resources/valentin.epub!/EPUB/C00000-5-chapter.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="../resources/valentin.epub!/EPUB/C00000-6-rearnotes.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="../resources/valentin.epub!/EPUB/C00000-7-chapter.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="../resources/valentin.epub!/EPUB/C00000-8-conclusion.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="../resources/valentin.epub!/EPUB/C00000-4-chapter.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="../resources/valentin.epub!/EPUB/C00000-2-frontmatter.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="../resources/valentin.epub!/EPUB/C00000-3-chapter.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="../resources/valentin.epub!/EPUB/css/accessibility.css" media-type="text/css"/>
						<d:file href="../resources/valentin.epub!/EPUB/css/fonts/opendyslexic/LICENSE.txt" media-type="text/plain"/>
						<d:file href="../resources/valentin.epub!/EPUB/css/fonts/opendyslexic/OpenDyslexic-Bold.otf" media-type="application/x-font-opentype"/>
						<d:file href="../resources/valentin.epub!/EPUB/css/fonts/opendyslexic/OpenDyslexic-BoldItalic.otf" media-type="application/x-font-opentype"/>
						<d:file href="../resources/valentin.epub!/EPUB/css/fonts/opendyslexic/OpenDyslexic-Italic.otf" media-type="application/x-font-opentype"/>
						<d:file href="../resources/valentin.epub!/EPUB/css/fonts/opendyslexic/OpenDyslexic-Regular.otf" media-type="application/x-font-opentype"/>
						<d:file href="../resources/valentin.epub!/EPUB/css/fonts/opendyslexic/OpenDyslexicMono-Regular.otf" media-type="application/x-font-opentype"/>
						<d:file href="../resources/valentin.epub!/EPUB/images/valentin.jpg" media-type="image/jpeg"/>
						<d:file href="../resources/valentin.epub!/META-INF/container.xml" media-type="application/xml"/>
					</d:fileset>
				</x:document>
			</x:input>
			<x:input port="epub.in.in-memory"/>
			<x:option name="result-base" select="resolve-uri('result/')"/>
			<x:option name="braille-translator" select="'(translator:liblouis)'"/>
			<x:option name="stylesheet" select="''"/>
			<x:option name="apply-document-specific-stylesheets" select="false()"/>
			<x:option name="set-default-rendition-to-braille" select="false()"/>
			<x:input port="tts-config">
				<x:document type="inline">
					<config>
						<voice engine="mock-tts" name="mock-en" lang="en" gender="male-adult"/>
						<!-- log can be found in "log" output -->
						<property key="log" value="true"/>
					</config>
				</x:document>
			</x:input>
			<x:option name="temp-dir" select="concat($temp-dir,'valentin/')"/>
		</x:call>
		<x:scenario label="braille-rendition">
			<x:call>
				<x:option name="braille" select="true()"/>
				<x:option name="tts" select="false()"/>
				<x:option name="sentence-detection" select="false()"/>
			</x:call>
			<x:context label="epub.out.fileset port">
				<x:document type="port" port="epub.out.fileset"/>
			</x:context>
			<x:expect label="epub.out.fileset port" type="custom"
			          href="http://www.daisy.org/pipeline/modules/fileset-utils/library.xpl" step="x:fileset-compare">
				<x:document type="inline">
					<d:fileset>
						<d:file href="result/mimetype" compression-method="stored"
						        original-href="../resources/valentin.epub!/mimetype"/>
						<d:file href="result/EPUB/C00000-1-cover.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/package.opf" media-type="application/oebps-package+xml" indent="true"
						        original-href="../resources/valentin.epub!/EPUB/package.opf"/>
						<d:file href="result/EPUB/nav.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/nav.ncx" media-type="application/x-dtbncx+xml"
						        original-href="../resources/valentin.epub!/EPUB/nav.ncx"/>
						<d:file href="result/EPUB/C00000-9-footnotes.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/C00000-5-chapter.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/C00000-6-rearnotes.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/C00000-7-chapter.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/C00000-8-conclusion.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/C00000-4-chapter.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/C00000-2-frontmatter.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/C00000-3-chapter.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/css/accessibility.css" media-type="text/css"
						        original-href="../resources/valentin.epub!/EPUB/css/accessibility.css"/>
						<d:file href="result/EPUB/css/fonts/opendyslexic/LICENSE.txt" media-type="text/plain"
						        original-href="../resources/valentin.epub!/EPUB/css/fonts/opendyslexic/LICENSE.txt"/>
						<d:file href="result/EPUB/css/fonts/opendyslexic/OpenDyslexic-Bold.otf" media-type="application/x-font-opentype"
						        original-href="../resources/valentin.epub!/EPUB/css/fonts/opendyslexic/OpenDyslexic-Bold.otf"/>
						<d:file href="result/EPUB/css/fonts/opendyslexic/OpenDyslexic-BoldItalic.otf" media-type="application/x-font-opentype"
						        original-href="../resources/valentin.epub!/EPUB/css/fonts/opendyslexic/OpenDyslexic-BoldItalic.otf"/>
						<d:file href="result/EPUB/css/fonts/opendyslexic/OpenDyslexic-Italic.otf" media-type="application/x-font-opentype"
						        original-href="../resources/valentin.epub!/EPUB/css/fonts/opendyslexic/OpenDyslexic-Italic.otf"/>
						<d:file href="result/EPUB/css/fonts/opendyslexic/OpenDyslexic-Regular.otf" media-type="application/x-font-opentype"
						        original-href="../resources/valentin.epub!/EPUB/css/fonts/opendyslexic/OpenDyslexic-Regular.otf"/>
						<d:file href="result/EPUB/css/fonts/opendyslexic/OpenDyslexicMono-Regular.otf" media-type="application/x-font-opentype"
						        original-href="../resources/valentin.epub!/EPUB/css/fonts/opendyslexic/OpenDyslexicMono-Regular.otf"/>
						<d:file href="result/EPUB/images/valentin.jpg" media-type="image/jpeg"
						        original-href="../resources/valentin.epub!/EPUB/images/valentin.jpg"/>
						<d:file href="result/META-INF/container.xml" media-type="application/xml"/>
						<d:file href="result/EPUB/C00000-1-cover_braille.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/C00000-2-frontmatter_braille.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/C00000-3-chapter_braille.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/C00000-4-chapter_braille.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/C00000-5-chapter_braille.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/C00000-6-rearnotes_braille.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/C00000-7-chapter_braille.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/C00000-8-conclusion_braille.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/C00000-9-footnotes_braille.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/nav_braille.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/C00000-1-cover_braille.css" media-type="text/plain"/>
						<d:file href="result/EPUB/C00000-2-frontmatter_braille.css" media-type="text/plain"/>
						<d:file href="result/EPUB/C00000-3-chapter_braille.css" media-type="text/plain"/>
						<d:file href="result/EPUB/C00000-4-chapter_braille.css" media-type="text/plain"/>
						<d:file href="result/EPUB/C00000-5-chapter_braille.css" media-type="text/plain"/>
						<d:file href="result/EPUB/C00000-6-rearnotes_braille.css" media-type="text/plain"/>
						<d:file href="result/EPUB/C00000-7-chapter_braille.css" media-type="text/plain"/>
						<d:file href="result/EPUB/C00000-8-conclusion_braille.css" media-type="text/plain"/>
						<d:file href="result/EPUB/C00000-9-footnotes_braille.css" media-type="text/plain"/>
						<d:file href="result/EPUB/nav_braille.css" media-type="text/plain"/>
						<d:file href="result/META-INF/metadata.xml"/>
						<d:file href="result/EPUB/package-braille.opf" media-type="application/oebps-package+xml" indent="true"/>
						<d:file href="result/EPUB/renditionMapping.html" indent="true"/>
					</d:fileset>
				</x:document>
			</x:expect>
			<x:context label="the package document">
				<x:document type="port" port="epub.out.in-memory" select="/*[base-uri()=resolve-uri('result/EPUB/package-braille.opf')]"/>
			</x:context>
			<x:expect label="the package document" type="custom"
			          href="http://www.daisy.org/pipeline/modules/epub-utils/library.xpl" step="x:epub3-compare-package-doc">
				<x:document type="inline">
					<package xmlns="http://www.idpf.org/2007/opf" unique-identifier="pub-identifier" version="3.0"
					         prefix="nordic: http://www.mtm.se/epub/">
						<metadata xmlns:dc="http://purl.org/dc/elements/1.1/">
							<dc:identifier id="pub-identifier">C00000</dc:identifier>
							<dc:title>Valentin HaÃ¼y - the father of the education for the blind</dc:title>
							<dc:creator>Beatrice Christensen SkÃ¶ld</dc:creator>
							<dc:source>urn:isbn:123456789</dc:source>
							<dc:format>EPUB3</dc:format>
							<dc:publisher>MTM</dc:publisher>
							<dc:date>2006-03-23</dc:date>
							<meta property="dcterms:modified">2020-03-09T15:37:52Z</meta>
							<meta name="dcterms:modified" content="2020-03-09T15:37:52Z"/>
							<meta property="nordic:guidelines">2015-1</meta>
							<meta name="nordic:guidelines" content="2015-1"/>
							<meta property="nordic:supplier">MTM</meta>
							<meta name="nordic:supplier" content="MTM"/>
							<dc:language>en-Brai</dc:language>
						</metadata>
						<manifest>
							<item id="item_1" href="css/accessibility.css" media-type="text/css"/>
							<item id="item_2" href="css/fonts/opendyslexic/OpenDyslexic-Regular.otf" media-type="application/x-font-opentype"/>
							<item id="item_3" href="css/fonts/opendyslexic/OpenDyslexic-Italic.otf" media-type="application/x-font-opentype"/>
							<item id="item_4" href="css/fonts/opendyslexic/OpenDyslexic-Bold.otf" media-type="application/x-font-opentype"/>
							<item id="item_5" href="css/fonts/opendyslexic/OpenDyslexic-BoldItalic.otf" media-type="application/x-font-opentype"/>
							<item id="item_6" href="css/fonts/opendyslexic/OpenDyslexicMono-Regular.otf" media-type="application/x-font-opentype"/>
							<item id="item_7" href="css/fonts/opendyslexic/LICENSE.txt" media-type="text/plain"/>
							<item id="item_8" href="images/valentin.jpg" media-type="image/jpeg"/>
							<item id="item_9" href="nav.ncx" media-type="application/x-dtbncx+xml"/>
							<item id="item_10" href="C00000-1-cover_braille.xhtml" media-type="application/xhtml+xml"/>
							<item id="item_11" href="C00000-2-frontmatter_braille.xhtml" media-type="application/xhtml+xml"/>
							<item id="item_12" href="C00000-3-chapter_braille.xhtml" media-type="application/xhtml+xml"/>
							<item id="item_13" href="C00000-4-chapter_braille.xhtml" media-type="application/xhtml+xml"/>
							<item id="item_14" href="C00000-5-chapter_braille.xhtml" media-type="application/xhtml+xml"/>
							<item id="item_15" href="C00000-6-rearnotes_braille.xhtml" media-type="application/xhtml+xml"/>
							<item id="item_16" href="C00000-7-chapter_braille.xhtml" media-type="application/xhtml+xml"/>
							<item id="item_17" href="C00000-8-conclusion_braille.xhtml" media-type="application/xhtml+xml"/>
							<item id="item_18" href="C00000-9-footnotes_braille.xhtml" media-type="application/xhtml+xml"/>
							<item id="item_19" href="nav_braille.xhtml" properties="nav" media-type="application/xhtml+xml"/>
							<item id="item_20" href="C00000-1-cover_braille.css" media-type="text/css"/>
							<item id="item_21" href="nav_braille.css" media-type="text/css"/>
							<item id="item_22" href="C00000-9-footnotes_braille.css" media-type="text/css"/>
							<item id="item_23" href="C00000-5-chapter_braille.css" media-type="text/css"/>
							<item id="item_24" href="C00000-6-rearnotes_braille.css" media-type="text/css"/>
							<item id="item_25" href="C00000-7-chapter_braille.css" media-type="text/css"/>
							<item id="item_26" href="C00000-8-conclusion_braille.css" media-type="text/css"/>
							<item id="item_27" href="C00000-4-chapter_braille.css" media-type="text/css"/>
							<item id="item_28" href="C00000-2-frontmatter_braille.css" media-type="text/css"/>
							<item id="item_29" href="C00000-3-chapter_braille.css" media-type="text/css"/>
						</manifest>
						<spine toc="item_9">
							<itemref id="itemref_1" idref="item_10" linear="no"/>
							<itemref id="itemref_2" idref="item_11"/>
							<itemref id="itemref_3" idref="item_12"/>
							<itemref id="itemref_4" idref="item_13"/>
							<itemref id="itemref_5" idref="item_14"/>
							<itemref id="itemref_6" idref="item_15" linear="no"/>
							<itemref id="itemref_7" idref="item_16"/>
							<itemref id="itemref_8" idref="item_17"/>
							<itemref id="itemref_9" idref="item_18"/>
						</spine>
					</package>
				</x:document>
			</x:expect>
			<x:context label="the container document">
				<x:document type="port" port="epub.out.in-memory"
				            select="/*[base-uri()=resolve-uri('result/META-INF/container.xml')]"/>
			</x:context>
			<x:expect label="the in-memory output port contains the container document" type="compare">
				<x:document type="inline">
					<container xmlns="urn:oasis:names:tc:opendocument:xmlns:container" version="1.0"
					           xmlns:rendition="http://www.idpf.org/2013/rendition">
						<rootfiles>
							<rootfile full-path="EPUB/package.opf" media-type="application/oebps-package+xml"/>
							<rootfile full-path="EPUB/package-braille.opf" media-type="application/oebps-package+xml"
							          rendition:accessMode="tactile" rendition:label="Pre-translated to braille"
							          rendition:language="en-Brai" rendition:layout="reflowable"/>
						</rootfiles>
						<link href="EPUB/renditionMapping.html" rel="mapping" media-type="application/xhtml+xml"/>
					</container>
				</x:document>
			</x:expect>
			<x:context label="the first content document">
				<x:document type="port" port="epub.out.in-memory"
				            select="/*[base-uri()=resolve-uri('result/EPUB/C00000-1-cover_braille.xhtml')]"/>
			</x:context>
			<x:expect label="cross-references should be correct" type="xpath"
			          test="/html:html/html:head/html:link[@rel='next']/@href" equals="'C00000-2-frontmatter_braille.xhtml'"/>
			<x:context label="the renditionMapping document">
				<x:document type="port" port="epub.out.in-memory"
				            select="/*[base-uri()=resolve-uri('result/EPUB/renditionMapping.html')]"/>
			</x:context>
			<x:expect label="the renditionMapping document should be as expected" type="compare">
				<x:document type="inline">
					<html xmlns="http://www.w3.org/1999/xhtml">
						<head>
							<meta charset="utf-8"/>
						</head>
						<body>
							<nav epub:type="resource-map">
								<ul>
									<li>
										<a href="package.opf#epubcfi(/6/2[itemref_1])"/>
									</li>
									<li>
										<a href="package-braille.opf#epubcfi(/6/2[itemref_1])"/>
									</li>
								</ul>
								<ul>
									<li>
										<a href="package.opf#epubcfi(/6/18[itemref_9])"/>
									</li>
									<li>
										<a href="package-braille.opf#epubcfi(/6/18[itemref_9])"/>
									</li>
								</ul>
								<ul>
									<li>
										<a href="package.opf#epubcfi(/6/10[itemref_5])"/>
									</li>
									<li>
										<a href="package-braille.opf#epubcfi(/6/10[itemref_5])"/>
									</li>
								</ul>
								<ul>
									<li>
										<a href="package.opf#epubcfi(/6/12[itemref_6])"/>
									</li>
									<li>
										<a href="package-braille.opf#epubcfi(/6/12[itemref_6])"/>
									</li>
								</ul>
								<ul>
									<li>
										<a href="package.opf#epubcfi(/6/14[itemref_7])"/>
									</li>
									<li>
										<a href="package-braille.opf#epubcfi(/6/14[itemref_7])"/>
									</li>
								</ul>
								<ul>
									<li>
										<a href="package.opf#epubcfi(/6/16[itemref_8])"/>
									</li>
									<li>
										<a href="package-braille.opf#epubcfi(/6/16[itemref_8])"/>
									</li>
								</ul>
								<ul>
									<li>
										<a href="package.opf#epubcfi(/6/8[itemref_4])"/>
									</li>
									<li>
										<a href="package-braille.opf#epubcfi(/6/8[itemref_4])"/>
									</li>
								</ul>
								<ul>
									<li>
										<a href="package.opf#epubcfi(/6/4[itemref_2])"/>
									</li>
									<li>
										<a href="package-braille.opf#epubcfi(/6/4[itemref_2])"/>
									</li>
								</ul>
								<ul>
									<li>
										<a href="package.opf#epubcfi(/6/6[itemref_3])"/>
									</li>
									<li>
										<a href="package-braille.opf#epubcfi(/6/6[itemref_3])"/>
									</li>
								</ul>
							</nav>
						</body>
					</html>
				</x:document>
			</x:expect>
		</x:scenario>
		<x:scenario label="tts">
			<x:call>
				<x:option name="braille" select="false()"/>
				<x:option name="tts" select="true()"/>
			</x:call>
			<x:context label="epub.out.fileset port">
				<x:document type="port" port="epub.out.fileset"/>
			</x:context>
			<x:expect label="epub.out.fileset port" type="custom"
			          href="http://www.daisy.org/pipeline/modules/fileset-utils/library.xpl" step="x:fileset-compare">
				<x:document type="inline">
					<d:fileset>
						<d:file href="result/mimetype" compression-method="stored"
						        original-href="../resources/valentin.epub!/mimetype"/>
						<d:file href="result/EPUB/C00000-1-cover.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/package.opf" media-type="application/oebps-package+xml" indent="true"/>
						<d:file href="result/EPUB/nav.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/nav.ncx" media-type="application/x-dtbncx+xml"
						        original-href="../resources/valentin.epub!/EPUB/nav.ncx"/>
						<d:file href="result/EPUB/C00000-9-footnotes.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/C00000-5-chapter.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/C00000-6-rearnotes.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/C00000-7-chapter.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/C00000-8-conclusion.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/C00000-4-chapter.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/C00000-2-frontmatter.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/C00000-3-chapter.xhtml" media-type="application/xhtml+xml"/>
						<d:file href="result/EPUB/css/accessibility.css" media-type="text/css"
						        original-href="../resources/valentin.epub!/EPUB/css/accessibility.css"/>
						<d:file href="result/EPUB/css/fonts/opendyslexic/LICENSE.txt" media-type="text/plain"
						        original-href="../resources/valentin.epub!/EPUB/css/fonts/opendyslexic/LICENSE.txt"/>
						<d:file href="result/EPUB/css/fonts/opendyslexic/OpenDyslexic-Bold.otf" media-type="application/x-font-opentype"
						        original-href="../resources/valentin.epub!/EPUB/css/fonts/opendyslexic/OpenDyslexic-Bold.otf"/>
						<d:file href="result/EPUB/css/fonts/opendyslexic/OpenDyslexic-BoldItalic.otf" media-type="application/x-font-opentype"
						        original-href="../resources/valentin.epub!/EPUB/css/fonts/opendyslexic/OpenDyslexic-BoldItalic.otf"/>
						<d:file href="result/EPUB/css/fonts/opendyslexic/OpenDyslexic-Italic.otf" media-type="application/x-font-opentype"
						        original-href="../resources/valentin.epub!/EPUB/css/fonts/opendyslexic/OpenDyslexic-Italic.otf"/>
						<d:file href="result/EPUB/css/fonts/opendyslexic/OpenDyslexic-Regular.otf" media-type="application/x-font-opentype"
						        original-href="../resources/valentin.epub!/EPUB/css/fonts/opendyslexic/OpenDyslexic-Regular.otf"/>
						<d:file href="result/EPUB/css/fonts/opendyslexic/OpenDyslexicMono-Regular.otf" media-type="application/x-font-opentype"
						        original-href="../resources/valentin.epub!/EPUB/css/fonts/opendyslexic/OpenDyslexicMono-Regular.otf"/>
						<d:file href="result/EPUB/images/valentin.jpg" media-type="image/jpeg"
						        original-href="../resources/valentin.epub!/EPUB/images/valentin.jpg"/>
						<d:file href="result/META-INF/container.xml" media-type="application/xml"
						        original-href="../resources/valentin.epub!/META-INF/container.xml"/>
						<d:file href="result/EPUB/mo/C00000-1-cover.smil" media-type="application/smil+xml"/>
						<d:file href="result/EPUB/mo/C00000-9-footnotes.smil" media-type="application/smil+xml"/>
						<d:file href="result/EPUB/mo/C00000-5-chapter.smil" media-type="application/smil+xml"/>
						<d:file href="result/EPUB/mo/C00000-6-rearnotes.smil" media-type="application/smil+xml"/>
						<d:file href="result/EPUB/mo/C00000-7-chapter.smil" media-type="application/smil+xml"/>
						<d:file href="result/EPUB/mo/C00000-8-conclusion.smil" media-type="application/smil+xml"/>
						<d:file href="result/EPUB/mo/C00000-4-chapter.smil" media-type="application/smil+xml"/>
						<d:file href="result/EPUB/mo/C00000-2-frontmatter.smil" media-type="application/smil+xml"/>
						<d:file href="result/EPUB/mo/C00000-3-chapter.smil" media-type="application/smil+xml"/>
						<d:file href="result/EPUB/audio/mock.mp3" media-type="audio/mpeg"
						        original-href="../../../target/generated-test-resources/mock.mp3"/>
					</d:fileset>
				</x:document>
			</x:expect>
			<x:context label="the C00000-1-cover.xhtml document">
				<x:document type="port" port="epub.out.in-memory"
				            select="/*[base-uri()=resolve-uri('result/EPUB/C00000-1-cover.xhtml')]/html:body"/>
			</x:context>
			<x:expect label="the C00000-1-cover.xhtml document" type="compare">
				<x:document type="inline">
					<body xmlns="http://www.w3.org/1999/xhtml"
					      id="level1_1" epub:type="cover">
						<section id="prodnote_1" class="render-optional rearcover">
							<p>
								<span id="st1-1">Gro fÃ¶rsÃ¶ker att fÃ¥ Runa pÃ¥ gott humÃ¶r igen.</span></p>
							<p>
								<span id="st1-2">â€“ Vi har det bara sÃ¥ lÃ¥ngtrÃ¥kigt.</span>
								<span id="st1-3">
									<span id="i1st1-3-no-skippable">Du har tur.</span>
									<a epub:type="noteref" class="noteref" id="dtb155111">90</a>
									<span id="i1st1-3-dtb155111"> Du fÃ¥r gÃ¥ ut och in i tornet.</span></span>
								<span id="st1-4">Alvilda och jag mÃ¥ste sitta hÃ¤r dag ut och dag in.</span>
								<span id="st1-5">Bara om natten fÃ¥r vi komma till kvinnosalen.</span>
								<span id="st1-6">Om det bara snart ville kommma nÃ¥gon som kan slÃ¥ ihjÃ¤l ormen.</span></p>
							<p>
								<span id="st1-7">Gro suckar djupt.</span>
								<span id="st1-8">Liksom Alvilda Ã¤r hon trÃ¶tt pÃ¥ att vara inspÃ¤rrad.</span></p>
							<p>
								<span id="st1-9">Alvilda tittar ner pÃ¥ sina brÃ¶der igen.</span></p>
							<p>
								<span id="st1-10">â€“ Jag vill hellre lÃ¤ra mig att slÃ¥ss, mumlar hon.</span>
								<span id="st1-11">DÃ¥ skulle jag sjÃ¤lv kunna slÃ¥ ihjÃ¤l odjuret.</span></p>
							<p>
								<span id="st1-12">â€“ Jag hÃ¶rde nog vad du sa.</span>
								<span id="st1-13">Runa ruskar pÃ¥ huvudet.</span>
								<span id="st1-14">Du vet inte vad som Ã¤r bÃ¤st fÃ¶r dig.</span>
								<span id="st1-15">TÃ¤nk pÃ¥ allt det besvÃ¤r din pappa och mamma har haft.</span>
								<span id="st1-16">FÃ¶rst byggde de det hÃ¤r tornet av koppar.</span>
								<span id="st1-17">Sedan har de skaffat en orm, som kan vakta din dygd.</span>
								<span id="st1-18">MÃ¥nga unga mÃ¤n har mist sina liv fÃ¶r din skull.</span></p>
						</section>
					</body>
				</x:document>
			</x:expect>
			<x:context label="the C00000-1-cover.smil document">
				<x:document type="port" port="epub.out.in-memory"
				            select="/*[base-uri()=resolve-uri('result/EPUB/mo/C00000-1-cover.smil')]"/>
			</x:context>
			<x:expect label="the C00000-1-cover.smil document" type="compare">
				<x:document type="inline">
					<smil xmlns="http://www.w3.org/ns/SMIL" version="3.0">
						<body epub:textref="../C00000-1-cover.xhtml#level1_1" epub:type="cover">
							<seq epub:textref="../C00000-1-cover.xhtml#prodnote_1">
								<par>
									<text src="../C00000-1-cover.xhtml#st1-1"/>
									<audio src="../audio/mock.mp3" clipBegin="0:00:00.000" clipEnd="0:00:01.223"/>
								</par>
								<par>
									<text src="../C00000-1-cover.xhtml#st1-2"/>
									<audio src="../audio/mock.mp3" clipBegin="0:00:01.223" clipEnd="0:00:02.446"/>
								</par>
								<seq epub:textref="../C00000-1-cover.xhtml#st1-3">
								    <par>
								        <text src="../C00000-1-cover.xhtml#i1st1-3-no-skippable"/>
								        <audio src="../audio/mock.mp3" clipBegin="0:00:02.446" clipEnd="0:00:03.669"/>
									</par>
								    <par epub:type="noteref">
								        <text src="../C00000-1-cover.xhtml#dtb155111"/>
								        <audio src="../audio/mock.mp3" clipBegin="0:00:04.892" clipEnd="0:00:06.115"/>
									</par>
								    <par>
								        <text src="../C00000-1-cover.xhtml#i1st1-3-dtb155111"/>
								        <audio src="../audio/mock.mp3" clipBegin="0:00:03.669" clipEnd="0:00:04.892"/>
									</par>
								</seq>
								<par>
								    <text src="../C00000-1-cover.xhtml#st1-4"/>
								    <audio src="../audio/mock.mp3" clipBegin="0:00:06.115" clipEnd="0:00:07.338"/>
								</par>
								<par>
								    <text src="../C00000-1-cover.xhtml#st1-5"/>
								    <audio src="../audio/mock.mp3" clipBegin="0:00:07.338" clipEnd="0:00:08.561"/>
								</par>
								<par>
								    <text src="../C00000-1-cover.xhtml#st1-6"/>
								    <audio src="../audio/mock.mp3" clipBegin="0:00:08.561" clipEnd="0:00:09.784"/>
								</par>
								<par>
								    <text src="../C00000-1-cover.xhtml#st1-7"/>
								    <audio src="../audio/mock.mp3" clipBegin="0:00:09.784" clipEnd="0:00:11.007"/>
								</par>
								<par>
									<text src="../C00000-1-cover.xhtml#st1-8"/>
									<audio src="../audio/mock.mp3" clipBegin="0:00:11.007" clipEnd="0:00:12.230"/>
								</par>
								<par>
									<text src="../C00000-1-cover.xhtml#st1-9"/>
									<audio src="../audio/mock.mp3" clipBegin="0:00:12.230" clipEnd="0:00:13.453"/>
								</par>
								<par>
									<text src="../C00000-1-cover.xhtml#st1-10"/>
									<audio src="../audio/mock.mp3" clipBegin="0:00:13.453" clipEnd="0:00:14.677"/>
								</par>
								<par>
									<text src="../C00000-1-cover.xhtml#st1-11"/>
									<audio src="../audio/mock.mp3" clipBegin="0:00:14.677" clipEnd="0:00:15.900"/>
								</par>
								<par>
									<text src="../C00000-1-cover.xhtml#st1-12"/>
									<audio src="../audio/mock.mp3" clipBegin="0:00:15.900" clipEnd="0:00:17.123"/>
								</par>
								<par>
									<text src="../C00000-1-cover.xhtml#st1-13"/>
									<audio src="../audio/mock.mp3" clipBegin="0:00:17.123" clipEnd="0:00:18.346"/>
								</par>
								<par>
									<text src="../C00000-1-cover.xhtml#st1-14"/>
									<audio src="../audio/mock.mp3" clipBegin="0:00:18.346" clipEnd="0:00:19.569"/>
								</par>
								<par>
									<text src="../C00000-1-cover.xhtml#st1-15"/>
									<audio src="../audio/mock.mp3" clipBegin="0:00:19.569" clipEnd="0:00:20.792"/>
								</par>
								<par>
									<text src="../C00000-1-cover.xhtml#st1-16"/>
									<audio src="../audio/mock.mp3" clipBegin="0:00:20.792" clipEnd="0:00:22.015"/>
								</par>
								<par>
									<text src="../C00000-1-cover.xhtml#st1-17"/>
									<audio src="../audio/mock.mp3" clipBegin="0:00:22.015" clipEnd="0:00:23.238"/>
								</par>
								<par>
									<text src="../C00000-1-cover.xhtml#st1-18"/>
									<audio src="../audio/mock.mp3" clipBegin="0:00:23.238" clipEnd="0:00:24.461"/>
								</par>
							</seq>
						</body>
					</smil>
				</x:document>
			</x:expect>
			<!-- <x:context label="the tts log"> -->
			<!-- 	<x:document type="port" port="tts-log"/> -->
			<!-- </x:context> -->
			<!-- <x:expect label="uncomment to see the tts log in the xprocspec report" type="compare"/> -->
		</x:scenario>
	</x:scenario>
	
</x:description>
