<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns:x="http://www.daisy.org/ns/xprocspec"
               xmlns:louis="http://liblouis.org/liblouis"
               script="../../main/resources/xml/format.xpl">

  <!-- ======= -->
  <!-- test_01 -->
  <!-- ======= -->
  <!--
      - Page dimensions can be changed within the document.
      - When page dimensions change, a new section is started.
      - Page dimensions are inherited from parent elements.
  -->
  <x:scenario label="test_01">
    <x:call step="louis:format">
      <x:input port="source">
        <x:document type="inline">
          <doc>
            <body style="@page { size: 15 5 }">
              <frontmatter style="@page { size: 30 5 }">
                ⠤⠤⠤
              </frontmatter>
              <bodymatter>
                ⠤⠤⠤
              </bodymatter>
              <rearmatter style="@page { size: 30 5 }">
                ⠤⠤⠤
              </rearmatter>
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="temp-dir" select="$temp-dir"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="30" rowgap="0" duplex="false">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                </page>
              </section>
              <section cols="15">
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <!-- ======= -->
  <!-- test_02 -->
  <!-- ======= -->
  <!--
      - The print page number can be placed in the bottom right corner.
      - The running header can be placed at the top.
      - The running footer can be placed at the bottom.
      - The print page number and the running header/footer can be updated.
        => FIXME: running-footer is updated 1 page too soon
  -->
  <x:scenario label="test_02" pending="failure">
    <x:call step="louis:format">
      <x:input port="source">
        <x:document type="inline">
          <doc>
            <body style="@page {
                         size: 20 5;
                         @top-center { content: string(running-header) }
                         @bottom-right { content: string(print-page) }
                         @bottom-center { content: string(running-footer) }}">
              <section style="display: block;">
                ⠤⠤⠤
              </section>
              <section style="display: block;
                              page-break-before: always;
                              string-set: print-page '⠤'">
                ⠤⠤⠤
              </section>
              <section style="display: block;
                              page-break-before: always;
                              string-set: print-page '⠤⠤', running-footer '⠤⠤'">
                ⠤⠤⠤
              </section>
              <section style="display: block;
                              page-break-before: always;
                              string-set: print-page '', running-header '⠤⠤'">
                ⠤⠤⠤
              </section>
              <section style="display: block;
                              page-break-before: always;
                              string-set: print-page '⠤⠤⠤', running-footer ''">
                ⠤⠤⠤
              </section>
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="temp-dir" select="$temp-dir"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="20" rowgap="0" duplex="false">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤⠀⠀⠀⠀⠀⠀⠀⠀⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤⠀⠀⠀⠀⠀⠀⠀⠤⠤</row>
                </page>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <!-- ======= -->
  <!-- test_03 -->
  <!-- ======= -->
  <!--
      - The placement of the running header and print page number can be changed within the document.
      - When the page layout changes, a new section is started.
  -->
  <x:scenario label="test_03">
    <x:call step="louis:format">
      <x:input port="source">
        <x:document type="inline">
          <doc>
            <body style="@page { size: 20 5; }">
              <section style="display: block;
                              string-set: print-page '⠤', running-footer '⠤⠤'">
                ⠤⠤⠤
              </section>
              <section style="@page {
                              size: 20 5;
                              @bottom-center { content: string(running-footer) }
                              @bottom-right { content: string(print-page) }}">
                ⠤⠤⠤
              </section>
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="temp-dir" select="$temp-dir"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="20" rowgap="0" duplex="false">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤⠀⠀⠀⠀⠀⠀⠀⠀⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <!-- ======= -->
  <!-- test_04 -->
  <!-- ======= -->
  <!--
      - The braille page number can be placed in the bottom right corner.
      - The braille page number is augmented with each page break.
      - The braille page number can be reset.
      - The rendering of braille page numbers can be disabled, but the number will still be
        augmented with each page break.
  -->
  <x:scenario label="test_04">
    <x:call step="louis:format">
      <x:input port="source">
        <x:document type="inline">
          <doc>
            <body style="@page {
                         size: 15 5;
                         @bottom-right { content: counter(braille-page) }}">
              <section style="display: block;">
                ⠤⠤⠤
              </section>
              <section style="@page { size: 15 5 }">
                ⠤⠤⠤
              </section>
              <section style="display: block;
                              page-break-before: always">
                ⠤⠤⠤
              </section>
              <section style="display: block;
                              page-break-before: always;
                              counter-reset: braille-page 10">
                ⠤⠤⠤
              </section>
              <section style="display: block;
                              page-break-before: always">
                ⠤⠤⠤
              </section>
              <section style="@page {
                              size: 15 5;
                              @top-right { content: counter(braille-page) }}">
                ⠤⠤⠤
              </section>
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="temp-dir" select="$temp-dir"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="false">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠉</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁⠚</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁⠁</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁⠃</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <!-- ======= -->
  <!-- test_05 -->
  <!-- ======= -->
  <!--
      - The braille page number can be given different styles.
      - The default page number style is 'decimal'.
      - The page number style can be changed within the document.
  -->
  <x:scenario label="test_05">
    <x:call step="louis:format">
      <x:input port="source">
        <x:document type="inline">
          <doc>
            <body style="@page {
                         size: 15 5;
                         @bottom-right { content: counter(braille-page) }}">
              <frontmatter style="@page {
                                  size: 15 5;
                                  @bottom-right { content: counter(braille-page, prefix-p) }}">
                ⠤⠤⠤
              </frontmatter>
              <bodymatter>
                ⠤⠤⠤
              </bodymatter>
              <rearmatter style="counter-reset: braille-page 1
                                 @page {
                                 size: 15 5;
                                 @bottom-right { content: counter(braille-page, lower-roman) }}">
                ⠤⠤⠤
              </rearmatter>
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="temp-dir" select="$temp-dir"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="false">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠏⠼⠁</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠃</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠊</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <!-- ======= -->
  <!-- test_06 -->
  <!-- ======= -->
  <!--
      - The print page number and braille page number can be placed next to each other in the bottom
        right corner.
  -->
  <x:scenario label="test_06">
    <x:call step="louis:format">
      <x:input port="source">
        <x:document type="inline">
          <doc>
            <body style="@page {
                         size: 15 5;
                         @bottom-right { content: string(print-page) ' ' counter(braille-page) }}">
              <section style="string-set: print-page '⠤⠤'">
                ⠤⠤⠤
              </section>
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="temp-dir" select="$temp-dir"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="false">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤⠀⠼⠁</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <!-- ======= -->
  <!-- test_07 -->
  <!-- ======= -->
  <!--
      - A separator line can be inserted when a page break occurs in print.
      - The new print page number is placed at the end of the separator line.
      - The separator line is omitted when no text preceeds or follows on the same braille page.
  -->
  <x:scenario label="test_07" pending="broken since ???">
    <x:call step="louis:format">
      <x:input port="source">
        <x:document type="inline">
          <doc>
            <body style="@page {
                         size: 15 5;
                         @top-right { content: string(print-page) }}">
              <section style="display: block">
                ⠤⠤⠤
                <pagenum style="display: -louis-page-break;
                                string-set: print-page '⠸⠤'"/>
                ⠤⠤⠤
              </section>
              <section style="display: block;
                              page-break-before: always;">
                <pagenum style="display: -louis-page-break;
                                string-set: print-page '⠸⠤⠤'"/>
                ⠤⠤⠤
                <pagenum style="display: -louis-page-break;
                                string-set: print-page '⠸⠤⠤⠤'"/>
                ⠤⠤⠤
              </section>
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="temp-dir" select="$temp-dir"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="false">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠸⠤</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                </page>
                <page>
                  <row>⠤⠤⠤⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠸⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <!-- ======= -->
  <!-- test_08 -->
  <!-- ======= -->
  <!--
      - A block can be kept together on the same page.
      - The first lines of a block can be kept together on the same page (orphan control).
      - A page break can be forced.
  -->
  <x:scenario label="test_08">
    <x:call step="louis:format">
      <x:input port="source">
        <x:document type="inline">
          <doc>
            <body style="@page { size: 10 6; }">
              <section style="display: block;
                              page-break-before: always">
                <p style="display: block;">⠤⠤⠤</p>
                <p style="display: block;">⠤⠤⠤</p>
                <p style="display: block;">⠤⠤⠤</p>
                <p style="display: block;">⠤⠤⠤</p>
                <section>
                  <p style="display: block;">⠤⠤⠤</p>
                  <p style="display: block;">⠤⠤⠤</p>
                  <p style="display: block;">⠤⠤⠤</p>
                  <p style="display: block;">⠤⠤⠤</p>
                </section>
              </section>
              <section style="display: block;
                              page-break-before: always">
                <p style="display: block;">⠤⠤⠤</p>
                <p style="display: block;">⠤⠤⠤</p>
                <p style="display: block;">⠤⠤⠤</p>
                <p style="display: block;">⠤⠤⠤</p>
                <section style="display: block;
                                page-break-inside: avoid;">
                  <p style="display: block;">⠤⠤⠤</p>
                  <p style="display: block;">⠤⠤⠤</p>
                  <p style="display: block;">⠤⠤⠤</p>
                  <p style="display: block;">⠤⠤⠤</p>
                </section>
              </section>
              <section style="display: block;
                              page-break-before: always">
                <p style="display: block;">⠤⠤⠤</p>
                <p style="display: block;">⠤⠤⠤</p>
                <p style="display: block;">⠤⠤⠤</p>
                <p style="display: block;">⠤⠤⠤</p>
                <section style="display: block;
                                orphans: 3;">
                  <p style="display: block;">⠤⠤⠤</p>
                  <p style="display: block;">⠤⠤⠤</p>
                  <p style="display: block;">⠤⠤⠤</p>
                  <p style="display: block;">⠤⠤⠤</p>
                </section>
              </section>
              <section style="display: block;
                              page-break-before: always">
                <p style="display: block;">⠤⠤⠤</p>
                <p style="display: block;">⠤⠤⠤</p>
                <p style="display: block;">⠤⠤⠤</p>
                <p style="display: block;">⠤⠤⠤</p>
                <section style="display: block;
                                page-break-after: avoid;">
                  <p style="display: block;">⠤⠤⠤</p>
                  <p style="display: block;">⠤⠤⠤</p>
                </section>
                <p style="display: block;">⠤⠤⠤</p>
              </section>
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="temp-dir" select="$temp-dir"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="6" cols="10" rowgap="0" duplex="false">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <!-- ======= -->
  <!-- test_09 -->
  <!-- ======= -->
  <!--
      - A block can have borders.
      - Boxes can be nested.
  -->
  <!--
      FIXME: paddings should not collapse with margins
  -->
  <x:scenario label="test_09" pending="broken since 8d75a10">
    <x:call step="louis:format">
      <x:input port="source">
        <x:document type="inline">
          <doc>
            <body style="@page { size: 20 15; }">
              <div style="display: block;
                          text-align: center;
                          margin-left: 1;
                          margin-right: 1;
                          margin-top: 1;
                          margin-bottom: 1;
                          padding-left: 1;
                          padding-right: 1;
                          padding-top: 1;
                          padding-bottom: 1;
                          border-left: ⠇;
                          border-right: ⠸;
                          border-top: ⠤;
                          border-bottom: ⠉">
                ⠿⠿⠿⠿
              </div>
              <div style="display: block;
                          text-align: center;
                          margin-left: 1;
                          margin-right: 1;
                          margin-top: 1;
                          margin-bottom: 1;
                          padding-left: 1;
                          padding-right: 1;
                          padding-top: 1;
                          padding-bottom: 1;
                          border-left: ⠇;
                          border-right: ⠸;
                          border-top: ⠤;
                          border-bottom: ⠉">
                <div style="display: block;
                            margin-left: 1;
                            margin-right: 1;
                            margin-top: 1;
                            margin-bottom: 1;
                            padding-left: 1;
                            padding-right: 1;
                            padding-top: 1;
                            padding-bottom: 1;
                            border-left: ⠇;
                            border-right: ⠸;
                            border-top: ⠤;
                            border-bottom: ⠉">
                  ⠿⠿⠿⠿
                </div>
              </div>
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="temp-dir" select="$temp-dir"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="15" cols="20" rowgap="0" duplex="false">
              <section>
                <page>
                  <row>⠀⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠀⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸</row>
                  <row>⠀⠇⠀⠀⠀⠀⠀⠀⠿⠿⠿⠿⠀⠀⠀⠀⠀⠀⠸</row>
                  <row>⠀⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸</row>
                  <row>⠀⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉</row>
                  <row/>
                  <row>⠀⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠀⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸</row>
                  <row>⠀⠇⠀⠀⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠀⠀⠸</row>
                  <row>⠀⠇⠀⠀⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⠀⠀⠸</row>
                  <row>⠀⠇⠀⠀⠇⠀⠀⠀⠿⠿⠿⠿⠀⠀⠀⠸⠀⠀⠸</row>
                  <row>⠀⠇⠀⠀⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⠀⠀⠸</row>
                  <row>⠀⠇⠀⠀⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠀⠀⠸</row>
                  <row>⠀⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸</row>
                  <row>⠀⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <!-- ======= -->
  <!-- test_10 -->
  <!-- ======= -->
  <!--
      - Content can be inserted before or after items with CSS.
  -->
  <x:scenario label="test_10">
    <x:call step="louis:format">
      <x:input port="source">
        <x:document type="inline">
          <doc>
            <body style="@page { size: 30 2; }">
              <table>
                <tr style="display: block">
                  <td style="&amp;::after { content: '⠆' } ">⠤⠤⠤</td>
                  <td style="&amp;::after { content: '⠆' } ">⠤⠤⠤</td>
                  <td style="&amp;::after { content: '⠆' } ">⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                </tr>
              </table>
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="temp-dir" select="$temp-dir"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="2" cols="30" rowgap="0" duplex="false">
              <section>
                <page>
                  <row>⠤⠤⠤⠆⠀⠤⠤⠤⠆⠀⠤⠤⠤⠆⠀⠤⠤⠤</row>
                  <row/>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <!-- ======= -->
  <!-- test_11 -->
  <!-- ======= -->
  <!--
      - A table of content can be created from a list of references.
      - If braille page numbering is enabled, a TOC entry can show the braille page number of the
        target.
  -->
  <x:scenario label="test_11">
    <x:call step="louis:format">
      <x:input port="source">
        <x:document type="inline">
          <doc>
            <body style="@page { size: 14 8; @bottom-right { content: counter(braille-page) }}">
              <frontmatter>
                <toc>
                  <h style="display:block;
                            text-align: center;
                            margin-bottom: 1;">
                    ⠤⠤⠤
                  </h>
                  <entry ref="chapter_1" style="display: block;
                                                content: target-text(attr(ref))
                                                         leader('⠄')
                                                         target-counter(attr(ref), braille-page)"/>
                  <entry ref="chapter_2" style="display: block;
                                                content: target-text(attr(ref))
                                                         leader('⠄')
                                                         target-counter(attr(ref), braille-page)"/>
                  <entry ref="chapter_3" style="display: block;
                                                content: target-text(attr(ref))
                                                         leader('⠄')
                                                         target-counter(attr(ref), braille-page)"/>
                  <entry ref="chapter_4" style="display: block;
                                                content: target-text(attr(ref))
                                                         leader('⠄')
                                                         target-counter(attr(ref), braille-page)"/>
                </toc>
              </frontmatter>
              <bodymatter style="display: block;
                                 page-break-before: always">
                <h xml:id="chapter_1" style="display:block;
                                             text-align: center;
                                             margin-top: 1;
                                             page-break-after: avoid">
                  ⠿
                </h>
                <p style="display: block;">⠤⠤⠤</p>
                <h xml:id="chapter_2" style="display:block;
                                             text-align: center;
                                             margin-top: 1;
                                             page-break-after: avoid">
                  ⠿⠿
                </h>
                <p style="display: block;">⠤⠤⠤</p>
                <h xml:id="chapter_3" style="display:block;
                                             text-align: center;
                                             margin-top: 1;
                                             page-break-after: avoid">
                  ⠿⠿⠿
                </h>
                <p style="display: block;">⠤⠤⠤</p>
                <h xml:id="chapter_4" style="display:block;
                                             text-align: center;
                                             margin-top: 1;
                                             page-break-after: avoid">
                  ⠿⠿⠿⠿
                </h>
                <p style="display: block;">⠤⠤⠤</p>
              </bodymatter>
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="temp-dir" select="$temp-dir"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="8" cols="14" rowgap="0" duplex="false">
              <section>
                <page>
                  <row>⠀⠀⠀⠀⠀⠤⠤⠤</row>
                  <row/>
                  <row>⠿⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠃</row>
                  <row>⠿⠿⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠃</row>
                  <row>⠿⠿⠿⠀⠄⠄⠄⠄⠄⠄⠄⠀⠼⠃</row>
                  <row>⠿⠿⠿⠿⠀⠄⠄⠄⠄⠄⠄⠀⠼⠉</row>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠿</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠿⠿</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠿⠿⠿</row>
                  <row>⠤⠤⠤⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠃</row>
                </page>
                <page>
                  <row>⠀⠀⠀⠀⠀⠿⠿⠿⠿</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠉</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <!-- ======= -->
  <!-- test_12 -->
  <!-- ======= -->
  <!--
      - The entries in a TOC can be styled individually.
      - If print page numbering is enabled, a TOC entry can show the print page number of the target.
  -->
  <x:scenario label="test_12">
    <x:call step="louis:format">
      <x:input port="source">
        <x:document type="inline">
          <doc>
            <body style="@page {
                         size: 23 9;
                         @top-right {
                         content: string(print-page) }
                         @bottom-right {
                         content: counter(braille-page) }}">
              <frontmatter>
                <pagenum style="string-set: print-page '⠤';
                                display: none"/>
                <toc style="display:block;
                            margin-right: 2;">
                  <entry ref="chapter_1" style="display: block;
                                                margin-left: 4;
                                                text-indent: -4;
                                                content: target-text(attr(ref))
                                                         leader('⠄')
                                                         target-string(attr(ref), print-page)
                                                         target-counter(attr(ref), braille-page)"/>
                  <entry ref="chapter_1_1" style="display: block;
                                                  margin-left: 6;
                                                  text-indent: -4;
                                                  content: target-text(attr(ref))
                                                           leader('⠄')
                                                           target-string(attr(ref), print-page)
                                                           target-counter(attr(ref), braille-page)"/>
                  <entry ref="chapter_1_2" style="display: block;
                                                  margin-left: 6;
                                                  text-indent: -4;
                                                  content: target-text(attr(ref))
                                                           leader('⠄')
                                                           target-string(attr(ref), print-page)
                                                           target-counter(attr(ref), braille-page)"/>
                  <entry ref="chapter_2" style="display: block;
                                                margin-left: 4;
                                                text-indent: -4;
                                                content: target-text(attr(ref))
                                                         leader('⠄')
                                                         target-string(attr(ref), print-page)
                                                         target-counter(attr(ref), braille-page)"/>
                </toc>
              </frontmatter>
              <bodymatter style="display: block;
                                 page-break-before: always">
                <section>
                  <pagenum style="string-set: print-page '⠤⠤';
                                  display: none"/>
                  <h xml:id="chapter_1" style="display:block;
                                               margin-top: 1">
                    ⠿⠿⠿⠿ ⠿⠿⠿⠿ ⠿⠿⠿⠿ ⠿⠿⠿⠿
                  </h>
                  <p style="display: block">⠤⠤⠤</p>
                  <section>
                    <h xml:id="chapter_1_1" style="display:block;
                                                   margin-top: 1">
                      ⠿⠿⠿⠿ ⠿⠿⠿⠿
                    </h>
                    <p style="display: block">⠤⠤⠤</p>
                  </section>
                  <section>
                    <h xml:id="chapter_1_2" style="display:block;
                                                   margin-top: 1">
                      ⠿⠿⠿⠿ ⠿⠿⠿⠿ ⠿⠿⠿⠿
                    </h>
                    <p style="display: block">⠤⠤⠤</p>
                  </section>
                </section>
                <section>
                  <pagenum style="string-set: print-page '⠤⠤⠤';
                                  display: none"/>
                  <h xml:id="chapter_2" style="display:block;
                                               margin-top: 1">
                    ⠿⠿⠿⠿ ⠿⠿⠿⠿
                  </h>
                  <p style="display: block">⠤⠤⠤</p>
                </section>
              </bodymatter>
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="temp-dir" select="$temp-dir"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="9" cols="23" rowgap="0" duplex="false">
              <section>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤</row>
                  <row>⠿⠿⠿⠿⠀⠿⠿⠿⠿⠀⠿⠿⠿⠿</row>
                  <row>⠀⠀⠀⠀⠿⠿⠿⠿⠀⠄⠄⠄⠄⠄⠄⠀⠤⠤⠀⠼⠃</row>
                  <row>⠀⠀⠿⠿⠿⠿⠀⠿⠿⠿⠿⠀⠄⠄⠄⠀⠤⠤⠀⠼⠃</row>
                  <row>⠀⠀⠿⠿⠿⠿⠀⠿⠿⠿⠿</row>
                  <row>⠀⠀⠀⠀⠀⠀⠿⠿⠿⠿⠀⠄⠄⠄⠄⠀⠤⠤⠀⠼⠃</row>
                  <row>⠿⠿⠿⠿⠀⠿⠿⠿⠿⠀⠄⠄⠄⠄⠀⠤⠤⠤⠀⠼⠉</row>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠀⠿⠿⠿⠿⠀⠿⠿⠿⠿⠀⠀⠀⠀⠀⠀⠀⠤⠤</row>
                  <row>⠿⠿⠿⠿</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row>⠿⠿⠿⠿⠀⠿⠿⠿⠿</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row>⠿⠿⠿⠿⠀⠿⠿⠿⠿⠀⠿⠿⠿⠿</row>
                  <row>⠤⠤⠤⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠃</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠀⠿⠿⠿⠿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠉</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <!-- ======= -->
  <!-- test_13 -->
  <!-- ======= -->
  <!--
      - A table of content can reference items from multiple sections.
      - A TOC entry shows the print page number in the same style as on the target page.
  -->
  <x:scenario label="test_13">
    <x:call step="louis:format">
      <x:input port="source">
        <x:document type="inline">
          <doc>
            <body style="@page {
                         size: 15 8
                         @bottom-right {
                         content: counter(braille-page) }}">
              <frontmatter style="@page {
                                  size: 15 8
                                  @bottom-right {
                                  content: counter(braille-page, lower-roman) }}">
                <toc>
                  <entry ref="chapter_1" style="display: block;
                                                content: target-text(attr(ref))
                                                         leader('⠄')
                                                         target-counter(attr(ref), braille-page)"/>
                  <entry ref="chapter_2" style="display: block;
                                                content: target-text(attr(ref))
                                                         leader('⠄')
                                                         target-counter(attr(ref), braille-page)"/>
                  <entry ref="chapter_3" style="display: block;
                                                content: target-text(attr(ref))
                                                         leader('⠄')
                                                         target-counter(attr(ref), braille-page)"/>
                </toc>
                <h xml:id="chapter_1" style="display: block;
                                             margin-top: 1">
                  ⠿
                </h>
                <p style="display: block">⠤⠤⠤</p>
              </frontmatter>
              <bodymatter style="display: block;
                                 page-break-before: always;
                                 counter-reset: braille-page 1">
                <h xml:id="chapter_2" style="display:block;
                                             margin-top: 1">
                  ⠿⠿
                </h>
                <p style="display: block">⠤⠤⠤</p>
                <h xml:id="chapter_3" style="display:block;
                                             margin-top: 1">
                  ⠿⠿⠿
                </h>
                <p style="display: block">⠤⠤⠤</p>
              </bodymatter>
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="temp-dir" select="$temp-dir"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="8" cols="15" rowgap="0" duplex="false">
              <section>
                <page>
                  <row>⠿⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠊</row>
                  <row>⠿⠿⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠁</row>
                  <row>⠿⠿⠿⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠁</row>
                  <row/>
                  <row>⠿</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠊</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠿⠿</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row>⠿⠿⠿</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <!-- ======= -->
  <!-- test_14 -->
  <!-- ======= -->
  <!--
      - Multiple TOCs/indexes can exist in the same document.
      - An TOC/index can reference items that occured before the TOC/index.
  -->
  <x:scenario label="test_14">
    <x:call step="louis:format">
      <x:input port="source">
        <x:document type="inline">
          <doc>
            <body style="@page {
                         size: 15 5
                         @bottom-right {
                         content: counter(braille-page) }}">
              <frontmatter>
                <toc>
                  <entry ref="chapter_1" style="display: block;
                                                content: target-text(attr(ref))
                                                         leader('⠄')
                                                         target-counter(attr(ref), braille-page)"/>
                  <entry ref="chapter_2" style="display: block;
                                                content: target-text(attr(ref))
                                                         leader('⠄')
                                                         target-counter(attr(ref), braille-page)"/>
                </toc>
              </frontmatter>
              <bodymatter style="display: block;
                                 page-break-before: always">
                <h xml:id="chapter_1" style="display:block;
                                             margin-top: 1">
                  ⠿
                </h>
                <p style="display: block" xml:id="x" >⠤⠤⠤</p>
                <h xml:id="chapter_2" style="display:block;
                                             margin-top: 1">
                  ⠿⠿
                </h>
                <p style="display: block" xml:id="y" >⠤⠤⠤</p>
                <p style="display: block" xml:id="z" >⠤⠤⠤</p>
              </bodymatter>
              <rearmatter style="display: block;
                                 page-break-before: always">
                <index>
                  <entry ref="x" style="display: block;
                                        content: target-text(attr(ref))
                                                 leader('⠄')
                                                 target-counter(attr(ref), braille-page)"/>
                  <entry ref="y" style="display: block;
                                        content: target-text(attr(ref))
                                                 leader('⠄')
                                                 target-counter(attr(ref), braille-page)"/>
                  <entry ref="z" style="display: block;
                                        content: target-text(attr(ref))
                                                 leader('⠄')
                                                 target-counter(attr(ref), braille-page)"/>
                </index>
              </rearmatter>
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="temp-dir" select="$temp-dir"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
    <head xmlns:dc="http://purl.org/dc/elements/1.1/">
        <meta>
            <dc:format>application/x-pef+xml</dc:format>
        </meta>
    </head>
    <body>
        <volume rows="5" cols="15" rowgap="0" duplex="false">
            <section>
                <page>
                    <row>⠿⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠃</row>
                    <row>⠿⠿⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠃</row>
                    <row/>
                    <row/>
                    <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
                <page>
                    <row>⠿</row>
                    <row>⠤⠤⠤</row>
                    <row/>
                    <row>⠿⠿</row>
                    <row>⠤⠤⠤⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠃</row>
                </page>
                <page>
                    <row>⠤⠤⠤</row>
                    <row/>
                    <row/>
                    <row/>
                    <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠉</row>
                </page>
                <page>
                    <row>⠤⠤⠤⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠃</row>
                    <row>⠤⠤⠤⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠃</row>
                    <row>⠤⠤⠤⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠉</row>
                    <row/>
                    <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠙</row>
                </page>
            </section>
        </volume>
    </body>
</pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <!-- ======= -->
  <!-- test_15 -->
  <!-- ======= -->
  <!--
      - FIXME: A TOC entry can not reference a boxed item.
  -->
  <x:scenario label="test_15" pending="failure">
    <x:call step="louis:format">
      <x:input port="source">
        <x:document type="inline">
          <doc>
            <body style="@page {
                         size: 15 7
                         @bottom-right {
                         content: counter(braille-page) }}">
              <frontmatter>
                <toc>
                  <entry ref="chapter_1" style="display: block;
                                                content: target-text(attr(ref))
                                                         leader('⠄')
                                                         target-counter(attr(ref), braille-page)"/>
                  <entry ref="chapter_2" style="display: block;
                                                content: target-text(attr(ref))
                                                         leader('⠄')
                                                         target-counter(attr(ref), braille-page)"/>
                </toc>
              </frontmatter>
              <bodymatter style="display: block;
                                 page-break-before: always">
                <h xml:id="chapter_1" style="display:block;
                                             text-align: center">
                  ⠿
                </h>
                <p style="display: block">⠤⠤⠤</p>
                <h xml:id="chapter_2" style="display:block;
                                             text-align: center;
                                             border-left: ⠇;
                                             border-right: ⠸;
                                             border-top: ⠤;
                                             border-bottom: ⠉">
                  ⠿⠿
                </h>
              </bodymatter>
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="temp-dir" select="$temp-dir"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="7" cols="15" rowgap="0" duplex="false">
              <section>
                <page>
                  <row>⠿⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠃</row>
                  <row>⠿⠿⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠃</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠿</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠇⠀⠀⠀⠀⠀⠿⠿⠀⠀⠀⠀⠀⠀⠸</row>
                  <row>⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉</row>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠃</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <!-- ======= -->
  <!-- test_16 -->
  <!-- ======= -->
  <!--

  -->
  <x:scenario label="test_16">
    <x:call step="louis:format">
      <x:input port="source">
        <x:document type="inline">
          <doc>
            <body style="@page {
                         size: 15 7
                         @bottom-right {
                         content: counter(braille-page) }
                         @bottom-center {
                         content: string(running-footer) }}">
              <frontmatter style="@page { size: 15 4 }">
                <toc>
                  <entry ref="chapter_1" style="display: block;
                                                content: target-text(attr(ref))
                                                         leader('⠄')
                                                         target-counter(attr(ref), braille-page)"/>
                  <entry ref="chapter_2" style="display: block;
                                                content: target-text(attr(ref))
                                                         leader('⠄')
                                                         target-counter(attr(ref), braille-page)"/>
                </toc>
              </frontmatter>
              <bodymatter style="display: block;
                                 string-set: running-footer '⠤⠤⠤⠤⠤'">
                <h xml:id="chapter_1" style="display: block">⠿</h>
                <p style="display: block">⠤⠤⠤</p>
                <h xml:id="chapter_2" style="display: block">⠿⠿</h>
                <p style="display: block">⠤⠤⠤</p>
              </bodymatter>
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="temp-dir" select="$temp-dir"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="7" cols="15" rowgap="0" duplex="false">
              <section rows="4">
                <page>
                  <row>⠿⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠁</row>
                  <row>⠿⠿⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠁</row>
                  <row/>
                  <row/>
                </page>
              </section>
              <section>
                <page>
                  <row>⠿</row>
                  <row>⠤⠤⠤</row>
                  <row>⠿⠿</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠤⠤⠤⠤⠤⠀⠀⠀⠼⠁</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <!-- ======= -->
  <!-- test_17 -->
  <!-- ======= -->
  <!--
      - By default, whitespace is normalized (trimmed and collapsed).
      - Whitespace can also be preserved.
  -->
  <x:scenario label="test_17" pending="failure on mac">
    <x:call step="louis:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="@page { size: 40 6 }">
            <body style="display: block;
                         margin-left: 2;
                         margin-right: 2">
              <div>
⠿⠿⠿
   ⠿⠿⠿
⠿⠿⠿   ⠿⠿⠿
   ⠿⠿⠿   ⠿⠿⠿
</div>
              <div xml:space="preserve">
⠿⠿⠿
   ⠿⠿⠿
⠿⠿⠿   ⠿⠿⠿
   ⠿⠿⠿   ⠿⠿⠿
</div>
              <div style="display: block;
                          page-break-before: always">
                ⠤⠤⠤
              </div>
              ⠤⠤⠤
              <div>
                ⠤⠤⠤
                <div style="display: block">
                  ⠤⠤⠤
                </div>
              </div>
              <div style="display: block;
                          page-break-before: always"
                   xml:space="preserve">
⠤⠤⠤</div>
  </body>
</doc>
        </x:document>
      </x:input>
      <x:option name="temp-dir" select="$temp-dir"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="6" cols="40" rowgap="0" duplex="false">
              <section>
                <page>
                  <row>⠀⠀⠿⠿⠿⠀⠿⠿⠿⠀⠿⠿⠿⠀⠿⠿⠿⠀⠿⠿⠿⠀⠿⠿⠿</row>
                  <row>⠀⠀⠿⠿⠿</row>
                  <row>⠀⠀⠀⠀⠀⠿⠿⠿</row>
                  <row>⠀⠀⠿⠿⠿⠀⠀⠀⠿⠿⠿</row>
                  <row>⠀⠀⠀⠀⠀⠿⠿⠿⠀⠀⠀⠿⠿⠿</row>
                  <row/>
                </page>
                <page>
                  <row>⠀⠀⠤⠤⠤</row>
                  <row>⠀⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠀⠀⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                </page>
                <page>
                  <row/>
                  <row>⠀⠀⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <!-- ======= -->
  <!-- test_18 -->
  <!-- ======= -->
  <!--
      - Hyphenation marks (SHY and ZWSP) are not visible in the output.
      - A SHY makes a word splittable and a hyphen is inserted when the word is split.
      - A ZWSP makes a word splittable but no hyphen is inserted when the word is split.
  -->
  <x:scenario label="test_18">
    <x:call step="louis:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="@page { size: 30 3 }">
            <section style="display: block;">
              ⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿
            </section>
            <section style="display: block;
                            page-break-before: always">
              ⠿⠿⠿⠿⠿&#xAD;⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿&#xAD;⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿&#xAD;⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿&#xAD;⠿⠿⠿⠿⠿
            </section>
            <section style="display: block;
                            page-break-before: always">
              ⠿⠿⠿⠿⠿&#x200B;⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿&#x200B;⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿&#x200B;⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿&#x200B;⠿⠿⠿⠿⠿
            </section>
          </doc>
        </x:document>
      </x:input>
      <x:option name="temp-dir" select="$temp-dir"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="3" cols="30" rowgap="0" duplex="false">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row/>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠤</row>
                  <row>⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row/>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row/>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <!-- ======= -->
  <!-- test_19 -->
  <!-- ======= -->
  <!--
      TOC entry referencing nothing.
  -->
  <x:scenario label="test_19">
    <x:call step="louis:format">
      <x:input port="source">
        <x:document type="inline">
          <doc>
            <body style="@page { size: 15 3 }">
              <frontmatter>
                <toc>
                  <entry ref="chapter_1" style="display: block;
                                                content: target-text(attr(ref))"/>
                  <entry ref="chapter_2" style="display: block;
                                                content: target-text(attr(ref))"/>
                </toc>
              </frontmatter>
              <bodymatter style="display: block; page-break-before: always">
                <h xml:id="chapter_1" style="display:block"> ⠿ </h>
              </bodymatter>
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="temp-dir" select="$temp-dir"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="3" cols="15" rowgap="0" duplex="false">
              <section>
                <page>
                  <row>⠿</row>
                  <row/>
                  <row/>
                </page>
                <page>
                  <row>⠿</row>
                  <row/>
                  <row/>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <!-- ======= -->
  <!-- test_20 -->
  <!-- ======= -->
  <!--
      TOC entry referencing an inline item.
  -->
  <x:scenario label="test_20">
    <x:call step="louis:format">
      <x:input port="source">
        <x:document type="inline">
          <doc>
            <body style="@page { size: 15 3 }">
              <frontmatter>
                <toc>
                  <entry ref="r1" style="display: block;
                                          content: target-text(attr(ref))"/>
                  <entry ref="r2" style="display: block;
                                          content: target-text(attr(ref))"/>
                </toc>
              </frontmatter>
              <bodymatter style="display: block; page-break-before: always">
                <p style="display: block" xml:id="r1">
                  ⠿⠿⠿
                </p>
                <p style="display: block">
                  ⠿⠿⠿ <span xml:id="r2">⠿</span> ⠿⠿⠿
                </p>
              </bodymatter>
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="temp-dir" select="$temp-dir"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="3" cols="15" rowgap="0" duplex="false">
              <section>
                <page>
                  <row>⠿⠿⠿</row>
                  <row>⠿</row>
                  <row/>
                </page>
                <page>
                  <row>⠿⠿⠿</row>
                  <row>⠿⠿⠿⠀⠿⠀⠿⠿⠿</row>
                  <row/>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <!-- ======= -->
  <!-- test_21 -->
  <!-- ======= -->
  <!--
      liblouisutdml bug (leftMargin + firstLineIndent < 0)
  -->
  <x:scenario label="test_21" pending="broken since 8d75a10">
    <x:call step="louis:format">
      <x:input port="source">
        <x:document type="inline">
          <doc>
            <body style="@page { size: 15 3 }">
              <div style="display: block;
                          margin-left: 1;
                          padding-left: 1;
                          text-indent: -2;
                          border-left: ⠇">
                ⠿⠿⠿⠿
              </div>
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="temp-dir" select="$temp-dir"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="3" cols="15" rowgap="0" duplex="false">
              <section>
                <page>
                  <row>⠀⠇⠿⠿⠿⠿</row>
                  <row/>
                  <row/>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <!-- ======= -->
  <!-- test_22 -->
  <!-- ======= -->
  <!--
      - Print page numbers and braille page numbers can be enabled or disabled in a TOC.
  -->
  <x:scenario label="test_22">
    <x:call step="louis:format">
      <x:input port="source">
        <x:document type="inline">
          <doc>
            <body style="@page {
                         size: 15 10
                         @bottom-right {
                         content: string(print-page) ' ' counter(braille-page) }}">
              <pagenum style="string-set: print-page '⠤';
                              display: none"/>
              <frontmatter>
                <toc>
                  <entry ref="chapter_1" style="display: block;
                                                content: target-text(attr(ref))"/>
                  <entry ref="chapter_2" style="display: block;
                                                content: target-text(attr(ref))
                                                         leader('⠄')
                                                         target-string(attr(ref), print-page)"/>
                  <entry ref="chapter_3" style="display: block;
                                                content: target-text(attr(ref))
                                                         leader('⠄')
                                                         target-counter(attr(ref), braille-page)"/>
                  <entry ref="chapter_4" style="display: block;
                                                content: target-text(attr(ref))
                                                         leader('⠄')
                                                         target-string(attr(ref), print-page)
                                                         target-counter(attr(ref), braille-page)"/>
                </toc>
              </frontmatter>
              <bodymatter style="display: block;
                                 margin-top: 1">
                <h xml:id="chapter_1" style="display:block">
                  ⠿
                </h>
                <h xml:id="chapter_2" style="display:block">
                  ⠿⠿
                </h>
                <h xml:id="chapter_3" style="display:block">
                  ⠿⠿⠿
                </h>
                <h xml:id="chapter_4" style="display:block">
                  ⠿⠿⠿⠿
                </h>
              </bodymatter>
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="temp-dir" select="$temp-dir"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="10" cols="15" rowgap="0" duplex="false">
              <section>
                <page>
                  <row>⠿</row>
                  <row>⠿⠿⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠤</row>
                  <row>⠿⠿⠿⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠁</row>
                  <row>⠿⠿⠿⠿⠀⠄⠄⠄⠄⠄⠀⠤⠀⠼⠁</row>
                  <row/>
                  <row>⠿</row>
                  <row>⠿⠿</row>
                  <row>⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠀⠼⠁</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <!-- ======= -->
  <!-- test_23 -->
  <!-- ======= -->
  <!--
      - The leader pattern in a TOC can be configured.
  -->
  <x:scenario label="test_23">
    <x:call step="louis:format">
      <x:input port="source">
        <x:document type="inline">
          <doc>
            <body style="@page {
                         size: 15 8
                         @bottom-right {
                         content: counter(braille-page) }}">
              <frontmatter>
                <toc>
                  <entry ref="chapter_1" style="display: block;
                                                content: target-text(attr(ref))
                                                         leader('⠄')
                                                         target-counter(attr(ref), braille-page)"/>
                  <entry ref="chapter_2" style="display: block;
                                                content: target-text(attr(ref))
                                                         leader('⠤')
                                                         target-counter(attr(ref), braille-page)"/>
                  <entry ref="chapter_3" style="display: block;
                                                content: target-text(attr(ref))
                                                         target-counter(attr(ref), braille-page)"/>
                </toc>
              </frontmatter>
              <bodymatter style="display: block;
                                 margin-top: 1">
                <h xml:id="chapter_1" style="display:block">
                  ⠿
                </h>
                <h xml:id="chapter_2" style="display:block">
                  ⠿⠿
                </h>
                <h xml:id="chapter_3" style="display:block">
                  ⠿⠿⠿
                </h>
              </bodymatter>
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="temp-dir" select="$temp-dir"/>
    </x:call>
    <x:context label="result">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="8" cols="15" rowgap="0" duplex="false">
              <section>
                <page>
                  <row>⠿⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠁</row>
                  <row>⠿⠿⠀⠤⠤⠤⠤⠤⠤⠤⠤⠤⠀⠼⠁</row>
                  <row>⠿⠿⠿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                  <row/>
                  <row>⠿</row>
                  <row>⠿⠿</row>
                  <row>⠿⠿⠿</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

</x:description>
