<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns:x="http://www.jenitennison.com/xslt/xspec"
               xmlns:css="http://www.daisy.org/ns/pipeline/braille-css"
               xmlns="http://www.w3.org/1999/xhtml"
               stylesheet="../resources/phony.xsl">
  
  <!--
      Render table by row
  -->
  <x:scenario label="by-row">
    
    <!--
        Row axis not marked up explicitly
    -->
    <x:scenario label="implicit">
      
      <!--
          Simple table with data cells only
      -->
      <x:scenario label="no-headers">
        <x:call function="css:render-table-by">
          <x:param select="'row'"/>
          <x:param>
            <table>
              <tr>
                <td>Cell 1.1</td>
                <td>Cell 1.2</td>
                <td>Cell 1.3</td>
              </tr>
              <tr>
                <td>Cell 2.1</td>
                <td>Cell 2.2</td>
                <td>Cell 2.3</td>
              </tr>
              <tr>
                <td>Cell 3.1</td>
                <td>Cell 3.2</td>
                <td>Cell 3.3</td>
              </tr>
            </table>
          </x:param>
        </x:call>
        <x:expect label="result">
          <table>
            <css:table-by axis="row">
              <css:list-item>
                <td>Cell 1.1</td>
                <td>Cell 1.2</td>
                <td>Cell 1.3</td>
              </css:list-item>
              <css:list-item>
                <td>Cell 2.1</td>
                <td>Cell 2.2</td>
                <td>Cell 2.3</td>
              </css:list-item>
              <css:list-item>
                <td>Cell 3.1</td>
                <td>Cell 3.2</td>
                <td>Cell 3.3</td>
              </css:list-item>
            </css:table-by>
          </table>
        </x:expect>
      </x:scenario>
      
      <!--
          Table with column headers
          
          Each data cell is preceded by the appropriate column heading. The row containing the column
          headings is discarded.
      -->
      <x:scenario label="with-column-headers">
        <x:call function="css:render-table-by">
          <x:param select="'row'"/>
          <x:param>
            <table>
              <tr>
                <th>Column 1</th>
                <th>Column 2</th>
                <th>Column 3</th>
              </tr>
              <tr>
                <td>Cell 1.1</td>
                <td>Cell 1.2</td>
                <td>Cell 1.3</td>
              </tr>
              <tr>
                <td>Cell 2.1</td>
                <td>Cell 2.2</td>
                <td>Cell 2.3</td>
              </tr>
              <tr>
                <td>Cell 3.1</td>
                <td>Cell 3.2</td>
                <td>Cell 3.3</td>
              </tr>
            </table>
          </x:param>
        </x:call>
        <x:expect label="result">
          <table>
            <css:table-by axis="row">
              <css:list-item>
                <th>Column 1</th>
                <td>Cell 1.1</td>
                <th>Column 2</th>
                <td>Cell 1.2</td>
                <th>Column 3</th>
                <td>Cell 1.3</td>
              </css:list-item>
              <css:list-item>
                <th>Column 1</th>
                <td>Cell 2.1</td>
                <th>Column 2</th>
                <td>Cell 2.2</td>
                <th>Column 3</th>
                <td>Cell 2.3</td>
              </css:list-item>
              <css:list-item>
                <th>Column 1</th>
                <td>Cell 3.1</td>
                <th>Column 2</th>
                <td>Cell 3.2</td>
                <th>Column 3</th>
                <td>Cell 3.3</td>
              </css:list-item>
            </css:table-by>
          </table>
        </x:expect>
      </x:scenario>
    </x:scenario>
    
    <!--
        Row axis marked up explicitly
    -->
    <x:scenario label="explicit">
      
      <!--
          Table with row and column headers
          
          A cell is preceded by its column heading. A row is preceded by its row heading.
      -->
      <x:scenario label="with-column-and-row-headers">
        <x:call function="css:render-table-by">
          <x:param select="'row'"/>
          <x:param>
            <table>
              <tr>
                <th/>
                <th>Column 1</th>
                <th>Column 2</th>
                <th>Column 3</th>
              </tr>
              <tr>
                <th axis="row">Row 1</th>
                <td>Cell 1.1</td>
                <td>Cell 1.2</td>
                <td>Cell 1.3</td>
              </tr>
              <tr>
                <th axis="row">Row 2</th>
                <td>Cell 2.1</td>
                <td>Cell 2.2</td>
                <td>Cell 2.3</td>
              </tr>
              <tr>
                <th axis="row">Row 3</th>
                <td>Cell 3.1</td>
                <td>Cell 3.2</td>
                <td>Cell 3.3</td>
              </tr>
            </table>
          </x:param>
        </x:call>
        <x:expect label="result">
          <table>
            <css:table-by axis="row">
              <css:list-item>
                <th axis="row">Row 1</th>
                <th>Column 1</th>
                <td>Cell 1.1</td>
                <th>Column 2</th>
                <td>Cell 1.2</td>
                <th>Column 3</th>
                <td>Cell 1.3</td>
              </css:list-item>
              <css:list-item>
                <th axis="row">Row 2</th>
                <th>Column 1</th>
                <td>Cell 2.1</td>
                <th>Column 2</th>
                <td>Cell 2.2</td>
                <th>Column 3</th>
                <td>Cell 2.3</td>
              </css:list-item>
              <css:list-item>
                <th axis="row">Row 3</th>
                <th>Column 1</th>
                <td>Cell 3.1</td>
                <th>Column 2</th>
                <td>Cell 3.2</td>
                <th>Column 3</th>
                <td>Cell 3.3</td>
              </css:list-item>
            </css:table-by>
          </table>
        </x:expect>
      </x:scenario>
    </x:scenario>
  </x:scenario>
  
  <!--
      Render table by column
      
      If a table has few columns compared to the number of rows, it may be better to render it
      column by column. Note: This requires markup; it is not enabled automatically for a certain
      row/column ratio.
  -->
  <x:scenario label="by-column">
    
    <!--
        Column axis marked up explicitly
    -->
    <x:scenario label="explicit">
      
      <!--
          Table with column and row headers
      -->
      <x:scenario label="with-column-and-row-headers">
        <x:call function="css:render-table-by">
          <x:param select="'column'"/>
          <x:param>
            <table>
              <tr>
                <th/>
                <th axis="column">Column 1</th>
                <th axis="column">Column 2</th>
                <th axis="column">Column 3</th>
              </tr>
              <tr>
                <th>Row 1</th>
                <td>Cell 1.1</td>
                <td>Cell 1.2</td>
                <td>Cell 1.3</td>
              </tr>
              <tr>
                <th>Row 2</th>
                <td>Cell 2.1</td>
                <td>Cell 2.2</td>
                <td>Cell 2.3</td>
              </tr>
              <tr>
                <th>Row 3</th>
                <td>Cell 3.1</td>
                <td>Cell 3.2</td>
                <td>Cell 3.3</td>
              </tr>
            </table>
          </x:param>
        </x:call>
        <x:expect label="result">
          <table>
            <css:table-by axis="column">
              <css:list-item>
                <th axis="column">Column 1</th>
                <th>Row 1</th>
                <td>Cell 1.1</td>
                <th>Row 2</th>
                <td>Cell 2.1</td>
                <th>Row 3</th>
                <td>Cell 3.1</td>
              </css:list-item>
              <css:list-item>
                <th axis="column">Column 2</th>
                <th>Row 1</th>
                <td>Cell 1.2</td>
                <th>Row 2</th>
                <td>Cell 2.2</td>
                <th>Row 3</th>
                <td>Cell 3.2</td>
              </css:list-item>
              <css:list-item>
                <th axis="column">Column 3</th>
                <th>Row 1</th>
                <td>Cell 1.3</td>
                <th>Row 2</th>
                <td>Cell 2.3</td>
                <th>Row 3</th>
                <td>Cell 3.3</td>
              </css:list-item>
            </css:table-by>
          </table>
        </x:expect>
      </x:scenario>
    </x:scenario>
    
    <!--
        Column axis not marked up explicitly
    -->
    <x:scenario label="implicit">
      
      <!--
          Table with column headers
      -->
      <x:scenario label="with-column-headers">
        <x:call function="css:render-table-by">
          <x:param select="'column'"/>
          <x:param>
            <table>
              <tr>
                <th>Column 1</th>
                <th>Column 2</th>
                <th>Column 3</th>
              </tr>
              <tr>
                <td>Cell 1.1</td>
                <td>Cell 1.2</td>
                <td>Cell 1.3</td>
              </tr>
              <tr>
                <td>Cell 2.1</td>
                <td>Cell 2.2</td>
                <td>Cell 2.3</td>
              </tr>
              <tr>
                <td>Cell 3.1</td>
                <td>Cell 3.2</td>
                <td>Cell 3.3</td>
              </tr>
            </table>
          </x:param>
        </x:call>
        <x:expect label="result">
          <table>
            <css:table-by axis="column">
              <css:list-item>
                <th>Column 1</th>
                <td>Cell 1.1</td>
                <td>Cell 2.1</td>
                <td>Cell 3.1</td>
              </css:list-item>
              <css:list-item>
                <th>Column 2</th>
                <td>Cell 1.2</td>
                <td>Cell 2.2</td>
                <td>Cell 3.2</td>
              </css:list-item>
              <css:list-item>
                <th>Column 3</th>
                <td>Cell 1.3</td>
                <td>Cell 2.3</td>
                <td>Cell 3.3</td>
              </css:list-item>
            </css:table-by>
          </table>
        </x:expect>
      </x:scenario>
      
      <!--
          Table with column and row headers
      -->
      <x:scenario label="with-column-and-row-headers">
        <x:call function="css:render-table-by">
          <x:param select="'column'"/>
          <x:param>
            <table>
              <tr>
                <th/>
                <th>Column 1</th>
                <th>Column 2</th>
                <th>Column 3</th>
              </tr>
              <tr>
                <th>Row 1</th>
                <td>Cell 1.1</td>
                <td>Cell 1.2</td>
                <td>Cell 1.3</td>
              </tr>
              <tr>
                <th>Row 2</th>
                <td>Cell 2.1</td>
                <td>Cell 2.2</td>
                <td>Cell 2.3</td>
              </tr>
              <tr>
                <th>Row 3</th>
                <td>Cell 3.1</td>
                <td>Cell 3.2</td>
                <td>Cell 3.3</td>
              </tr>
            </table>
          </x:param>
        </x:call>
        <x:expect label="result">
          <table>
            <css:table-by axis="column">
              <css:list-item>
                <th>Column 1</th>
                <th>Row 1</th>
                <td>Cell 1.1</td>
                <th>Row 2</th>
                <td>Cell 2.1</td>
                <th>Row 3</th>
                <td>Cell 3.1</td>
              </css:list-item>
              <css:list-item>
                <th>Column 2</th>
                <th>Row 1</th>
                <td>Cell 1.2</td>
                <th>Row 2</th>
                <td>Cell 2.2</td>
                <th>Row 3</th>
                <td>Cell 3.2</td>
              </css:list-item>
              <css:list-item>
                <th>Column 3</th>
                <th>Row 1</th>
                <td>Cell 1.3</td>
                <th>Row 2</th>
                <td>Cell 2.3</td>
                <th>Row 3</th>
                <td>Cell 3.3</td>
              </css:list-item>
            </css:table-by>
          </table>
        </x:expect>
      </x:scenario>
    </x:scenario>
  </x:scenario>

  <!--
      Render table by column and group each column by row
  -->
  <x:scenario label="by-column-and-row">
    
    <!--
        Column axis marked up explicitly
    -->
    <x:scenario label="explicit">
      
      <!--
          Table with column and row headers
      -->
      <x:scenario label="with-column-and-row-headers">
        <x:call function="css:render-table-by">
          <x:param select="'column, row'"/>
          <x:param>
            <table>
              <tr>
                <th/>
                <th axis="column">Column 1</th>
                <th axis="column">Column 2</th>
                <th axis="column">Column 3</th>
              </tr>
              <tr>
                <th>Row 1</th>
                <td>Cell 1.1</td>
                <td>Cell 1.2</td>
                <td>Cell 1.3</td>
              </tr>
              <tr>
                <th>Row 2</th>
                <td>Cell 2.1</td>
                <td>Cell 2.2</td>
                <td>Cell 2.3</td>
              </tr>
              <tr>
                <th>Row 3</th>
                <td>Cell 3.1</td>
                <td>Cell 3.2</td>
                <td>Cell 3.3</td>
              </tr>
            </table>
          </x:param>
        </x:call>
        <x:expect label="result">
          <table>
            <css:table-by axis="column">
              <css:list-item>
                <th axis="column">Column 1</th>
                <css:table-by axis="row">
                  <css:list-item>
                    <th>Row 1</th>
                    <td>Cell 1.1</td>
                  </css:list-item>
                  <css:list-item>
                    <th>Row 2</th>
                    <td>Cell 2.1</td>
                  </css:list-item>
                  <css:list-item>
                    <th>Row 3</th>
                    <td>Cell 3.1</td>
                  </css:list-item>
                </css:table-by>
              </css:list-item>
              <css:list-item>
                <th axis="column">Column 2</th>
                <css:table-by axis="row">
                  <css:list-item>
                    <th>Row 1</th>
                    <td>Cell 1.2</td>
                  </css:list-item>
                  <css:list-item>
                    <th>Row 2</th>
                    <td>Cell 2.2</td>
                  </css:list-item>
                  <css:list-item>
                    <th>Row 3</th>
                    <td>Cell 3.2</td>
                  </css:list-item>
                </css:table-by>
              </css:list-item>
              <css:list-item>
                <th axis="column">Column 3</th>
                <css:table-by axis="row">
                  <css:list-item>
                    <th>Row 1</th>
                    <td>Cell 1.3</td>
                  </css:list-item>
                  <css:list-item>
                    <th>Row 2</th>
                    <td>Cell 2.3</td>
                  </css:list-item>
                  <css:list-item>
                    <th>Row 3</th>
                    <td>Cell 3.3</td>
                  </css:list-item>
                </css:table-by>
              </css:list-item>
            </css:table-by>
          </table>
        </x:expect>
      </x:scenario>
    </x:scenario>
    
    <!--
        Column axis not marked up explicitly
    -->
    <x:scenario label="implicit">
      
      <!--
          Table with column and row headers
      -->
      <x:scenario label="with-column-and-row-headers">
        <x:call function="css:render-table-by">
          <x:param select="'column, row'"/>
          <x:param>
            <table>
              <tr>
                <th/>
                <th>Column 1</th>
                <th>Column 2</th>
                <th>Column 3</th>
              </tr>
              <tr>
                <th>Row 1</th>
                <td>Cell 1.1</td>
                <td>Cell 1.2</td>
                <td>Cell 1.3</td>
              </tr>
              <tr>
                <th>Row 2</th>
                <td>Cell 2.1</td>
                <td>Cell 2.2</td>
                <td>Cell 2.3</td>
              </tr>
              <tr>
                <th>Row 3</th>
                <td>Cell 3.1</td>
                <td>Cell 3.2</td>
                <td>Cell 3.3</td>
              </tr>
            </table>
          </x:param>
        </x:call>
        <x:expect label="result">
          <table>
            <css:table-by axis="column">
              <css:list-item>
                <css:table-by axis="row">
                  <css:list-item>
                    <th>Column 1</th>
                    <th>Row 1</th>
                    <td>Cell 1.1</td>
                  </css:list-item>
                  <css:list-item>
                    <th>Row 2</th>
                    <td>Cell 2.1</td>
                  </css:list-item>
                  <css:list-item>
                    <th>Row 3</th>
                    <td>Cell 3.1</td>
                  </css:list-item>
                </css:table-by>
              </css:list-item>
              <css:list-item>
                <css:table-by axis="row">
                  <css:list-item>
                    <th>Column 2</th>
                    <th>Row 1</th>
                    <td>Cell 1.2</td>
                  </css:list-item>
                  <css:list-item>
                    <th>Row 2</th>
                    <td>Cell 2.2</td>
                  </css:list-item>
                  <css:list-item>
                    <th>Row 3</th>
                    <td>Cell 3.2</td>
                  </css:list-item>
                </css:table-by>
              </css:list-item>
              <css:list-item>
                <css:table-by axis="row">
                  <css:list-item>
                    <th>Column 3</th>
                    <th>Row 1</th>
                    <td>Cell 1.3</td>
                  </css:list-item>
                  <css:list-item>
                    <th>Row 2</th>
                    <td>Cell 2.3</td>
                  </css:list-item>
                  <css:list-item>
                    <th>Row 3</th>
                    <td>Cell 3.3</td>
                  </css:list-item>
                </css:table-by>
              </css:list-item>
            </css:table-by>
          </table>
        </x:expect>
      </x:scenario>
    </x:scenario>
  </x:scenario>
  
  <!--
      Merged headings
      
      Support for merged cells is primitive. Only headings spanning mutiple columns/rows are
      considered. In the table below, the two first data cells in rows 2 and 3 are under the same
      heading ("Cities"); hence that heading is applied to both those cells rather than just the
      first. In row 4 the first data cell spans two rows; however, the merged data cell is actually
      treated as two separate cells and thus appears twice, which is redundant.
  -->
  <x:scenario label="merged-headers">
    <x:call function="css:render-table-by">
      <x:param select="'area'"/>
      <x:param>
        <table>
          <tr>
            <th/>
            <th axis="type-of-place" css:table-header-policy="always" colspan="2">Cities</th>
            <th axis="type-of-place" css:table-header-policy="always">Mountains</th>
          </tr>
          <tr>
            <th axis="area">Europe</th>
            <td>Copenhagen</td>
            <td>Brussels</td>
            <td>Mont Blanc</td>
          </tr>
          <tr>
            <th axis="area">Asia</th>
            <td>Beijing</td>
            <td>Singapore</td>
            <td>K2</td>
          </tr>
          <tr>
            <th axis="area">Mars</th>
            <td colspan="2">None?</td>
            <td>Olympus Mons</td>
          </tr>
        </table>
      </x:param>
    </x:call>
    <x:expect label="result">
      <table>
        <css:table-by axis="area">
          <css:list-item>
            <th axis="area">Europe</th>
            <th axis="type-of-place">Cities</th>
            <td>Copenhagen</td>
            <th axis="type-of-place">Cities</th>
            <td>Brussels</td>
            <th axis="type-of-place">Mountains</th>
            <td>Mont Blanc</td>
          </css:list-item>
          <css:list-item>
            <th axis="area">Asia</th>
            <th axis="type-of-place">Cities</th>
            <td>Beijing</td>
            <th axis="type-of-place">Cities</th>
            <td>Singapore</td>
            <th axis="type-of-place">Mountains</th>
            <td>K2</td>
          </css:list-item>
          <css:list-item>
            <th axis="area">Mars</th>
            <th axis="type-of-place">Cities</th>
            <td>None?</td>
            <th axis="type-of-place">Cities</th>
            <td>None?</td>
            <th axis="type-of-place">Mountains</th>
            <td>Olympus Mons</td>
          </css:list-item>
        </css:table-by>
      </table>
    </x:expect>
  </x:scenario>
  
  <!--
      Nested merged headings
      
      Headings may be nested. the following table has column headers "earth" and "elsewhere", each
      of which contains two additional headers.
  -->
  <x:scenario label="nested-row-headers">
    <x:call function="css:render-table-by">
      <x:param select="'area, sub-area'"/>
      <x:param>
        <table>
          <tr>
            <th/>
            <th/>
            <th axis="type-of-place" css:table-header-policy="always" colspan="2">Cities</th>
            <th axis="type-of-place" css:table-header-policy="always">Mountains</th>
          </tr>
          <tr>
            <th axis="area" rowspan="2">Earth</th>
            <th axis="sub-area">Europe</th>
            <td>Copenhagen</td>
            <td>Brussels</td>
            <td>Mont Blanc</td>
          </tr>
          <tr>
            <th axis="sub-area">Asia</th>
            <td>Beijing</td>
            <td>Singapore</td>
            <td>K2</td>
          </tr>
          <tr>
            <th axis="area">Elsewhere</th>
            <th axis="sub-area">Mars</th>
            <td colspan="2">None?</td>
            <td>Olympus Mons</td>
          </tr>
        </table>
      </x:param>
    </x:call>
    <x:expect label="result">
      <table>
        <css:table-by axis="area">
          <css:list-item>
            <th axis="area">Earth</th>
            <css:table-by axis="sub-area">
              <css:list-item>
                <th axis="sub-area">Europe</th>
                <th axis="type-of-place">Cities</th>
                <td>Copenhagen</td>
                <th axis="type-of-place">Cities</th>
                <td>Brussels</td>
                <th axis="type-of-place">Mountains</th>
                <td>Mont Blanc</td>
              </css:list-item>
              <css:list-item>
                <th axis="sub-area">Asia</th>
                <th axis="type-of-place">Cities</th>
                <td>Beijing</td>
                <th axis="type-of-place">Cities</th>
                <td>Singapore</td>
                <th axis="type-of-place">Mountains</th>
                <td>K2</td>
              </css:list-item>
            </css:table-by>
          </css:list-item>
          <css:list-item>
            <th axis="area">Elsewhere</th>
            <css:table-by axis="sub-area">
              <css:list-item>
                <th axis="sub-area">Mars</th>
                <th axis="type-of-place">Cities</th>
                <td>None?</td>
                <th axis="type-of-place">Cities</th>
                <td>None?</td>
                <th axis="type-of-place">Mountains</th>
                <td>Olympus Mons</td>
              </css:list-item>
            </css:table-by>
          </css:list-item>
        </css:table-by>
      </table>
    </x:expect>
  </x:scenario>
  
  <!--
      If both nested row headers and nested column headers are present, the table contents will be
      grouped by combinations of the "outermost" headings. Note that the system fails to consider
      that not all headings have to be nested if one of them is; here only the "Cities" heading has
      subheadings, but "Mountains" is treated similarly regardless.
  -->
  <x:scenario label="nested-row-and-column-headers">
    <x:call function="css:render-table-by">
      <x:param select="'area, type-of-place, sub-area'"/>
      <x:param>
        <table>
          <tr>
            <th/>
            <th/>
            <th axis="type-of-place" colspan="2">Cities</th>
            <th axis="type-of-place">Mountains</th>
          </tr>
          <tr>
            <th/>
            <th/>
            <th axis="population">pop &gt; 1 million</th>
            <th axis="population">pop &gt; 2 million</th>
            <th/>
          </tr>
          <tr>
            <th axis="area" rowspan="2" css:table-header-policy="always">Earth</th>
            <th axis="sub-area">Europe</th>
            <td>Paris</td>
            <td>London</td>
            <td>Mont Blanc</td>
          </tr>
          <tr>
            <th axis="sub-area">Asia</th>
            <td>Beijing</td>
            <td>Beijing</td>
            <td>K2</td>
          </tr>
          <tr>
            <th axis="area" css:table-header-policy="always">Elsewhere</th>
            <th axis="sub-area">Mars</th>
            <td colspan="2">None?</td>
            <td>Olympus Mons</td>
          </tr>
        </table>
      </x:param>
    </x:call>
    <x:expect label="result">
      <table>
        <css:table-by axis="area">
          <css:list-item>
            <css:table-by axis="type-of-place">
              <css:list-item>
                <th axis="area">Earth</th>
                <th axis="type-of-place">Cities</th>
                <css:table-by axis="sub-area">
                  <css:list-item>
                    <th axis="sub-area">Europe</th>
                    <th axis="population">pop > 1 million</th>
                    <td>Paris</td>
                    <th axis="population">pop > 2 million</th>
                    <td>London</td>
                  </css:list-item>
                  <css:list-item>
                    <th axis="sub-area">Asia</th>
                    <th axis="population">pop > 1 million</th>
                    <td>Beijing</td>
                    <th axis="population">pop > 2 million</th>
                    <td>Beijing</td>
                  </css:list-item>
                </css:table-by>
              </css:list-item>
              <css:list-item>
                <th axis="area">Earth</th>
                <th axis="type-of-place">Mountains</th>
                <css:table-by axis="sub-area">
                  <css:list-item>
                    <th axis="sub-area">Europe</th>
                    <th/>
                    <td>Mont Blanc</td>
                  </css:list-item>
                  <css:list-item>
                    <th axis="sub-area">Asia</th>
                    <th/>
                    <td>K2</td>
                  </css:list-item>
                </css:table-by>
              </css:list-item>
            </css:table-by>
          </css:list-item>
          <css:list-item>
            <css:table-by axis="type-of-place">
              <css:list-item>
                <th axis="area">Elsewhere</th>
                <th axis="type-of-place">Cities</th>
                <css:table-by axis="sub-area">
                  <css:list-item>
                    <th axis="sub-area">Mars</th>
                    <th axis="population">pop > 1 million</th>
                    <td>None?</td>
                    <th axis="population">pop > 2 million</th>
                    <td>None?</td>
                  </css:list-item>
                </css:table-by>
              </css:list-item>
              <css:list-item>
                <th axis="area">Elsewhere</th>
                <th axis="type-of-place">Mountains</th>
                <css:table-by axis="sub-area">
                  <css:list-item>
                    <th axis="sub-area">Mars</th>
                    <th/>
                    <td>Olympus Mons</td>
                  </css:list-item>
                </css:table-by>
              </css:list-item>
            </css:table-by>
          </css:list-item>
        </css:table-by>
      </table>
    </x:expect>
  </x:scenario>
  
  <!--
      Example in section 11.4.2 of HTML 4 specification, with some minor
      modification. https://www.w3.org/TR/REC-html40/struct/tables.html#h-11.4.2
  -->
  <x:scenario label="example-html4-spec-11.4.2">
    <x:call function="css:render-table-by">
      <x:param select="'location, date'"/>
      <x:param>
        <TABLE border="1"
               summary="This table summarizes travel expenses
                        incurred during August trips to
                        San Jose and Seattle">
          <CAPTION>
            Travel Expense Report
          </CAPTION>
          <TR>
            <TH/>
            <TH id="a2" axis="expenses">Meals</TH>
            <TH id="a3" axis="expenses">Hotels</TH>
            <TH id="a4" axis="expenses">Transport</TH>
            <!-- <TD>subtotals</TD> --> <TH>subtotals</TH>
          </TR>
          <TR>
            <TH id="a6" axis="location">San Jose</TH>
            <!-- <TH/> -->
            <!-- <TH/> -->
            <!-- <TH/> -->
            <!-- <TD/> -->
          </TR>
          <TR>
            <TD id="a7" axis="date">25-Aug-97</TD>
            <TD headers="a6 a7 a2">37.74</TD>
            <TD headers="a6 a7 a3">112.00</TD>
            <TD headers="a6 a7 a4">45.00</TD>
            <!-- <TD/> -->
          </TR>
          <TR>
            <TD id="a8" axis="date">26-Aug-97</TD>
            <TD headers="a6 a8 a2">27.28</TD>
            <TD headers="a6 a8 a3">112.00</TD>
            <TD headers="a6 a8 a4">45.00</TD>
            <!-- <TD/> -->
          </TR>
          <TR>
            <!-- <TD>subtotals</TD> --> <TH headers="a6">subtotals</TH>
            <TD>65.02</TD>
            <TD>224.00</TD>
            <TD>90.00</TD>
            <TD>379.02</TD>
          </TR>
          <TR>
            <TH id="a10" axis="location">Seattle</TH>
            <!-- <TH/> -->
            <!-- <TH/> -->
            <!-- <TH/> -->
            <!-- <TD/> -->
          </TR>
          <TR>
            <TD id="a11" axis="date">27-Aug-97</TD>
            <TD headers="a10 a11 a2">96.25</TD>
            <TD headers="a10 a11 a3">109.00</TD>
            <TD headers="a10 a11 a4">36.00</TD>
            <!-- <TD/> -->
          </TR>
          <TR>
            <TD id="a12" axis="date">28-Aug-97</TD>
            <TD headers="a10 a12 a2">35.00</TD>
            <TD headers="a10 a12 a3">109.00</TD>
            <TD headers="a10 a12 a4">36.00</TD>
            <!-- <TD/> -->
          </TR>
          <TR>
            <!-- <TD>subtotals</TD> --> <TH headers="a10">subtotals</TH>
            <TD>131.25</TD>
            <TD>218.00</TD>
            <TD>72.00</TD>
            <TD>421.25</TD>
          </TR>
          <TR>
            <TH>Totals</TH>
            <TD>196.27</TD>
            <TD>442.00</TD>
            <TD>162.00</TD>
            <TD>800.27</TD>
          </TR>
        </TABLE>
      </x:param>
    </x:call>
    <x:expect label="result">
      <TABLE border="1"
             summary="This table summarizes travel expenses
                        incurred during August trips to
                        San Jose and Seattle">
        <CAPTION>
            Travel Expense Report
          </CAPTION>
        <css:table-by axis="location">
          <css:list-item>
            <th id="a6" axis="location">San Jose</th>
            <css:table-by axis="date">
              <css:list-item>
                <td id="a7" axis="date">25-Aug-97</td>
                <th id="a2" axis="expenses">Meals</th>
                <td headers="a6 a7 a2">37.74</td>
                <th id="a3" axis="expenses">Hotels</th>
                <td headers="a6 a7 a3">112.00</td>
                <th id="a4" axis="expenses">Transport</th>
                <td headers="a6 a7 a4">45.00</td>
              </css:list-item>
              <css:list-item>
                <td id="a8" axis="date">26-Aug-97</td>
                <th axis="expenses">Meals</th>
                <td headers="a6 a8 a2">27.28</td>
                <th axis="expenses">Hotels</th>
                <td headers="a6 a8 a3">112.00</td>
                <th axis="expenses">Transport</th>
                <td headers="a6 a8 a4">45.00</td>
              </css:list-item>
              <css:list-item>
                <th headers="a6">subtotals</th>
                <th axis="expenses">Meals</th>
                <td>65.02</td>
                <th axis="expenses">Hotels</th>
                <td>224.00</td>
                <th axis="expenses">Transport</th>
                <td>90.00</td>
                <th>subtotals</th>
                <td>379.02</td>
              </css:list-item>
            </css:table-by>
          </css:list-item>
          <css:list-item>
            <th id="a10" axis="location">Seattle</th>
            <css:table-by axis="date">
              <css:list-item>
                <td id="a11" axis="date">27-Aug-97</td>
                <th axis="expenses">Meals</th>
                <td headers="a10 a11 a2">96.25</td>
                <th axis="expenses">Hotels</th>
                <td headers="a10 a11 a3">109.00</td>
                <th axis="expenses">Transport</th>
                <td headers="a10 a11 a4">36.00</td>
              </css:list-item>
              <css:list-item>
                <td id="a12" axis="date">28-Aug-97</td>
                <th axis="expenses">Meals</th>
                <td headers="a10 a12 a2">35.00</td>
                <th axis="expenses">Hotels</th>
                <td headers="a10 a12 a3">109.00</td>
                <th axis="expenses">Transport</th>
                <td headers="a10 a12 a4">36.00</td>
              </css:list-item>
              <css:list-item>
                <th headers="a10">subtotals</th>
                <th axis="expenses">Meals</th>
                <td>131.25</td>
                <th axis="expenses">Hotels</th>
                <td>218.00</td>
                <th axis="expenses">Transport</th>
                <td>72.00</td>
                <th>subtotals</th>
                <td>421.25</td>
              </css:list-item>
            </css:table-by>
          </css:list-item>
          <css:list-item>
            <th>Totals</th>
            <th axis="expenses">Meals</th>
            <td>196.27</td>
            <th axis="expenses">Hotels</th>
            <td>442.00</td>
            <th axis="expenses">Transport</th>
            <td>162.00</td>
            <th>subtotals</th>
            <td>800.27</td>
          </css:list-item>
        </css:table-by>
      </TABLE>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="pseudo-elements">
    <x:call function="css:render-table-by">
      <x:param select="'row, column'"/>
      <x:param>
        <table style="display: a;
                      &amp;::table-by(row)::list-item {{ display: b }}
                      &amp;::table-by(column) {{ display: c }}
                      &amp;::table-by(column)::list-item {{ display: d }}
                      &amp;::table-by(column)::list-item::after {{ display: e }}
                      &amp;::table-by(column)::list-item:nth-last-child(1)::after {{ display: f }}">
          <tr>
            <td>Cell 1.1</td>
            <td>Cell 1.2</td>
            <td>Cell 1.3</td>
          </tr>
          <tr>
            <td>Cell 2.1</td>
            <td>Cell 2.2</td>
            <td>Cell 2.3</td>
          </tr>
          <tr>
            <td>Cell 3.1</td>
            <td>Cell 3.2</td>
            <td>Cell 3.3</td>
          </tr>
        </table>
      </x:param>
    </x:call>
    <x:expect label="result">
      <table style="display: a">
        <css:table-by axis="row">
          <css:list-item style="display: b">
            <css:table-by axis="column" style="display: c">
              <css:list-item style="display: d; &amp;::after {{ display: e }}">
                <td>Cell 1.1</td>
              </css:list-item>
              <css:list-item style="display: d; &amp;::after {{ display: e }}">
                <td>Cell 1.2</td>
              </css:list-item>
              <css:list-item style="display: d; &amp;::after {{ display: e; display: f }}">
                <td>Cell 1.3</td>
              </css:list-item>
            </css:table-by>
          </css:list-item>
          <css:list-item style="display: b">
            <css:table-by axis="column" style="display: c">
              <css:list-item style="display: d; &amp;::after {{ display: e }}">
                <td>Cell 2.1</td>
              </css:list-item>
              <css:list-item style="display: d; &amp;::after {{ display: e }}">
                <td>Cell 2.2</td>
              </css:list-item>
              <css:list-item style="display: d; &amp;::after {{ display: e; display: f }}">
                <td>Cell 2.3</td>
              </css:list-item>
            </css:table-by>
          </css:list-item>
          <css:list-item style="display: b">
            <css:table-by axis="column" style="display: c">
              <css:list-item style="display: d; &amp;::after {{ display: e }}">
                <td>Cell 3.1</td>
              </css:list-item>
              <css:list-item style="display: d; &amp;::after {{ display: e }}">
                <td>Cell 3.2</td>
              </css:list-item>
              <css:list-item style="display: d; &amp;::after {{ display: e; display: f }}">
                <td>Cell 3.3</td>
              </css:list-item>
            </css:table-by>
          </css:list-item>
        </css:table-by>
      </table>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="nested-column-headers-implicit">
    <x:call function="css:render-table-by">
      <x:param select="'row'"/>
      <x:param>
        <table>
          <tr>
            <th colspan="2">Column 1</th>
            <th>Column 2</th>
          </tr>
          <tr>
            <th>A</th>
            <th>B</th>
          </tr>
          <tr>
            <td>Cell 1.1A</td>
            <td>Cell 1.1B</td>
            <td>Cell 1.2</td>
          </tr>
          <tr>
            <td>Cell 2.1A</td>
            <td>Cell 2.1B</td>
            <td>Cell 2.2</td>
          </tr>
        </table>
      </x:param>
    </x:call>
    <x:expect label="result">
      <table>
        <css:table-by axis="row">
          <css:list-item>
            <th>Column 1</th>
            <th>A</th>
            <td>Cell 1.1A</td>
            <th>B</th>
            <td>Cell 1.1B</td>
            <th>Column 2</th>
            <td>Cell 1.2</td>
          </css:list-item>
          <css:list-item>
            <th>Column 1</th>
            <th>A</th>
            <td>Cell 2.1A</td>
            <th>B</th>
            <td>Cell 2.1B</td>
            <th>Column 2</th>
            <td>Cell 2.2</td>
          </css:list-item>
        </css:table-by>
      </table>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="header-policy-front">
    <x:call function="css:render-table-by">
      <x:param select="'row'"/>
      <x:param>
        <table>
          <caption>Fünf Länder im Vergleich</caption>
          <thead>
            <tr>
              <th css:table-header-policy="front">Land</th>
              <th css:table-header-policy="front">Hauptstadt</th>
              <th css:table-header-policy="front">Währung</th>
              <th css:table-header-policy="front">Amtssprache</th>
            </tr>
          </thead>
          <!--
          <tfoot>
            <tr>
              <td>Quelle: Wikipedia</td>
              <td>Quelle: Wikipedia</td>
              <td>Quelle: Wikipedia</td>
              <td>Quelle: Wikipedia</td>
            </tr>
          </tfoot>
          -->
          <tbody>
            <tr>
              <td><abbr>USA</abbr></td>
              <td>Washington</td>
              <td><abbr>US</abbr>-Dollar</td>
              <td>Englisch</td>
            </tr>
            <tr>
              <td>Japan</td>
              <td>Tokio</td>
              <td>Yen</td>
              <td>Japanisch</td>
            </tr>
            <tr>
              <td>Indien</td>
              <td>Neu-Delhi</td>
              <td>Rupie</td>
              <td>Hindi</td>
            </tr>
            <tr>
              <td>Grönland</td>
              <td>Nuuk</td>
              <td>Dänische Krone</td>
              <td>Dänisch</td>
            </tr>
            <tr>
              <td>Brasilien</td>
              <td>Brasília</td>
              <td>Real</td>
              <td>Portugiesisch</td>
            </tr>
          </tbody>
        </table>
      </x:param>
    </x:call>
    <x:expect label="result">
      <table>
        <caption>Fünf Länder im Vergleich</caption>
        <css:table-by axis="row">
          <css:list-header>
            <th>Land</th>
            <th>Hauptstadt</th>
            <th>Währung</th>
            <th>Amtssprache</th>
          </css:list-header>
          <css:list-item>
            <td><abbr>USA</abbr></td>
            <td>Washington</td>
            <td><abbr>US</abbr>-Dollar</td>
            <td>Englisch</td>
          </css:list-item>
          <css:list-item>
            <td>Japan</td>
            <td>Tokio</td>
            <td>Yen</td>
            <td>Japanisch</td>
          </css:list-item>
          <css:list-item>
            <td>Indien</td>
            <td>Neu-Delhi</td>
            <td>Rupie</td>
            <td>Hindi</td>
          </css:list-item>
          <css:list-item>
            <td>Grönland</td>
            <td>Nuuk</td>
            <td>Dänische Krone</td>
            <td>Dänisch</td>
          </css:list-item>
          <css:list-item>
            <td>Brasilien</td>
            <td>Brasília</td>
            <td>Real</td>
            <td>Portugiesisch</td>
          </css:list-item>
        </css:table-by>
      </table>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="header-policy-front-nested">
    <x:call function="css:render-table-by">
      <x:param select="'row'"/>
      <x:param>
        <table>
          <tr>
            <th colspan="2">Column 1</th>
            <th css:table-header-policy="front">Column 2</th>
          </tr>
          <tr>
            <th css:table-header-policy="front">A</th>
            <th css:table-header-policy="front">B</th>
          </tr>
          <tr>
            <td>Cell 1.1A</td>
            <td>Cell 1.1B</td>
            <td>Cell 1.2</td>
          </tr>
          <tr>
            <td>Cell 2.1A</td>
            <td>Cell 2.1B</td>
            <td>Cell 2.2</td>
          </tr>
        </table>
      </x:param>
    </x:call>
    <x:expect label="result">
      <table>
        <css:table-by axis="row">
          <css:list-header>
            <th>Column 1</th>
            <th>A</th>
            <th>B</th>
            <th>Column 2</th>
          </css:list-header>
          <css:list-item>
            <td>Cell 1.1A</td>
            <td>Cell 1.1B</td>
            <td>Cell 1.2</td>
          </css:list-item>
          <css:list-item>
            <td>Cell 2.1A</td>
            <td>Cell 2.1B</td>
            <td>Cell 2.2</td>
          </css:list-item>
        </css:table-by>
      </table>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="table-footer">
    <x:call function="css:render-table-by">
      <x:param select="'row'"/>
      <x:param>
        <table xmlns="http://www.daisy.org/z3986/2005/dtbook/">
          <caption>Fünf Länder im Vergleich</caption>
          <thead>
            <tr>
              <th css:table-header-policy="front">Land</th>
              <th css:table-header-policy="front">Hauptstadt</th>
              <th css:table-header-policy="front">Währung</th>
              <th css:table-header-policy="front">Amtssprache</th>
            </tr>
          </thead>
          <tfoot>
            <tr>
              <td>Quelle: Wikipedia</td>
              <td>Quelle: Wikipedia</td>
              <td>Quelle: Wikipedia</td>
              <td>Quelle: Wikipedia</td>
            </tr>
          </tfoot>
          <tbody>
            <tr>
              <td><abbr>USA</abbr></td>
              <td>Washington</td>
              <td><abbr>US</abbr>-Dollar</td>
              <td>Englisch</td>
            </tr>
            <tr>
              <td>Japan</td>
              <td>Tokio</td>
              <td>Yen</td>
              <td>Japanisch</td>
            </tr>
            <tr>
              <td>Indien</td>
              <td>Neu-Delhi</td>
              <td>Rupie</td>
              <td>Hindi</td>
            </tr>
            <tr>
              <td>Grönland</td>
              <td>Nuuk</td>
              <td>Dänische Krone</td>
              <td>Dänisch</td>
            </tr>
            <tr>
              <td>Brasilien</td>
              <td>Brasília</td>
              <td>Real</td>
              <td>Portugiesisch</td>
            </tr>
          </tbody>
        </table>
      </x:param>
    </x:call>
    <x:expect label="result">
      <table xmlns="http://www.daisy.org/z3986/2005/dtbook/">
        <caption>Fünf Länder im Vergleich</caption>
        <css:table-by axis="row">
          <css:list-header>
            <th>Land</th>
            <th>Hauptstadt</th>
            <th>Währung</th>
            <th>Amtssprache</th>
          </css:list-header>
          <css:list-item>
            <td>
              <abbr>USA</abbr>
            </td>
            <td>Washington</td>
            <td><abbr>US</abbr>-Dollar</td>
            <td>Englisch</td>
          </css:list-item>
          <css:list-item>
            <td>Japan</td>
            <td>Tokio</td>
            <td>Yen</td>
            <td>Japanisch</td>
          </css:list-item>
          <css:list-item>
            <td>Indien</td>
            <td>Neu-Delhi</td>
            <td>Rupie</td>
            <td>Hindi</td>
          </css:list-item>
          <css:list-item>
            <td>Grönland</td>
            <td>Nuuk</td>
            <td>Dänische Krone</td>
            <td>Dänisch</td>
          </css:list-item>
          <css:list-item>
            <td>Brasilien</td>
            <td>Brasília</td>
            <td>Real</td>
            <td>Portugiesisch</td>
          </css:list-item>
          <css:list-item>
            <td>Quelle: Wikipedia</td>
            <td>Quelle: Wikipedia</td>
            <td>Quelle: Wikipedia</td>
            <td>Quelle: Wikipedia</td>
          </css:list-item>
        </css:table-by>
      </table>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="by-row-group">
    <x:call function="css:render-table-by">
      <x:param select="'row-group, row'"/>
      <x:param>
        <table xmlns="http://www.daisy.org/z3986/2005/dtbook/">
          <caption>Fünf Länder im Vergleich</caption>
          <thead>
            <tr>
              <th>Land</th>
              <th>Hauptstadt</th>
              <th>Währung</th>
              <th>Amtssprache</th>
            </tr>
          </thead>
          <tfoot>
            <tr>
              <td>Quelle: Wikipedia</td>
              <td>Quelle: Wikipedia</td>
              <td>Quelle: Wikipedia</td>
              <td>Quelle: Wikipedia</td>
            </tr>
          </tfoot>
          <tbody>
            <tr>
              <td><abbr>USA</abbr></td>
              <td>Washington</td>
              <td><abbr>US</abbr>-Dollar</td>
              <td>Englisch</td>
            </tr>
            <tr>
              <td>Japan</td>
              <td>Tokio</td>
              <td>Yen</td>
              <td>Japanisch</td>
            </tr>
            <tr>
              <td>Indien</td>
              <td>Neu-Delhi</td>
              <td>Rupie</td>
              <td>Hindi</td>
            </tr>
            <tr>
              <td>Grönland</td>
              <td>Nuuk</td>
              <td>Dänische Krone</td>
              <td>Dänisch</td>
            </tr>
            <tr>
              <td>Brasilien</td>
              <td>Brasília</td>
              <td>Real</td>
              <td>Portugiesisch</td>
            </tr>
          </tbody>
        </table>
      </x:param>
    </x:call>
    <x:expect label="result">
      <table xmlns="http://www.daisy.org/z3986/2005/dtbook/">
        <caption>Fünf Länder im Vergleich</caption>
        <css:table-by axis="row-group">
          <css:list-item>
            <css:table-by axis="row">
              <css:list-item>
                <th>Land</th>
                <td><abbr>USA</abbr></td>
                <th>Hauptstadt</th>
                <td>Washington</td>
                <th>Währung</th>
                <td><abbr>US</abbr>-Dollar</td>
                <th>Amtssprache</th>
                <td>Englisch</td>
              </css:list-item>
              <css:list-item>
                <th>Land</th>
                <td>Japan</td>
                <th>Hauptstadt</th>
                <td>Tokio</td>
                <th>Währung</th>
                <td>Yen</td>
                <th>Amtssprache</th>
                <td>Japanisch</td>
              </css:list-item>
              <css:list-item>
                <th>Land</th>
                <td>Indien</td>
                <th>Hauptstadt</th>
                <td>Neu-Delhi</td>
                <th>Währung</th>
                <td>Rupie</td>
                <th>Amtssprache</th>
                <td>Hindi</td>
              </css:list-item>
              <css:list-item>
                <th>Land</th>
                <td>Grönland</td>
                <th>Hauptstadt</th>
                <td>Nuuk</td>
                <th>Währung</th>
                <td>Dänische Krone</td>
                <th>Amtssprache</th>
                <td>Dänisch</td>
              </css:list-item>
              <css:list-item>
                <th>Land</th>
                <td>Brasilien</td>
                <th>Hauptstadt</th>
                <td>Brasília</td>
                <th>Währung</th>
                <td>Real</td>
                <th>Amtssprache</th>
                <td>Portugiesisch</td>
              </css:list-item>
            </css:table-by>
          </css:list-item>
          <css:list-item>
            <css:table-by axis="row">
              <css:list-item>
                <th>Land</th>
                <td>Quelle: Wikipedia</td>
                <th>Hauptstadt</th>
                <td>Quelle: Wikipedia</td>
                <th>Währung</th>
                <td>Quelle: Wikipedia</td>
                <th>Amtssprache</th>
                <td>Quelle: Wikipedia</td>
              </css:list-item>
            </css:table-by>
          </css:list-item>
        </css:table-by>
      </table>
    </x:expect>
  </x:scenario>

  <x:scenario label="style-and-lang-inheriting">
    <x:call function="css:render-table-by">
      <x:param select="'row'"/>
      <x:param>
        <table>
          <tbody style="word-spacing: 2" xml:lang="en">
            <tr style="text-transform: foo">
              <td>Cell 1.1</td>
              <td>Cell 1.2</td>
              <td>Cell 1.3</td>
            </tr>
            <tr xml:lang="und">
              <td>Cell 2.1</td>
              <td>Cell 2.2</td>
              <td>Cell 2.3</td>
            </tr>
            <tr>
              <td>Cell 3.1</td>
              <td>Cell 3.2</td>
              <td>Cell 3.3</td>
            </tr>
          </tbody>
        </table>
      </x:param>
    </x:call>
    <x:expect label="result">
      <table>
        <css:table-by axis="row">
          <css:list-item>
            <td xml:lang="en" style="text-transform: foo; word-spacing: 2">Cell 1.1</td>
            <td xml:lang="en" style="text-transform: foo; word-spacing: 2">Cell 1.2</td>
            <td xml:lang="en" style="text-transform: foo; word-spacing: 2">Cell 1.3</td>
          </css:list-item>
          <css:list-item>
            <td xml:lang="und" style="word-spacing: 2">Cell 2.1</td>
            <td xml:lang="und" style="word-spacing: 2">Cell 2.2</td>
            <td xml:lang="und" style="word-spacing: 2">Cell 2.3</td>
          </css:list-item>
          <css:list-item>
            <td xml:lang="en" style="word-spacing: 2">Cell 3.1</td>
            <td xml:lang="en" style="word-spacing: 2">Cell 3.2</td>
            <td xml:lang="en" style="word-spacing: 2">Cell 3.3</td>
          </css:list-item>
        </css:table-by>
      </table>
    </x:expect>
  </x:scenario>
  
</x:description>
