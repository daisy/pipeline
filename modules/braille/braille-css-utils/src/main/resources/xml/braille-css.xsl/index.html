<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html vocab="http://www.daisy.org/ns/pipeline/" typeof="source">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta charset="utf-8">
<meta http-equiv="content-language" content="en">
<link rel="stylesheet" type="text/css" href="/pipeline/css/nxml-mode.css">
<link rel="shortcut icon" href="http://www.daisy.org/sites/default/files/favicon_0.ico">
<link rev="doc" href="../braille-css.xsl">
</head>
<body><div class="code" about="../braille-css.xsl">&lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">stylesheet</span> <span class="code-xml-attribute-prefix">xmlns:</span><span class="code-xml-attribute-local-name">xsl</span>=<span class="code-xml-attribute-value">"http://www.w3.org/1999/XSL/Transform"</span> <span class="code-xml-attribute-prefix">xmlns:</span><span class="code-xml-attribute-local-name">xs</span>=<span class="code-xml-attribute-value">"http://www.w3.org/2001/XMLSchema"</span> <span class="code-xml-attribute-prefix">xmlns:</span><span class="code-xml-attribute-local-name">css</span>=<span class="code-xml-attribute-value">"http://www.daisy.org/ns/pipeline/braille-css"</span> <span class="code-xml-attribute-prefix">xmlns:</span><span class="code-xml-attribute-local-name">re</span>=<span class="code-xml-attribute-value">"regex-utils"</span> <span class="code-xml-attribute-local-name">version</span>=<span class="code-xml-attribute-value">"3.0"</span> <span class="code-xml-attribute-local-name">exclude-result-prefixes</span>=<span class="code-xml-attribute-value">"#all"</span>&gt;
    
    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">import</span> <span class="code-xml-attribute-local-name">href</span>=<span class="code-xml-attribute-value">"<a href="/pipeline/modules/braille/braille-css-utils/src/main/resources/xml/base.xsl" class="source">base.xsl</a>"</span>/&gt;
    
    
    
    
    
    
    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"css:properties"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string*"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"('display',                  'flow',                  'left',                  'right',                  'margin-left',                  'margin-right',                  'margin-top',                  'margin-bottom',                  'padding-left',                  'padding-right',                  'padding-bottom',                  'padding-top',                  'border-left-pattern',                  'border-left-style',                  'border-left-width',                  'border-left-align',                  'border-right-pattern',                  'border-right-style',                  'border-right-width',                  'border-right-align',                  'border-bottom-pattern',                  'border-bottom-style',                  'border-bottom-width',                  'border-bottom-align',                  'border-top-pattern',                  'border-top-style',                  'border-top-width',                  'border-top-align',                  'text-indent',                  'list-style-type',                  'text-align',                  'page-break-before',                  'page-break-after',                  'page-break-inside',                  'volume-break-before',                  'volume-break-after',                  'volume-break-inside',                  'orphans',                  'widows',                  'page',                  'string-set',                  'counter-reset',                  'counter-set',                  'counter-increment',                  'content',                  'white-space',                  'hyphens',                  'hyphenate-character',                  'size',                  'max-height',                  'min-length',                  'max-length',                  'text-transform',                  'braille-charset',                  'font-style',                  'font-weight',                  'text-decoration',                  'color',                  'line-height',                  'letter-spacing',                  'word-spacing',                  'render-table-by',                  'table-header-policy',                  '-obfl-right-text-indent')"</span>/&gt;
    
    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"css:values"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string*"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"(re:exact(re:or(('block','inline','list-item','none','table',$css:VENDOR_PRF_IDENT_RE))),                  re:exact($css:IDENT_RE),                  re:exact(re:or(($css:NON_NEGATIVE_INTEGER_RE,'auto'))),                  re:exact(re:or(($css:NON_NEGATIVE_INTEGER_RE,'auto'))),                  re:exact($css:INTEGER_RE),                  re:exact($css:INTEGER_RE),                  re:exact($css:NON_NEGATIVE_INTEGER_RE),                  re:exact($css:NON_NEGATIVE_INTEGER_RE),                  re:exact($css:NON_NEGATIVE_INTEGER_RE),                  re:exact($css:NON_NEGATIVE_INTEGER_RE),                  re:exact($css:NON_NEGATIVE_INTEGER_RE),                  re:exact($css:NON_NEGATIVE_INTEGER_RE),                  re:exact(re:or(($css:BRAILLE_CHAR_RE,'none'))),                  re:exact(re:or(('none','solid'))),                  re:exact(re:or(($css:NON_NEGATIVE_INTEGER_RE,'thin','medium','thick'))),                  re:exact(re:or(('inner','center','outer'))),                  re:exact(re:or(($css:BRAILLE_CHAR_RE,'none'))),                  re:exact(re:or(('none','solid'))),                  re:exact(re:or(($css:NON_NEGATIVE_INTEGER_RE,'thin','medium','thick'))),                  re:exact(re:or(('inner','middle','outer'))),                  re:exact(re:or(($css:BRAILLE_CHAR_RE,'none'))),                  re:exact(re:or(('none','solid'))),                  re:exact(re:or(($css:NON_NEGATIVE_INTEGER_RE,'thin','medium','thick'))),                  re:exact(re:or(('inner','middle','outer'))),                  re:exact(re:or(($css:BRAILLE_CHAR_RE,'none'))),                  re:exact(re:or(('none','solid'))),                  re:exact(re:or(($css:NON_NEGATIVE_INTEGER_RE,'thin','medium','thick'))),                  re:exact(re:or(('inner','middle','outer'))),                  re:exact($css:INTEGER_RE),                  re:exact(re:or(($css:IDENT_RE,$css:BRAILLE_STRING_RE,$css:SYMBOLS_FN_RE))),                  re:exact(re:or(('center','left','right'))),                  re:exact(re:or(('always','auto','avoid','left','right'))),                  re:exact(re:or(('always','auto','avoid','left','right'))),                  re:exact(re:or(('auto','avoid'))),                  re:exact(re:or(('always','auto','avoid','prefer'))),                  re:exact(re:or(('always','auto','avoid','prefer'))),                  re:exact(re:or(('auto','avoid',$css:VENDOR_PRF_FN_RE))),                  re:exact($css:INTEGER_RE),                  re:exact($css:INTEGER_RE),                  re:exact(re:or(($css:IDENT_RE,'auto'))),                  re:exact(re:or(('none',re:comma-separated($css:STRING_SET_PAIR_RE)))),                  re:exact(re:or(('none',re:space-separated($css:COUNTER_SET_PAIR_RE)))),                  re:exact(re:or(('none',re:space-separated($css:COUNTER_SET_PAIR_RE)))),                  re:exact(re:or(('none',re:space-separated($css:COUNTER_SET_PAIR_RE)))),                  re:exact(re:or(('none',$css:CONTENT_LIST_RE))),                  re:exact(re:or(('normal','pre-wrap','pre-line'))),                  re:exact(re:or(('auto','manual','none'))),                  re:exact(re:or(('auto',$css:BRAILLE_STRING_RE))),                  re:exact(concat('(',$css:NON_NEGATIVE_INTEGER_RE,')\s+(',$css:NON_NEGATIVE_INTEGER_RE,')')),                  re:exact(re:or(('none',$css:NON_NEGATIVE_INTEGER_RE))),                  re:exact(re:or(($css:NON_NEGATIVE_INTEGER_RE,'auto'))),                  re:exact(re:or(($css:NON_NEGATIVE_INTEGER_RE,'auto'))),                  re:exact(re:or((re:space-separated(re:or(($css:IDENT_RE,$css:VENDOR_PRF_IDENT_RE))),'auto','none'))),                  re:exact(re:or(('unicode','custom'))),                  re:exact(re:or(('normal','italic','oblique'))),                  re:exact(re:or(('normal','bold','100','200','300','400','500','600','700','800','900'))),                  re:exact(re:or(('none','underline','overline','line-through','blink'))),                  re:exact($css:COLOR_RE),                  re:exact(re:or(($css:POSITIVE_NUMBER_RE,$css:POSITIVE_PERCENTAGE_RE))),                  re:exact($css:NON_NEGATIVE_INTEGER_RE),                  re:exact($css:NON_NEGATIVE_INTEGER_RE),                  re:exact(re:or(('auto',re:comma-separated($css:IDENT_RE)))),                  re:exact(re:or(('once','always','front'))),                  re:exact($css:NON_NEGATIVE_INTEGER_RE))"</span>/&gt;
    
    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"css:applies-to"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string*"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"('.*',                  '.*',                  '^(block|table|list-item)$',                  '^(block|table|list-item)$',                  '^(block|table|table-cell|list-item)$',                  '^(block|table|table-cell|list-item)$',                  '^(block|table|table-cell|list-item)$',                  '^(block|table|table-cell|list-item)$',                  '^(block|table|table-cell|list-item)$',                  '^(block|table|table-cell|list-item)$',                  '^(block|table|table-cell|list-item)$',                  '^(block|table|table-cell|list-item)$',                  '^(block|table|table-cell|list-item)$',                  '^(block|table|table-cell|list-item)$',                  '^(block|table|table-cell|list-item)$',                  '^(block|table|table-cell|list-item)$',                  '^(block|table|table-cell|list-item)$',                  '^(block|table|table-cell|list-item)$',                  '^(block|table|table-cell|list-item)$',                  '^(block|table|table-cell|list-item)$',                  '^(block|table|table-cell|list-item)$',                  '^(block|table|table-cell|list-item)$',                  '^(block|table|table-cell|list-item)$',                  '^(block|table|table-cell|list-item)$',                  '^(block|table|table-cell|list-item)$',                  '^(block|table|table-cell|list-item)$',                  '^(block|table|table-cell|list-item)$',                  '^(block|table|table-cell|list-item)$',                  '^(block|table|table-cell|list-item)$',                  '^(list-item)$',                  '^(block|table|table-cell|list-item)$',                  '^(block|table|list-item)$',                  '^(block|table|list-item)$',                  '^(block|table|list-item)$',                  '^(block|table|list-item)$',                  '^(block|table|list-item)$',                  '^(block|table|list-item)$',                  '^(block|list-item)$',                  '^(block|list-item)$',                  '.*',                  '.*',                  '.*',                  '.*',                  '.*',                  '^(::before|::after|@top-left|@top-center|@top-right|@bottom-left|@bottom-center|@bottom-right)$',                  '.*',                  '.*',                  '.*',                  '^@page$',                  '^@footnotes$',                  '^@volume$',                  '^@volume$',                  '.*',                  '.*',                  '.*',                  '.*',                  '.*',                  '.*',                  '^(block|table|list-item)$',                  '.*',                  '.*',                  '.*',                  '.*',                  '^(block|list-item)$')"</span>/&gt;
    
    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"css:initial-values"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string*"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"('inline',                  'normal',                  'auto',                  'auto',                  '0',                  '0',                  '0',                  '0',                  '0',                  '0',                  '0',                  '0',                  'none',                  'none',                  '1',                  'center',                  'none',                  'none',                  '1',                  'center',                  'none',                  'none',                  '1',                  'center',                  'none',                  'none',                  '1',                  'center',                  '0',                  'none',                  'left',                  'auto',                  'auto',                  'auto',                  'auto',                  'auto',                  'auto',                  '0',                  '0',                  'auto',                  'none',                  'none',                  'none',                  'none',                  'none',                  'normal',                  'manual',                  'auto',                  '40 25',                  'none',                  'auto',                  'auto',                  'auto',                  'unicode',                  'normal',                  'normal',                  'none',                  '#000000',                  '1',                  '0',                  '1',                  'auto',                  'once',                  '0')"</span>/&gt;
    
    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"css:media"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string*"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"('embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'print',                  'print',                  'print',                  'print',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed',                  'embossed')"</span>/&gt;
    
    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"css:inherited-properties"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string*"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"('text-indent',                  'list-style-type',                  'text-align',                  'page',                  'white-space',                  'hyphens',                  'hyphenate-character',                  'font-style',                  'font-weight',                  'text-decoration',                  'color',                  'line-height',                  'letter-spacing',                  'word-spacing',                  'text-transform',                  'braille-charset',                  '-obfl-right-text-indent')"</span>/&gt;
    
    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"css:paged-media-properties"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string*"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"('page-break-before',                  'page-break-after',                  'page-break-inside',                  'orphans',                  'widows')"</span>/&gt;
    
    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">function</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"css:is-valid"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:boolean"</span>&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"css:property"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"element()"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"index"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"index-of($css:properties, $css:property/@name)"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"if ($index)                               then $css:property/@value=('inherit', 'initial') or matches($css:property/@value, $css:values[$index], 'x')                               else matches($css:property/@name, re:exact($css:VENDOR_PRF_IDENT_RE))"</span>/&gt; 
    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">function</span>&gt;
    
    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">function</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"css:initial-value"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string?"</span>&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"property"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"index"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"index-of($css:properties, $property)"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">if</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$index"</span>&gt;
            &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"$css:initial-values[$index]"</span>/&gt;
        &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">if</span>&gt;
    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">function</span>&gt;
    
    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">function</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"css:is-inherited"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:boolean"</span>&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"property"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"$property=$css:inherited-properties"</span>/&gt;
    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">function</span>&gt;
    
    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">function</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"css:applies-to"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:boolean"</span>&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"property"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"display"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"index"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"index-of($css:properties, $property)"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"if ($index)                               then matches($display, $css:applies-to[$index])                               else matches($property, re:exact($css:VENDOR_PRF_IDENT_RE))"</span>/&gt; 
    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">function</span>&gt;
    
    
    
    
    
    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">template</span> <span class="code-xml-attribute-local-name">match</span>=<span class="code-xml-attribute-value">"css:property[@name='text-transform']"</span> <span class="code-xml-attribute-local-name">mode</span>=<span class="code-xml-attribute-value">"css:compute"</span>&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"concretize-inherit"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:boolean"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"concretize-initial"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:boolean"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"validate"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:boolean"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"context"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"node()"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">choose</span>&gt;
            &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"@value='inherit'"</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"."</span>/&gt;
            &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span>&gt;
            &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"@value='none'"</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"."</span>/&gt;
            &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span>&gt;
            &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">otherwise</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"parent-computed"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"element()"</span>&gt;
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">call-template</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"css:parent-property"</span>&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">with-param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"property"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"@name"</span>/&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">with-param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"compute"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"true()"</span>/&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">with-param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"concretize-inherit"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"true()"</span>/&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">with-param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"concretize-initial"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"$concretize-initial"</span>/&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">with-param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"validate"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"$validate"</span>/&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">with-param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"context"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"$context"</span>/&gt;
                    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">call-template</span>&gt;
                &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">choose</span>&gt;
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"@value=('initial','auto') and $parent-computed/@value='none'"</span>&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"."</span>/&gt;
                    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span>&gt;
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"@value=('initial','auto')"</span>&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"$parent-computed"</span>/&gt;
                    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span>&gt;
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$parent-computed/@value=('auto','none','initial')"</span>&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"."</span>/&gt;
                    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span>&gt;
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">otherwise</span>&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"css:property(@name, string-join(                                                 distinct-values((                                                   tokenize(normalize-space(@value), ' '),                                                   tokenize(normalize-space($parent-computed/@value), ' '))),                                                 ' '))"</span>/&gt;
                    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">otherwise</span>&gt;
                &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">choose</span>&gt;
            &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">otherwise</span>&gt;
        &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">choose</span>&gt;
    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">template</span>&gt;
    
    
    
    
    
    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">function</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"css:named-counter-style"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"element()"</span>&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"name"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"style"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"element()?"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"(css:custom-counter-style($name),$css:predefined-counter-styles[@name=$name])[1]"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">choose</span>&gt;
            &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$style                             and ((($style/@system=('symbolic','alphabetic','numeric','cyclic','fixed')                                    or not($style/@system))                                   and $style/@symbols)                                  or ($style/@system='additive'                                      and $style/@additive-symbols))"</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">element</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"css:counter-style"</span>&gt;
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">attribute</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"system"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"($style/@system,'symbolic')[1]"</span>/&gt;
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">choose</span>&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$style/@system='additive'"</span>&gt;
                            &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"$style/@additive-symbols"</span>/&gt;
                        &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span>&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">otherwise</span>&gt;
                            &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"$style/@symbols"</span>/&gt;
                        &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">otherwise</span>&gt;
                    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">choose</span>&gt;
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">if</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$style/@system=('symbolic','alphabetic','numeric','additive') or not($style/@system)"</span>&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">attribute</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"negative"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"($style/@negative,'-')[1]"</span>/&gt;
                    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">if</span>&gt;
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">attribute</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"prefix"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"($style/@prefix,'')[1]"</span>/&gt;
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">attribute</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"suffix"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"($style/@suffix,' ')[1]"</span>/&gt;
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">attribute</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"fallback"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"($style/@fallback,'decimal')[1]"</span>/&gt;
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">attribute</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"text-transform"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"($style/@text-transform,'auto')[1]"</span>/&gt;
                &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">element</span>&gt;
            &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span>&gt;
            &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">otherwise</span>&gt;
                &lt;<span class="code-xml-element-prefix">css:</span><span class="code-xml-element-local-name">counter-style</span> <span class="code-xml-attribute-local-name">system</span>=<span class="code-xml-attribute-value">"numeric"</span> <span class="code-xml-attribute-local-name">symbols</span>=<span class="code-xml-attribute-value">"'0' '1' '2' '3' '4' '5' '6' '7' '8' '9'"</span> <span class="code-xml-attribute-local-name">negative</span>=<span class="code-xml-attribute-value">"-"</span> <span class="code-xml-attribute-local-name">prefix</span>=<span class="code-xml-attribute-value">""</span> <span class="code-xml-attribute-local-name">suffix</span>=<span class="code-xml-attribute-value">" "</span> <span class="code-xml-attribute-local-name">fallback</span>=<span class="code-xml-attribute-value">"decimal"</span> <span class="code-xml-attribute-local-name">text-transform</span>=<span class="code-xml-attribute-value">"auto"</span>/&gt;
            &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">otherwise</span>&gt;
        &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">choose</span>&gt;
    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">function</span>&gt;
    
    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"css:predefined-counter-styles"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"element()*"</span>&gt;
        
        &lt;<span class="code-xml-element-prefix">css:</span><span class="code-xml-element-local-name">counter-style</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"decimal"</span> <span class="code-xml-attribute-local-name">system</span>=<span class="code-xml-attribute-value">"numeric"</span> <span class="code-xml-attribute-local-name">symbols</span>=<span class="code-xml-attribute-value">"'0' '1' '2' '3' '4' '5' '6' '7' '8' '9'"</span> <span class="code-xml-attribute-local-name">negative</span>=<span class="code-xml-attribute-value">"-"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">css:</span><span class="code-xml-element-local-name">counter-style</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"lower-alpha"</span> <span class="code-xml-attribute-local-name">system</span>=<span class="code-xml-attribute-value">"alphabetic"</span> <span class="code-xml-attribute-local-name">symbols</span>=<span class="code-xml-attribute-value">"'a' 'b' 'c' 'd' 'e' 'f' 'g' 'h' 'i' 'j' 'k' 'l' 'm' 'n' 'o' 'p' 'q' 'r' 's' 't' 'u' 'v' 'w' 'x' 'y' 'z'"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">css:</span><span class="code-xml-element-local-name">counter-style</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"upper-alpha"</span> <span class="code-xml-attribute-local-name">system</span>=<span class="code-xml-attribute-value">"alphabetic"</span> <span class="code-xml-attribute-local-name">symbols</span>=<span class="code-xml-attribute-value">"'A' 'B' 'C' 'D' 'E' 'F' 'G' 'H' 'I' 'J' 'K' 'L' 'M' 'N' 'O' 'P' 'Q' 'R' 'S' 'T' 'U' 'V' 'W' 'X' 'Y' 'Z'"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">css:</span><span class="code-xml-element-local-name">counter-style</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"lower-roman"</span> <span class="code-xml-attribute-local-name">system</span>=<span class="code-xml-attribute-value">"additive"</span> <span class="code-xml-attribute-local-name">range</span>=<span class="code-xml-attribute-value">"1 3999"</span> <span class="code-xml-attribute-local-name">additive-symbols</span>=<span class="code-xml-attribute-value">"1000 'm', 900 'cm', 500 'd', 400 'cd', 100 'c', 90 'xc', 50 'l', 40 'xl', 10 'x', 9 'ix', 5 'v', 4 'iv', 1 'i'"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">css:</span><span class="code-xml-element-local-name">counter-style</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"upper-roman"</span> <span class="code-xml-attribute-local-name">system</span>=<span class="code-xml-attribute-value">"additive"</span> <span class="code-xml-attribute-local-name">range</span>=<span class="code-xml-attribute-value">"1 3999"</span> <span class="code-xml-attribute-local-name">additive-symbols</span>=<span class="code-xml-attribute-value">"1000 'M', 900 'CM', 500 'D', 400 'CD', 100 'C', 90 'XC', 50 'L', 40 'XL', 10 'X', 9 'IX', 5 'V', 4 'IV', 1 'I'"</span>/&gt;
    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span>&gt;
    
    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">function</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"css:custom-counter-style"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"element(css:counter-style)?"</span>&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"name"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string"</span>/&gt;
    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">function</span>&gt;
    
    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">function</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"css:parse-counter-styles"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"map(xs:string,element(css:counter-style))"</span>&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"stylesheet"</span>&gt;
            
        &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span>&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">map</span>&gt;
            &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"stylesheet"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"element(css:rule)?"</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">choose</span>&gt;
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"not(exists($stylesheet))"</span>/&gt;
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$stylesheet instance of element(css:rule)"</span>&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"$stylesheet[@selector='@counter-style']"</span>/&gt;
                    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span>&gt;
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$stylesheet instance of attribute(css:counter-style)"</span>&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"stylesheet"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"element(css:rule)"</span>&gt;
                            &lt;<span class="code-xml-element-prefix">css:</span><span class="code-xml-element-local-name">rule</span> <span class="code-xml-attribute-local-name">selector</span>=<span class="code-xml-attribute-value">"@counter-style"</span> <span class="code-xml-attribute-local-name">style</span>=<span class="code-xml-attribute-value">"{string($stylesheet)}"</span>/&gt;
                        &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span>&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"css:deep-parse-stylesheet(css:serialize-stylesheet($stylesheet))                                               [@selector='@counter-style']"</span>/&gt;
                    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span>&gt;
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$stylesheet=''"</span>/&gt;
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">otherwise</span>&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"css:deep-parse-stylesheet($stylesheet)[@selector='@counter-style']"</span>/&gt;
                    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">otherwise</span>&gt;
                &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">choose</span>&gt;
            &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span>&gt;
            &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">for-each</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"$stylesheet/css:rule"</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"name"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"replace(@selector,'^&amp; ','')"</span>/&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">if</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"matches($name,re:exact($css:IDENT_RE))"</span>&gt;
                    
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"system"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"(css:property[@name='system']/@value,                                                                         'symbolic')[1]"</span>/&gt;
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"symbols"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string?"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"if ($system='additive')                                           then (css:property[@name='additive-symbols']/@value)[1]                                           else (css:property[@name='symbols']/@value)[1]"</span>/&gt;
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">if</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$system=('cyclic','numeric','alphabetic','symbolic','additive','fixed')                                   and exists($symbols)"</span>&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"negative"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"(css:property[@name='negative']/@value,                                                                               '-')[1]"</span>/&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"prefix"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"(css:property[@name='prefix']/@value,                                                                             '')[1]"</span>/&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"suffix"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"(css:property[@name='suffix']/@value,                                                                             ' ')[1]"</span>/&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"fallback"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"(css:property[@name='fallback']/@value,                                                                               'decimal')[1]"</span>/&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"text-transform"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"(css:property[@name='text-transform']/@value,                                                                                     'auto')[1]"</span>/&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">map-entry</span> <span class="code-xml-attribute-local-name">key</span>=<span class="code-xml-attribute-value">"$name"</span>&gt;
                            &lt;<span class="code-xml-element-prefix">css:</span><span class="code-xml-element-local-name">counter-style</span> <span class="code-xml-attribute-local-name">system</span>=<span class="code-xml-attribute-value">"{$system}"</span> <span class="code-xml-attribute-local-name">negative</span>=<span class="code-xml-attribute-value">"{$negative}"</span> <span class="code-xml-attribute-local-name">prefix</span>=<span class="code-xml-attribute-value">"{$prefix}"</span> <span class="code-xml-attribute-local-name">suffix</span>=<span class="code-xml-attribute-value">"{$suffix}"</span> <span class="code-xml-attribute-local-name">fallback</span>=<span class="code-xml-attribute-value">"{$fallback}"</span> <span class="code-xml-attribute-local-name">text-transform</span>=<span class="code-xml-attribute-value">"{$text-transform}"</span>&gt;
                                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">attribute</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"{if ($system='additive') then 'additive-symbols' else 'symbols'}"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"$symbols"</span>/&gt;
                            &lt;/<span class="code-xml-element-prefix">css:</span><span class="code-xml-element-local-name">counter-style</span>&gt;
                        &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">map-entry</span>&gt;
                    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">if</span>&gt;
                &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">if</span>&gt;
            &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">for-each</span>&gt;
        &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">map</span>&gt;
    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">function</span>&gt;
    
    
    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">function</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"css:round-line-height"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string"</span>&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"line-height"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">analyze-string</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"$line-height"</span> <span class="code-xml-attribute-local-name">regex</span>=<span class="code-xml-attribute-value">"^(({$css:POSITIVE_NUMBER_RE})|({$css:POSITIVE_PERCENTAGE_RE}))$"</span>&gt;
            &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">matching-substring</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"value"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:double"</span>&gt;
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">choose</span>&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"regex-group(2)!=''"</span>&gt;
                            &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"number(regex-group(2))"</span>/&gt;
                        &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span>&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">otherwise</span>&gt;
                            &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"number(regex-group(2 + $css:POSITIVE_NUMBER_RE_groups + 1 + $css:POSITIVE_PERCENTAGE_RE_number))                                                   div 100"</span>/&gt;
                        &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">otherwise</span>&gt;
                    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">choose</span>&gt;
                &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"value"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:double"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"round($value * 4) div 4"</span>/&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"format-number($value, '0.##')"</span>/&gt;
            &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">matching-substring</span>&gt;
            &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">non-matching-substring</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">message</span> <span class="code-xml-attribute-local-name">terminate</span>=<span class="code-xml-attribute-value">"yes"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"concat('Not a valid line-height: ',$line-height)"</span>/&gt;
            &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">non-matching-substring</span>&gt;
        &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">analyze-string</span>&gt;
    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">function</span>&gt;
    
&lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">stylesheet</span>&gt;</div></body>
</html>
