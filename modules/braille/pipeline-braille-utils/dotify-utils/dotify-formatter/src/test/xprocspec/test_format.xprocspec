<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns:x="http://www.daisy.org/ns/xprocspec"
               xmlns:dotify="http://code.google.com/p/dotify/"
               xmlns:p="http://www.w3.org/ns/xproc"
               xmlns:pxi="http://www.daisy.org/ns/pipeline/xproc/internal">
  
  <x:script>
    <p:declare-step type="dotify:format" version="1.0">
      <p:input port="source"/>
      <p:output port="result" primary="true"/>
      <p:output port="obfl" sequence="false">
        <p:pipe step="obfl" port="result"/>
      </p:output>
      <p:option name="text-transform" select="''"/>
      <p:option name="skip-margin-top-of-page" select="'false'"/>
      <p:import href="../../main/resources/xml/css-to-obfl.xpl"/>
      <p:import href="../../main/resources/xml/obfl-normalize-space.xpl"/>
      <p:import href="http://www.daisy.org/pipeline/modules/braille/dotify-utils/library.xpl"/>
      <pxi:css-to-obfl name="obfl" duplex="true">
        <p:with-option name="text-transform" select="concat($text-transform,'(input:text-css)(output:braille)')"/>
        <p:with-option name="skip-margin-top-of-page" select="$skip-margin-top-of-page"/>
      </pxi:css-to-obfl>
      <pxi:obfl-normalize-space/>
      <p:for-each><p:identity/></p:for-each>
      <dotify:obfl-to-pef locale="und">
        <p:with-option name="mode" select="concat($text-transform,'(input:text-css)(output:braille)')"/>
      </dotify:obfl-to-pef>
    </p:declare-step>
  </x:script>
  
  <x:scenario label="test_01">
    <x:documentation>
      Tests page styles with different dimensions in the same document.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page { size: 15 5 }">
              <frontmatter style="{ display: block } @page { size: 30 5 }">
                ⠤⠤⠤
              </frontmatter>
              <bodymatter style="display: block">
                ⠤⠤⠤
              </bodymatter>
              <rearmatter style="{ display: block } @page { size: 30 5 }">
                ⠤⠤⠤
              </rearmatter>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="30" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <layout-master name="b" page-width="15" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              ⠤⠤⠤
            </block>
          </sequence>
          <sequence master="b">
            <block>
              ⠤⠤⠤
            </block>
          </sequence>
          <sequence master="a">
            <block>
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="30" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
              <section cols="15">
                <page>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_02">
    <x:documentation>
      Tests rendering print page, running header and running footer in page margin. The strings are
      set, and sometimes emptied, individually at various places in the document.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page {
                         size: 20 5;
                         @top-center { content: string(running-header) }
                         @bottom-right { content: string(print-page) }
                         @bottom-center { content: string(running-footer) }}">
              <section style="display: block;">
                ⠤⠤⠤
              </section>
              <section style="display: block;
                              page-break-before: always;
                              string-set: print-page '⠤'">
                ⠤⠤⠤
              </section>
              <section style="display: block;
                              page-break-before: always;
                              string-set: print-page '⠤⠤', running-footer '⠤⠤'">
                ⠤⠤⠤
              </section>
              <section style="display: block;
                              page-break-before: always;
                              string-set: print-page '', running-header '⠤⠤'">
                ⠤⠤⠤
              </section>
              <section style="display: block;
                              page-break-before: always;
                              string-set: print-page '⠤⠤⠤', running-footer ''">
                ⠤⠤⠤
              </section>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="20" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <marker-reference marker="running-header" direction="forward" scope="page" text-style="/-dotify-def:tmp_.+/"/>
                  <marker-reference marker="running-header" direction="backward" scope="sequence" text-style="/-dotify-defifndef:tmp_.+/"/>
                  <marker-reference marker="running-header/entry" direction="backward" scope="sequence" text-style="/-dotify-ifndef:tmp_.+/"/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </header>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <marker-reference marker="running-footer" direction="forward" scope="page" text-style="/-dotify-def:tmp_.+/"/>
                  <marker-reference marker="running-footer" direction="backward" scope="sequence" text-style="/-dotify-defifndef:tmp_.+/"/>
                  <marker-reference marker="running-footer/entry" direction="backward" scope="sequence" text-style="/-dotify-ifndef:tmp_.+/"/>
                </field>
                <field>
                  <marker-reference marker="print-page" direction="forward" scope="page" text-style="/-dotify-def:tmp_.+/"/>
                  <marker-reference marker="print-page" direction="backward" scope="sequence" text-style="/-dotify-defifndef:tmp_.+/"/>
                  <marker-reference marker="print-page/entry" direction="backward" scope="sequence" text-style="/-dotify-ifndef:tmp_.+/"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              ⠤⠤⠤
            </block>
            <block break-before="page">
              <marker class="print-page" value="⠤"/>
              ⠤⠤⠤
            </block>
            <block break-before="page">
              <marker class="print-page/prev" value="⠤"/>
              <marker class="print-page" value="⠤⠤"/>
              <marker class="running-footer" value="⠤⠤"/>
              ⠤⠤⠤
            </block>
            <block break-before="page">
              <marker class="print-page/prev" value="⠤⠤"/>
              <marker class="print-page" value="​"/>
              <marker class="running-header" value="⠤⠤"/>
              ⠤⠤⠤
            </block>
            <block break-before="page">
              <marker class="print-page/prev" value="​"/>
              <marker class="print-page" value="⠤⠤⠤"/>
              <marker class="running-footer/prev" value="⠤⠤"/>
              <marker class="running-footer" value="​"/>
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="20" rowgap="0" duplex="true">
              <section>
                <page>
                  <row/>
                  <row>⠤⠤⠤</row>
                </page>
                <page>
                  <row/>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤</row>
                </page>
                <page>
                  <row/>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤</row>
                </page>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_03">
    <x:documentation>
      Tests rendering print page and running footer in bottom page margin. The print page and
      running footer strings are set in a previous section that has no page margin.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page { size: 20 5; }">
              <section style="display: block;
                              string-set: print-page '⠤', running-footer '⠤⠤'">
                ⠤⠤⠤
              </section>
              <section style="{ display: block }
                              @page {
                              size: 20 5;
                              @bottom-center { content: string(running-footer) }
                              @bottom-right { content: string(print-page) }}">
                ⠤⠤⠤
              </section>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="20" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <layout-master name="b" page-width="20" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <marker-reference marker="running-footer" direction="forward" scope="page" text-style="/-dotify-def:tmp_.+/"/>
                  <marker-reference marker="running-footer" direction="backward" scope="sequence" text-style="/-dotify-defifndef:tmp_.+/"/>
                  <marker-reference marker="running-footer/entry" direction="backward" scope="sequence" text-style="/-dotify-ifndef:tmp_.+/"/>
                </field>
                <field>
                  <marker-reference marker="print-page" direction="forward" scope="page" text-style="/-dotify-def:tmp_.+/"/>
                  <marker-reference marker="print-page" direction="backward" scope="sequence" text-style="/-dotify-defifndef:tmp_.+/"/>
                  <marker-reference marker="print-page/entry" direction="backward" scope="sequence" text-style="/-dotify-ifndef:tmp_.+/"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              <marker class="print-page" value="⠤"/>
              <marker class="running-footer" value="⠤⠤"/>
              ⠤⠤⠤
            </block>
          </sequence>
          <sequence master="b">
            <block>
              <marker class="print-page/entry" value="⠤"/>
              <marker class="running-footer/entry" value="⠤⠤"/>
            </block>
            <block>
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="20" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤⠀⠀⠀⠀⠀⠀⠀⠀⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_04">
    <x:documentation>
      Tests counter(page) and counter-set:page. In different sections the page number is placed in
      different positions (header, footer or nowhere).
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page {
                         size: 15 5;
                         @bottom-right { content: counter(page) }}">
              <section style="display: block;">
                ⠤⠤⠤
              </section>
              <section style="{ display: block } @page { size: 15 5 }">
                ⠤⠤⠤
              </section>
              <section style="display: block;
                              page-break-before: always">
                ⠤⠤⠤
              </section>
              <section style="display: block;
                              page-break-before: always;
                              counter-set: page 10">
                ⠤⠤⠤
              </section>
              <section style="display: block;
                              page-break-before: always">
                ⠤⠤⠤
              </section>
              <section style="{ display: block }
                              @page {
                              size: 15 5;
                              @top-right { content: counter(page) }}">
                ⠤⠤⠤
              </section>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="15" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <layout-master name="b" page-width="15" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <layout-master name="c" page-width="15" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <layout-master name="d" page-width="15" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </header>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              ⠤⠤⠤
            </block>
          </sequence>
          <sequence master="b">
            <block>
              ⠤⠤⠤
            </block>
          </sequence>
          <sequence master="a">
            <block break-before="page">
              ⠤⠤⠤
            </block>
          </sequence>
          <sequence master="c" initial-page-number="10">
            <block break-before="page">
              ⠤⠤⠤
            </block>
            <block break-before="page">
              ⠤⠤⠤
            </block>
          </sequence>
          <sequence master="d">
            <block>
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠑</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁⠚</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁⠁</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁⠃</row>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_05" pending="xfail doesn't work because of error">
    <x:documentation>
      Tests counter(page) with different counter styles. Broken: "Invalid input: 'i'" (roman numbers
      are not translated).
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page {
                         size: 15 5;
                         @bottom-right { content: counter(page) }}">
              <frontmatter style="@page {
                                  size: 15 5;
                                  @bottom-right { content: '⠏' counter(page) }}">
                ⠤⠤⠤
              </frontmatter>
              <bodymatter>
                ⠤⠤⠤
              </bodymatter>
              <rearmatter style="{ counter-set: page 1 }
                                 @page {
                                 size: 15 5;
                                 @bottom-right { content: counter(page, lower-roman) }}">
                ⠤⠤⠤
              </rearmatter>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="front" page-width="15" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value="⠏"/>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <layout-master name="body" page-width="15" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <layout-master name="rear" page-width="15" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="lower-roman"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="front">
            <block>
              ⠤⠤⠤
            </block>
          </sequence>
          <sequence master="body">
            <block>
              ⠤⠤⠤
            </block>
          </sequence>
          <sequence master="rear" initial-page-number="1">
            <block>
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠏⠼⠁</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠉</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠊</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <!--
      TODO: move orphans and widows to their own test?
  -->
  <x:scenario label="test_07">
    <x:documentation>
      Tests page-break-inside:avoid and page-break-after:avoid, both on text-only blocks and on
      blocks with nested blocks. Also tests orphans and widows.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page { size: 10 6; }">
              <section style="display: block; page-break-before: right">
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                <section style="display: block">
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                </section>
              </section>
              <section style="display: block; page-break-before: right">
                <p style="display: block">⠤⠤⠤</p>
                <p style="display: block">⠤⠤⠤</p>
                <p style="display: block">⠤⠤⠤</p>
                <p style="display: block">⠤⠤⠤</p>
                <section>
                  <p style="display: block">⠤⠤⠤</p>
                  <p style="display: block">⠤⠤⠤</p>
                  <p style="display: block">⠤⠤⠤</p>
                  <p style="display: block">⠤⠤⠤</p>
                </section>
              </section>
              <section style="display: block; page-break-before: right">
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                <section style="display: block; page-break-inside: avoid">
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                </section>
              </section>
              <section style="display: block; page-break-before: right">
                <p style="display: block">⠤⠤⠤</p>
                <p style="display: block">⠤⠤⠤</p>
                <p style="display: block">⠤⠤⠤</p>
                <p style="display: block">⠤⠤⠤</p>
                <section style="display: block; page-break-inside: avoid">
                  <p style="display: block">⠤⠤⠤</p>
                  <p style="display: block">⠤⠤⠤</p>
                  <p style="display: block">⠤⠤⠤</p>
                  <p style="display: block">⠤⠤⠤</p>
                </section>
              </section>
              <section style="display: block; page-break-before: right">
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                <section style="display: block; page-break-after: avoid">
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                </section>
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
              </section>
              <section style="display: block; page-break-before: right">
                <p style="display: block">⠤⠤⠤</p>
                <p style="display: block">⠤⠤⠤</p>
                <p style="display: block">⠤⠤⠤</p>
                <p style="display: block">⠤⠤⠤</p>
                <section style="display: block; page-break-after: avoid">
                  <p style="display: block">⠤⠤⠤</p>
                  <p style="display: block">⠤⠤⠤</p>
                </section>
                <p style="display: block">⠤⠤⠤</p>
              </section>
              <section style="display: block; page-break-before: right">
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                <section style="display: block; orphans: 3">
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                </section>
              </section>
              <section style="display: block; page-break-before: right">
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                <section style="display: block; widows: 3">
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                </section>
              </section>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" page-width="10" page-height="6" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              <block>
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
              </block>
              <block>
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
          <sequence master="body">
            <block>
              <block>⠤⠤⠤</block>
              <block>⠤⠤⠤</block>
              <block>⠤⠤⠤</block>
              <block>⠤⠤⠤</block>
              <block>⠤⠤⠤</block>
              <block>⠤⠤⠤</block>
              <block>⠤⠤⠤</block>
              <block>⠤⠤⠤</block>
            </block>
          </sequence>
          <sequence master="body">
            <block>
              <block>
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
              </block>
              <block keep="page">
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
          <sequence master="body">
            <block>
              <block>⠤⠤⠤</block>
              <block>⠤⠤⠤</block>
              <block>⠤⠤⠤</block>
              <block>⠤⠤⠤</block>
              <block>
                <block keep-with-next="1" keep="page">⠤⠤⠤</block>
                <block keep-with-next="1" keep="page">⠤⠤⠤</block>
                <block keep-with-next="1" keep="page">⠤⠤⠤</block>
                <block keep="page">⠤⠤⠤</block>
              </block>
            </block>
          </sequence>
          <sequence master="body">
            <block>
              <block>
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
              </block>
              <block keep-with-next="1" keep="page">
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
              </block>
              <block>
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
          <sequence master="body">
            <block>
              <block>⠤⠤⠤</block>
              <block>⠤⠤⠤</block>
              <block>⠤⠤⠤</block>
              <block>⠤⠤⠤</block>
              <block>
                <block>⠤⠤⠤</block>
                <block keep-with-next="1" keep="page">⠤⠤⠤</block>
              </block>
              <block>⠤⠤⠤</block>
            </block>
          </sequence>
          <sequence master="body">
            <block>
              <block>
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
              </block>
              <block orphans="3">
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
          <sequence master="body">
            <block>
              <block>
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
              </block>
              <block widows="3">
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="6" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_08">
    <x:documentation>
      Tests orphans and widows on blocks with top/bottom borders. Counting of orphan and widow lines
      does not include borders.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page { size: 10 6; }">
              <section style="display: block; page-break-before: right">
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                <section style="display: block; border-top: ⠒; border-bottom: ⠒; orphans: 3">
                  ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                  ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                  ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                  ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                </section>
              </section>
              <section style="display: block; page-break-before: right">
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                <section style="display: block; border-top: ⠒; border-bottom: ⠒; widows: 3">
                  ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                  ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                  ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                  ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                </section>
              </section>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" page-width="10" page-height="6" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              <block>
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
              </block>
              <block orphans="3"
                     border-top-style="solid"
                     border-top-align="center"
                     border-bottom-style="solid"
                     border-bottom-align="center">
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
              </block>
            </block>
          </sequence>
          <sequence master="body">
            <block>
              <block>
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
              </block>
              <block widows="3"
                     border-top-style="solid"
                     border-top-align="center"
                     border-bottom-style="solid"
                     border-bottom-align="center">
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="6" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_09">
    <x:documentation>
      Tests page-break-after:always.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform:none } @page { size: 10 6 }">
            <level1 style="display:block; page-break-after: always">
              ⠤⠤⠤
            </level1>
            <level1 style="display:block; page-break-after: always">
              ⠤⠤⠤
            </level1>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" page-width="10" page-height="6" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block> ⠤⠤⠤ </block>
            <block break-before="page"> ⠤⠤⠤ </block>
            <block break-before="page"/>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="6" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
                <page/>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_10">
    <x:documentation>
      Tests that forced page break before a first-child box is moved to container.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none; display:block">
            <body style="@page { size: 20 15 }">
              ⠿⠿⠿⠿
              <div style="display: block;
                          text-align: center;
                          border-top: ⠤;
                          border-bottom: ⠉">
                <div style="display: block;
                            margin-top: 1;
                            margin-bottom: 1;
                            page-break-before: always">
                  ⠿⠿⠿⠿
                </div>
              </div>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" page-width="20" page-height="15" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              <block>
                ⠿⠿⠿⠿
              </block>
              <block break-before="page"
                     align="center"
                     border-top-style="solid"
                     border-top-align="inner"
                     border-bottom-style="solid"
                     border-bottom-align="inner">
                <block align="center"
                       margin-top="1"
                       margin-bottom="1">
                  ⠿⠿⠿⠿
                </block>
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="15" cols="20" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠿⠿⠿⠿</row>
                  <row/>
                  <row>⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_11">
    <x:documentation>
      Tests nested blocks with borders and margins.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page { size: 20 15 }">
              <div style="display: block;
                          text-align: center;
                          margin-left: 1;
                          margin-right: 1;
                          margin-top: 1;
                          margin-bottom: 1;
                          padding-left: 1;
                          padding-right: 1;
                          padding-top: 1;
                          padding-bottom: 1;
                          border-left: ⠇;
                          border-right: ⠸;
                          border-top: ⠤;
                          border-bottom: ⠉;">
                <div style="display: block;
                            margin-left: 1;
                            margin-right: 1;
                            padding-left: 1;
                            padding-right: 1;
                            padding-top: 1;
                            padding-bottom: 1;
                            border-left: ⠇;
                            border-right: ⠸;
                            border-top: ⠤;
                            border-bottom: ⠉">
                  ⠿⠿⠿⠿
                </div>
              </div>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" page-width="20" page-height="15" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block align="center"
                   margin-left="1"
                   margin-right="1"
                   margin-top="1"
                   margin-bottom="1"
                   border-left-style="solid"
                   border-left-align="outer"
                   border-right-style="solid"
                   border-right-align="outer"
                   border-top-style="solid"
                   border-top-align="inner"
                   border-bottom-style="solid"
                   border-bottom-align="inner"
                   padding-top="1"
                   padding-bottom="1">
                <block align="center"
                       margin-left="2"
                       margin-right="2"
                       border-left-style="solid"
                       border-left-align="outer"
                       border-right-style="solid"
                       border-right-align="outer"
                       border-top-style="solid"
                       border-top-align="inner"
                       border-bottom-style="solid"
                       border-bottom-align="inner"
                       padding-left="1"
                       padding-right="1"
                       padding-top="1"
                       padding-bottom="1">
                  ⠿⠿⠿⠿
                </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="15" cols="20" rowgap="0" duplex="true">
              <section>
                <page>
                  <row/>
                  <row>⠀⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠀⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⠀</row>
                  <row>⠀⠇⠀⠀⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠀⠀⠸⠀</row>
                  <row>⠀⠇⠀⠀⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⠀⠀⠸⠀</row>
                  <row>⠀⠇⠀⠀⠇⠀⠀⠀⠿⠿⠿⠿⠀⠀⠀⠸⠀⠀⠸⠀</row>
                  <row>⠀⠇⠀⠀⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⠀⠀⠸⠀</row>
                  <row>⠀⠇⠀⠀⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠀⠀⠸⠀</row>
                  <row>⠀⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⠀</row>
                  <row>⠀⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉</row>
                  <row/>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_12">
    <x:documentation>
      Tests top and bottom borders with pattern "⠒".
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page { size: 20 15 }">
              <div style="display: block;
                          text-align: center;
                          border-left: ⠇;
                          border-right: ⠸;
                          border-top: ⠒;
                          border-bottom: ⠒">
                ⠿⠿⠿⠿
              </div>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" page-width="20" page-height="15" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block align="center"
                   border-left-style="solid"
                   border-left-align="outer"
                   border-right-style="solid"
                   border-right-align="outer"
                   border-top-style="solid"
                   border-top-align="center"
                   border-bottom-style="solid"
                   border-bottom-align="center">
              ⠿⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="15" cols="20" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠖⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠲</row>
                  <row>⠇⠀⠀⠀⠀⠀⠀⠀⠿⠿⠿⠿⠀⠀⠀⠀⠀⠀⠀⠸</row>
                  <row>⠓⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠚</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_13">
    <x:documentation>
      Tests ::after pseudo element.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page { size: 30 2; }">
              <table>
                <tr style="display: block">
                  <td style="::after { content: '⠆' } ">⠤⠤⠤</td>
                  <td style="::after { content: '⠆' } ">⠤⠤⠤</td>
                  <td style="::after { content: '⠆' } ">⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                </tr>
              </table>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" page-width="30" page-height="2" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
                  ⠤⠤⠤⠆
                  ⠤⠤⠤⠆
                  ⠤⠤⠤⠆
                  ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="2" cols="30" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠆⠀⠤⠤⠤⠆⠀⠤⠤⠤⠆⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_14">
    <x:documentation>
      Tests cumulation of left margins.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="display: block; margin-left: 1">
              <p style="display: block; margin-left: 1"> ⠤⠤⠤ </p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" page-width="40" page-height="25" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              <block padding-left="2">
                ⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠀⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_15">
    <x:documentation>
      Tests cumulation of left margins including negative margins.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="display: block; margin-left: 3">
              <p style="display: block; margin-left: -1"> ⠤⠤⠤ </p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" page-width="40" page-height="25" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              <block padding-left="2">
                ⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠀⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_16">
    <x:documentation>
      Tests text-indent.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform:none } @page { size: 15 5 }">
            <body>
              <p style="display: block; text-indent: 2"> ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ </p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" page-width="15" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block first-line-indent="2">
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_17">
    <x:documentation>
      Tests hanging indentation (negative text-indent).
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform:none } @page { size: 15 5 }">
            <body style="display: block; margin-left: 4">
              <p style="display: block; text-indent: -2"> ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ </p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" page-width="15" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              <block first-line-indent="2" text-indent="4">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠀⠀⠀⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_18">
    <x:documentation>
      Tests print page break indicator line within block. The line breaks the block in two
      fragments. The text-indent of the block is only applied to the first fragment.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform:none } @page { size: 15 5 }">
            <p style="display: block; text-indent: 2">
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              <pagenum style="{display:block;text-indent:0} ::before{content: leader('⠐') ' '}">⠿</pagenum>
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
            </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" page-width="15" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              <block first-line-indent="2">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </block>
              <block>
                <leader pattern="⠐" position="100%" align="right"/>
                ⠿
              </block>
              <block>
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠐⠐⠐⠐⠐⠐⠐⠐⠐⠐⠐⠐⠐⠀⠿</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_19">
    <x:documentation>
      Tests display:list-item, list-style-type and counter-reset.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <ul style="text-transform: none; list-style-type: decimal">
            <li style="display: list-item">⠤⠤⠤</li>
            <li style="display: list-item">⠤⠤⠤</li>
            <li>
              <ul style="list-style-type: lower-roman; counter-reset: list-item">
                <li style="display: list-item">⠤⠤⠤</li>
                <li style="display: list-item">⠤⠤⠤</li>
              </ul>
            </li>
            <li>
              <ul style="list-style-type: '⠶'; counter-reset: list-item">
                <li style="display: list-item">⠤⠤⠤</li>
                <li style="display: list-item">⠤⠤⠤</li>
              </ul>
            </li>
            <li style="display: list-item">⠤⠤⠤</li>
          </ul>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" page-width="40" page-height="25" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block><span translate="">1</span> ⠤⠤⠤ </block>
            <block><span translate="">2</span> ⠤⠤⠤ </block>
            <block><span translate="">i</span> ⠤⠤⠤ </block>
            <block><span translate="">ii</span> ⠤⠤⠤ </block>
            <block>⠶ ⠤⠤⠤ </block>
            <block>⠶ ⠤⠤⠤ </block>
            <block><span translate="">3</span> ⠤⠤⠤ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠁⠀⠤⠤⠤</row>
                  <row>⠼⠃⠀⠤⠤⠤</row>
                  <row>⠊⠀⠤⠤⠤</row>
                  <row>⠊⠊⠀⠤⠤⠤</row>
                  <row>⠶⠀⠤⠤⠤</row>
                  <row>⠶⠀⠤⠤⠤</row>
                  <row>⠼⠉⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_20">
    <x:documentation>
      Tests a table of content with target-text(), target-string(), target-counter() and
      leader().
    </x:documentation>
      <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page { size: 14 8; @bottom-right { content: counter(page) }}">
              <frontmatter>
                <toc>
                  <entry ref="chapter_1" style="display: block;
                                                content: target-text(attr(ref))
                                                         ' ⠄⠄⠄⠄⠄⠄⠄ '
                                                         target-string(attr(ref), print-page)
                                                         ' '
                                                         target-counter(attr(ref), page)"/>
                  <entry ref="chapter_2" style="display: block;
                                                content: target-text(attr(ref))
                                                         ' ⠄⠄⠄⠄⠄⠄ '
                                                         target-string(attr(ref), print-page)
                                                         ' '
                                                         target-counter(attr(ref), page)"/>
                  <entry ref="chapter_3" style="display: block;
                                                content: target-text(attr(ref))
                                                         ' ⠄⠄⠄⠄ '
                                                         target-string(attr(ref), print-page)
                                                         ' '
                                                         target-counter(attr(ref), page)"/>
                </toc>
              </frontmatter>
              <bodymatter>
                <pagenum style="display:none;string-set:print-page '⠤'"/>
                <h id="chapter_1" style="display:block;text-align:center;page-break-before:always">⠿</h>
                <p style="display:block">⠤⠤⠤</p>
                <h id="chapter_2" style="display:block;text-align:center;page-break-before:always">⠿⠿</h>
                <p style="display:block">⠤⠤⠤</p>
                <pagenum style="display:none;string-set:print-page '⠤⠤'"/>
                <h id="chapter_3" style="display:block;text-align:center;page-break-before:always">⠿⠿⠿</h>
                <p style="display:block">⠤⠤⠤</p>
              </bodymatter>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" page-width="14" page-height="8" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              ⠿
              ⠄⠄⠄⠄⠄⠄⠄
              ⠤
              <page-number ref-id="chapter_1" number-format="default"/>
            </block>
            <block>
              ⠿⠿
              ⠄⠄⠄⠄⠄⠄
              ⠤
              <page-number ref-id="chapter_2" number-format="default"/>
            </block>
            <block>
              ⠿⠿⠿
              ⠄⠄⠄⠄
              ⠤⠤
              <page-number ref-id="chapter_3" number-format="default"/>
            </block>
            <block align="center" break-before="page" id="chapter_1">
              <marker class="print-page" value="⠤"/>
              ⠿
            </block>
            <block>
              ⠤⠤⠤
            </block>
            <block align="center" break-before="page" id="chapter_2">
              ⠿⠿
            </block>
            <block>
              ⠤⠤⠤
            </block>
            <block align="center" break-before="page" id="chapter_3">
              <marker class="print-page/prev" value="⠤"/>
              <marker class="print-page" value="⠤⠤"/>
              ⠿⠿⠿
            </block>
            <block>
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="8" cols="14" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠀⠄⠄⠄⠄⠄⠄⠄⠀⠤⠀⠼⠃</row>
                  <row>⠿⠿⠀⠄⠄⠄⠄⠄⠄⠀⠤⠀⠼⠉</row>
                  <row>⠿⠿⠿⠀⠄⠄⠄⠄⠀⠤⠤⠀⠼⠙</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠿</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠃</row>
                </page>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠿⠿</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠉</row>
                </page>
                <page>
                  <row>⠀⠀⠀⠀⠀⠿⠿⠿</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠙</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_21">
    <x:documentation>
      Tests target-text() and target-counter() with both forward references (table of contents in
      the front) and backward references (index in the back).
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page { size: 15 5; @bottom-right { content: counter(page) }}">
              <frontmatter>
                <toc>
                  <entry ref="chapter_1" style="display: block;
                                                content: target-text(attr(ref))
                                                         ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄ '
                                                         target-counter(attr(ref), page)"/>
                  <entry ref="chapter_2" style="display: block;
                                                content: target-text(attr(ref))
                                                         ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄ '
                                                         target-counter(attr(ref), page)"/>
                </toc>
              </frontmatter>
              <bodymatter style="display:block;page-break-before:always">
                <h style="display:block" id="chapter_1">⠿</h>
                <p style="display:block" id="x">⠤⠤⠤</p>
                <h style="display:block" id="chapter_2">⠿⠿</h>
                <p style="display:block" id="y">⠤⠤⠤</p>
                <p style="display:block" id="z">⠤⠤⠤</p>
              </bodymatter>
              <rearmatter style="display:block;page-break-before:always">
                <index>
                  <entry ref="x" style="display: block;
                                        content: target-text(attr(ref))
                                                 ' ⠄⠄⠄⠄⠄⠄⠄⠄ '
                                                 target-counter(attr(ref), page)"/>
                  <entry ref="y" style="display: block;
                                        content: target-text(attr(ref))
                                                 ' ⠄⠄⠄⠄⠄⠄⠄⠄ '
                                                 target-counter(attr(ref), page)"/>
                  <entry ref="z" style="display: block;
                                        content: target-text(attr(ref))
                                                 ' ⠄⠄⠄⠄⠄⠄⠄⠄ '
                                                 target-counter(attr(ref), page)"/>
                </index>
              </rearmatter>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" page-width="15" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              ⠿
              ⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄
              <page-number ref-id="chapter_1" number-format="default"/>
            </block>
            <block>
              ⠿⠿
              ⠄⠄⠄⠄⠄⠄⠄⠄⠄
              <page-number ref-id="chapter_2" number-format="default"/>
            </block>
            <block break-before="page">
              <block id="chapter_1">
                ⠿
              </block>
              <block id="x">
                ⠤⠤⠤
              </block>
              <block id="chapter_2">
                ⠿⠿
              </block>
              <block id="y">
                ⠤⠤⠤
              </block>
              <block id="z">
                ⠤⠤⠤
              </block>
            </block>
            <block break-before="page">
              <block>
                ⠤⠤⠤
                ⠄⠄⠄⠄⠄⠄⠄⠄
                <page-number ref-id="x" number-format="default"/>
              </block>
              <block>
                ⠤⠤⠤
                ⠄⠄⠄⠄⠄⠄⠄⠄
                <page-number ref-id="y" number-format="default"/>
              </block>
              <block>
                ⠤⠤⠤
                ⠄⠄⠄⠄⠄⠄⠄⠄
                <page-number ref-id="z" number-format="default"/>
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠃</row>
                  <row>⠿⠿⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠃</row>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
                <page>
                  <row>⠿</row>
                  <row>⠤⠤⠤</row>
                  <row>⠿⠿</row>
                  <row>⠤⠤⠤</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠃</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠉</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠃</row>
                  <row>⠤⠤⠤⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠃</row>
                  <row>⠤⠤⠤⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠉</row>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠙</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_22" pending="xfail doesn't work because of error">
    <x:documentation>
      Tests target-counter() referencing inline element.
      
      Broken: "Failed to complete volume division": is this a Dotify bug?
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform:none } @page { size: 14 8 }">
            <p style="display:block">
              <a href="foo" style="::after { content: target-counter(attr(href), page) }"/>
            </p>
            <p style="display:block">
              ⠤⠤⠤⠤
              <a id="foo">
                ⠿
              </a>
            </p>
            <p style="display:block">
              ⠤⠤⠤⠤
            </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" page-width="14" page-height="8" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              <page-number ref-id="foo" number-format="default"/>
            </block>
            <block>
              ⠤⠤⠤⠤
              <span id="foo">
                ⠿
              </span>
            </block>
            <block>
              ⠤⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="8" cols="14" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠁</row>
                  <row>⠤⠤⠤⠤⠀⠿</row>
                  <row>⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_23">
    <x:documentation>
      Tests generated newline (&#xA;) and white-space:pre-line.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none; display:block">
            ⠤⠤⠤<br style="::before { content: '&#xA;'; white-space: pre-line; }"/>⠤⠤⠤
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="40" page-height="25" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              ⠤⠤⠤<br/>⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_24">
    <x:documentation>
      Tests -obfl-vertical-position and -obfl-vertical-align:before.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <div style="display: block; -obfl-vertical-align: before; -obfl-vertical-position: 5">
              ⠤⠤⠤
            </div>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="40" page-height="25" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block vertical-align="before" vertical-position="5">
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="40" rows="25" rowgap="0" duplex="true">
              <section>
                <page>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_25">
    <x:documentation>
      Tests (pre-)hyphenation.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform:none; display:block } @page { size: 12 5; }">
            ⠿⠿⠿⠿⠿⠿ ⠿⠿⠿­⠿⠿⠿ ⠿⠿⠿⠿⠿⠿
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="12" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block >
              ⠿⠿⠿⠿⠿⠿ ⠿⠿⠿­⠿⠿⠿ ⠿⠿⠿⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="12" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠤</row>
                  <row>⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_26">
    <x:documentation>
      Tests collapsing of margins of adjacent sibling blocks, and non-collapsing of padding.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page { size: 20 15 }">
              <div style="display: block; margin-bottom: 1">
                ⠿⠿⠿⠿
              </div>
              <div style="display: block; margin-top: 1; margin-bottom: 1">
                ⠿⠿⠿⠿
              </div>
              <div style="display: block; padding-top: 1">
                ⠿⠿⠿⠿
              </div>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" page-width="20" page-height="15" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block margin-bottom="1">
              ⠿⠿⠿⠿
            </block>
            <block margin-top="1" margin-bottom="1">
              ⠿⠿⠿⠿
            </block>
            <block padding-top="1">
              ⠿⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="15" cols="20" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿</row>
                  <row/>
                  <row>⠿⠿⠿⠿</row>
                  <row/>
                  <row/>
                  <row>⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_27">
    <x:documentation>
      Tests collapsing of margins of three adjacent sibling blocks, the middle one being empty.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <p style="display:block; margin-bottom:1"> ⠿ </p>
            <p style="display:block; margin-bottom:1"/>
            <p style="display:block; margin-top:1"> ⠿ </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="40" page-height="25" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block margin-bottom="1"> ⠿ </block>
            <block margin-bottom="1"/>
            <block margin-top="1"> ⠿ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿</row>
                  <row/>
                  <row>⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_28">
    <x:documentation>
      Tests line-height:2 on blocks.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform:none } @page { size: 40 25 }">
            <body>
              <p style="display: block; line-height: 2">
                ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
              </p>
              <p style="display: block; line-height: 2">
                ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
              </p>
              <p style="display: block; line-height: 2">
                ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
              </p>
              <p style="display: block; line-height: 2">
                ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
              </p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="40" page-height="25" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block row-spacing="2.0">⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿</block>
            <block row-spacing="2.0">⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿</block>
            <block row-spacing="2.0">⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿</block>
            <block row-spacing="2.0">⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿</block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row rowgap="4">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row rowgap="4">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row rowgap="4">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_29">
    <x:documentation>
      Tests line-height:2 on root element.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none; line-height:2">
            <body>
              <p style="display:block">
                ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
              </p>
              <p style="display:block">
                ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
              </p>
              <p style="display:block">
                ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
              </p>
              <p style="display:block">
                ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
              </p>
              </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="40" page-height="25" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block row-spacing="2.0">⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿</block>
            <block row-spacing="2.0">⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿</block>
            <block row-spacing="2.0">⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿</block>
            <block row-spacing="2.0">⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿</block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row rowgap="4">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row rowgap="4">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row rowgap="4">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_30">
    <x:documentation>
      Tests combination of line-height:2 and margin-top or margin-bottom.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body>
              <p style="display: block; line-height: 2; margin-bottom: 1;">
                ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
              </p>
              <p style="display: block; line-height: 2; margin-top: 1; margin-bottom: 1;">
                ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
              </p>
              <p style="display: block; line-height: 2; margin-top: 1;">
                ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
              </p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="40" page-height="25" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block margin-bottom="1">
              <block row-spacing="2.0">⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿</block>
            </block>
            <block margin-top="1" margin-bottom="1">
              <block row-spacing="2.0">⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿</block>
            </block>
            <block margin-top="1">
              <block row-spacing="2.0">⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿</block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row rowgap="4">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row/>
                  <row rowgap="4">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row/>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_31">
    <x:documentation>
      Tests combination of line-height:2 and border-bottom.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none; display:block">
            <p style="display:block; line-height:2; border-bottom:⠒">
              ⠿⠿⠿⠿⠿⠿⠿⠿
            </p>
            ⠿⠿⠿⠿⠿⠿⠿⠿
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="40" page-height="25" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              <block border-bottom-style="solid" border-bottom-align="center">
                <block row-spacing="2.0"> ⠿⠿⠿⠿⠿⠿⠿⠿ </block>
              </block>
              <block> ⠿⠿⠿⠿⠿⠿⠿⠿ </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="40" rows="25" rowgap="0" duplex="true">
              <section>
                <page>
                  <row rowgap="4">⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_32">
    <x:documentation>
      Tests combination of line-height:2, margin-bottom, and text-align. Text-align must end up on
      inner block.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none; display:block">
            <p style="display:block; line-height:2; margin-bottom:1; text-align:center">
              ⠿⠿⠿⠿⠿⠿⠿⠿
            </p>
            ⠿⠿⠿⠿⠿⠿⠿⠿
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="40" page-height="25" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              <block margin-bottom="1">
                <block row-spacing="2.0" align="center"> ⠿⠿⠿⠿⠿⠿⠿⠿ </block>
              </block>
              <block> ⠿⠿⠿⠿⠿⠿⠿⠿ </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="40" rows="25" rowgap="0" duplex="true">
              <section>
                <page>
                  <row rowgap="4">⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row/>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_33">
    <x:documentation>
      Tests margin-top:1 in @page.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform:none } @page { margin-top: 1; }">
            <body>
              <p style="display:block">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="40" page-height="25" duplex="true" page-number-variable="page">
            <default-template>
              <header>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </header>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_34">
    <x:documentation>
      Tests margin-top:2 in @page.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform:none } @page { margin-top: 2; }">
            <body>
              <p style="display:block">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="40" page-height="25" duplex="true" page-number-variable="page">
            <default-template>
              <header>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </header>
              <header>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </header>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_35">
    <x:documentation>
      Tests simple content in @top-left.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform:none } @page { @top-left { content: '⠆' } margin-top: 1; }">
            <body>
              <p style="display:block">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="40" page-height="25" duplex="true" page-number-variable="page">
            <default-template>
              <header>
                <field>
                  <string value="⠆"/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </header>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_36">
    <x:documentation>
      Tests simple content in @top-left within two-line top page margin.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform:none } @page { @top-left { content: '⠆' } margin-top: 2; }">
            <body>
              <p style="display:block">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="40" page-height="25" duplex="true" page-number-variable="page">
            <default-template>
              <header>
                <field>
                  <string value="⠆"/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </header>
              <header>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </header>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <x:scenario label="test_37">
    <x:documentation>
      Tests @page:right and @page:left pseudo-selectors.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform:none } @page:right{margin-top:1} @page:left{margin-top:2}">
            <body>
              <p style="display:block;">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</p>
              <p style="display:block; page-break-before:always;">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="40" page-height="25" duplex="true" page-number-variable="page">
            <template use-when="(= (% $page 2) 1)">
              <header>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </header>
              <footer/>
            </template>
            <template use-when="(= (% $page 2) 0)">
              <header>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </header>
              <header>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </header>
              <footer/>
            </template>
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
            </block>
            <block break-before="page">
              ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_38">
    <x:documentation>
      Tests empty blocks. Blocks containing only an empty span or a blank braille pattern are also
      considered empty.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none; display:block">
            <p style="display:block"/>
            ⠿
            <p style="display:block">
              <span> </span>
            </p>
            ⠿
            <p style="display:block"> </p>
            ⠿
            <p style="display:block">⠀</p>
            ⠿
            <p style="display:block; margin-bottom:1"/>
            ⠿
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="40" page-height="25" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              <block/>
              <block>⠿</block>
              <block/>
              <block>⠿</block>
              <block> </block>
              <block>⠿ </block>
              <block/>
              <block>⠿</block>
              <block margin-bottom="1"/>
              <block>⠿</block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠀</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row/>
                  <row>⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_39">
    <x:documentation>
      Tests empty blocks with border. A block containing a blank braille pattern is also considered
      empty.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <p style="display:block; border-bottom:⠤"/>
            <p style="display:block; border-bottom:⠤"> ⠀ </p>
            <p style="display:block; border-bottom:⠤">   </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="40" page-height="25" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block border-bottom-style="solid" border-bottom-align="outer"/>
            <block border-bottom-style="solid" border-bottom-align="outer"/>
            <block border-bottom-style="solid" border-bottom-align="outer">   </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠀</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_40" pending="xfail doesn't work because of error">
    <x:documentation>
      Tests target-counter() referencing empty inline element. Broken: "Failed to complete volume
      division": is this a Dotify bug?
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <p style="display:block">
              <a href="foo" style="::after { content: target-counter(attr(href), page) }"/>
            </p>
            <p style="display:block">
              <a id="foo"/>
            </p>
            <p style="display:block">
              ⠿
            </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="40" page-height="25" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              <page-number ref-id="foo" number-format="default"/>
            </block>
            <block>
              <span id="foo"/>
            </block>
            <block>
              ⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠁</row>
                  <row>⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_41">
    <x:documentation>
      Tests hyphens:none, text-transform. hyphens:none is currently handled in XSLT (not in
      Dotify). text-transform is handled in Dotify.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform:none } @page { size: 12 8 }">
            <p style="display:block">
              ⠿⠿⠿­⠿⠿⠿ ⠿⠿⠿­⠿⠿⠿
            </p>
            <p style="display:block; hyphens:none">
              ⠿⠿⠿­⠿⠿⠿ ⠿⠿⠿­⠿⠿⠿
            </p>
            <p style="display:block">
              <span style="text-transform:auto">1</span> ⠿⠿⠿
            </p>
            <p style="display:block">
              <span style="text-transform:downshift">1</span> ⠿⠿⠿
            </p>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" page-width="12" page-height="8" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              ⠿⠿⠿­⠿⠿⠿ ⠿⠿⠿­⠿⠿⠿
            </block>
            <block>
              ⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿
            </block>
            <block>
              <span translate="">1</span> ⠿⠿⠿
            </block>
            <block>
              <span translate=""><style name="text-transform:downshift">1</style></span> ⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="8" cols="12" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠤</row>
                  <row>⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿</row>
                  <row>⠼⠁⠀⠿⠿⠿</row>
                  <row>⠂⠀⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_42">
    <x:documentation>
      Tests margin-bottom:1 in @page.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform:none } @page { size: 15 5; margin-bottom: 1; }">
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="15" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_43">
    <x:documentation>
      Tests margin-bottom:2 in @page.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform:none } @page { size: 15 5; margin-bottom: 2; }">
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="15" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_44">
    <x:documentation>
      Tests simple content in @bottom-left.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform:none }
                      @page { @bottom-left { content: '⠆' } size: 15 5; margin-bottom: 1; }">
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="15" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value="⠆"/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row/>
                  <row/>
                  <row>⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_45">
    <x:documentation>
      Tests simple content in @bottom-left within two-line bottom page margin.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform:none }
                      @page { @bottom-left { content: '⠆' } size: 15 5; margin-bottom: 2;}">
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="15" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
              <footer>
                <field>
                  <string value="⠆"/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_46">
    <x:documentation>
      Tests newline (&#x0a;) with white-space:pre-wrap in bottom page margin, which results into
      multi-line footer.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform:none }
                      @page { @bottom-left { content: '⠆&#x0a;⠆⠆'; white-space: pre-wrap; } size: 15 5; margin-bottom: 2; }">
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="15" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value="⠆"/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
              <footer>
                <field>
                  <string value="⠆⠆"/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠆⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠆⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_47">
    <x:documentation>
      Tests newline (&#x0a;) with white-space:pre-wrap in bottom page margin, which results into
      multi-line footer, even with margin-bottom:1.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform:none }
                      @page { @bottom-left { content: '⠆&#x0a;⠆⠆'; white-space: pre-wrap; } size: 15 5; margin-bottom: 1; }">
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="15" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value="⠆"/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
              <footer>
                <field>
                  <string value="⠆⠆"/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠆⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠆⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_48">
    <x:documentation>
      Tests rendering of range of print pages covered on current page (left corner of all pages) or
      current page spread (right corner of right-hand pages). Test both using the combination
      start-except-last/last (top of page) and the combination start/last-except-start (bottom of
      page).
      
      Note: the start/last-except-start part of the test is currently disabled because
      "last-except-start" is not supported anymore.
      
      Broken: behavior of page-content changed in Dotify 2.0.0 (see
      https://github.com/joeha480/dotify/issues/150) and spread-content does not exist.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform:none }
                      @page {
                        size: 20 7;
                      }
                      @page:left {
                        margin-top: 1;
                        margin-bottom: 1;
                        @top-left {
                          content: string(print-page-dash, page-start-except-last)
                                   string(print-page, page-last); }}
                      @page:right {
                        margin-top: 1;
                        margin-bottom: 1;
                        @top-left {
                          content: string(print-page-dash, page-start-except-last)
                                   string(print-page, page-last); }
                        @top-right {
                          content: string(print-page-dash, spread-start-except-last)
                                   string(print-page, spread-last); }}"
               style-bottom="@page:left {
                               @bottom-left {
                                 content: string(print-page, page-start)
                                          string(dash-print-page, page-last-except-start); }}
                             @page:right {
                               @bottom-left {
                                 content: string(print-page, page-start)
                                          string(dash-print-page, page-last-except-start); }
                               @bottom-right {
                                 content: string(print-page, spread-start)
                                          string(dash-print-page, spread-last-except-start); }}">
            <pagenum style="display: none;
                            string-set: print-page content(),
                                        dash-print-page '⠒' content(),
                                        print-page-dash content() '⠒'">1</pagenum>
            <!-- begin right page -->
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <!-- begin left page -->
            <pagenum style="display: none;
                            string-set: print-page content(),
                                        dash-print-page '⠒' content(),
                                        print-page-dash content() '⠒'">2</pagenum>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <!-- begin right page -->
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <pagenum style="display: none;
                            string-set: print-page content(),
                                        dash-print-page '⠒' content(),
                                        print-page-dash content() '⠒'">3</pagenum>
            <p style="display: block">⠁⠁⠁</p>
            <!-- begin left page -->
            <pagenum style="display: none;
                            string-set: print-page content(),
                                        dash-print-page '⠒' content(),
                                        print-page-dash content() '⠒'">4</pagenum>
            <p style="display: block">⠁⠁⠁</p>
            <pagenum style="display: none;
                            string-set: print-page content(),
                                        dash-print-page '⠒' content(),
                                        print-page-dash content() '⠒'">5</pagenum>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <!-- begin right page -->
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <pagenum style="display: none;
                            string-set: print-page content(),
                                        dash-print-page '⠒' content(),
                                        print-page-dash content() '⠒'">6</pagenum>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="20" page-height="7" duplex="true" page-number-variable="page">
            <template use-when="(= (% $page 2) 1)">
              <header>
                <field>
                  <marker-reference marker="print-page-dash/prev" direction="forward" scope="page-content"/>
                  <marker-reference marker="print-page" direction="backward" scope="sequence" text-style="/-dotify-def:tmp_.+/"/>
                  <marker-reference marker="print-page/entry" direction="backward" scope="sequence" text-style="/-dotify-ifndef:tmp_.+/"/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <marker-reference marker="print-page-dash/prev" direction="forward" scope="spread" start-offset="-1"/>
                  <marker-reference marker="print-page" direction="backward" scope="sequence" text-style="/-dotify-def:tmp_.+/"/>
                  <marker-reference marker="print-page/entry" direction="backward" scope="sequence" text-style="/-dotify-ifndef:tmp_.+/"/>
                </field>
              </header>
              <footer>
                <!--
                <field>
                  <marker-reference marker="print-page/prev" direction="forward" scope="page-content" text-style="/-dotify-def:tmp_.+/"/>
                  <marker-reference marker="print-page" direction="backward" scope="sequence" text-style="/-dotify-defifndef:tmp_.+/"/>
                  <marker-reference marker="print-page/entry" direction="backward" scope="sequence" text-style="/-dotify-ifndef:tmp_.+/"/>
                  <marker-reference marker="dash-print-page" direction="backward" scope="page-content"/>
                </field>
                -->
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <!--
                <field>
                  <marker-reference marker="print-page/prev" direction="forward" scope="spread" text-style="/-dotify-def:tmp_.+/" start-offset="-1"/>
                  <marker-reference marker="print-page" direction="backward" scope="sequence" text-style="/-dotify-defifndef:tmp_.+/"/>
                  <marker-reference marker="print-page/entry" direction="backward" scope="sequence" text-style="/-dotify-ifndef:tmp_.+/"/>
                  <marker-reference marker="dash-print-page" direction="backward" scope="spread"/>
                </field>
                -->
                <field>
                  <string value=""/>
                </field>
              </footer>
            </template>
            <template use-when="(= (% $page 2) 0)">
              <header>
                <field>
                  <marker-reference marker="print-page-dash/prev" direction="forward" scope="page-content"/>
                  <marker-reference marker="print-page" direction="backward" scope="sequence" text-style="/-dotify-def:tmp_.+/"/>
                  <marker-reference marker="print-page/entry" direction="backward" scope="sequence" text-style="/-dotify-ifndef:tmp_.+/"/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </header>
              <footer>
                <!--
                <field>
                  <marker-reference marker="print-page/prev" direction="forward" scope="page-content" text-style="/-dotify-def:tmp_.+/"/>
                  <marker-reference marker="print-page" direction="backward" scope="sequence" text-style="/-dotify-defifndef:tmp_.+/"/>
                  <marker-reference marker="print-page/entry" direction="backward" scope="sequence" text-style="/-dotify-ifndef:tmp_.+/"/>
                  <marker-reference marker="dash-print-page" direction="backward" scope="page-content"/>
                </field>
                -->
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
            </template>
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <!-- begin right page -->
            <block>
              <marker class="print-page" value="1"/>
              <marker class="dash-print-page" value="⠒1"/>
              <marker class="print-page-dash" value="1⠒"/>
              ⠁⠁⠁
            </block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <!-- begin left page -->
            <block>
              <marker class="print-page/prev" value="1"/>
              <marker class="print-page" value="2"/>
              <marker class="dash-print-page/prev" value="⠒1"/>
              <marker class="dash-print-page" value="⠒2"/>
              <marker class="print-page-dash/prev" value="1⠒"/>
              <marker class="print-page-dash" value="2⠒"/>
              ⠁⠁⠁
            </block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <!-- begin right page -->
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>
              <marker class="print-page/prev" value="2"/>
              <marker class="print-page" value="3"/>
              <marker class="dash-print-page/prev" value="⠒2"/>
              <marker class="dash-print-page" value="⠒3"/>
              <marker class="print-page-dash/prev" value="2⠒"/>
              <marker class="print-page-dash" value="3⠒"/>
              ⠁⠁⠁
            </block>
            <!-- begin left page -->
            <block>
              <marker class="print-page/prev" value="3"/>
              <marker class="print-page" value="4"/>
              <marker class="dash-print-page/prev" value="⠒3"/>
              <marker class="dash-print-page" value="⠒4"/>
              <marker class="print-page-dash/prev" value="3⠒"/>
              <marker class="print-page-dash" value="4⠒"/>
              ⠁⠁⠁
            </block>
            <block>
              <marker class="print-page/prev" value="4"/>
              <marker class="print-page" value="5"/>
              <marker class="dash-print-page/prev" value="⠒4"/>
              <marker class="dash-print-page" value="⠒5"/>
              <marker class="print-page-dash/prev" value="4⠒"/>
              <marker class="print-page-dash" value="5⠒"/>
              ⠁⠁⠁
            </block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <!-- begin right page -->
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare" xfail="true">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="7" rowgap="0" duplex="true">
              <section>
                <!-- right -->
                <page>
                  <!-- print page 1 -->
                  <row>⠼⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row> <!-- 1     ...     1 -->
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <!--<row>⠒⠼⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠒⠼⠁</row>--> <!-- -1    ...    -1 -->
                </page>
                <!-- left -->
                <page>
                  <!-- print page 2 -->
                  <row>⠼⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row> <!-- 2               --> <!-- was: 1-2             -->
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <!--<row>⠼⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>--> <!-- 2               --> <!-- was: 1-2             -->
                </page>
                <!-- right -->
                <page>
                  <row>⠼⠃⠒⠼⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠃⠒⠼⠉</row> <!-- 2-3   ...   2-3 --> <!-- was: 2-3   ...   1-3 -->
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <!-- print page 3 -->
                  <row>⠁⠁⠁</row>
                  <!-- print page 4 -->
                  <!--<row>⠼⠃⠒⠼⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠃⠒⠼⠉</row>--> <!-- 2-3   ...   2-3 --> <!-- was: 2-3   ...   1-3 -->
                </page>
                <!-- left -->
                <page>
                  <row>⠼⠙⠒⠼⠑⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row> <!-- 4-5             --> <!-- was: 3-5             -->
                  <row>⠁⠁⠁</row>
                  <!-- print page 5 -->
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <!--<row>⠼⠙⠒⠼⠑⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>--> <!-- 4-5             --> <!-- was: 3-5             -->
                </page>
                <!-- right -->
                <page>
                  <row>⠼⠑⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠙⠒⠼⠑</row> <!-- 5     ...   4-5 --> <!-- was: 5     ...   3-5 -->
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <!-- print page 6 -->
                  <row/>
                  <!--<row>⠼⠑⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠙⠒⠼⠑</row>--> <!-- 5     ...   4-5 --> <!-- was: 5     ...   3-5 -->
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_52">
    <x:documentation>
      Tests string-set on not-rendered elements in between blocks.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform:none }
                      @page {
                        size: 20 6;
                        @bottom-left {
                          content: string(print-page, page-start); }}">
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <pagenum style="display: none; string-set: print-page content()">1</pagenum>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <pagenum style="display: none; string-set: print-page content()">2</pagenum>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="20" page-height="6" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer>
                <field>
                  <marker-reference marker="print-page/prev" direction="forward" scope="page-content" text-style="/-dotify-def:tmp_.+/"/>
                  <marker-reference marker="print-page" direction="backward" scope="sequence" text-style="/-dotify-defifndef:tmp_.+/"/>
                  <marker-reference marker="print-page/entry" direction="backward" scope="sequence" text-style="/-dotify-ifndef:tmp_.+/"/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>
              <marker class="print-page" value="1"/>
              ⠁⠁⠁
            </block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>
              <marker class="print-page/prev" value="1"/>
              <marker class="print-page" value="2"/>
              ⠁⠁⠁
            </block>
            <block>⠁⠁⠁</block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row> <!-- (empty) -->
                </page>
                <page>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <!-- 1 -->
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠼⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row> <!-- 1 -->
                </page>
                <page>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <!-- 2 -->
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row/>
                  <row>⠼⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row> <!-- 1 -->
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_53">
    <x:documentation>
      Tests string-set on not-rendered elements inside blocks.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform:none }
                      @page {
                        size: 10 6;
                        margin-bottom: 1;
                        @bottom-left {
                          content: string(print-page, page-start); }}">
            <p style="display: block">
              <pagenum style="display: none; string-set: print-page content()">1</pagenum>
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              <pagenum style="display: none; string-set: print-page content()">2</pagenum>
            </p>
            <p style="display: block">
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
            </p>
            <pagenum style="display: none; string-set: print-page content()">3</pagenum>
            <p style="display: block">
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              <pagenum style="display: none; string-set: print-page content()">4</pagenum>
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
            </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="10" page-height="6" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer>
                <field>
                  <marker-reference marker="print-page/prev" direction="forward" scope="page-content" text-style="/-dotify-def:tmp_.+/"/>
                  <marker-reference marker="print-page" direction="backward" scope="sequence" text-style="/-dotify-defifndef:tmp_.+/"/>
                  <marker-reference marker="print-page/entry" direction="backward" scope="sequence" text-style="/-dotify-ifndef:tmp_.+/"/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              <marker class="print-page" value="1"/>
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              <marker class="print-page/prev" value="1"/>
              <marker class="print-page" value="2"/>
            </block>
            <block>
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
            </block>
            <block>
              <marker class="print-page/prev" value="2"/>
              <marker class="print-page" value="3"/>
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              <marker class="print-page/prev" value="3"/>
              <marker class="print-page" value="4"/>
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <!-- 1 -->
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠼⠁⠀⠀⠀⠀⠀⠀⠀⠀</row> <!-- 1 -->
                </page>
                <page>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <!-- 2 -->
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠼⠁⠀⠀⠀⠀⠀⠀⠀⠀</row> <!-- 1 -->
                </page>
                <page>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <!-- 3 -->
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠼⠃⠀⠀⠀⠀⠀⠀⠀⠀</row> <!-- 2 -->
                </page>
                <page>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <!-- 4 -->
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠼⠉⠀⠀⠀⠀⠀⠀⠀⠀</row> <!-- 3 -->
                </page>
                <page>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠼⠙⠀⠀⠀⠀⠀⠀⠀⠀</row> <!-- 4 -->
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_49">
    <x:documentation>
      Tests flow, flow() and @begin.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="@page { size: 15 5 } @volume { @begin { content: flow(titlepage) }} { text-transform: none }">
            <front>
              <titlepage style="display: block; flow: titlepage">
                ⠿⠿⠿
              </titlepage>
            </front>
            <body style="display: block">
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" page-width="15" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <sequence master="main">
                <block>
                  ⠿⠿⠿
                </block>
              </sequence>
            </pre-content>
          </volume-template>
          <sequence master="main">
            <block translate=""/>
            <block>
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_50">
    <x:documentation>
      Tests max-length.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="@page { size: 10 5 } @volume { max-length: 3 } { text-transform: none }">
            <body style="display:block">
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" page-width="10" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="3"/>
          <sequence master="main">
            <block>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume rows="5" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume rows="5" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_51">
    <x:documentation>
      Tests volume pseudo-class @volume:first.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="@page { size: 10 5 } @volume { max-length: 3 } @volume:first { max-length: 1 } { text-transform: none }">
            <body style="display: block">
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" page-width="10" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template use-when="(! (= $volume 1))" sheets-in-volume-max="3"/>
          <volume-template use-when="(= $volume 1)" sheets-in-volume-max="1"/>
          <sequence master="main">
            <block>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume rows="5" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume rows="5" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_54">
    <x:documentation>
      Tests string(..., first) and string(..., start) with multiple sequences.
      
      Broken: behavior of page-content changed in Dotify 2.0.0 (see
      https://github.com/joeha480/dotify/issues/150)
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform: none }
                      @page {
                        size: 10 5;
                        @bottom-left { content: string(foo, first) }
                        @bottom-right { content: string(foo, start) }}">
            <section style="display: block;
                            string-set: foo '⠿'">
              ⠤⠤⠤
            </section>
            <section style="display: block;
                            page-break-before: right">
              ⠤⠤⠤
              <_ style="display: none; string-set: foo '⠿⠿'"/>
              ⠤⠤⠤
            </section>
            <section style="display: block;
                            page-break-before: right">
              <_ style="display: none; string-set: foo '⠿⠿⠿'"/>
              ⠤⠤⠤
            </section>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" page-width="10" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer>
                <field>
                  <marker-reference marker="foo" direction="forward" scope="page" text-style="/-dotify-def:tmp_.+/"/>
                  <marker-reference marker="foo" direction="backward" scope="sequence" text-style="/-dotify-defifndef:tmp_.+/"/>
                  <marker-reference marker="foo/entry" direction="backward" scope="sequence" text-style="/-dotify-ifndef:tmp_.+/"/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <marker-reference marker="foo/prev" direction="forward" scope="page-content" text-style="/-dotify-def:tmp_.+/"/>
                  <marker-reference marker="foo" direction="backward" scope="sequence" text-style="/-dotify-defifndef:tmp_.+/"/>
                  <marker-reference marker="foo/entry" direction="backward" scope="sequence" text-style="/-dotify-ifndef:tmp_.+/"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              <marker class="foo" value="⠿"/>
              ⠤⠤⠤
            </block>
          </sequence>
          <sequence master="a">
            <block>
              <marker class="foo/entry" value="⠿"/>
            </block>
            <block>
              ⠤⠤⠤
              <marker class="foo/prev" value="⠿"/>
              <marker class="foo" value="⠿⠿"/>
              ⠤⠤⠤
            </block>
          </sequence>
          <sequence master="a">
            <block>
              <marker class="foo/entry" value="⠿⠿"/>
            </block>
            <block>
              <marker class="foo/prev" value="⠿⠿"/>
              <marker class="foo" value="⠿⠿⠿"/>
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare" xfail="true">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠿⠀⠀⠀⠀⠀⠀⠀⠀⠿</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠿⠿⠀⠀⠀⠀⠀⠀⠀⠿</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠿⠿⠿⠀⠀⠀⠀⠿⠿⠿</row> <!-- was: ⠿⠿⠿     ⠿⠿ -->
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_55">
    <x:documentation>
      Tests margin-left in @page.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform: none }
                      @page { size: 15 5; margin-left: 2 }">
            <body style="display: block">
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" page-width="15" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
              <margin-region align="left" width="2">
                <indicators/>
              </margin-region>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_56">
    <x:documentation>
      Tests -obfl-marker-indicator() in @left.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform: none }
                      @page { size: 15 5; margin-left: 2; @left { content: -obfl-marker-indicator(pagenum, '⠿') }}">
            <body style="display: block">
              <pagenum style="display: none; -obfl-marker: pagenum">1</pagenum>
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              <pagenum style="display: none; -obfl-marker: pagenum">2</pagenum>
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              <pagenum style="display: none; -obfl-marker: pagenum">3</pagenum>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" page-width="15" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
              <margin-region align="left" width="2">
                <indicators>
                  <marker-indicator markers="indicator/pagenum" indicator="⠿"/>
                </indicators>
              </margin-region>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              <marker class="indicator/pagenum" value="x"/>
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              <marker class="indicator/pagenum" value="x"/>
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              <marker class="indicator/pagenum" value="x"/>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠿⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠿⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_57">
    <x:documentation>
      Tests -obfl-marker-indicator() in @left when @page has no margin-left.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform: none }
                      @page { size: 15 5; @left { content: -obfl-marker-indicator(pagenum, '⠿') }}">
            <body style="display: block">
              <pagenum style="display: none; -obfl-marker: pagenum">1</pagenum>
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              <pagenum style="display: none; -obfl-marker: pagenum">2</pagenum>
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              <pagenum style="display: none; -obfl-marker: pagenum">3</pagenum>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" page-width="15" page-height="5" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
              <margin-region align="left" width="1">
                <indicators>
                  <marker-indicator markers="indicator/pagenum" indicator="⠿"/>
                </indicators>
              </margin-region>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              <marker class="indicator/pagenum" value="x"/>
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              <marker class="indicator/pagenum" value="x"/>
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              <marker class="indicator/pagenum" value="x"/>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠿⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠿⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_58">
    <x:documentation>
      Tests stacked pseudo-elements.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform:none } @page { size: 10 10; }">
            <body style="{ display: block }
                         ::after { display:block; margin-left:1; content:'⠤⠤⠤' }
                         ::after::before { display:block; margin-left:1; content:'⠸⠸⠸' }
                         ::after::after { display:block; margin-left:1; content:'⠛⠛⠛' }">
              ⠿⠿⠿
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" page-width="10" page-height="10" duplex="true" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              <block> ⠿⠿⠿ </block>
              <block>
                <block padding-left="2"> ⠸⠸⠸ </block>
                <block padding-left="1"> ⠤⠤⠤ </block>
                <block padding-left="2"> ⠛⠛⠛ </block>
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="10" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿</row>
                  <row>⠀⠀⠸⠸⠸</row>
                  <row>⠀⠤⠤⠤</row>
                  <row>⠀⠀⠛⠛⠛</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_59">
    <x:documentation>
      Tests display:table.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <table xmlns="http://www.daisy.org/z3986/2005/dtbook/"
                 style="{ display:table;
                          padding-left:1;
                          padding-right:1;
                          -obfl-table-col-spacing:1;
                          text-transform:none }
                        @page { size: 20 12; }">
            <caption>
              <p style="display:block; text-align:center">
                ⠿⠿⠿⠿
              </p>
            </caption>
            <thead>
              <tr>
                <th colspan="2" style="border-bottom:⠒">⠤⠤⠤</th>
                <th style="border-bottom:⠒">⠤⠤⠤</th>
              </tr>
            </thead>
            <tfoot>
              <tr>
                <td style="border-top:⠒">⠤⠤⠤</td>
                <td style="border-top:⠒">⠤⠤⠤</td>
                <td style="border-top:⠒">⠤⠤⠤</td>
              </tr>
            </tfoot>
            <tbody>
              <tr>
                <td>
                  <ul style="list-style-type:decimal">
                    <li style="display:list-item"/>
                    <li style="display:list-item"/>
                    <li style="display:list-item"/>
                  </ul>
                </td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
              <pagenum style="display:none; string-set:print-page '⠿⠿'"/>
              <tr>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
            </tbody>
            <tbody>
              <tr>
                <td rowspan="2">⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
              <tr>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
            </tbody>
          </table>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="20" page-height="12">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="main">
            <block>
              <block>
                <block padding-left="1" padding-right="1" align="center">
                  ⠿⠿⠿⠿
                </block>
              </block>
            </block>
            <table padding-left="1" padding-right="1" table-col-spacing="1" >
              <thead>
                <tr>
                  <td border-bottom-style="solid" border-bottom-align="center" col-span="2">⠤⠤⠤</td>
                  <td border-bottom-style="solid" border-bottom-align="center">⠤⠤⠤</td>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <block><span translate="">1</span></block>
                    <block><span translate="">2</span></block>
                    <block><span translate="">3</span></block>
                  </td>
                  <td>⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                </tr>
                <tr>
                  <td>
                    <marker class="print-page" value="⠿⠿"/>
                    ⠤⠤⠤
                  </td>
                  <td>⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                </tr>
                <tr>
                  <td row-span="2">⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                </tr>
                <tr>
                  <td>⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                </tr>
                <tr>
                  <td border-top-style="solid" border-top-align="center">⠤⠤⠤</td>
                  <td border-top-style="solid" border-top-align="center">⠤⠤⠤</td>
                  <td border-top-style="solid" border-top-align="center">⠤⠤⠤</td>
                </tr>
              </tbody>
            </table>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="12" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠿⠿⠿⠿</row>
                  <row>⠀⠤⠤⠤⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤⠤</row>
                  <row>⠀⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠀⠀⠒⠒⠒⠒⠒</row>
                  <row>⠀⠼⠁⠀⠀⠀⠀⠤⠤⠤⠀⠀⠀⠤⠤⠤</row>
                  <row>⠀⠼⠃⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠀⠼⠉⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠀⠤⠤⠤⠀⠀⠀⠤⠤⠤⠀⠀⠀⠤⠤⠤</row>
                  <row>⠀⠤⠤⠤⠀⠀⠀⠤⠤⠤⠀⠀⠀⠤⠤⠤</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠤⠤⠤⠀⠀⠀⠤⠤⠤</row>
                  <row>⠀⠒⠒⠒⠒⠒⠀⠒⠒⠒⠒⠒⠀⠒⠒⠒⠒⠒</row>
                  <row>⠀⠤⠤⠤⠀⠀⠀⠤⠤⠤⠀⠀⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_60">
    <x:documentation>
      Tests display:table with render-table-by:column.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <table xmlns="http://www.daisy.org/z3986/2005/dtbook/"
                 style="@page { size: 25 10; }
                        { display:table;
                          -obfl-table-col-spacing:1;
                          -obfl-preferred-empty-space:0;
                          render-table-by:column;
                          text-transform:none; }">
            <thead>
              <tr>
                <th colspan="2">⠤⠤⠤</th>
                <th>⠤⠤⠤</th>
              </tr>
            </thead>
            <tfoot>
              <tr>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
            </tfoot>
            <tbody>
              <tr>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
              <tr>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
            </tbody>
            <tbody>
              <tr>
                <td rowspan="2">⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
              <tr>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
            </tbody>
          </table>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" duplex="true" page-number-variable="page" page-width="25" page-height="10">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <table table-col-spacing="1" preferred-empty-space="0">
              <tr>
                <td row-span="2">⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td col-span="2">⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
              <tr>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
              <tr>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
            </table>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="25" rows="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠀⠀⠀⠀⠤⠤⠤</row>
                  <row>⠀⠀⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_61">
    <x:documentation>
      Tests flow:footnotes, @footnotes page area and ::footnote-call pseudo-element.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform:none }
                       @page { size: 10 6; @footnotes { content: flow(footnotes) }}">
            <p style="display:block">
              ⠤⠤⠤
              <note style="{flow:footnotes; display:block}
                           ::footnote-call { content:'⠶' }">⠿⠿⠿</note>
              ⠤⠤⠤
              <note style="{flow:footnotes; display:block}
                           ::footnote-call { content:'⠶⠶' }">⠿⠿⠿⠿⠿⠿</note>
            </p>
            <p style="display:block;page-break-before:always">
              ⠤⠤⠤
              <note style="{flow:footnotes; display:block}
                           ::footnote-call { content:'⠶' }">⠿⠿⠿⠿⠿⠿⠿⠿⠿</note>
            </p>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" duplex="true" page-width="10" page-height="6" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="3" collection="footnotes"/>
          </layout-master>
          <collection name="footnotes">
            <item id="a">
              <block>⠿⠿⠿</block>
            </item>
            <item id="b">
              <block>⠿⠿⠿⠿⠿⠿</block>
            </item>
            <item id="c">
              <block>⠿⠿⠿⠿⠿⠿⠿⠿⠿</block>
            </item>
          </collection>
          <sequence master="body">
            <block>
              ⠤⠤⠤ ⠶
              <anchor item="a"/>
              ⠤⠤⠤ ⠶⠶
              <anchor item="b"/>
            </block>
            <block break-before="page">
              ⠤⠤⠤ ⠶
              <anchor item="c"/>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="6" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠶⠀⠤⠤⠤</row>
                  <row>⠶⠶</row>
                  <row/>
                  <row/>
                  <row>⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠀⠶</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_62">
    <x:documentation>
      Tests flow:footnotes with ::alternate pseudo-element and target-content().
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform:none }
                       @page { size: 10 6; @footnotes { content: flow(footnotes) }}">
            <p style="display:block">
              ⠤⠤⠤
              <noteref ref="note_1"
                       style="::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶
              </noteref>
            </p>
            <note id="note_1" style="display:none">
              ⠿⠿⠿
            </note>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" duplex="true" page-width="10" page-height="6" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="3" collection="footnotes"/>
          </layout-master>
          <collection name="footnotes">
            <item id="a">
              <block>⠿⠿⠿</block>
            </item>
          </collection>
          <sequence master="body">
            <block>
              ⠤⠤⠤ ⠶
              <anchor item="a"/>
            </block>
            <block translate=""/>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="6" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠶</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_63">
    <x:documentation>
      Tests volume notes using ::alternate pseudo-element and target-content() and volume range flow().
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="@page { size: 10 6 }
                      @volume {
                        max-length: 3;
                        @end {
                          content: flow(endnotes, volume) }}
                      { text-transform: none }">
            <body>
              <p style="display:block">
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                <noteref ref="note_1" style="::alternate { flow:endnotes; display:block; content:target-content(attr(ref)) }">
                  ⠶
                </noteref>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </p>
              <p style="display:block">
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                <noteref ref="note_2" style="::alternate { flow:endnotes; display:block; content:target-content(attr(ref)) }">
                  ⠶
                </noteref>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </p>
            </body>
            <ul id="notes" style="display:none">
              <li id="note_1">
                ⠿⠿⠿
              </li>
              <li id="note_2">
                ⠿⠿⠿⠿⠿⠿
              </li>
            </ul>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="10" page-height="6">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="3">
            <post-content>
              <dynamic-sequence master="main">
                <list-of-references collection="endnotes" range="volume"/>
              </dynamic-sequence>
            </post-content>
          </volume-template>
          <collection name="endnotes">
            <item id="a">
              <block> ⠿⠿⠿ </block>
            </item>
            <item id="b">
              <block> ⠿⠿⠿⠿⠿⠿ </block>
            </item>
          </collection>
          <sequence master="main">
            <block>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠶
              <anchor item="a"/>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
            <block>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠶
              <anchor item="b"/>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
            <block translate=""/>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠶</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠿⠿⠿</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠶</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_64">
    <x:documentation>
      Tests numbering of footnotes. Numbers are added both to the note itself and to the note
      reference. The numbering is not reset on each page. Two alternative methods are used for
      adding a number to the note itself.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform:none }
                       @page { size: 20 6; @footnotes { content: flow(footnotes) }}">
            <p style="display:block">
              ⠤⠤⠤
              <noteref ref="note_1"
                       style="{ counter-increment: footnote; }
                              ::after { content: '⠦' counter(footnote) '⠴'; }
                              ::alternate {
                                flow: footnotes;
                                display: block;
                                content: counter(footnote) ' ' target-content(attr(ref)); }"/>
              ⠤⠤⠤
              <noteref ref="note_2"
                       style="{ counter-increment: footnote; }
                              ::after { content: '⠦' counter(footnote) '⠴'; }
                              ::alternate {
                                flow: footnotes;
                                display: block;
                                content: target-content(attr(ref)); }
                              ::alternate::before { content: counter(footnote) ' '; }"/>
            </p>
            <note id="note_1" style="display:none">
              ⠿⠿⠿
            </note>
            <note id="note_2" style="display:none">
              ⠿⠿⠿
            </note>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="20" page-height="6">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="3" collection="footnotes"/>
          </layout-master>
          <collection name="footnotes">
            <item id="a">
              <block> <span translate="">1</span> ⠿⠿⠿ </block>
            </item>
            <item id="b">
              <block> <span translate="">2</span> ⠿⠿⠿ </block>
            </item>
          </collection>
          <sequence master="main">
            <block>
              ⠤⠤⠤ ⠦<span translate="">1</span>⠴
              <anchor item="a"/>
              ⠤⠤⠤ ⠦<span translate="">2</span>⠴
              <anchor item="b"/>
            </block>
            <block translate=""/>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠦⠼⠁⠴⠀⠤⠤⠤⠀⠦⠼⠃⠴</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠼⠁⠀⠿⠿⠿</row>
                  <row>⠼⠃⠀⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_65">
    <x:documentation>
      Tests chapter endnotes using flow() function in ::after pseudo-element.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="@page { size: 20 6 } { text-transform:none }">
            <section style="{ display: block }
                            ::after { display:block; content: flow(chapter-notes)}">
              <h1 style="display:block; page-break-before:always">
                ⠤⠤⠤
              </h1>
              ⠤⠤⠤
              <note style="{flow:chapter-notes; display:block}
                           ::alternate { content:'⠶' }">⠿⠿⠿</note>
              ⠤⠤⠤
              <noteref ref="note_2"
                       style="::alternate {
                                flow: chapter-notes;
                                display: block;
                                content: target-content(attr(ref)); }">
                ⠶⠶
              </noteref>
              ⠤⠤⠤
            </section>
            <section style="{ display: block }
                            ::after { display:block; content: flow(chapter-notes)}">
              <h1 style="display:block; page-break-before:always">
                ⠤⠤⠤
              </h1>
              ⠤⠤⠤
              <note style="{flow:chapter-notes; display:block}
                           ::alternate { content:'⠶⠶⠶' }">⠿⠿⠿</note>
              ⠤⠤⠤
            </section>
            <note id="note_2" style="display:none">
              ⠿⠿⠿
            </note>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="20" page-height="6">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="main">
            <block break-before="page">
              <block>
                ⠤⠤⠤
              </block>
              <block>
                ⠤⠤⠤ ⠶ ⠤⠤⠤ ⠶⠶ ⠤⠤⠤
              </block>
              <block>
                <block> ⠿⠿⠿ </block>
                <block> ⠿⠿⠿ </block>
              </block>
            </block>
            <block break-before="page">
              <block>
                ⠤⠤⠤
              </block>
              <block>
                ⠤⠤⠤ ⠶⠶⠶ ⠤⠤⠤
              </block>
              <block>
                <block> ⠿⠿⠿ </block>
              </block>
            </block>
            <block translate=""/>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠶⠀⠤⠤⠤⠀⠶⠶⠀⠤⠤⠤</row>
                  <row>⠿⠿⠿</row>
                  <row>⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠶⠶⠶⠀⠤⠤⠤</row>
                  <row>⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_66">
    <x:documentation>
      Tests numbering of chapter endnotes.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="@page { size: 20 6 } { text-transform:none; counter-reset:note; }">
            <section style="{ display: block }
                            ::after { display:block; content: flow(chapter-notes)}">
              ⠤⠤⠤
              <noteref ref="note_1"
                       style="{ counter-increment: note; }
                              ::after { content: '⠦' counter(note) '⠴'; }
                              ::alternate {
                                flow: chapter-notes;
                                display: block;
                                content: counter(note) ' ' target-content(attr(ref)); }"/>
              ⠤⠤⠤
              <noteref ref="note_2"
                       style="{ counter-increment: note; }
                              ::after { content: '⠦' counter(note) '⠴'; }
                              ::alternate {
                                flow: chapter-notes;
                                display: block;
                                content: counter(note) ' ' target-content(attr(ref)); }"/>
              ⠤⠤⠤
            </section>
            <section class="notes" style="display:none">
              <note id="note_1">
                ⠿⠿⠿
              </note>
              <note id="note_2">
                ⠿⠿⠿
              </note>
            </section>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="20" page-height="6">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="main">
            <block>
              <block> ⠤⠤⠤ ⠦<span translate="">1</span>⠴ ⠤⠤⠤ ⠦<span translate="">2</span>⠴ ⠤⠤⠤ </block>
              <block>
                <block><span translate="">1</span> ⠿⠿⠿ </block>
                <block><span translate="">2</span> ⠿⠿⠿ </block>
              </block>
            </block>
            <block translate=""/>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠦⠼⠁⠴⠀⠤⠤⠤⠀⠦⠼⠃⠴⠀</row>
                  <row>⠤⠤⠤</row>
                  <row>⠼⠁⠀⠿⠿⠿</row>
                  <row>⠼⠃⠀⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_67" pending="not supported yet">
    <x:documentation>
      Tests nested footnotes (noteref inside note).
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="@page { size: 10 6; @footnotes { content: flow(footnotes) }}">
            <p style="display:block">
              ⠤⠤⠤
              <noteref ref="note_1" style="::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶
              </noteref>
              ⠤⠤⠤
            </p>
            <note id="note_1" style="display:none">
              ⠿⠿⠿
              <noteref ref="note_2" style="::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶⠶
              </noteref>
              ⠿⠿⠿
            </note>
            <note id="note_2" style="display:none">
              ⠿⠿⠿
            </note>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" duplex="true" page-width="10" page-height="6" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="3" collection="footnotes"/>
          </layout-master>
          <collection name="footnotes">
            <item id="a">
              <block>⠿⠿⠿ ⠶⠶ ⠿⠿⠿</block>
            </item>
            <item id="b">
              <block>⠿⠿⠿</block>
            </item>
          </collection>
          <sequence master="body">
            <block>
              ⠤⠤⠤ ⠶
              <anchor item="a"/>
              <anchor item="b"/>
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="6" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠶⠀⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠿⠿⠿⠀⠶⠶⠀⠿⠿⠿</row>
                  <row>⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_68">
    <x:documentation>
      Tests -obfl-fallback-collection with footnotes small enough to fit in the @footnotes area.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform:none }
                       @page {
                         size: 20 10;
                         @footnotes {
                           content: flow(footnotes);
                           -obfl-fallback-collection: endnotes; }}
                       @volume {
                         @end {
                           content: flow(endnotes, volume); }}">
            <p style="display:block">
              ⠤⠤⠤
              <noteref ref="note_1" style="::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶
              </noteref>
              ⠤⠤⠤
              <noteref ref="note_2" style="::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶⠶
              </noteref>
              ⠤⠤⠤
            </p>
            <note id="note_1" style="display:none">
              ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
            </note>
            <note id="note_2" style="display:none">
              ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
            </note>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="20" page-height="10">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="5" collection="footnotes">
              <fallback>
                <rename collection="footnotes" to="endnotes"/>
                <rename collection="meta/footnotes" to="meta/endnotes"/>
              </fallback>
            </page-area>
          </layout-master>
          <volume-template sheets-in-volume-max="1000">
            <post-content>
              <dynamic-sequence master="main">
                <list-of-references collection="endnotes" range="volume"/>
              </dynamic-sequence>
            </post-content>
          </volume-template>
          <collection name="footnotes">
            <item id="a">
              <block> ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ </block>
            </item>
            <item id="b">
              <block> ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ </block>
            </item>
          </collection>
          <sequence master="main">
            <block>
              ⠤⠤⠤ ⠶
              <anchor item="a"/>
              ⠤⠤⠤ ⠶⠶
              <anchor item="b"/>
              ⠤⠤⠤
            </block>
            <block translate=""/>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠶⠀⠤⠤⠤⠀⠶⠶⠀⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_69">
    <x:documentation>
      Tests -obfl-fallback-collection with footnotes too big to fit in the @footnotes area.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform:none }
                       @page {
                         size: 20 10;
                         @footnotes {
                           content: flow(footnotes);
                           -obfl-fallback-collection: endnotes; }}
                       @volume {
                         @end {
                           content: flow(endnotes, volume); }}">
            <p style="display:block">
              ⠤⠤⠤
              <noteref ref="note_1" style="::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶
              </noteref>
              ⠤⠤⠤
              <noteref ref="note_2" style="::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶⠶
              </noteref>
              ⠤⠤⠤
            </p>
            <note id="note_1" style="display:none">
              ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
            </note>
            <note id="note_2" style="display:none">
              ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
            </note>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="20" page-height="10">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="5" collection="footnotes">
              <fallback>
                <rename collection="footnotes" to="endnotes"/>
                <rename collection="meta/footnotes" to="meta/endnotes"/>
              </fallback>
            </page-area>
          </layout-master>
          <volume-template sheets-in-volume-max="1000">
            <post-content>
              <dynamic-sequence master="main">
                <list-of-references collection="endnotes" range="volume"/>
              </dynamic-sequence>
            </post-content>
          </volume-template>
          <collection name="footnotes">
            <item id="a">
              <block>
                ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
              </block>
            </item>
            <item id="b">
              <block>
                ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
              </block>
            </item>
          </collection>
          <sequence master="main">
            <block>
              ⠤⠤⠤ ⠶
              <anchor item="a"/>
              ⠤⠤⠤ ⠶⠶
              <anchor item="b"/>
              ⠤⠤⠤
            </block>
            <block translate=""/>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠶⠀⠤⠤⠤⠀⠶⠶⠀⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_70">
    <x:documentation>
      Tests document scope table of contents in @begin area of first volume and volume scope table
      of contents in @begin are of subsequent volumes.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="@page { size: 15 7; @bottom-right {content: counter(page) }}
                      @volume:first { max-length: 3; @begin { content: flow(first-front) }}
                      @volume { max-length: 3; @begin { content: flow(next-front) }}
                      { text-transform: none }">
            <front>
              <h1 style="display:block; flow:first-front">
                ⠿ ⠿ ⠿ ⠿
              </h1>
              <h1 style="{ display:block; flow:first-front }
                         ::duplicate { display:block; flow:next-front }">
                ⠿⠿⠿⠿
              </h1>
              <toc style="{ display:-obfl-toc; flow:first-front; text-transform:auto }
                          ::-obfl-on-volume-start { content:-obfl-evaluate('(round $started-volume-number)') }
                          ::duplicate { display:-obfl-toc; -obfl-toc-range:volume; flow:next-front; text-transform:auto }
                          ::duplicate::-obfl-on-toc-start { content:'⠿⠿⠿' }">
                <entry ref="ch_1" style="{display:block}
                                         ::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 1 </entry>
                <entry style="display:block; margin-left:1">
                  <entry ref="ch_1_1" style="{display:block}
                                             ::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 1 </entry>
                  <entry ref="ch_1_2" style="{display:block}
                                             ::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 2 </entry>
                </entry>
                <entry ref="ch_2" style="{display:block}
                                         ::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 2 </entry>
                <entry style="display:block; margin-left:1">
                  <entry ref="ch_2_1" style="{display:block}
                                             ::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 1 </entry>
                  <entry ref="ch_2_2" style="{display:block}
                                             ::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 2 </entry>
                </entry>
              </toc>
            </front>
            <body style="display: block">
              <h1 id="ch_1" style="display:block; text-transform:auto"> 1 </h1>
              <h2 id="ch_1_1" style="display:block; text-transform:auto"> 1 </h2>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              <h2 id="ch_1_2" style="display:block; text-transform:auto"> 2 </h2>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              <h1 id="ch_2" style="display:block; text-transform:auto"> 2 </h1>
              <h2 id="ch_2_1" style="display:block; text-transform:auto"> 1 </h2>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              <h2 id="ch_2_2" style="display:block; text-transform:auto"> 2 </h2>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="15" page-height="7">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <table-of-contents name="volume-toc">
            <toc-entry ref-id="ch_1" translate="">
              <toc-entry ref-id="ch_1">
                1 ⠄⠄⠄⠄⠄⠄⠄⠄⠄
                <page-number ref-id="ch_1" number-format="default"/>
              </toc-entry>
              <toc-entry ref-id="ch_1_1">
                <toc-entry ref-id="ch_1_1" padding-left="1">
                  1 ⠄⠄⠄⠄⠄⠄⠄⠄
                  <page-number ref-id="ch_1_1" number-format="default"/>
                </toc-entry>
                <toc-entry ref-id="ch_1_2" padding-left="1">
                  2 ⠄⠄⠄⠄⠄⠄⠄⠄
                  <page-number ref-id="ch_1_2" number-format="default"/>
                </toc-entry>
              </toc-entry>
              <toc-entry ref-id="ch_2">
                2 ⠄⠄⠄⠄⠄⠄⠄⠄⠄
                <page-number ref-id="ch_2" number-format="default"/>
              </toc-entry>
              <toc-entry ref-id="ch_2_1">
                <toc-entry ref-id="ch_2_1" padding-left="1">
                  1 ⠄⠄⠄⠄⠄⠄⠄⠄
                  <page-number ref-id="ch_2_1" number-format="default"/>
                </toc-entry>
                <toc-entry ref-id="ch_2_2" padding-left="1">
                  2 ⠄⠄⠄⠄⠄⠄⠄⠄
                  <page-number ref-id="ch_2_2" number-format="default"/>
                </toc-entry>
              </toc-entry>
            </toc-entry>
          </table-of-contents>
          <table-of-contents name="document-toc">
            <toc-entry ref-id="ch_1" translate="">
              <toc-entry ref-id="ch_1">
                1 ⠄⠄⠄⠄⠄⠄⠄⠄⠄
                <page-number ref-id="ch_1" number-format="default"/>
              </toc-entry>
              <toc-entry ref-id="ch_1_1">
                <toc-entry ref-id="ch_1_1" padding-left="1">
                  1 ⠄⠄⠄⠄⠄⠄⠄⠄
                  <page-number ref-id="ch_1_1" number-format="default"/>
                </toc-entry>
                <toc-entry ref-id="ch_1_2" padding-left="1">
                  2 ⠄⠄⠄⠄⠄⠄⠄⠄
                  <page-number ref-id="ch_1_2" number-format="default"/>
                </toc-entry>
              </toc-entry>
              <toc-entry ref-id="ch_2">
                2 ⠄⠄⠄⠄⠄⠄⠄⠄⠄
                <page-number ref-id="ch_2" number-format="default"/>
              </toc-entry>
              <toc-entry ref-id="ch_2_1">
                <toc-entry ref-id="ch_2_1" padding-left="1">
                  1 ⠄⠄⠄⠄⠄⠄⠄⠄
                  <page-number ref-id="ch_2_1" number-format="default"/>
                </toc-entry>
                <toc-entry ref-id="ch_2_2" padding-left="1">
                  2 ⠄⠄⠄⠄⠄⠄⠄⠄
                  <page-number ref-id="ch_2_2" number-format="default"/>
                </toc-entry>
              </toc-entry>
            </toc-entry>
          </table-of-contents>
          <volume-template sheets-in-volume-max="3" use-when="(! (= $volume 1))">
            <pre-content>
              <sequence master="main">
                <block> ⠿⠿⠿⠿ </block>
              </sequence>
              <toc-sequence toc="volume-toc" master="main" range="volume">
                <on-toc-start>
                  <block translate=""> ⠿⠿⠿ </block>
                </on-toc-start>
              </toc-sequence>
            </pre-content>
          </volume-template>
          <volume-template sheets-in-volume-max="3" use-when="(= $volume 1)">
            <pre-content>
              <toc-sequence toc="document-toc" master="main" range="document">
                <on-toc-start>
                  <block> ⠿ ⠿ ⠿ ⠿ </block>
                  <block> ⠿⠿⠿⠿ </block>
                </on-toc-start>
                <on-volume-start>
                  <block translate="">
                    <evaluate expression="(round $started-volume-number)"/>
                  </block>
                </on-volume-start>
              </toc-sequence>
            </pre-content>
          </volume-template>
          <sequence master="main">
            <block translate=""/>
            <block>
              <block id="ch_1" translate=""> 1 </block>
              <block id="ch_1_1" translate=""> 1 </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
              <block id="ch_1_2" translate=""> 2 </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
              <block id="ch_2" translate=""> 2 </block>
              <block id="ch_2_1" translate=""> 1 </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
              <block id="ch_2_2" translate=""> 2 </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠀⠿⠀⠿⠀⠿</row>
                  <row>⠿⠿⠿⠿</row>
                  <row>⠼⠁</row>
                  <row>⠼⠁⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠁</row>
                  <row>⠀⠼⠁⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠁</row>
                  <row>⠀⠼⠃⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠉</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
                <page>
                  <row>⠼⠃⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠙</row>
                  <row>⠼⠃</row>
                  <row>⠀⠼⠁⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠑</row>
                  <row>⠀⠼⠃⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠋</row>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠃</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠼⠁</row>
                  <row>⠼⠁</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠃</row>
                </page>
                <page>
                  <row>⠼⠃</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠉</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠼⠃</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠙</row>
                </page>
              </section>
            </volume>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠿⠿⠿</row>
                  <row>⠀⠼⠁⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠑</row>
                  <row>⠀⠼⠃⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠋</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠉</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠼⠁</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠑</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠼⠃</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠋</row>
                </page>
              </section>
            </volume>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠛</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠓</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_71">
    <x:documentation>
      Tests omitting of a table of contents entry that references an element in the volume @begin
      area.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="@page { size: 15 7; @bottom-right {content: counter(page) }}
                      @volume { @begin { content: flow(front) }}
                      { text-transform: none }">
            <front>
              <h1 id="ch_0" style="display:block; margin-bottom:1; flow:front; text-transform:auto"> 0 </h1>
              <toc style="{ display:-obfl-toc; flow:front; text-transform:auto }">
                <entry ref="ch_0" style="{display:block}
                                         ::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 0 </entry>
                <entry ref="ch_1" style="{display:block}
                                         ::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 1 </entry>
                <entry style="display:block; margin-left:1">
                  <entry ref="ch_1_1" style="{display:block}
                                             ::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 1 </entry>
                  <entry ref="ch_1_2" style="{display:block}
                                             ::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 2 </entry>
                </entry>
              </toc>
            </front>
            <body style="display: block">
              <h1 id="ch_1" style="display:block; text-transform:auto"> 1 </h1>
              <h2 id="ch_1_1" style="display:block; text-transform:auto"> 1 </h2>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              <h2 id="ch_1_2" style="display:block; text-transform:auto"> 2 </h2>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="15" page-height="7">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <table-of-contents name="toc">
            <toc-entry ref-id="ch_1" translate="">
              <toc-entry ref-id="ch_1">
                1 ⠄⠄⠄⠄⠄⠄⠄⠄⠄
                <page-number ref-id="ch_1" number-format="default"/>
              </toc-entry>
              <toc-entry ref-id="ch_1_1">
                <toc-entry ref-id="ch_1_1" padding-left="1">
                  1 ⠄⠄⠄⠄⠄⠄⠄⠄
                  <page-number ref-id="ch_1_1" number-format="default"/>
                </toc-entry>
                <toc-entry ref-id="ch_1_2" padding-left="1">
                  2 ⠄⠄⠄⠄⠄⠄⠄⠄
                  <page-number ref-id="ch_1_2" number-format="default"/>
                </toc-entry>
              </toc-entry>
            </toc-entry>
          </table-of-contents>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <toc-sequence master="main" range="document" toc="toc">
                <on-toc-start>
                  <block margin-bottom="1" translate=""> 0 </block>
                </on-toc-start>
              </toc-sequence>
            </pre-content>
          </volume-template>
          <sequence master="main">
            <block translate=""/>
            <block>
              <block id="ch_1" translate=""> 1 </block>
              <block id="ch_1_1" translate=""> 1 </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
              <block id="ch_1_2" translate=""> 2 </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠚</row>
                  <row/>
                  <row>⠼⠁⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠁</row>
                  <row>⠀⠼⠁⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠁</row>
                  <row>⠀⠼⠃⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠉</row>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠼⠁</row>
                  <row>⠼⠁</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠃</row>
                </page>
                <page>
                  <row>⠼⠃</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠉</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠙</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_72">
    <x:documentation>
      Tests page-break-after on elements in named flows.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform:none } @volume { @begin { content: flow(foo) flow(bar); }}">
            <level1 style="display: block; page-break-after: always; flow: foo;">
              <p style="display: block">⠤⠤⠤</p>
            </level1>
            <level1 style="display: block; page-break-after: right; flow: foo;">
              <p style="display: block">⠤⠤⠤</p>
            </level1>
            <level1 style="display: block; page-break-after: always; flow: bar;">
              <p style="display: block">⠤⠤⠤</p>
            </level1>
            <level1 style="display: block; page-break-after: always;">
              <p style="display: block">⠤⠤⠤</p>
            </level1>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="40" page-height="25">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <sequence master="main">
                <block>
                  <block>⠤⠤⠤</block>
                </block>
                <block break-before="page">
                  <block>⠤⠤⠤</block>
                </block>
              </sequence>
              <sequence master="main">
                <block>
                  <block>⠤⠤⠤</block>
                </block>
                <block break-before="page"/>
              </sequence>
            </pre-content>
          </volume-template>
          <sequence master="main">
            <block translate=""/>
            <block>
              <block>⠤⠤⠤</block>
            </block>
            <block break-before="page"/>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="40" rows="25" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
                <page/>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
                <page/>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_73">
    <x:documentation>
      Tests page-break-before on an element with display:-obfl-toc.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="@volume { @begin { content: flow(front); }}">
            <level1 style="display: block; flow: front; page-break-before: always;">
              <h1 style="display: block">⠿⠿⠿ 0</h1>
            </level1>
            <list style="display: -obfl-toc; flow: front; page-break-before: always;">
              <li style="display:block">
                <a href="ch_1" style="::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(href), page) }"> ⠿⠿⠿ 1 </a>
              </li>
            </list>
            <level1 style="display: block; page-break-before: always;">
              <h1 id="ch_1" style="display: block">⠿⠿⠿ 1</h1>
              <p style="display: block">⠤⠤⠤</p>
            </level1>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="40" page-height="25">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <table-of-contents name="toc">
            <toc-entry ref-id="a" translate="">
              <toc-entry ref-id="a"> ⠿⠿⠿ 1 ⠄⠄⠄⠄⠄⠄⠄⠄⠄
              <page-number ref-id="a" number-format="default"/>
              </toc-entry>
            </toc-entry>
          </table-of-contents>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <toc-sequence master="main" range="document" toc="toc">
                <on-toc-start>
                  <block break-before="page" translate="">
                    <block>⠿⠿⠿ 0</block>
                  </block>
                  <block break-before="page"/>
                </on-toc-start>
              </toc-sequence>
            </pre-content>
          </volume-template>
          <sequence master="main">
            <block translate=""/>
            <block break-before="page" translate="">
              <block id="a">⠿⠿⠿ 1</block>
              <block>⠤⠤⠤</block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="40" rows="25" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠀⠼⠚</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠀⠼⠁⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠁</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠿⠿⠿⠀⠼⠁</row>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_74">
    <x:documentation>
      Tests @page within @begin area.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform:none }
                      @page {
                        size: 15 5;
                        @top-right {
                          content: counter(page); }}
                      @volume {
                        @begin {
                          content: flow(titlepage);
                          @page { size: 15 5 }}}">
            <front>
              <titlepage style="display: block; flow: titlepage">
                ⠿⠿⠿
              </titlepage>
            </front>
            <body style="display: block">
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="master_1" duplex="true" page-number-variable="page" page-width="15" page-height="5">
            <default-template>
              <header>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </header>
              <footer/>
            </default-template>
          </layout-master>
          <layout-master name="master_2" duplex="true" page-number-variable="page" page-width="15" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <sequence master="master_2">
                <block> ⠿⠿⠿ </block>
              </sequence>
            </pre-content>
          </volume-template>
          <sequence master="master_1">
            <block translate=""/>
            <block> ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_75">
    <x:documentation>
      Tests max-height and border-top within @footnotes area.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform:none }
                       @page {
                         size: 10 6;
                         @footnotes {
                           content: flow(footnotes);
                           max-height: 4;
                           border-top: ⠒; }}">
            <p style="display:block">
              ⠤⠤⠤
              <note style="{flow:footnotes; display:block} ::footnote-call { content:'⠶' }">⠿⠿⠿</note>
              ⠤⠤⠤
              <note style="{flow:footnotes; display:block} ::footnote-call { content:'⠶' }">⠿⠿⠿</note>
              ⠤⠤⠤
            </p>
            <p style="display:block; page-break-before:always">
              ⠤⠤⠤
            </p>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" duplex="true" page-width="10" page-height="6" page-number-variable="page">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="4" collection="footnotes">
              <before>
                <leader pattern="⠒" position="100%" align="right"/>
              </before>
            </page-area>
          </layout-master>
          <collection name="footnotes">
            <item id="a">
              <block>⠿⠿⠿</block>
            </item>
            <item id="b">
              <block>⠿⠿⠿</block>
            </item>
          </collection>
          <sequence master="body">
            <block>
              ⠤⠤⠤ ⠶
              <anchor item="a"/>
              ⠤⠤⠤ ⠶
              <anchor item="b"/>
              ⠤⠤⠤
            </block>
            <block break-before="page">
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="6" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠶⠀⠤⠤⠤</row>
                  <row>⠶⠀⠤⠤⠤</row>
                  <row/>
                  <row>⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒</row>
                  <row>⠿⠿⠿</row>
                  <row>⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_76">
    <x:documentation>
      Tests combination of @page:left and @page:right with counter-set of 'page' to an even number.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page { size: 10 5; }
                         @page:right { @bottom-right { content: counter(page) }}">
              <p style="display:block">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </p>
              <p style="display:block; counter-set: page 10">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="a" duplex="true" page-number-variable="page" page-width="10" page-height="5">
            <template use-when="(= (% $page 2) 1)">
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </template>
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <layout-master name="b" duplex="true" page-number-variable="page" page-width="10" page-height="5">
            <template use-when="(= (% $page 2) 0)">
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </template>
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block> ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ </block>
          </sequence>
          <sequence master="b" initial-page-number="10">
            <block> ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠼⠁⠚</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_77">
    <x:documentation>
      Tests word-spacing.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform:none } @page { size: 15 5; }">
            <p style="display:block; word-spacing:2">
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
            </p>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="15" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="main">
            <block>⠤⠤⠤  ​⠤⠤⠤  ​⠤⠤⠤  ​⠤⠤⠤  ​⠤⠤⠤  ​⠤⠤⠤  ​⠤⠤⠤  ​⠤⠤⠤  ​⠤⠤⠤</block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠀⠤⠤⠤⠀⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠀⠤⠤⠤⠀⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠀⠤⠤⠤⠀⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_78">
    <x:documentation>
      Tests skip-margin-top-of-page parameter.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform:none } @page { size: 15 7; }">
            <div style="display: block">
              <p style="display: block; margin-top: 2; margin-bottom: 1">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </p>
              <p style="display: block; margin-top: 2; margin-bottom: 1">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </p>
              <p style="display: block; margin-top: 2; margin-bottom: 1">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </p>
            </div>
            <div style="display: block; page-break-before: always">
              <p style="display: block; margin-top: 2">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </p>
            </div>
            <div style="display: block; border-top: ⠒; page-break-before: always">
              <p style="display: block; margin-top: 2">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </p>
            </div>
            <div style="display: block; page-break-before: always">
              <p style="display: block; padding-top: 2">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </p>
            </div>
          </body>
        </x:document>
      </x:input>
      <x:option name="skip-margin-top-of-page" select="true()"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="15" page-height="7">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="main">
            <block margin-bottom="2">
              <block margin-bottom="2">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </block>
              <block margin-bottom="2">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </block>
              <block margin-bottom="1">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </block>
            </block>
            <block break-before="page">
              <block>
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </block>
            </block>
            <block border-top-style="solid" border-top-align="center" break-before="page">
              <block margin-top="2">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </block>
            </block>
            <block break-before="page">
              <block padding-top="2">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒</row>
                  <row/>
                  <row/>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
                <page>
                  <row/>
                  <row/>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_79">
    <x:documentation>
      Tests block with border-top, margin-left and text-indent.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform:none } @page { size: 15 7; }">
            <p style="display: block; border-top: ⠒; margin-left: 2; text-indent: 2">
              ⠤⠤⠤
            </p>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="master_1" duplex="true" page-number-variable="page" page-width="15" page-height="7">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="master_1">
            <block border-top-style="solid"
                   border-top-align="center"
                   margin-left="2"
                   first-line-indent="2"> ⠤⠤⠤ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠀⠀⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒</row>
                  <row>⠀⠀⠀⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_80">
    <x:documentation>
      Tests counter(page) with custom counter style.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform:none; display:block }
                       @page {
                         size: 15 5;
                         @bottom-right { content: counter(page, symbols(numeric '⠴' '⠂' '⠆' '⠒' '⠲' '⠢' '⠖' '⠶' '⠦' '⠔')) }}">
            ⠤⠤⠤
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="master_1" duplex="true" page-number-variable="page" page-width="15" page-height="5">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"
                                text-style="text-transform: -dotify-counter; -dotify-counter-style: symbols(numeric '⠴' '⠂' '⠆' '⠒' '⠲' '⠢' '⠖' '⠶' '⠦' '⠔')"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="master_1">
            <block> ⠤⠤⠤ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠂</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_81" xfail="true">
    <x:documentation>
      Tests target-counter(page) with custom counter style.
      
      Broken: text-style not supported on page-number element.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform:none">
            <a href="#a" style="::after { content: target-counter(attr(href url), page, symbols(numeric '⠴' '⠂' '⠆' '⠒' '⠲' '⠢' '⠖' '⠶' '⠦' '⠔')) }"/>
            <div id="a" style="display: block; page-break-before: always">⠤⠤⠤</div>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="master_1" duplex="true" page-number-variable="page" page-width="40" page-height="25">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="master_1">
            <block>
              <page-number ref-id="a" number-format="default"
                           text-style="text-transform: -dotify-counter; -dotify-counter-style: symbols(numeric '⠴' '⠂' '⠆' '⠒' '⠲' '⠢' '⠖' '⠶' '⠦' '⠔')"/>
            </block>
            <block break-before="page" id="a"> ⠤⠤⠤ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="40" rows="25" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠆</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_82">
    <x:documentation>
      Tests variables "sheets-in-volume" and "sheets-in-document".
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform: none; display: block; }
                       @page { size: 15 5; }
                       @volume { max-length: 3; @begin { content: flow(pre) }}">
            <p style="display: block; text-transform: auto; flow: pre">
              <span style="::before { content: -obfl-evaluate('(round $sheets-in-volume)') ' ⠌ ' -obfl-evaluate('(round $sheets-in-document)') }"/>
            </p>
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="15" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="3">
            <pre-content>
              <sequence master="main">
                <block translate="">
                  <evaluate expression="(round $sheets-in-volume)"/> ⠌ <evaluate expression="(round $sheets-in-document)"/>
                </block>
              </sequence>
            </pre-content>
          </volume-template>
          <sequence master="main">
            <block>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠉⠀⠌⠀⠼⠑</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume cols="15" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠃⠀⠌⠀⠼⠑</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_83">
    <x:documentation>
      Tests footnotes without a ::footnote-call.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform:none } @page { size: 10 6; @footnotes { content: flow(footnotes) }}">
            <p style="display:block">
              ⠤⠤⠤
              <note style="flow:footnotes; display:block">⠿</note>
              ⠤⠤⠤
              <note style="flow:footnotes; display:block">⠿⠿</note>
              ⠤⠤⠤
            </p>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" duplex="true" page-number-variable="page" page-width="10" page-height="6">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="3" collection="footnotes"/>
          </layout-master>
          <collection name="footnotes">
            <item id="a">
              <block>⠿</block>
            </item>
            <item id="b">
              <block>⠿⠿</block>
            </item>
          </collection>
          <sequence master="body">
            <block>
              ⠤⠤⠤
              <anchor item="a"/>
              ⠤⠤⠤
              <anchor item="b"/>
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row>⠿</row>
                  <row>⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_84">
    <x:documentation>
      Tests document scope table of contents in @begin area of last volume.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="@page { size: 15 7 }
                      @volume { max-length: 2 }
                      @volume:last { max-length: 2; @begin { content: flow(toc) }}
                      { text-transform: none }">
            <toc style="display:-obfl-toc; flow:toc; text-transform:auto">
              <entry ref="ch_1"
                     style="{display:block} ::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 1 </entry>
              <entry ref="ch_2"
                     style="{display:block} ::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 2 </entry>
            </toc>
            <body style="display:block">
              <h1 id="ch_1" style="display:block; text-transform:auto"> 1 </h1>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              <h1 id="ch_2" style="display:block; text-transform:auto"> 2 </h1>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="15" page-height="7">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <table-of-contents name="toc">
            <toc-entry ref-id="ch_1" translate="">
              <toc-entry ref-id="ch_1">
                1 ⠄⠄⠄⠄⠄⠄⠄⠄⠄ <page-number ref-id="ch_1" number-format="default"/>
              </toc-entry>
              <toc-entry ref-id="ch_2">
                2 ⠄⠄⠄⠄⠄⠄⠄⠄⠄ <page-number ref-id="ch_2" number-format="default"/>
              </toc-entry>
            </toc-entry>
          </table-of-contents>
          <volume-template sheets-in-volume-max="2" use-when="(! (= $volume $volumes))"/>
          <volume-template sheets-in-volume-max="2" use-when="(= $volume $volumes)">
            <pre-content>
              <toc-sequence toc="toc" master="main" range="document"/>
            </pre-content>
          </volume-template>
          <sequence master="main">
            <block translate=""/>
            <block>
              <block id="ch_1" translate=""> 1 </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
              <block id="ch_2" translate=""> 2 </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠁</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠼⠃</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                </page>
              </section>
            </volume>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠁⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠁</row>
                  <row>⠼⠃⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠙</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_85">
    <x:documentation>
      Tests document scope table of contents in @end area of last volume.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="@page { size: 15 7 }
                      @volume { max-length: 2 }
                      @volume:last { max-length: 2; @end { content: flow(toc) }}
                      { text-transform: none }">
            <toc style="display:-obfl-toc; flow:toc; text-transform:auto">
              <entry ref="ch_1"
                     style="{display:block} ::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 1 </entry>
              <entry ref="ch_2"
                     style="{display:block} ::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 2 </entry>
            </toc>
            <body style="display:block">
              <h1 id="ch_1" style="display:block; text-transform:auto"> 1 </h1>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              <h1 id="ch_2" style="display:block; text-transform:auto"> 2 </h1>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="15" page-height="7">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <table-of-contents name="toc">
            <toc-entry ref-id="ch_1" translate="">
              <toc-entry ref-id="ch_1">
                1 ⠄⠄⠄⠄⠄⠄⠄⠄⠄ <page-number ref-id="ch_1" number-format="default"/>
              </toc-entry>
              <toc-entry ref-id="ch_2">
                2 ⠄⠄⠄⠄⠄⠄⠄⠄⠄ <page-number ref-id="ch_2" number-format="default"/>
              </toc-entry>
            </toc-entry>
          </table-of-contents>
          <volume-template sheets-in-volume-max="2" use-when="(! (= $volume $volumes))"/>
          <volume-template sheets-in-volume-max="2" use-when="(= $volume $volumes)">
            <post-content>
              <toc-sequence toc="toc" master="main" range="document"/>
            </post-content>
          </volume-template>
          <sequence master="main">
            <block translate=""/>
            <block>
              <block id="ch_1" translate=""> 1 </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
              <block id="ch_2" translate=""> 2 </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠁</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠼⠃</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                </page>
              </section>
            </volume>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠼⠁⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠁</row>
                  <row>⠼⠃⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠙</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_86">
    <x:documentation>
      Tests @page on elements inside named flows.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform: none }
                       @page { size: 20 10 }
                       @volume:first { @begin { content: flow(front); @page { size: 10 5 }}}">
            <front style="display: block; flow: front">
              ⠤⠤⠤⠤⠤
              <toc style="{ display: block } @page { size: 10 10 }">
                ⠤⠤⠤⠤⠤
              </toc>
            </front>
            <body style="display: block">
              ⠤⠤⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="body" duplex="true" page-number-variable="page" page-width="20" page-height="10">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <layout-master name="front" duplex="true" page-number-variable="page" page-width="10" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <layout-master name="toc" duplex="true" page-number-variable="page" page-width="10" page-height="10">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template use-when="(= $volume 1)" sheets-in-volume-max="1000">
            <pre-content>
              <sequence master="front">
                <block> ⠤⠤⠤⠤⠤ </block>
              </sequence>
              <sequence master="toc">
                <block>
                  <block> ⠤⠤⠤⠤⠤ </block>
                </block>
              </sequence>
            </pre-content>
          </volume-template>
          <sequence master="body">
            <block translate=""/>
            <block> ⠤⠤⠤⠤⠤ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="10" rowgap="0" duplex="true">
              <section cols="10" rows="5">
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
              <section cols="10" rows="10">
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_87">
    <x:documentation>
      Tests nested inline elements with styles.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none; display:block">
            <span style="text-transform:auto">
              1 2 3
              <span style="text-transform:none">
                ⠿⠿⠿
              </span>
              4 5 6
            </span>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="master_1" duplex="true" page-number-variable="page" page-width="40" page-height="25">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="master_1">
            <block>
              <span translate="">
                1 2 3
              </span>
              ⠿⠿⠿
              <span translate="">
                4 5 6
              </span>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="40" rows="25" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠁⠀⠼⠃⠀⠼⠉⠀⠿⠿⠿⠀⠼⠙⠀⠼⠑⠀⠼⠋</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_88">
    <x:documentation>
      Tests text-transform:auto on -obfl-evaluate().
      
      Broken: white space is stripped too aggressively (Dotify issue?).
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform: none } @volume { @begin { content: flow(titlepage) }}">
            <titlepage style="display: block; flow: titlepage">
              ⠤⠤⠤⠤⠤
              <span style="::before {
                             text-transform: auto;
                             content: -obfl-evaluate('(round $volume)') }"/>
              ⠤⠤⠤⠤⠤
            </titlepage>
            <body style="display: block">
              ⠤⠤⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="40" page-height="25">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <sequence master="main">
                <block translate="">
                  <span translate="pre-translated-text-css">
                    ⠤⠤⠤⠤⠤
                  </span>
                  <evaluate expression="(round $volume)"/>
                  <span translate="pre-translated-text-css">
                    ⠤⠤⠤⠤⠤
                  </span>
                </block>
              </sequence>
            </pre-content>
          </volume-template>
          <sequence master="main">
            <block translate=""/>
            <block>
              ⠤⠤⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="40" rows="25" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠼⠁⠤⠤⠤⠤⠤</row> <!-- white space problem! -->
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_89">
    <x:documentation>
      Tests text-transform ≠ auto|none on -obfl-evaluate().
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="{ text-transform: none } @volume { @begin { content: flow(titlepage) }}">
            <titlepage style="display: block; flow: titlepage; text-transform: auto">
              1<span style="::after {
                              text-transform: downshift;
                              content: -obfl-evaluate('(round $volumes)') }"/>
            </titlepage>
            <body style="display: block">
              ⠤⠤⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="40" page-height="25">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <sequence master="main">
                <block translate="">
                  1<style name="text-transform: downshift">
                  <evaluate expression="(round $volumes)"/>
                  </style>
                </block>
              </sequence>
            </pre-content>
          </volume-template>
          <sequence master="main">
            <block translate=""/>
            <block>
              ⠤⠤⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="40" rows="25" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠁⠂</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_90">
    <x:documentation>
      Tests -obfl-use-when-collection-not-empty.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform:none }
                       @page {
                         size: 20 10;
                         @footnotes {
                           content: flow(footnotes);
                           -obfl-fallback-collection: endnotes; }}
                       @volume {
                         @begin {
                           content: flow(front) }
                         @end {
                           content: flow(endnotes, volume); }}">
            <p style="display: block; flow: front; -obfl-use-when-collection-not-empty: footnotes">
              ⠌⠌⠌
            </p>
            <p style="display: block; flow: front; -obfl-use-when-collection-not-empty: endnotes">
              ⠡⠡⠡
            </p>
            <p style="display:block">
              ⠤⠤⠤
              <noteref ref="note_1" style="::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶
              </noteref>
              ⠤⠤⠤
              <noteref ref="note_2" style="::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶⠶
              </noteref>
              ⠤⠤⠤
            </p>
            <note id="note_1" style="display:none">
              ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
            </note>
            <note id="note_2" style="display:none">
              ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
            </note>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="20" page-height="10">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="5" collection="footnotes">
              <fallback>
                <rename collection="footnotes" to="endnotes"/>
                <rename collection="meta/footnotes" to="meta/endnotes"/>
              </fallback>
            </page-area>
          </layout-master>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <dynamic-sequence master="main">
                <list-of-references collection="meta/footnotes" range="document">
                  <on-collection-start>
                    <block> ⠌⠌⠌ </block>
                  </on-collection-start>
                </list-of-references>
                <list-of-references collection="meta/endnotes" range="document">
                  <on-collection-start>
                    <block> ⠡⠡⠡ </block>
                  </on-collection-start>
                </list-of-references>
              </dynamic-sequence>
            </pre-content>
            <post-content>
              <dynamic-sequence master="main">
                <list-of-references collection="endnotes" range="volume"/>
              </dynamic-sequence>
            </post-content>
          </volume-template>
          <collection name="footnotes">
            <item id="a">
              <block>
                ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
              </block>
            </item>
            <item id="b">
              <block>
                ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
              </block>
            </item>
          </collection>
          <collection name="meta/footnotes">
            <item id="a">
              <block/>
            </item>
          </collection>
          <sequence master="main">
            <block translate=""/>
            <block>
              ⠤⠤⠤ ⠶
              <anchor item="a"/>
              ⠤⠤⠤ ⠶⠶
              <anchor item="b"/>
              ⠤⠤⠤
            </block>
            <block translate=""/>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠡⠡⠡</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠶⠀⠤⠤⠤⠀⠶⠶⠀⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_91">
    <x:documentation>
      Tests -obfl-underline.
      
      Broken: translator puts empty spaces at the end of lines which causes underlining to be one
      cell too long.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform:none } @page { size: 10 10 }">
            <h1 style="display: block; -obfl-underline:⠒">
              ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿
            </h1>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="master_1" duplex="true" page-number-variable="page" page-width="10" page-height="10">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="master_1">
            <block underline-style="solid" underline-align="center"> ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare" xfail="true">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿</row>
                  <row>⠒⠒⠒⠒⠒⠒⠒⠒</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_92">
    <x:documentation>
      Tests manual volume breaking.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ display: block; text-transform: none } @page { size: 10 5 }">
            ⠿⠿⠿⠿⠿ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            <br style="display: block; volume-break-before: always"/>
            ⠿⠿⠿⠿⠿ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="10" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="main">
            <block>
              ⠿⠿⠿⠿⠿ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
          </sequence>
          <sequence master="main" break-before="volume">
            <block>
              <block/>
              <block>
                ⠿⠿⠿⠿⠿ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_93">
    <x:documentation>
      Tests volume-break-inside: -obfl-keep(...)
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform: none }
                       @page { size: 10 5 }
                       @volume { max-length: 3 }">
            <section style="display: block; page-break-before: right; volume-break-inside: -obfl-keep(1)">
              ⠿⠿⠿⠿⠿ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </section>
            <section style="display: block; page-break-before: right; volume-break-inside: -obfl-keep(1)">
              ⠿⠿⠿⠿⠿ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </section>
            <section style="display: block; page-break-before: right; volume-break-inside: -obfl-keep(1)">
              ⠿⠿⠿⠿⠿ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </section>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="10" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="3"/>
          <sequence master="main">
            <block volume-keep-priority="1">
              ⠿⠿⠿⠿⠿ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
          </sequence>
          <sequence master="main">
            <block volume-keep-priority="1">
              ⠿⠿⠿⠿⠿ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
          </sequence>
          <sequence master="main">
            <block volume-keep-priority="1">
              ⠿⠿⠿⠿⠿ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_94">
    <x:documentation>
      Tests -obfl-keep-with-next-sheets.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="{ text-transform: none }
                       @page { size: 10 5 }
                       @volume { max-length: 3 }">
            <section style="display: block">
              <h1 style="display: block">
                ⠿⠿⠿⠿⠿
              </h1>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </section>
            <section style="display: block">
              <h1 style="display: block; -obfl-keep-with-next-sheets: 1">
                ⠿⠿⠿⠿⠿
              </h1>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </section>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <layout-master name="main" duplex="true" page-number-variable="page" page-width="10" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="3"/>
          <sequence master="main">
            <block>
              <block>
                ⠿⠿⠿⠿⠿
              </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
            <block>
              <block keep-with-next-sheets="1">
                ⠿⠿⠿⠿⠿
              </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
</x:description>
