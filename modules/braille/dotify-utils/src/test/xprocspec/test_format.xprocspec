<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns:x="http://www.daisy.org/ns/xprocspec"
               xmlns:dotify="http://code.google.com/p/dotify/"
               xmlns:p="http://www.w3.org/ns/xproc"
               xmlns:px="http://www.daisy.org/ns/pipeline/xproc"
               xmlns:pxi="http://www.daisy.org/ns/pipeline/xproc/internal"
               xmlns:dp2="http://www.daisy.org/ns/pipeline/"
               xmlns:obfl="http://www.daisy.org/ns/2011/obfl"
               xmlns:pef="http://www.daisy.org/ns/2008/pef">
  
  <x:script>
    <p:declare-step type="dotify:format" version="1.0">
      <p:input port="source"/>
      <p:output port="result" primary="true">
        <p:pipe step="pef" port="result"/>
      </p:output>
      <p:output port="obfl" sequence="false">
        <p:pipe step="obfl-final" port="result"/>
      </p:output>
      <p:option name="text-transform" select="'(input:braille)'"/>
      <p:option name="braille-charset" select="''"/>
      <p:option name="skip-margin-top-of-page" select="'false'"/>
      <p:variable name="allow-text-overflow-trimming" select="'true'"/>
      <p:import href="../../main/resources/xml/css-to-obfl.xpl"/>
      <p:import href="../../main/resources/xml/obfl-normalize-space.xpl"/>
      <p:import href="http://www.daisy.org/pipeline/modules/braille/dotify-utils/library.xpl"/>
      <pxi:css-to-obfl name="obfl" px:message="css-to-obfl" px:progress=".89"
                       duplex="true" document-locale="und">
        <p:with-option name="text-transform" select="$text-transform"/>
        <p:with-option name="braille-charset" select="$braille-charset"/>
        <p:with-option name="skip-margin-top-of-page" select="$skip-margin-top-of-page"/>
      </pxi:css-to-obfl>
      <pxi:obfl-normalize-space px:progress=".01"/>
      <p:try px:progress=".10">
        <p:group>
          <px:obfl-to-pef px:message="obfl-to-pef" px:progress="1">
            <p:with-param port="parameters" name="allow-text-overflow-trimming" select="$allow-text-overflow-trimming"/>
          </px:obfl-to-pef>
          <p:delete match="/pef:pef/pef:head/pef:meta/dp2:ascii-braille-charset"/>
        </p:group>
        <p:catch name="catch">
          <p:identity>
            <p:input port="source">
              <p:pipe step="catch" port="error"/>
            </p:input>
          </p:identity>
        </p:catch>
      </p:try>
      <p:identity name="pef"/>
      <p:sink/>
      <p:delete match="/obfl:obfl/obfl:meta/dp2:default-mode">
        <p:input port="source">
          <p:pipe step="obfl" port="result"/>
        </p:input>
      </p:delete>
      <p:delete match="/obfl:obfl/obfl:meta/dp2:braille-charset" name="obfl-final"/>
      <p:sink/>
    </p:declare-step>
  </x:script>
  
  <x:scenario label="test_01">
    <x:documentation>
      Tests page styles with different dimensions in the same document.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page { size: 15 5 }">
              <frontmatter style="display: block; @page { size: 30 5 }">
                ⠤⠤⠤
              </frontmatter>
              <bodymatter style="display: block">
                ⠤⠤⠤
              </bodymatter>
              <rearmatter style="display: block; @page { size: 30 5 }">
                ⠤⠤⠤
              </rearmatter>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="30" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <layout-master name="b" page-width="15" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              ⠤⠤⠤
            </block>
          </sequence>
          <sequence master="b">
            <block break-before="sheet">
              ⠤⠤⠤
            </block>
          </sequence>
          <sequence master="a">
            <block break-before="sheet">
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="30" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
              <section cols="15">
                <page>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_02">
    <x:documentation>
      Tests rendering print page, running header and running footer in page margin. The strings are
      set, and sometimes emptied, individually at various places in the document.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page {
                         size: 20 5;
                         @top-center { content: string(running-header) }
                         @bottom-right { content: string(print-page) }
                         @bottom-center { content: string(running-footer) }}">
              <section style="display: block;">
                ⠤⠤⠤
              </section>
              <section style="display: block;
                              page-break-before: always;
                              string-set: print-page '⠤'">
                ⠤⠤⠤
              </section>
              <section style="display: block;
                              page-break-before: always;
                              string-set: print-page '⠤⠤', running-footer '⠤⠤'">
                ⠤⠤⠤
              </section>
              <section style="display: block;
                              page-break-before: always;
                              string-set: print-page '', running-header '⠤⠤'">
                ⠤⠤⠤
              </section>
              <section style="display: block;
                              page-break-before: always;
                              string-set: print-page '⠤⠤⠤', running-footer ''">
                ⠤⠤⠤
              </section>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="20" page-height="5" duplex="true">
            <default-template>
              <header>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <compound-marker-reference>
                    <marker-reference marker="running-header" direction="forward" scope="page"/>
                    <marker-reference marker="running-header" direction="backward" scope="sequence"/>
                    <marker-reference marker="running-header/entry" direction="backward" scope="sequence"/>
                  </compound-marker-reference>
                </field>
                <field>
                  <string value=""/>
                </field>
              </header>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <compound-marker-reference>
                    <marker-reference marker="running-footer" direction="forward" scope="page"/>
                    <marker-reference marker="running-footer" direction="backward" scope="sequence"/>
                    <marker-reference marker="running-footer/entry" direction="backward" scope="sequence"/>
                  </compound-marker-reference>
                </field>
                <field>
                  <compound-marker-reference>
                    <marker-reference marker="print-page" direction="forward" scope="page"/>
                    <marker-reference marker="print-page" direction="backward" scope="sequence"/>
                    <marker-reference marker="print-page/entry" direction="backward" scope="sequence"/>
                  </compound-marker-reference>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              ⠤⠤⠤
            </block>
            <block break-before="page">
              <block>
                <marker class="print-page" value="⠤"/>
              </block>
              ⠤⠤⠤
            </block>
            <block break-before="page">
              <block>
                <marker class="print-page" value="⠤⠤"/>
                <marker class="running-footer" value="⠤⠤"/>
              </block>
              ⠤⠤⠤
            </block>
            <block break-before="page">
              <block>
                <marker class="print-page" value="​"/>
                <marker class="running-header" value="⠤⠤"/>
              </block>
              ⠤⠤⠤
            </block>
            <block break-before="page">
              <block>
                <marker class="print-page" value="⠤⠤⠤"/>
                <marker class="running-footer" value="​"/>
              </block>
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="20" rowgap="0" duplex="true">
              <section>
                <page>
                  <row/>
                  <row>⠤⠤⠤</row>
                </page>
                <page>
                  <row/>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤</row>
                </page>
                <page>
                  <row/>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤</row>
                </page>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_03">
    <x:documentation>
      Tests rendering print page and running footer in bottom page margin. The print page and
      running footer strings are set in a previous section that has no page margin.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page { size: 20 5; }">
              <section style="display: block;
                              string-set: print-page '⠤', running-footer '⠤⠤'">
                ⠤⠤⠤
              </section>
              <section style="display: block;
                              @page {
                                size: 20 5;
                                @bottom-center { content: string(running-footer) }
                                @bottom-right { content: string(print-page) }}">
                ⠤⠤⠤
              </section>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="20" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <layout-master name="b" page-width="20" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <compound-marker-reference>
                    <marker-reference marker="running-footer" direction="forward" scope="page"/>
                    <marker-reference marker="running-footer" direction="backward" scope="sequence"/>
                    <marker-reference marker="running-footer/entry" direction="backward" scope="sequence"/>
                  </compound-marker-reference>
                </field>
                <field>
                  <compound-marker-reference>
                    <marker-reference marker="print-page" direction="forward" scope="page"/>
                    <marker-reference marker="print-page" direction="backward" scope="sequence"/>
                    <marker-reference marker="print-page/entry" direction="backward" scope="sequence"/>
                  </compound-marker-reference>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              <block>
                <marker class="print-page" value="⠤"/>
                <marker class="running-footer" value="⠤⠤"/>
              </block>
              ⠤⠤⠤
            </block>
          </sequence>
          <sequence master="b">
            <block>
              <marker class="print-page/entry" value="⠤"/>
              <marker class="running-footer/entry" value="⠤⠤"/>
            </block>
            <block break-before="sheet">
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="20" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤⠀⠀⠀⠀⠀⠀⠀⠀⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_04">
    <x:documentation>
      Tests counter(page) and counter-set:page. In different sections the page number is placed in
      different positions (header, footer or nowhere).
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page {
                         size: 15 5;
                         margin-bottom: 1;
                         @bottom-right { content: counter(page) }}">
              <section style="display: block;">
                ⠤⠤⠤
              </section>
              <section style="display: block; @page { size: 15 5 }">
                ⠤⠤⠤
              </section>
              <section style="display: block;
                              page-break-before: always">
                ⠤⠤⠤
              </section>
              <section style="display: block;
                              page-break-before: always;
                              counter-set: page 11">
                ⠤⠤⠤
              </section>
              <section style="display: block;
                              page-break-before: always">
                ⠤⠤⠤
              </section>
              <section style="display: block;
                              @page {
                              size: 15 5;
                              @top-right { content: counter(page) }}">
                ⠤⠤⠤
              </section>
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="15" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <layout-master name="b" page-width="15" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <layout-master name="c" page-width="15" page-height="5" duplex="true">
            <default-template>
              <header>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </header>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              ⠤⠤⠤
            </block>
          </sequence>
          <sequence master="b">
            <block break-before="sheet">
              ⠤⠤⠤
            </block>
          </sequence>
          <sequence master="a">
            <block break-before="sheet">
              ⠤⠤⠤
            </block>
          </sequence>
          <sequence master="a" initial-page-number="11">
            <block break-before="page">
              ⠤⠤⠤
            </block>
            <block break-before="page">
              ⠤⠤⠤
            </block>
          </sequence>
          <sequence master="c">
            <block break-before="sheet">
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠑</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁⠁</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁⠃</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁⠉</row>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_05">
    <x:documentation>
      Tests counter(page) with different counter styles.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page {
                           size: 15 5;
                           margin-bottom: 1;
                           @bottom-right { content: counter(page) }}">
              <frontmatter style="display: block;
                                  @page {
                                    size: 15 5;
                                    margin-bottom: 1;
                                    @bottom-right { content: '⠏' counter(page) }}">
                ⠤⠤⠤
              </frontmatter>
              <bodymatter style="display: block">
                ⠤⠤⠤
              </bodymatter>
              <rearmatter style="display: block;
                                 counter-set: page 1;
                                 @page {
                                   size: 15 5;
                                   margin-bottom: 1;
                                   @bottom-right { content: counter(page, lower-roman) }}">
                ⠤⠤⠤
              </rearmatter>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="front" page-width="15" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value="⠏"/>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <layout-master name="body" page-width="15" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <layout-master name="rear" page-width="15" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="lower-roman"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="front">
            <block>
              ⠤⠤⠤
            </block>
          </sequence>
          <sequence master="body">
            <block break-before="sheet">
              ⠤⠤⠤
            </block>
          </sequence>
          <sequence master="rear" initial-page-number="1">
            <block break-before="sheet">
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠏1</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀3</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀i</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <!--
      TODO: move orphans and widows to their own test?
  -->
  <x:scenario label="test_07">
    <x:documentation>
      Tests page-break-inside:avoid and page-break-after:avoid, both on text-only blocks and on
      blocks with nested blocks. Also tests orphans and widows.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page { size: 10 6; }">
              <section style="display: block; page-break-before: right">
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                <section style="display: block">
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                </section>
              </section>
              <section style="display: block; page-break-before: right">
                <p style="display: block">⠤⠤⠤</p>
                <p style="display: block">⠤⠤⠤</p>
                <p style="display: block">⠤⠤⠤</p>
                <p style="display: block">⠤⠤⠤</p>
                <section>
                  <p style="display: block">⠤⠤⠤</p>
                  <p style="display: block">⠤⠤⠤</p>
                  <p style="display: block">⠤⠤⠤</p>
                  <p style="display: block">⠤⠤⠤</p>
                </section>
              </section>
              <section style="display: block; page-break-before: right">
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                <section style="display: block; page-break-inside: avoid">
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                </section>
              </section>
              <section style="display: block; page-break-before: right">
                <p style="display: block">⠤⠤⠤</p>
                <p style="display: block">⠤⠤⠤</p>
                <p style="display: block">⠤⠤⠤</p>
                <p style="display: block">⠤⠤⠤</p>
                <section style="display: block; page-break-inside: avoid">
                  <p style="display: block">⠤⠤⠤</p>
                  <p style="display: block">⠤⠤⠤</p>
                  <p style="display: block">⠤⠤⠤</p>
                  <p style="display: block">⠤⠤⠤</p>
                </section>
              </section>
              <section style="display: block; page-break-before: right">
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                <section style="display: block; page-break-after: avoid">
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                </section>
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
              </section>
              <section style="display: block; page-break-before: right">
                <p style="display: block">⠤⠤⠤</p>
                <p style="display: block">⠤⠤⠤</p>
                <p style="display: block">⠤⠤⠤</p>
                <p style="display: block">⠤⠤⠤</p>
                <section style="display: block; page-break-after: avoid">
                  <p style="display: block">⠤⠤⠤</p>
                  <p style="display: block">⠤⠤⠤</p>
                </section>
                <p style="display: block">⠤⠤⠤</p>
              </section>
              <section style="display: block; page-break-before: right">
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                <section style="display: block; orphans: 3">
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                </section>
              </section>
              <section style="display: block; page-break-before: right">
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                <section style="display: block; widows: 3">
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                  ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                </section>
              </section>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="10" page-height="6" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block break-before="sheet">
              <block>
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
              </block>
              <block>
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
              </block>
            </block>
            <block break-before="sheet">
              <block>⠤⠤⠤</block>
              <block>⠤⠤⠤</block>
              <block>⠤⠤⠤</block>
              <block>⠤⠤⠤</block>
              <block>⠤⠤⠤</block>
              <block>⠤⠤⠤</block>
              <block>⠤⠤⠤</block>
              <block>⠤⠤⠤</block>
            </block>
            <block break-before="sheet">
              <block>
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
              </block>
              <block keep="page">
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
              </block>
            </block>
            <block break-before="sheet">
              <block>⠤⠤⠤</block>
              <block>⠤⠤⠤</block>
              <block>⠤⠤⠤</block>
              <block>⠤⠤⠤</block>
              <block>
                <block keep-with-next="1" keep="page">⠤⠤⠤</block>
                <block keep-with-next="1" keep="page">⠤⠤⠤</block>
                <block keep-with-next="1" keep="page">⠤⠤⠤</block>
                <block keep="page">⠤⠤⠤</block>
              </block>
            </block>
            <block break-before="sheet">
              <block>
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
              </block>
              <block keep-with-next="1" keep="page">
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
              </block>
              <block>
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
              </block>
            </block>
            <block break-before="sheet">
              <block>⠤⠤⠤</block>
              <block>⠤⠤⠤</block>
              <block>⠤⠤⠤</block>
              <block>⠤⠤⠤</block>
              <block>
                <block>⠤⠤⠤</block>
                <block keep-with-next="1" keep="page">⠤⠤⠤</block>
              </block>
              <block>⠤⠤⠤</block>
            </block>
            <block break-before="sheet">
              <block>
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
              </block>
              <block orphans="3">
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
              </block>
            </block>
            <block break-before="sheet">
              <block>
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
              </block>
              <block widows="3">
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="6" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_08">
    <x:documentation>
      Tests orphans and widows on blocks with top/bottom borders. Counting of orphan and widow lines
      does not include borders.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page { size: 10 6; }">
              <section style="display: block; page-break-before: right">
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                <section style="display: block; border-top-pattern: ⠒; border-bottom-pattern: ⠒; orphans: 3">
                  ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                  ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                  ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                  ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                </section>
              </section>
              <section style="display: block; page-break-before: right">
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                <section style="display: block; border-top-pattern: ⠒; border-bottom-pattern: ⠒; widows: 3">
                  ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                  ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                  ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                  ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                </section>
              </section>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="10" page-height="6" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block break-before="sheet">
              <block>
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
              </block>
              <block orphans="3"
                     border-top-style="solid"
                     border-top-align="center"
                     border-bottom-style="solid"
                     border-bottom-align="center">
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
              </block>
            </block>
            <block break-before="sheet">
              <block>
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
              </block>
              <block widows="3"
                     border-top-style="solid"
                     border-top-align="center"
                     border-bottom-style="solid"
                     border-bottom-align="center">
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿⠿⠿⠿⠿
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="6" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_09">
    <x:documentation>
      Tests page-break-after:always.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; @page { size: 10 6 }">
            <level1 style="display:block; page-break-after: always">
              ⠤⠤⠤
            </level1>
            <level1 style="display:block; page-break-after: always">
              ⠤⠤⠤
            </level1>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="10" page-height="6" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block> ⠤⠤⠤ </block>
            <block break-before="page"> ⠤⠤⠤ </block>
            <block break-before="page"/>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="6" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
                <page/>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_10">
    <x:documentation>
      Tests that forced page break before a first-child box is moved to container.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; display:block">
            <body style="@page { size: 20 15 }">
              ⠿⠿⠿⠿
              <div style="display: block;
                          text-align: center;
                          border-top-pattern: ⠤;
                          border-bottom-pattern: ⠉">
                <div style="display: block;
                            margin-top: 1;
                            margin-bottom: 1;
                            page-break-before: always">
                  ⠿⠿⠿⠿
                </div>
              </div>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="20" page-height="15" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              <block>
                ⠿⠿⠿⠿
              </block>
              <block break-before="page"
                     align="center"
                     border-top-style="solid"
                     border-top-align="inner"
                     border-bottom-style="solid"
                     border-bottom-align="inner">
                <block align="center"
                       margin-top="1"
                       margin-bottom="1">
                  ⠿⠿⠿⠿
                </block>
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="15" cols="20" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠿⠿⠿⠿</row>
                  <row/>
                  <row>⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_11">
    <x:documentation>
      Tests nested blocks with borders and margins.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page { size: 20 15 }">
              <div style="display: block;
                          text-align: center;
                          margin-left: 1;
                          margin-right: 1;
                          margin-top: 1;
                          margin-bottom: 1;
                          padding-left: 1;
                          padding-right: 1;
                          padding-top: 1;
                          padding-bottom: 1;
                          border-left-pattern: ⠇;
                          border-right-pattern: ⠸;
                          border-top-pattern: ⠤;
                          border-bottom-pattern: ⠉;">
                <div style="display: block;
                            margin-left: 1;
                            margin-right: 1;
                            padding-left: 1;
                            padding-right: 1;
                            padding-top: 1;
                            padding-bottom: 1;
                            border-left-pattern: ⠇;
                            border-right-pattern: ⠸;
                            border-top-pattern: ⠤;
                            border-bottom-pattern: ⠉">
                  ⠿⠿⠿⠿
                </div>
              </div>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="20" page-height="15" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block align="center"
                   margin-left="1"
                   margin-right="1"
                   margin-top="1"
                   margin-bottom="1"
                   border-left-style="solid"
                   border-left-align="outer"
                   border-right-style="solid"
                   border-right-align="outer"
                   border-top-style="solid"
                   border-top-align="inner"
                   border-bottom-style="solid"
                   border-bottom-align="inner"
                   padding-top="1"
                   padding-bottom="1">
                <block align="center"
                       margin-left="2"
                       margin-right="2"
                       border-left-style="solid"
                       border-left-align="outer"
                       border-right-style="solid"
                       border-right-align="outer"
                       border-top-style="solid"
                       border-top-align="inner"
                       border-bottom-style="solid"
                       border-bottom-align="inner"
                       padding-left="1"
                       padding-right="1"
                       padding-top="1"
                       padding-bottom="1">
                  ⠿⠿⠿⠿
                </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="15" cols="20" rowgap="0" duplex="true">
              <section>
                <page>
                  <row/>
                  <row>⠀⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠀⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⠀</row>
                  <row>⠀⠇⠀⠀⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠀⠀⠸⠀</row>
                  <row>⠀⠇⠀⠀⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⠀⠀⠸⠀</row>
                  <row>⠀⠇⠀⠀⠇⠀⠀⠀⠿⠿⠿⠿⠀⠀⠀⠸⠀⠀⠸⠀</row>
                  <row>⠀⠇⠀⠀⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⠀⠀⠸⠀</row>
                  <row>⠀⠇⠀⠀⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠀⠀⠸⠀</row>
                  <row>⠀⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⠀</row>
                  <row>⠀⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉</row>
                  <row/>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_12">
    <x:documentation>
      Tests top and bottom borders with pattern "⠒".
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page { size: 20 15 }">
              <div style="display: block;
                          text-align: center;
                          border-left-pattern: ⠇;
                          border-right-pattern: ⠸;
                          border-top-pattern: ⠒;
                          border-bottom-pattern: ⠒">
                ⠿⠿⠿⠿
              </div>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="20" page-height="15" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block align="center"
                   border-left-style="solid"
                   border-left-align="outer"
                   border-right-style="solid"
                   border-right-align="outer"
                   border-top-style="solid"
                   border-top-align="center"
                   border-bottom-style="solid"
                   border-bottom-align="center">
              ⠿⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="15" cols="20" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠖⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠲</row>
                  <row>⠇⠀⠀⠀⠀⠀⠀⠀⠿⠿⠿⠿⠀⠀⠀⠀⠀⠀⠀⠸</row>
                  <row>⠓⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠚</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_13">
    <x:documentation>
      Tests ::after pseudo element.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page { size: 30 2; }">
              <table>
                <tr style="display: block">
                  <td style="&amp;::after { content: '⠆' } ">⠤⠤⠤</td>
                  <td style="&amp;::after { content: '⠆' } ">⠤⠤⠤</td>
                  <td style="&amp;::after { content: '⠆' } ">⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                </tr>
              </table>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="30" page-height="2" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
                  ⠤⠤⠤⠆
                  ⠤⠤⠤⠆
                  ⠤⠤⠤⠆
                  ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="2" cols="30" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠆⠀⠤⠤⠤⠆⠀⠤⠤⠤⠆⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_14">
    <x:documentation>
      Tests cumulation of left margins.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="display: block; margin-left: 1">
              <p style="display: block; margin-left: 1"> ⠤⠤⠤ </p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="40" page-height="25" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              <block padding-left="2">
                ⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠀⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_15">
    <x:documentation>
      Tests cumulation of left margins including negative margins.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="display: block; margin-left: 3">
              <p style="display: block; margin-left: -1"> ⠤⠤⠤ </p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="40" page-height="25" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              <block padding-left="2">
                ⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠀⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_16">
    <x:documentation>
      Tests text-indent.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; @page { size: 15 5 }">
            <body>
              <p style="display: block; text-indent: 2"> ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ </p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="15" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block first-line-indent="2">
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_17">
    <x:documentation>
      Tests hanging indentation (negative text-indent).
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; @page { size: 15 5 }">
            <body style="display: block; margin-left: 4">
              <p style="display: block; text-indent: -2"> ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ </p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="15" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              <block first-line-indent="2" text-indent="4">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠀⠀⠀⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_18">
    <x:documentation>
      Tests print page break indicator line within block. The line breaks the block in two
      fragments. The text-indent of the block is only applied to the first fragment.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; @page { size: 15 5 }">
            <p style="display: block; text-indent: 2">
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              <pagenum style="display: block; text-indent: 0; &amp;::before{content: leader('⠐') ' '}">⠿</pagenum>
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
            </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="15" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              <block first-line-indent="2">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </block>
              <block>
                <leader pattern="⠐" position="100%" align="right"/>
                ⠿
              </block>
              <block>
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠐⠐⠐⠐⠐⠐⠐⠐⠐⠐⠐⠐⠐⠀⠿</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_19">
    <x:documentation>
      Tests display:list-item, list-style-type and counter-reset.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <ul style="text-transform: none; list-style-type: decimal">
            <li style="display: list-item">⠤⠤⠤</li>
            <li style="display: list-item">⠤⠤⠤</li>
            <li>
              <ul style="list-style-type: lower-roman; counter-reset: list-item">
                <li style="display: list-item">⠤⠤⠤</li>
                <li style="display: list-item">⠤⠤⠤</li>
              </ul>
            </li>
            <li>
              <ul style="list-style-type: '⠶'; counter-reset: list-item">
                <li style="display: list-item">⠤⠤⠤</li>
                <li style="display: list-item">⠤⠤⠤</li>
              </ul>
            </li>
            <li style="display: list-item">⠤⠤⠤</li>
          </ul>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="40" page-height="25" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block><span translate="">1. </span>⠤⠤⠤ </block>
            <block><span translate="">2. </span>⠤⠤⠤ </block>
            <block><span translate="">i. </span>⠤⠤⠤ </block>
            <block><span translate="">ii. </span>⠤⠤⠤ </block>
            <block>⠶ ⠤⠤⠤ </block>
            <block>⠶ ⠤⠤⠤ </block>
            <block><span translate="">3. </span>⠤⠤⠤ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠁.⠀⠤⠤⠤</row>
                  <row>⠼⠃.⠀⠤⠤⠤</row>
                  <row>⠊.⠀⠤⠤⠤</row>
                  <row>⠊⠊.⠀⠤⠤⠤</row>
                  <row>⠶⠀⠤⠤⠤</row>
                  <row>⠶⠀⠤⠤⠤</row>
                  <row>⠼⠉.⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_20">
    <x:documentation>
      Tests a table of content with target-text(), target-string() and target-counter().
    </x:documentation>
      <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page { size: 14 8; margin-bottom: 1; @bottom-right { content: counter(page) }}">
              <frontmatter>
                <toc style="display: block">
                  <entry ref="chapter_1" style="&amp;::after {
                                                  display: block;
                                                  text-transform: auto;
                                                  content: target-text(attr(ref))
                                                           ' ⠄⠄⠄⠄⠄⠄⠄ '
                                                           target-string(attr(ref), print-page)
                                                           ' '
                                                           target-counter(attr(ref), page); }"/>
                  <entry ref="chapter_2" style="&amp;::after {
                                                  display: block;
                                                  text-transform: auto;
                                                  content: target-text(attr(ref))
                                                           ' ⠄⠄⠄⠄⠄⠄ '
                                                           target-string(attr(ref), print-page)
                                                           ' '
                                                           target-counter(attr(ref), page); }"/>
                  <entry ref="chapter_3" style="&amp;::after {
                                                  display: block;
                                                  text-transform: auto;
                                                  content: target-text(attr(ref))
                                                           ' ⠄⠄⠄⠄ '
                                                           target-string(attr(ref), print-page)
                                                           ' '
                                                           target-counter(attr(ref), page); }"/>
                </toc>
              </frontmatter>
              <bodymatter>
                <pagenum style="display:none;string-set:print-page '⠤'"/>
                <h id="chapter_1" style="display:block;text-align:center;page-break-before:always">⠿</h>
                <p style="display:block">⠤⠤⠤</p>
                <h id="chapter_2" style="display:block;text-align:center;page-break-before:always">⠿⠿</h>
                <p style="display:block">⠤⠤⠤</p>
                <pagenum style="display:none;string-set:print-page '⠤⠤'"/>
                <h id="chapter_3" style="display:block;text-align:center;page-break-before:always">⠿⠿⠿</h>
                <p style="display:block">⠤⠤⠤</p>
              </bodymatter>
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="14" page-height="8" duplex="true">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
            <block translate="">
              ⠿
              ⠄⠄⠄⠄⠄⠄⠄
              ⠤
              <page-number ref-id="chapter_1" number-format="default"/>
            </block>
            <block translate="">
              ⠿⠿
              ⠄⠄⠄⠄⠄⠄
              ⠤
              <page-number ref-id="chapter_2" number-format="default"/>
            </block>
            <block translate="">
              ⠿⠿⠿
              ⠄⠄⠄⠄
              ⠤⠤
              <page-number ref-id="chapter_3" number-format="default"/>
            </block>
            </block>
            <block align="center" break-before="page">
              <block>
                <span id="chapter_1"/>
              </block>
              <block/>
              ⠿
            </block>
            <block>
              ⠤⠤⠤
            </block>
            <block align="center" break-before="page">
              <block>
                <span id="chapter_2"/>
              </block>
              ⠿⠿
            </block>
            <block>
              ⠤⠤⠤
            </block>
            <block align="center" break-before="page">
              <block>
                <span id="chapter_3"/>
              </block>
              <block/>
              ⠿⠿⠿
            </block>
            <block>
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="8" cols="14" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠀⠄⠄⠄⠄⠄⠄⠄⠀⠤⠀⠼⠃</row>
                  <row>⠿⠿⠀⠄⠄⠄⠄⠄⠄⠀⠤⠀⠼⠉</row>
                  <row>⠿⠿⠿⠀⠄⠄⠄⠄⠀⠤⠤⠀⠼⠙</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠿</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠃</row>
                </page>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠿⠿</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠉</row>
                </page>
                <page>
                  <row>⠀⠀⠀⠀⠀⠿⠿⠿</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠙</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_21">
    <x:documentation>
      Tests target-text() and target-counter() with both forward references (table of contents in
      the front) and backward references (index in the back).
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page { size: 15 5; margin-bottom: 1; @bottom-right { content: counter(page) }}">
              <frontmatter>
                <toc style="display: block">
                  <entry ref="chapter_1" style="&amp;::after {
                                                  display: block;
                                                  text-transform: auto;
                                                  content: target-text(attr(ref))
                                                           ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄ '
                                                           target-counter(attr(ref), page); }"/>
                  <entry ref="chapter_2" style="&amp;::after {
                                                  display: block;
                                                  text-transform: auto;
                                                  content: target-text(attr(ref))
                                                           ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄ '
                                                           target-counter(attr(ref), page); }"/>
                </toc>
              </frontmatter>
              <bodymatter style="display:block;page-break-before:always">
                <h style="display:block" id="chapter_1">⠿</h>
                <p style="display:block" id="x">⠤⠤⠤</p>
                <h style="display:block" id="chapter_2">⠿⠿</h>
                <p style="display:block" id="y">⠤⠤⠤</p>
                <p style="display:block" id="z">⠤⠤⠤</p>
              </bodymatter>
              <rearmatter style="display:block;page-break-before:always">
                <index>
                  <entry ref="x" style="&amp;::after {
                                          display: block;
                                          text-transform: auto;
                                          content: target-text(attr(ref))
                                                   ' ⠄⠄⠄⠄⠄⠄⠄⠄ '
                                                   target-counter(attr(ref), page); }"/>
                  <entry ref="y" style="&amp;::after {
                                          display: block;
                                          text-transform: auto;
                                          content: target-text(attr(ref))
                                                   ' ⠄⠄⠄⠄⠄⠄⠄⠄ '
                                                   target-counter(attr(ref), page); }"/>
                  <entry ref="z" style="&amp;::after {
                                          display: block;
                                          text-transform: auto;
                                          content: target-text(attr(ref))
                                                   ' ⠄⠄⠄⠄⠄⠄⠄⠄ '
                                                   target-counter(attr(ref), page); }"/>
                </index>
              </rearmatter>
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="15" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
            <block translate="">
              ⠿
              ⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄
              <page-number ref-id="chapter_1" number-format="default"/>
            </block>
            <block translate="">
              ⠿⠿
              ⠄⠄⠄⠄⠄⠄⠄⠄⠄
              <page-number ref-id="chapter_2" number-format="default"/>
            </block>
            </block>
            <block break-before="page">
              <block>
                <block>
                  <span id="chapter_1"/>
                </block>
                ⠿
              </block>
              <block>
                <block>
                  <span id="x"/>
                </block>
                ⠤⠤⠤
              </block>
              <block>
                <block>
                  <span id="chapter_2"/>
                </block>
                ⠿⠿
              </block>
              <block>
                <block>
                  <span id="y"/>
                </block>
                ⠤⠤⠤
              </block>
              <block>
                <block>
                  <span id="z"/>
                </block>
                ⠤⠤⠤
              </block>
            </block>
            <block break-before="page">
              <block translate="">
                ⠤⠤⠤
                ⠄⠄⠄⠄⠄⠄⠄⠄
                <page-number ref-id="x" number-format="default"/>
              </block>
              <block translate="">
                ⠤⠤⠤
                ⠄⠄⠄⠄⠄⠄⠄⠄
                <page-number ref-id="y" number-format="default"/>
              </block>
              <block translate="">
                ⠤⠤⠤
                ⠄⠄⠄⠄⠄⠄⠄⠄
                <page-number ref-id="z" number-format="default"/>
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠃</row>
                  <row>⠿⠿⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠃</row>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
                <page>
                  <row>⠿</row>
                  <row>⠤⠤⠤</row>
                  <row>⠿⠿</row>
                  <row>⠤⠤⠤</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠃</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠉</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠃</row>
                  <row>⠤⠤⠤⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠃</row>
                  <row>⠤⠤⠤⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠉</row>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠙</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_22">
    <x:documentation>
      Tests target-counter() referencing inline element.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; @page { size: 14 8 }">
            <p style="display:block">
              <a href="foo" style="&amp;::after { content: target-counter(attr(href), page); text-transform: auto }"/>
            </p>
            <p style="display:block">
              ⠤⠤⠤⠤
              <a id="foo">⠿</a>
            </p>
            <p style="display:block">
              ⠤⠤⠤⠤
            </p>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="14" page-height="8" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              <span translate="">
                <style name="">
                  <page-number ref-id="foo" number-format="default"/>
                </style>
              </span>
            </block>
            <block>
              ⠤⠤⠤⠤
              <span id="foo"/>⠿
            </block>
            <block>
              ⠤⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="8" cols="14" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠁</row>
                  <row>⠤⠤⠤⠤⠀⠿</row>
                  <row>⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_23">
    <x:documentation>
      Tests generated newline and white-space:pre-line.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; display:block">
            ⠤⠤⠤<br style="&amp;::before { content: '\A'; white-space: pre-line; }"/>⠤⠤⠤
            <br style="&amp;::before { content: '\A'; white-space: pre-line; }"/>
            <br style="&amp;::before { content: '\A'; white-space: pre-line; }"/>⠤⠤⠤
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="40" page-height="25" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              ⠤⠤⠤&#x200B;<br/>⠤⠤⠤
              &#x200B;<br/>
              &#x200B;<br/>⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_24">
    <x:documentation>
      Tests -obfl-vertical-position and -obfl-vertical-align:before.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <div style="display: block; -obfl-vertical-align: before; -obfl-vertical-position: 5">
              ⠤⠤⠤
            </div>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="40" page-height="25" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block vertical-align="before" vertical-position="5">
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="40" rows="25" rowgap="0" duplex="true">
              <section>
                <page>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_25">
    <x:documentation>
      Tests (pre-)hyphenation.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; display:block; @page { size: 12 5; }">
            ⠿⠿⠿⠿⠿⠿ ⠿⠿⠿­⠿⠿⠿ ⠿⠿⠿⠿⠿⠿
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="12" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block >
              ⠿⠿⠿⠿⠿⠿ ⠿⠿⠿­⠿⠿⠿ ⠿⠿⠿⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="12" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠤</row>
                  <row>⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_26">
    <x:documentation>
      Tests collapsing of margins of adjacent sibling blocks, and non-collapsing of padding.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page { size: 20 15 }">
              <div style="display: block; margin-bottom: 1">
                ⠿⠿⠿⠿
              </div>
              <div style="display: block; margin-top: 1; margin-bottom: 1">
                ⠿⠿⠿⠿
              </div>
              <div style="display: block; padding-top: 1">
                ⠿⠿⠿⠿
              </div>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="20" page-height="15" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block margin-bottom="1">
              ⠿⠿⠿⠿
            </block>
            <block margin-top="1" margin-bottom="1">
              ⠿⠿⠿⠿
            </block>
            <block padding-top="1">
              ⠿⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="15" cols="20" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿</row>
                  <row/>
                  <row>⠿⠿⠿⠿</row>
                  <row/>
                  <row/>
                  <row>⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_27">
    <x:documentation>
      Tests collapsing of margins of three adjacent sibling blocks, the middle one being empty. The
      middle one is said to "collapse through".
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <p style="display:block; margin-bottom:1"> ⠿ </p>
            <p style="display:block; margin-bottom:1"/>
            <p style="display:block; margin-top:1"> ⠿ </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="40" page-height="25" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block margin-bottom="1"> ⠿ </block>
            <block margin-bottom="1"/>
            <block margin-top="1"> ⠿ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿</row>
                  <row/>
                  <row>⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_28">
    <x:documentation>
      Tests line-height:2 on blocks.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; @page { size: 40 25 }">
            <body>
              <p style="display: block; line-height: 2">
                ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
              </p>
              <p style="display: block; line-height: 2">
                ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
              </p>
              <p style="display: block; line-height: 2">
                ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
              </p>
              <p style="display: block; line-height: 2">
                ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
              </p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="40" page-height="25" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block row-spacing="2.00">⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿</block>
            <block row-spacing="2.00">⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿</block>
            <block row-spacing="2.00">⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿</block>
            <block row-spacing="2.00">⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿</block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row rowgap="4">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row rowgap="4">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row rowgap="4">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_29">
    <x:documentation>
      Tests line-height:2 on root element.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; line-height:2">
            <body>
              <p style="display:block">
                ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
              </p>
              <p style="display:block">
                ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
              </p>
              <p style="display:block">
                ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
              </p>
              <p style="display:block">
                ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
              </p>
              </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="40" page-height="25" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block row-spacing="2.00">⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿</block>
            <block row-spacing="2.00">⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿</block>
            <block row-spacing="2.00">⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿</block>
            <block row-spacing="2.00">⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿</block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row rowgap="4">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row rowgap="4">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row rowgap="4">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_30">
    <x:documentation>
      Tests combination of line-height:2 and margin-top or margin-bottom.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body>
              <p style="display: block; line-height: 2; margin-bottom: 1;">
                ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
              </p>
              <p style="display: block; line-height: 2; margin-top: 1; margin-bottom: 1;">
                ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
              </p>
              <p style="display: block; line-height: 2; margin-top: 1;">
                ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
              </p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="40" page-height="25" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block margin-bottom="1">
              <block row-spacing="2.00">⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿</block>
            </block>
            <block margin-top="1" margin-bottom="1">
              <block row-spacing="2.00">⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿</block>
            </block>
            <block margin-top="1">
              <block row-spacing="2.00">⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿</block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row rowgap="4">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row/>
                  <row rowgap="4">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row/>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_31">
    <x:documentation>
      Tests combination of line-height:2 and border-bottom.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; display:block">
            <p style="display:block; line-height:2; border-bottom-pattern:⠒">
              ⠿⠿⠿⠿⠿⠿⠿⠿
            </p>
            ⠿⠿⠿⠿⠿⠿⠿⠿
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="40" page-height="25" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              <block border-bottom-style="solid" border-bottom-align="center">
                <block row-spacing="2.00"> ⠿⠿⠿⠿⠿⠿⠿⠿ </block>
              </block>
              <block> ⠿⠿⠿⠿⠿⠿⠿⠿ </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="40" rows="25" rowgap="0" duplex="true">
              <section>
                <page>
                  <row rowgap="4">⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_32">
    <x:documentation>
      Tests combination of line-height:2, margin-bottom, and text-align. Text-align must end up on
      inner block.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; display:block">
            <p style="display:block; line-height:2; margin-bottom:1; text-align:center">
              ⠿⠿⠿⠿⠿⠿⠿⠿
            </p>
            ⠿⠿⠿⠿⠿⠿⠿⠿
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="40" page-height="25" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              <block margin-bottom="1">
                <block row-spacing="2.00" align="center"> ⠿⠿⠿⠿⠿⠿⠿⠿ </block>
              </block>
              <block> ⠿⠿⠿⠿⠿⠿⠿⠿ </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="result" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="40" rows="25" rowgap="0" duplex="true">
              <section>
                <page>
                  <row rowgap="4">⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row/>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_33">
    <x:documentation>
      Tests margin-top:1 in @page.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; @page { margin-top: 1; }">
            <body>
              <p style="display:block">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="40" page-height="25" duplex="true">
            <default-template>
              <header>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </header>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_34">
    <x:documentation>
      Tests margin-top:2 in @page.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; @page { margin-top: 2; }">
            <body>
              <p style="display:block">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="40" page-height="25" duplex="true">
            <default-template>
              <header>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </header>
              <header>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </header>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_35">
    <x:documentation>
      Tests simple content in @top-left.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; @page { margin-top: 1; @top-left { content: '⠆'; text-transform: none } }">
            <body>
              <p style="display:block">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="40" page-height="25" duplex="true">
            <default-template>
              <header>
                <field>
                  <string value="⠆" text-style="text-transform:none"/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </header>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_36">
    <x:documentation>
      Tests simple content in @top-left within two-line top page margin.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; @page { margin-top: 2; @top-left { content: '⠆' } }">
            <body>
              <p style="display:block">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="40" page-height="25" duplex="true">
            <default-template>
              <header>
                <field>
                  <string value="⠆"/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </header>
              <header>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </header>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <x:scenario label="test_37">
    <x:documentation>
      Tests @page:right and @page:left pseudo-selectors.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; @page:right{margin-top:1} @page:left{margin-top:2}">
            <body>
              <p style="display:block;">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</p>
              <p style="display:block; page-break-before:always;">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="40" page-height="25" duplex="true">
            <template use-when="(= (% $page 2) 1)">
              <header>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </header>
              <footer/>
            </template>
            <template use-when="(= (% $page 2) 0)">
              <header>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </header>
              <header>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </header>
              <footer/>
            </template>
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
            </block>
            <block break-before="page">
              ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_38">
    <x:documentation>
      Tests empty blocks. Blocks containing only an empty span or a blank braille pattern are also
      considered empty.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; display:block">
            <p style="display:block"/>
            ⠿
            <p style="display:block">
              <span> </span>
            </p>
            ⠿
            <p style="display:block"> </p>
            ⠿
            <p style="display:block">⠀</p>
            ⠿
            <p style="display:block; margin-bottom:1"/>
            ⠿
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="40" page-height="25" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              <block/>
              <block>⠿</block>
              <block/>
              <block>⠿</block>
              <block> </block>
              <block>⠿ </block>
              <block/>
              <block>⠿</block>
              <block margin-bottom="1"/>
              <block>⠿</block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠀</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row/>
                  <row>⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_39">
    <x:documentation>
      Tests empty blocks with border. A block containing a blank braille pattern is also considered
      empty.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <p style="display:block; border-bottom-pattern:⠤"/>
            <p style="display:block; border-bottom-pattern:⠤"> ⠀ </p>
            <p style="display:block; border-bottom-pattern:⠤">   </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="40" page-height="25" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block border-bottom-style="solid" border-bottom-align="outer"/>
            <block border-bottom-style="solid" border-bottom-align="outer"/>
            <block border-bottom-style="solid" border-bottom-align="outer">   </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠀</row>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_40">
    <x:documentation>
      Tests target-counter() referencing empty inline element.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <p style="display:block">
              <a href="foo" style="&amp;::after { content: target-counter(attr(href), page); text-transform: auto }"/>
            </p>
            <p style="display:block">
              <a id="foo"/>
            </p>
            <p style="display:block">
              ⠿
            </p>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="40" page-height="25" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              <span translate="">
                <style name="">
                  <page-number ref-id="foo" number-format="default"/>
                </style>
              </span>
            </block>
            <block>
              <block>
                <span id="foo"/>
              </block>
            </block>
            <block>
              ⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠁</row>
                  <row>⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_41">
    <x:documentation>
      Tests hyphens:none, text-transform. hyphens:none is currently handled in XSLT (not in
      Dotify). text-transform is handled in Dotify.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; @page { size: 12 8 }">
            <p style="display:block">
              ⠿⠿⠿­⠿⠿⠿ ⠿⠿⠿­⠿⠿⠿
            </p>
            <p style="display:block; hyphens:none">
              ⠿⠿⠿­⠿⠿⠿ ⠿⠿⠿­⠿⠿⠿
            </p>
            <p style="display:block">
              <span style="text-transform:auto">1</span> ⠿⠿⠿
            </p>
            <p style="display:block">
              <span style="text-transform:downshift">1</span> ⠿⠿⠿
            </p>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="12" page-height="8" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              ⠿⠿⠿­⠿⠿⠿ ⠿⠿⠿­⠿⠿⠿
            </block>
            <block>
              <style name="hyphens: none">⠿⠿⠿­⠿⠿⠿ ⠿⠿⠿­⠿⠿⠿</style>
            </block>
            <block>
              <span translate="">1</span> ⠿⠿⠿
            </block>
            <block>
              <span translate=""><style name="text-transform: downshift">1</style></span> ⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="8" cols="12" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠤</row>
                  <row>⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿</row>
                  <row>⠼⠁⠀⠿⠿⠿</row>
                  <row>⠂⠀⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_42">
    <x:documentation>
      Tests margin-bottom:1 in @page.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; @page { size: 15 5; margin-bottom: 1; }">
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="15" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_43">
    <x:documentation>
      Tests margin-bottom:2 in @page.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; @page { size: 15 5; margin-bottom: 2; }">
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="15" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_44">
    <x:documentation>
      Tests simple content in @bottom-left.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page { size: 15 5; margin-bottom: 1; @bottom-left { content: '⠆' } }">
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="15" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value="⠆"/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row/>
                  <row/>
                  <row>⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_45">
    <x:documentation>
      Tests simple content in @bottom-left within two-line bottom page margin.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page { size: 15 5; margin-bottom: 2; @bottom-left { content: '⠆' } }">
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="15" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
              <footer>
                <field>
                  <string value="⠆"/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_46">
    <x:documentation>
      Tests newline with white-space:pre-wrap in bottom page margin, which results into
      multi-line footer.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page { size: 15 5; margin-bottom: 2; @bottom-left { content: '⠆\A⠆⠆'; white-space: pre-wrap; } }">
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="15" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value="⠆"/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
              <footer>
                <field>
                  <string value="⠆⠆"/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠆⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠆⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_47">
    <x:documentation>
      Tests newline with white-space:pre-wrap in bottom page margin, which results into multi-line
      footer, even with margin-bottom:1.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page { size: 15 5; margin-bottom: 1; @bottom-left { content: '⠆\A⠆⠆'; white-space: pre-wrap; } }">
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="15" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value="⠆"/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
              <footer>
                <field>
                  <string value="⠆⠆"/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠆⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠆⠆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_48">
    <x:documentation>
      Tests rendering of range of print pages covered on current page (left corner of all pages) or
      current page spread (right corner of right-hand pages). Test both using the combination
      start-except-last/last (top of page) and the combination start/last-except-start (bottom of
      page).
      
      Note: the start/last-except-start part of the test is currently disabled because
      "last-except-start" is not supported anymore.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page {
                        size: 20 7;
                      }
                      @page:left {
                        margin-top: 1;
                        margin-bottom: 1;
                        @top-left {
                          content: string(print-page-dash, page-start-except-last)
                                   string(print-page, page-last); }}
                      @page:right {
                        margin-top: 1;
                        margin-bottom: 1;
                        @top-left {
                          content: string(print-page-dash, page-start-except-last)
                                   string(print-page, page-last); }
                        @top-right {
                          content: string(print-page-dash, spread-start-except-last)
                                   string(print-page, spread-last); }}"
               style-bottom="@page:left {
                               @bottom-left {
                                 content: string(print-page, page-start)
                                          string(dash-print-page, page-last-except-start); }}
                             @page:right {
                               @bottom-left {
                                 content: string(print-page, page-start)
                                          string(dash-print-page, page-last-except-start); }
                               @bottom-right {
                                 content: string(print-page, spread-start)
                                          string(dash-print-page, spread-last-except-start); }}">
            <pagenum style="display: none;
                            string-set: print-page content(),
                                        dash-print-page '⠒' content(),
                                        print-page-dash content() '⠒'">1</pagenum>
            <!-- begin right page -->
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <!-- begin left page -->
            <pagenum style="display: none;
                            string-set: print-page content(),
                                        dash-print-page '⠒' content(),
                                        print-page-dash content() '⠒'">2</pagenum>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <!-- begin right page -->
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <pagenum style="display: none;
                            string-set: print-page content(),
                                        dash-print-page '⠒' content(),
                                        print-page-dash content() '⠒'">3</pagenum>
            <p style="display: block">⠁⠁⠁</p>
            <!-- begin left page -->
            <pagenum style="display: none;
                            string-set: print-page content(),
                                        dash-print-page '⠒' content(),
                                        print-page-dash content() '⠒'">4</pagenum>
            <p style="display: block">⠁⠁⠁</p>
            <pagenum style="display: none;
                            string-set: print-page content(),
                                        dash-print-page '⠒' content(),
                                        print-page-dash content() '⠒'">5</pagenum>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <!-- begin right page -->
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <pagenum style="display: none;
                            string-set: print-page content(),
                                        dash-print-page '⠒' content(),
                                        print-page-dash content() '⠒'">6</pagenum>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="20" page-height="7" duplex="true">
            <template use-when="(= (% $page 2) 1)">
              <header>
                <field>
                  <marker-reference marker="print-page-dash/prev" direction="forward" scope="page-content"/>
                  <compound-marker-reference>
                    <marker-reference marker="print-page" direction="backward" scope="sequence"/>
                    <marker-reference marker="print-page/entry" direction="backward" scope="sequence"/>
                  </compound-marker-reference>
                </field>
                <field>
                  <marker-reference marker="print-page-dash/prev" direction="forward" scope="spread-content" start-offset="-1"/>
                  <compound-marker-reference>
                    <marker-reference marker="print-page" direction="backward" scope="sequence"/>
                    <marker-reference marker="print-page/entry" direction="backward" scope="sequence"/>
                  </compound-marker-reference>
                </field>
              </header>
              <footer>
                <!--
                <field>
                  <compound-marker-reference>
                    <marker-reference marker="print-page/prev" direction="forward" scope="page-content"/>
                    <marker-reference marker="print-page" direction="backward" scope="sequence"/>
                    <marker-reference marker="print-page/entry" direction="backward" scope="sequence"/>
                  </compound-marker-reference>
                  <marker-reference marker="dash-print-page" direction="backward" scope="page"/>
                </field>
                -->
                <field>
                  <string value=""/>
                </field>
                <!--
                <field>
                  <compound-marker-reference>
                    <marker-reference marker="print-page/prev" direction="forward" scope="spread-content"/>
                    <marker-reference marker="print-page" direction="backward" scope="sequence"/>
                    <marker-reference marker="print-page/entry" direction="backward" scope="sequence"/>
                  </compound-marker-reference>
                  <marker-reference marker="dash-print-page" direction="backward" scope="spread"/>
                </field>
                -->
                <field>
                  <string value=""/>
                </field>
              </footer>
            </template>
            <template use-when="(= (% $page 2) 0)">
              <header>
                <field>
                  <marker-reference marker="print-page-dash/prev" direction="forward" scope="page-content"/>
                  <compound-marker-reference>
                    <marker-reference marker="print-page" direction="backward" scope="sequence"/>
                    <marker-reference marker="print-page/entry" direction="backward" scope="sequence"/>
                  </compound-marker-reference>
                </field>
                <field>
                  <string value=""/>
                </field>
              </header>
              <footer>
                <!--
                <field>
                  <compound-marker-reference>
                    <marker-reference marker="print-page/prev" direction="forward" scope="page-content"/>
                    <marker-reference marker="print-page" direction="backward" scope="sequence"/>
                    <marker-reference marker="print-page/entry" direction="backward" scope="sequence"/>
                  </compound-marker-reference>
                  <marker-reference marker="dash-print-page" direction="backward" scope="page"/>
                </field>
                -->
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
            </template>
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <!-- begin right page -->
            <block>
              <block>
                <marker class="print-page" value="1"/>
              </block>
              ⠁⠁⠁
            </block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <!-- begin left page -->
            <block>
              <block>
                <marker class="print-page" value="2"/>
                <marker class="print-page-dash/prev" value="1⠒"/>
              </block>
              ⠁⠁⠁
            </block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <!-- begin right page -->
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>
              <block>
                <marker class="print-page" value="3"/>
                <marker class="print-page-dash/prev" value="2⠒"/>
              </block>
              ⠁⠁⠁
            </block>
            <!-- begin left page -->
            <block>
              <block>
                <marker class="print-page" value="4"/>
                <marker class="print-page-dash/prev" value="3⠒"/>
              </block>
              ⠁⠁⠁
            </block>
            <block>
              <block>
                <marker class="print-page" value="5"/>
                <marker class="print-page-dash/prev" value="4⠒"/>
              </block>
              ⠁⠁⠁
            </block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <!-- begin right page -->
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>
              ⠁⠁⠁
              <marker class="print-page" value="6"/>
              <marker class="print-page-dash/prev" value="5⠒"/>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="7" rowgap="0" duplex="true">
              <section>
                <!-- right -->
                <page>
                  <!-- print page 1 -->
                  <row>⠼⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row> <!-- 1     ...     1 -->
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <!--<row>⠼⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>--> <!-- 1     ...     1 -->
                </page>
                <!-- left -->
                <page>
                  <!-- print page 2 -->
                  <row>⠼⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row> <!-- 2               -->
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <!--<row>⠼⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>--> <!-- 2                 -->
                </page>
                <!-- right -->
                <page>
                  <row>⠼⠃⠒⠼⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠃⠒⠼⠉</row> <!-- 2-3   ...   2-3 -->
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <!-- print page 3 -->
                  <row>⠁⠁⠁</row>
                  <!-- print page 4 -->
                  <!--<row>⠼⠃⠒⠼⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠃⠒⠼⠉</row>--> <!-- 2-3   ...   2-3 -->
                </page>
                <!-- left -->
                <page>
                  <row>⠼⠙⠒⠼⠑⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row> <!-- 4-5             -->
                  <row>⠁⠁⠁</row>
                  <!-- print page 5 -->
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <!--<row>⠼⠙⠒⠼⠑⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>--> <!-- 4-5             -->
                </page>
                <!-- right -->
                <page>
                  <row>⠼⠑⠒⠼⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠙⠒⠼⠋</row> <!-- 5-6   ...   4-6 -->
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <!-- print page 6 -->
                  <row/>
                  <!--<row>⠼⠑⠒⠼⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠙⠒⠼⠋</row>--> <!-- 5-6   ...   4-6 -->
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_52">
    <x:documentation>
      Tests string-set on not-rendered elements in between blocks.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page {
                        size: 20 6;
                        @bottom-left {
                          content: string(print-page, page-start); }}">
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <pagenum style="display: none; string-set: print-page content()">1</pagenum>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <pagenum style="display: none; string-set: print-page content()">2</pagenum>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="20" page-height="6" duplex="true">
            <default-template>
              <header/>
              <footer>
                <field>
                  <compound-marker-reference>
                    <marker-reference marker="print-page/prev" direction="forward" scope="page-content"/>
                    <marker-reference marker="print-page" direction="backward" scope="sequence"/>
                    <marker-reference marker="print-page/entry" direction="backward" scope="sequence"/>
                  </compound-marker-reference>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>
              <block>
                <marker class="print-page" value="1"/>
              </block>
              ⠁⠁⠁
            </block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>
              <block>
                <marker class="print-page/prev" value="1"/>
                <marker class="print-page" value="2"/>
              </block>
              ⠁⠁⠁
            </block>
            <block>⠁⠁⠁</block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row> <!-- (empty) -->
                </page>
                <page>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <!-- 1 -->
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠼⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row> <!-- 1 -->
                </page>
                <page>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <!-- 2 -->
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row/>
                  <row>⠼⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row> <!-- 1 -->
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_53">
    <x:documentation>
      Tests string-set on not-rendered elements inside blocks.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page {
                        size: 10 6;
                        margin-bottom: 1;
                        @bottom-left {
                          content: string(print-page, page-start); }}">
            <p style="display: block">
              <pagenum style="display: none; string-set: print-page content()">1</pagenum>
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              <pagenum style="display: none; string-set: print-page content()">2</pagenum>
            </p>
            <p style="display: block">
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
            </p>
            <pagenum style="display: none; string-set: print-page content()">3</pagenum>
            <p style="display: block">
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              <pagenum style="display: none; string-set: print-page content()">4</pagenum>
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
            </p>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="10" page-height="6" duplex="true">
            <default-template>
              <header/>
              <footer>
                <field>
                  <compound-marker-reference>
                    <marker-reference marker="print-page/prev" direction="forward" scope="page-content"/>
                    <marker-reference marker="print-page" direction="backward" scope="sequence"/>
                    <marker-reference marker="print-page/entry" direction="backward" scope="sequence"/>
                  </compound-marker-reference>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              <block>
                <marker class="print-page" value="1"/>
              </block>
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              <marker class="print-page/prev" value="1"/>
              <marker class="print-page" value="2"/>
            </block>
            <block>
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
            </block>
            <block>
              <block>
                <marker class="print-page/prev" value="2"/>
                <marker class="print-page" value="3"/>
              </block>
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              <marker class="print-page/prev" value="3"/>
              <marker class="print-page" value="4"/>
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <!-- 1 -->
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠼⠁⠀⠀⠀⠀⠀⠀⠀⠀</row> <!-- 1 -->
                </page>
                <page>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <!-- 2 -->
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠼⠁⠀⠀⠀⠀⠀⠀⠀⠀</row> <!-- 1 -->
                </page>
                <page>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <!-- 3 -->
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠼⠃⠀⠀⠀⠀⠀⠀⠀⠀</row> <!-- 2 -->
                </page>
                <page>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <!-- 4 -->
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠼⠉⠀⠀⠀⠀⠀⠀⠀⠀</row> <!-- 3 -->
                </page>
                <page>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠼⠙⠀⠀⠀⠀⠀⠀⠀⠀</row> <!-- 4 -->
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_49">
    <x:documentation>
      Tests flow, flow() and @begin.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; @page { size: 15 5 } @volume { @begin { content: flow(titlepage, document) }}">
            <front>
              <titlepage style="display: block; flow: titlepage">
                ⠿⠿⠿
              </titlepage>
            </front>
            <body style="display: block">
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" page-width="15" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <sequence master="main">
                <block translate="pre-translated-text-css">
                  ⠿⠿⠿
                </block>
              </sequence>
            </pre-content>
          </volume-template>
          <sequence master="main">
            <block/>
            <block translate="pre-translated-text-css">
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_50">
    <x:documentation>
      Tests max-length.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; @page { size: 10 5 } @volume { max-length: 3 }">
            <body style="display:block">
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" page-width="10" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="3"/>
          <sequence master="main">
            <block>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume rows="5" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume rows="5" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_51">
    <x:documentation>
      Tests volume pseudo-class @volume:first.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; @page { size: 10 5 } @volume { max-length: 3 } @volume:first { max-length: 1 }">
            <body style="display: block">
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" page-width="10" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template use-when="(! (= $volume 1))" sheets-in-volume-max="3"/>
          <volume-template use-when="(= $volume 1)" sheets-in-volume-max="1"/>
          <sequence master="main">
            <block>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume rows="5" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume rows="5" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_54">
    <x:documentation>
      Tests string(..., first) and string(..., start) with multiple sequences.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page {
                        size: 10 5;
                        @bottom-left { content: string(foo, first) }
                        @bottom-right { content: string(foo, start) }}">
            <section style="display: block;
                            string-set: foo '⠿'">
              ⠤⠤⠤
            </section>
            <section style="display: block;
                            page-break-before: right">
              ⠤⠤⠤
              <_ style="display: none; string-set: foo '⠿⠿'"/>
              ⠤⠤⠤
            </section>
            <section style="display: block;
                            page-break-before: right">
              <_ style="display: none; string-set: foo '⠿⠿⠿'"/>
              ⠤⠤⠤
            </section>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="10" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer>
                <field>
                  <compound-marker-reference>
                    <marker-reference marker="foo" direction="forward" scope="page"/>
                    <marker-reference marker="foo" direction="backward" scope="sequence"/>
                    <marker-reference marker="foo/entry" direction="backward" scope="sequence"/>
                  </compound-marker-reference>
                </field>
                <field>
                  <compound-marker-reference>
                    <marker-reference marker="foo/prev" direction="forward" scope="page-content"/>
                    <marker-reference marker="foo" direction="backward" scope="sequence"/>
                    <marker-reference marker="foo/entry" direction="backward" scope="sequence"/>
                  </compound-marker-reference>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              <block>
                <marker class="foo" value="⠿"/>
              </block>
              ⠤⠤⠤
            </block>
            <block break-before="sheet">
              ⠤⠤⠤
              <marker class="foo/prev" value="⠿"/>
              <marker class="foo" value="⠿⠿"/>
              ⠤⠤⠤
            </block>
            <block break-before="sheet">
              <block>
                <marker class="foo/prev" value="⠿⠿"/>
                <marker class="foo" value="⠿⠿⠿"/>
              </block>
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠿⠀⠀⠀⠀⠀⠀⠀⠀⠿</row>
                </page>
                <page>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠿⠀⠀⠀⠀⠀⠀⠀⠀⠿</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠿⠿⠀⠀⠀⠀⠀⠀⠀⠿</row>
                </page>
                <page>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠿⠿⠀⠀⠀⠀⠀⠀⠿⠿</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠿⠿⠿⠀⠀⠀⠀⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_55">
    <x:documentation>
      Tests margin-left in @page.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page { size: 15 5; margin-left: 2 }">
            <body style="display: block">
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="15" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer/>
              <margin-region align="left" width="2">
                <indicators/>
              </margin-region>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_56">
    <x:documentation>
      Tests -obfl-marker-indicator() in @left.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page {
                        size: 15 5;
                        margin-left: 2;
                        @left {
                          content: -obfl-marker-indicator(pagenum, '⠿');
                          text-transform: none; }}">
            <body style="display: block">
              <pagenum style="display: none; -obfl-marker: pagenum">1</pagenum>
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              <pagenum style="display: none; -obfl-marker: pagenum">2</pagenum>
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              <pagenum style="display: none; -obfl-marker: pagenum">3</pagenum>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="15" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer/>
              <margin-region align="left" width="2">
                <indicators>
                  <marker-indicator markers="indicator/pagenum" indicator="⠿" text-style="text-transform: none"/>
                </indicators>
              </margin-region>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              <marker class="indicator/pagenum" value="x"/>
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              <marker class="indicator/pagenum" value="x"/>
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              <marker class="indicator/pagenum" value="x"/>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠿⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠿⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_57">
    <x:documentation>
      Tests -obfl-marker-indicator() in @left when @page has no margin-left.

      Also tests that content in left margin is trimmed when needed. (Note that if
      allow-text-overflow-trimming is set to false, this would result in an error.)
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;">
            <section style="display: block; @page { size: 15 5; @left { content: -obfl-marker-indicator(pagenum, '⠿') }}">
              <pagenum style="display: none; -obfl-marker: pagenum">1</pagenum>
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              <pagenum style="display: none; -obfl-marker: pagenum">2</pagenum>
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
            </section>
            <section style="display: block; @page { size: 15 5; @left { content: -obfl-marker-indicator(pagenum, '⠿⠿⠿') }}">
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              <pagenum style="display: none; -obfl-marker: pagenum">3</pagenum>
            </section>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="15" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer/>
              <margin-region align="left" width="1">
                <indicators>
                  <marker-indicator markers="indicator/pagenum" indicator="⠿"/>
                </indicators>
              </margin-region>
            </default-template>
          </layout-master>
          <layout-master name="b" page-width="15" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer/>
              <margin-region align="left" width="1">
                <indicators>
                  <marker-indicator markers="indicator/pagenum" indicator="⠿⠿⠿"/>
                </indicators>
              </margin-region>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              <marker class="indicator/pagenum" value="x"/>
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              <marker class="indicator/pagenum" value="x"/>
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
            </block>
          </sequence>
          <sequence master="b">
            <block break-before="sheet">
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              <marker class="indicator/pagenum" value="x"/>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠿⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠿⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_58">
    <x:documentation>
      Tests stacked pseudo-elements.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; @page { size: 10 10; }">
            <body style="display: block;
                         &amp;::after { display:block; margin-left:1; content:'⠤⠤⠤' }
                         &amp;::after::before { display:block; margin-left:1; content:'⠸⠸⠸' }
                         &amp;::after::after { display:block; margin-left:1; content:'⠛⠛⠛' }">
              ⠿⠿⠿
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="10" page-height="10" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              <block> ⠿⠿⠿ </block>
              <block>
                <block padding-left="2"> ⠸⠸⠸ </block>
                <block padding-left="1"> ⠤⠤⠤ </block>
                <block padding-left="2"> ⠛⠛⠛ </block>
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="10" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿</row>
                  <row>⠀⠀⠸⠸⠸</row>
                  <row>⠀⠤⠤⠤</row>
                  <row>⠀⠀⠛⠛⠛</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_59">
    <x:documentation>
      Tests display:table.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <table xmlns="http://www.daisy.org/z3986/2005/dtbook/"
                 style="display: table;
                        padding-left: 1;
                        padding-right: 1;
                        -obfl-table-col-spacing: 1;
                        text-transform: none;
                        @page { size: 20 12; }">
            <caption>
              <p style="display:block; text-align:center">
                ⠿⠿⠿⠿
              </p>
            </caption>
            <thead>
              <tr>
                <th colspan="2" style="border-bottom-pattern:⠒">⠤⠤⠤</th>
                <th style="border-bottom-pattern:⠒">⠤⠤⠤</th>
              </tr>
            </thead>
            <tfoot>
              <tr>
                <td style="border-top-pattern:⠒">⠤⠤⠤</td>
                <td style="border-top-pattern:⠒">⠤⠤⠤</td>
                <td style="border-top-pattern:⠒">⠤⠤⠤</td>
              </tr>
            </tfoot>
            <tbody>
              <tr>
                <td>
                  <ul style="list-style-type:decimal">
                    <li style="display:list-item"/>
                    <li style="display:list-item"/>
                    <li style="display:list-item"/>
                  </ul>
                </td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
              <pagenum style="display:none; string-set:print-page '⠿⠿'"/>
              <tr>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
            </tbody>
            <tbody>
              <tr>
                <td rowspan="2">⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
              <tr>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
            </tbody>
          </table>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="20" page-height="12">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="main">
            <block>
              <block>
                <block padding-left="1" padding-right="1" align="center">
                  ⠿⠿⠿⠿
                </block>
              </block>
              <table padding-left="1" padding-right="1" table-col-spacing="1" >
                <thead>
                  <tr>
                    <td border-bottom-style="solid" border-bottom-align="center" col-span="2">⠤⠤⠤</td>
                    <td border-bottom-style="solid" border-bottom-align="center">⠤⠤⠤</td>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <block><span translate="">1.</span></block>
                      <block><span translate="">2.</span></block>
                      <block><span translate="">3.</span></block>
                    </td>
                    <td>⠤⠤⠤</td>
                    <td>⠤⠤⠤</td>
                  </tr>
                  <tr>
                    <td>
                      ⠤⠤⠤
                    </td>
                    <td>⠤⠤⠤</td>
                    <td>⠤⠤⠤</td>
                  </tr>
                  <tr>
                    <td row-span="2">⠤⠤⠤</td>
                    <td>⠤⠤⠤</td>
                    <td>⠤⠤⠤</td>
                  </tr>
                  <tr>
                    <td>⠤⠤⠤</td>
                    <td>⠤⠤⠤</td>
                  </tr>
                  <tr>
                    <td border-top-style="solid" border-top-align="center">⠤⠤⠤</td>
                    <td border-top-style="solid" border-top-align="center">⠤⠤⠤</td>
                    <td border-top-style="solid" border-top-align="center">⠤⠤⠤</td>
                  </tr>
                </tbody>
              </table>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="12" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠿⠿⠿⠿</row>
                  <row>⠀⠤⠤⠤⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤⠤</row>
                  <row>⠀⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠀⠀⠒⠒⠒⠒⠒</row>
                  <row>⠀⠼⠁.⠀⠀⠀⠤⠤⠤⠀⠀⠀⠤⠤⠤</row>
                  <row>⠀⠼⠃.</row>
                  <row>⠀⠼⠉.</row>
                  <row>⠀⠤⠤⠤⠀⠀⠀⠤⠤⠤⠀⠀⠀⠤⠤⠤</row>
                  <row>⠀⠤⠤⠤⠀⠀⠀⠤⠤⠤⠀⠀⠀⠤⠤⠤</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠤⠤⠤⠀⠀⠀⠤⠤⠤</row>
                  <row>⠀⠒⠒⠒⠒⠒⠀⠒⠒⠒⠒⠒⠀⠒⠒⠒⠒⠒</row>
                  <row>⠀⠤⠤⠤⠀⠀⠀⠤⠤⠤⠀⠀⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_60">
    <x:documentation>
      Tests display:table with render-table-by:column or render-table-by:column,row.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <table xmlns="http://www.daisy.org/z3986/2005/dtbook/"
                 style="display:table;
                        -obfl-table-col-spacing:1;
                        -obfl-preferred-empty-space:0;
                        render-table-by:column,row;
                        text-transform: none;
                        @page { size: 25 10; }">
            <thead>
              <tr>
                <th colspan="2">⠤⠤⠤</th>
                <th>⠤⠤⠤</th>
              </tr>
            </thead>
            <tfoot>
              <tr>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
            </tfoot>
            <tbody>
              <tr>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
              <tr>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
            </tbody>
            <tbody>
              <tr>
                <td rowspan="2">⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
              <tr>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
            </tbody>
          </table>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" duplex="true" page-width="25" page-height="10">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              <table table-col-spacing="1" preferred-empty-space="0">
                <tr>
                  <td row-span="2">⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                  <td col-span="2">⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                </tr>
                <tr>
                  <td>⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                </tr>
                <tr>
                  <td>⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                </tr>
              </table>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="25" rows="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠀⠀⠀⠀⠤⠤⠤</row>
                  <row>⠀⠀⠀⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_61">
    <x:documentation>
      Tests flow:footnotes, @footnotes page area and ::footnote-call pseudo-element.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none;
                       @page { size: 10 6; @footnotes { content: flow(footnotes, page) }}">
            <p style="display: block">
              ⠤⠤⠤
              <note style="flow: footnotes;
                           display: block;
                           &amp;::footnote-call { content:'⠶' }">⠿⠿⠿</note>
              ⠤⠤⠤
              <note style="flow: footnotes;
                           display: block;
                           &amp;::footnote-call { content:'⠶⠶' }">⠿⠿⠿⠿⠿⠿</note>
            </p>
            <p style="display: block; page-break-before: always">
              ⠤⠤⠤
              <note style="flow: footnotes;
                           display: block;
                           &amp;::footnote-call { content:'⠶' }">⠿⠿⠿⠿⠿⠿⠿⠿⠿</note>
            </p>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" duplex="true" page-width="10" page-height="6">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="3" collection="footnotes"/>
          </layout-master>
          <collection name="footnotes">
            <item id="a">
              <block>⠿⠿⠿</block>
            </item>
            <item id="b">
              <block>⠿⠿⠿⠿⠿⠿</block>
            </item>
            <item id="c">
              <block>⠿⠿⠿⠿⠿⠿⠿⠿⠿</block>
            </item>
          </collection>
          <sequence master="body">
            <block>
              ⠤⠤⠤ ⠶
              <anchor item="a"/>
              ⠤⠤⠤ ⠶⠶
              <anchor item="b"/>
            </block>
            <block break-before="page">
              ⠤⠤⠤ ⠶
              <anchor item="c"/>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="6" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠶⠀⠤⠤⠤</row>
                  <row>⠶⠶</row>
                  <row/>
                  <row/>
                  <row>⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠀⠶</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_62">
    <x:documentation>
      Tests flow:footnotes with ::alternate pseudo-element and target-content().
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none;
                       @page { size: 10 6; @footnotes { content: flow(footnotes, page) }}">
            <p style="display:block">
              ⠤⠤⠤
              <noteref ref="note_1"
                       style="&amp;::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶
              </noteref>
            </p>
            <note id="note_1" style="display:none">
              ⠿⠿⠿
            </note>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" duplex="true" page-width="10" page-height="6">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="3" collection="footnotes"/>
          </layout-master>
          <collection name="footnotes">
            <item id="a">
              <block>⠿⠿⠿</block>
            </item>
          </collection>
          <sequence master="body">
            <block>
              ⠤⠤⠤ ⠶
              <anchor item="a"/>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="6" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠶</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_63">
    <x:documentation>
      Tests volume notes using ::alternate pseudo-element and target-content() and volume range
      flow(). Note that there are sheet breaks between the `flow(endnotes, volume)' and any content
      that is included before and after it, and that the content before and after is not
      automatically skipped when the volume contains no notes. To accomplish this you need to use
      `display: -obfl-list-of-references' and a `::-obfl-on-collection-start' pseudo-element.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page { size: 10 6 }
                      @volume {
                        max-length: 4;
                        @end {
                          content: flow(volume-notes-title, document) flow(endnotes, volume) }}">
            <body style="&amp;::alternate {
                           flow: volume-notes-title;
                           display: block;
                           content: '⠭⠭⠭'; }">
              <p style="display:block">
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                <noteref ref="note_1" style="&amp;::alternate { flow:endnotes; display:block; content:target-content(attr(ref)) }">
                  ⠶
                </noteref>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </p>
              <p style="display:block">
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                <noteref ref="note_2" style="&amp;::alternate { flow:endnotes; display:block; content:target-content(attr(ref)) }">
                  ⠶
                </noteref>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </p>
            </body>
            <ul id="notes" style="display:none">
              <li id="note_1">
                ⠿⠿⠿
              </li>
              <li id="note_2">
                ⠿⠿⠿⠿⠿⠿
              </li>
            </ul>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="10" page-height="6">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="4">
            <post-content>
              <sequence master="main">
                <block>⠭⠭⠭</block>
              </sequence>
              <dynamic-sequence master="main">
                <list-of-references collection="endnotes" range="volume"/>
              </dynamic-sequence>
            </post-content>
          </volume-template>
          <collection name="endnotes">
            <item id="a">
              <block> ⠿⠿⠿ </block>
            </item>
            <item id="b">
              <block> ⠿⠿⠿⠿⠿⠿ </block>
            </item>
          </collection>
          <sequence master="main">
            <block>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠶
              <anchor item="a"/>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
            <block>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠶
              <anchor item="b"/>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠶</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠭⠭⠭</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠿⠿⠿</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠶</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠭⠭⠭</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠭⠭⠭</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_64">
    <x:documentation>
      Tests numbering of footnotes. Numbers are added both to the note itself and to the note
      reference. The numbering is not reset on each page. Two alternative methods are used for
      adding a number to the note itself. The third noteref has the text content "*" which is
      replaced with the number.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none;
                       @page { size: 20 6; @footnotes { content: flow(footnotes, page) }}">
            <p style="display:block">
              ⠤⠤⠤
              <noteref ref="note_1"
                       style="counter-increment: footnote;
                              &amp;::after { content: '⠦' counter(footnote) '⠴'; }
                              &amp;::alternate {
                                flow: footnotes;
                                display: block;
                                content: counter(footnote) ' ' target-content(attr(ref)); }"/>
              ⠤⠤⠤
              <noteref ref="note_2"
                       style="counter-increment: footnote;
                              &amp;::after { content: '⠦' counter(footnote) '⠴'; }
                              &amp;::alternate {
                                flow: footnotes;
                                display: block;
                                content: target-content(attr(ref)); }
                              &amp;::alternate::before { content: counter(footnote) ' '; }"/>
              ⠤⠤⠤
              <noteref ref="note_1"
                       style="flow: null;
                              counter-increment: footnote;
                              &amp;::alternate { content: '⠦' counter(footnote) '⠴'; }
                              &amp;::alternate::alternate {
                                flow: footnotes;
                                display: block;
                                content: counter(footnote) ' ' target-content(attr(ref)); }">*</noteref>
            </p>
            <note id="note_1" style="display:none">
              ⠿⠿⠿
            </note>
            <note id="note_2" style="display:none">
              ⠿⠿⠿
            </note>
            <note id="note_3" style="display:none">
              ⠿⠿⠿
            </note>
          </body>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="20" page-height="6">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="3" collection="footnotes"/>
          </layout-master>
          <collection name="footnotes">
            <item id="a">
              <block translate="pre-translated-text-css">
                <span translate="">1</span> ⠿⠿⠿
              </block>
            </item>
            <item id="b">
              <block translate="pre-translated-text-css">
                <span translate="">2</span> ⠿⠿⠿
              </block>
            </item>
            <item id="c">
              <block translate="pre-translated-text-css">
                <span translate="">3</span> ⠿⠿⠿
              </block>
            </item>
          </collection>
          <sequence master="main">
            <block translate="pre-translated-text-css">
              ⠤⠤⠤ ⠦<span translate="">1</span>⠴
              <anchor item="a"/>
              ⠤⠤⠤ ⠦<span translate="">2</span>⠴
              <anchor item="b"/>
              ⠤⠤⠤ ⠦<span translate="">3</span>⠴
              <anchor item="c"/>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠦⠼⠁⠴⠀⠤⠤⠤⠀⠦⠼⠃⠴</row>
                  <row>⠤⠤⠤⠀⠦⠼⠉⠴</row>
                  <row/>
                  <row>⠼⠁⠀⠿⠿⠿</row>
                  <row>⠼⠃⠀⠿⠿⠿</row>
                  <row>⠼⠉⠀⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_65">
    <x:documentation>
      Tests chapter endnotes using flow() function in ::after pseudo-element. Also tests that
      `display: -obfl-list-of-references' can occur outside of a @begin or @end area.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none; @page { size: 20 6 }">
            <section style="display: block;
                            &amp;::after {
                              display: block;
                              content: flow(chapter-notes) }">
              <h1 style="display:block; page-break-before:always">
                ⠤⠤⠤
              </h1>
              ⠤⠤⠤
              <note style="flow: chapter-notes;
                           display: block;
                           &amp;::alternate { content:'⠶' }">⠿⠿⠿</note>
              ⠤⠤⠤
              <noteref ref="note_2"
                       style="&amp;::alternate {
                                flow: chapter-notes;
                                display: block;
                                content: target-content(attr(ref)); }">
                ⠶⠶
              </noteref>
              ⠤⠤⠤
            </section>
            <section style="display: block;
                            &amp;::after {
                              display: -obfl-list-of-references;
                              content: flow(chapter-notes) }">
              <h1 style="display:block; page-break-before:always">
                ⠤⠤⠤
              </h1>
              ⠤⠤⠤
              <note style="flow: chapter-notes;
                           display: block;
                           &amp;::alternate { content:'⠶⠶⠶' }">⠿⠿⠿</note>
              ⠤⠤⠤
            </section>
            <note id="note_2" style="display:none">
              ⠿⠿⠿
            </note>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="20" page-height="6">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="main">
            <block break-before="page">
              <block>
                ⠤⠤⠤
              </block>
              <block>
                ⠤⠤⠤ ⠶ ⠤⠤⠤ ⠶⠶ ⠤⠤⠤
              </block>
              <block>
                <block> ⠿⠿⠿ </block>
                <block> ⠿⠿⠿ </block>
              </block>
            </block>
            <block break-before="page">
              <block>
                ⠤⠤⠤
              </block>
              <block>
                ⠤⠤⠤ ⠶⠶⠶ ⠤⠤⠤
              </block>
              <block>
                <block> ⠿⠿⠿ </block>
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠶⠀⠤⠤⠤⠀⠶⠶⠀⠤⠤⠤</row>
                  <row>⠿⠿⠿</row>
                  <row>⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠶⠶⠶⠀⠤⠤⠤</row>
                  <row>⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_66">
    <x:documentation>
      Tests numbering of chapter endnotes.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none;
                       counter-reset: note;
                       @page { size: 20 6 }">
            <section style="display: block;
                            &amp;::after { display:block; content: flow(chapter-notes)}">
              ⠤⠤⠤
              <noteref ref="note_1"
                       style="counter-increment: note;
                              &amp;::after { content: '⠦' counter(note) '⠴'; }
                              &amp;::alternate {
                                flow: chapter-notes;
                                display: block;
                                content: counter(note) ' ' target-content(attr(ref)); }"/>
              ⠤⠤⠤
              <noteref ref="note_2"
                       style="counter-increment: note;
                              &amp;::after { content: '⠦' counter(note) '⠴'; }
                              &amp;::alternate {
                                flow: chapter-notes;
                                display: block;
                                content: counter(note) ' ' target-content(attr(ref)); }"/>
              ⠤⠤⠤
            </section>
            <section class="notes" style="display:none">
              <note id="note_1">
                ⠿⠿⠿
              </note>
              <note id="note_2">
                ⠿⠿⠿
              </note>
            </section>
          </body>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="20" page-height="6">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="main">
            <block>
              <block> ⠤⠤⠤ ⠦<span translate="">1</span>⠴ ⠤⠤⠤ ⠦<span translate="">2</span>⠴ ⠤⠤⠤ </block>
              <block>
                <block><span translate="">1</span> ⠿⠿⠿ </block>
                <block><span translate="">2</span> ⠿⠿⠿ </block>
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠦⠼⠁⠴⠀⠤⠤⠤⠀⠦⠼⠃⠴⠀</row>
                  <row>⠤⠤⠤</row>
                  <row>⠼⠁⠀⠿⠿⠿</row>
                  <row>⠼⠃⠀⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_67" xfail="not supported yet">
    <x:documentation>
      Tests nested footnotes (noteref inside note).
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="@page { size: 10 6; @footnotes { content: flow(footnotes, page) }}">
            <p style="display:block">
              ⠤⠤⠤
              <noteref ref="note_1" style="&amp;::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶
              </noteref>
              ⠤⠤⠤
            </p>
            <note id="note_1" style="display:none">
              ⠿⠿⠿
              <noteref ref="note_2" style="&amp;::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶⠶
              </noteref>
              ⠿⠿⠿
            </note>
            <note id="note_2" style="display:none">
              ⠿⠿⠿
            </note>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" duplex="true" page-width="10" page-height="6">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="3" collection="footnotes"/>
          </layout-master>
          <collection name="footnotes">
            <item id="a">
              <block>⠿⠿⠿ ⠶⠶ ⠿⠿⠿</block>
            </item>
            <item id="b">
              <block>⠿⠿⠿</block>
            </item>
          </collection>
          <sequence master="body">
            <block>
              ⠤⠤⠤ ⠶
              <anchor item="a"/>
              <anchor item="b"/>
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="6" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠶⠀⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠿⠿⠿⠀⠶⠶⠀⠿⠿⠿</row>
                  <row>⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_68">
    <x:documentation>
      Tests -obfl-fallback-collection with footnotes small enough to fit in the @footnotes area.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none;
                       @page {
                         size: 20 10;
                         @footnotes {
                           content: flow(footnotes, page);
                           -obfl-fallback-collection: endnotes; }}
                       @volume {
                         @end {
                           content: flow(endnotes, volume); }}">
            <p style="display:block">
              ⠤⠤⠤
              <noteref ref="note_1" style="&amp;::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶
              </noteref>
              ⠤⠤⠤
              <noteref ref="note_2" style="&amp;::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶⠶
              </noteref>
              ⠤⠤⠤
            </p>
            <note id="note_1" style="display:none">
              ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
            </note>
            <note id="note_2" style="display:none">
              ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
            </note>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="20" page-height="10">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="5" collection="footnotes">
              <fallback>
                <rename collection="footnotes" to="endnotes"/>
                <rename collection="meta/footnotes" to="meta/endnotes"/>
              </fallback>
            </page-area>
          </layout-master>
          <volume-template sheets-in-volume-max="1000">
            <post-content>
              <dynamic-sequence master="main">
                <list-of-references collection="endnotes" range="volume"/>
              </dynamic-sequence>
            </post-content>
          </volume-template>
          <collection name="footnotes">
            <item id="a">
              <block> ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ </block>
            </item>
            <item id="b">
              <block> ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ </block>
            </item>
          </collection>
          <sequence master="main">
            <block>
              ⠤⠤⠤ ⠶
              <anchor item="a"/>
              ⠤⠤⠤ ⠶⠶
              <anchor item="b"/>
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠶⠀⠤⠤⠤⠀⠶⠶⠀⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_69">
    <x:documentation>
      Tests -obfl-fallback-collection with footnotes too big to fit in the @footnotes area.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none;
                       @page {
                         size: 20 10;
                         @footnotes {
                           content: flow(footnotes, page);
                           -obfl-fallback-collection: endnotes; }}
                       @volume {
                         @end {
                           content: flow(endnotes, volume); }}">
            <p style="display:block">
              ⠤⠤⠤
              <noteref ref="note_1" style="&amp;::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶
              </noteref>
              ⠤⠤⠤
              <noteref ref="note_2" style="&amp;::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶⠶
              </noteref>
              ⠤⠤⠤
            </p>
            <note id="note_1" style="display:none">
              ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
            </note>
            <note id="note_2" style="display:none">
              ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
            </note>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="20" page-height="10">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="5" collection="footnotes">
              <fallback>
                <rename collection="footnotes" to="endnotes"/>
                <rename collection="meta/footnotes" to="meta/endnotes"/>
              </fallback>
            </page-area>
          </layout-master>
          <volume-template sheets-in-volume-max="1000">
            <post-content>
              <dynamic-sequence master="main">
                <list-of-references collection="endnotes" range="volume"/>
              </dynamic-sequence>
            </post-content>
          </volume-template>
          <collection name="footnotes">
            <item id="a">
              <block>
                ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
              </block>
            </item>
            <item id="b">
              <block>
                ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
              </block>
            </item>
          </collection>
          <sequence master="main">
            <block>
              ⠤⠤⠤ ⠶
              <anchor item="a"/>
              ⠤⠤⠤ ⠶⠶
              <anchor item="b"/>
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠶⠀⠤⠤⠤⠀⠶⠶⠀⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_70">
    <x:documentation>
      Tests document scope table of contents in @begin area of first volume and volume scope table
      of contents in @begin area of subsequent volumes. Note that there are sheet breaks between the
      TOC and any content that is included before and after it, and that content before the TOC is
      not automatically put in a "on-toc-start" element. For this you need to use a
      `::-obfl-on-toc-start' pseudo-element.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page {
                        size: 15 7;
                        margin-bottom: 1;
                        @bottom-right { content: counter(page) }}
                      @volume:first { max-length: 4; @begin { content: flow(first-front, document) }}
                      @volume { max-length: 4; @begin { content: flow(next-front, document) }}">
            <front>
              <h1 style="display: block; flow: first-front">
                ⠿ ⠿ ⠿ ⠿
              </h1>
              <h1 style="display: block;
                         flow: first-front;
                         &amp;::duplicate { display:block; flow:next-front }">
                ⠿⠿⠿⠿
              </h1>
              <toc style="display: -obfl-toc;
                          flow: first-front;
                          text-transform: auto;
                          &amp;::-obfl-on-volume-start { content: counter(-obfl-started-volume-number) }
                          &amp;::duplicate { display:-obfl-toc; -obfl-toc-range:volume; flow:next-front; text-transform:auto }
                          &amp;::duplicate::-obfl-on-toc-start { content:'⠿⠿⠿' }">
                <entry ref="ch_1" style="display: block;
                                         &amp;::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 1 </entry>
                <entry style="display: block; margin-left: 1">
                  <entry ref="ch_1_1" style="display: block;
                                             &amp;::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 1 </entry>
                  <entry ref="ch_1_2" style="display: block;
                                             &amp;::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 2 </entry>
                </entry>
                <entry ref="ch_2" style="display: block;
                                         &amp;::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 2 </entry>
                <entry style="display: block; margin-left: 1">
                  <entry ref="ch_2_1" style="display: block;
                                             &amp;::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 1 </entry>
                  <entry ref="ch_2_2" style="display: block;
                                             &amp;::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 2 </entry>
                </entry>
              </toc>
            </front>
            <body style="display: block">
              <h1 id="ch_1" style="display:block; text-transform:auto"> 1 </h1>
              <h2 id="ch_1_1" style="display:block; text-transform:auto"> 1 </h2>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              <h2 id="ch_1_2" style="display:block; text-transform:auto"> 2 </h2>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              <h1 id="ch_2" style="display:block; text-transform:auto"> 2 </h1>
              <h2 id="ch_2_1" style="display:block; text-transform:auto"> 1 </h2>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              <h2 id="ch_2_2" style="display:block; text-transform:auto"> 2 </h2>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="15" page-height="7">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <table-of-contents name="toc">
            <toc-block>
              <toc-block>
                <toc-entry ref-id="ch_1">1 ⠄⠄⠄⠄⠄⠄⠄⠄⠄
                <page-number ref-id="ch_1" number-format="default"/></toc-entry>
              </toc-block>
              <toc-block>
                <toc-block padding-left="1">
                  <toc-entry ref-id="ch_1_1">1 ⠄⠄⠄⠄⠄⠄⠄⠄
                  <page-number ref-id="ch_1_1" number-format="default"/></toc-entry>
                </toc-block>
                <toc-block padding-left="1">
                  <toc-entry ref-id="ch_1_2">2 ⠄⠄⠄⠄⠄⠄⠄⠄
                  <page-number ref-id="ch_1_2" number-format="default"/></toc-entry>
                </toc-block>
              </toc-block>
              <toc-block>
                <toc-entry ref-id="ch_2">2 ⠄⠄⠄⠄⠄⠄⠄⠄⠄
                <page-number ref-id="ch_2" number-format="default"/></toc-entry>
              </toc-block>
              <toc-block>
                <toc-block padding-left="1">
                  <toc-entry ref-id="ch_2_1">1 ⠄⠄⠄⠄⠄⠄⠄⠄
                  <page-number ref-id="ch_2_1" number-format="default"/></toc-entry>
                </toc-block>
                <toc-block padding-left="1">
                  <toc-entry ref-id="ch_2_2">2 ⠄⠄⠄⠄⠄⠄⠄⠄
                  <page-number ref-id="ch_2_2" number-format="default"/></toc-entry>
                </toc-block>
              </toc-block>
            </toc-block>
          </table-of-contents>
          <volume-template sheets-in-volume-max="4" use-when="(! (= $volume 1))">
            <pre-content>
              <sequence master="main">
                <block translate="pre-translated-text-css"> ⠿⠿⠿⠿ </block>
              </sequence>
              <toc-sequence toc="toc" master="main" range="volume">
                <on-toc-start>
                  <block> ⠿⠿⠿ </block>
                </on-toc-start>
              </toc-sequence>
            </pre-content>
          </volume-template>
          <volume-template sheets-in-volume-max="4" use-when="(= $volume 1)">
            <pre-content>
              <sequence master="main">
                <block translate="pre-translated-text-css"> ⠿ ⠿ ⠿ ⠿ </block>
                <block translate="pre-translated-text-css"> ⠿⠿⠿⠿ </block>
              </sequence>
              <toc-sequence toc="toc" master="main" range="document">
                <on-volume-start>
                  <block>
                    <evaluate expression="$started-volume-number"/>
                  </block>
                </on-volume-start>
              </toc-sequence>
            </pre-content>
          </volume-template>
          <sequence master="main">
            <block/>
            <block translate="pre-translated-text-css">
              <block translate="">
                <block>
                  <span id="ch_1"/>
                </block>
                1
              </block>
              <block translate="">
                <block>
                  <span id="ch_1_1"/>
                </block>
                1
              </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
              <block translate="">
                <block>
                  <span id="ch_1_2"/>
                </block>
                2
              </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
              <block translate="">
                <block>
                  <span id="ch_2"/>
                </block>
                2
              </block>
              <block translate="">
                <block>
                  <span id="ch_2_1"/>
                </block>
                1
              </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
              <block translate="">
                <block>
                  <span id="ch_2_2"/>
                </block>
                2
              </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠀⠿⠀⠿⠀⠿</row>
                  <row>⠿⠿⠿⠿</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠼⠁</row>
                  <row>⠼⠁⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠁</row>
                  <row>⠀⠼⠁⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠁</row>
                  <row>⠀⠼⠃⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠉</row>
                  <row>⠼⠃⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠙</row>
                  <row>⠼⠃</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠉</row>
                </page>
                <page>
                  <row>⠀⠼⠁⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠑</row>
                  <row>⠀⠼⠃⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠋</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠙</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠼⠁</row>
                  <row>⠼⠁</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠃</row>
                </page>
                <page>
                  <row>⠼⠃</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠉</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠼⠃</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠙</row>
                </page>
              </section>
            </volume>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠿⠿⠿</row>
                  <row>⠀⠼⠁⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠑</row>
                  <row>⠀⠼⠃⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠋</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠉</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠼⠁</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠑</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠼⠃</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠋</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠛</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠓</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_71">
    <x:documentation>
      Tests omitting of a table of contents entry that references an element in the volume @begin
      area.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page {
                        size: 15 7;
                        margin-bottom: 1;
                        @bottom-right {content: counter(page) }}
                      @volume { @begin { content: flow(front, document) }}">
            <front>
              <toc id="ch_0"
                   style="display: -obfl-toc;
                          flow: front;
                          text-transform: auto;
                          &amp;::-obfl-on-toc-start {
                            display: block;
                            margin-bottom: 1;
                            text-transform: auto;
                            content: '0'; }">
                <entry ref="ch_0" style="display: block;
                                         &amp;::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 0 </entry>
                <entry ref="ch_1" style="display: block;
                                         &amp;::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 1 </entry>
                <entry style="display: block; margin-left: 1">
                  <entry ref="ch_1_1" style="display: block;
                                             &amp;::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 1 </entry>
                  <entry ref="ch_1_2" style="display: block;
                                             &amp;::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 2 </entry>
                </entry>
              </toc>
            </front>
            <body style="display: block">
              <h1 id="ch_1" style="display:block; text-transform:auto"> 1 </h1>
              <h2 id="ch_1_1" style="display:block; text-transform:auto"> 1 </h2>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              <h2 id="ch_1_2" style="display:block; text-transform:auto"> 2 </h2>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="15" page-height="7">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <table-of-contents name="toc">
            <toc-block>
              <toc-block>
                <toc-entry ref-id="ch_1">1 ⠄⠄⠄⠄⠄⠄⠄⠄⠄
                <page-number ref-id="ch_1" number-format="default"/></toc-entry>
              </toc-block>
              <toc-block>
                <toc-block padding-left="1">
                  <toc-entry ref-id="ch_1_1">1 ⠄⠄⠄⠄⠄⠄⠄⠄
                  <page-number ref-id="ch_1_1" number-format="default"/></toc-entry>
                </toc-block>
                <toc-block padding-left="1">
                  <toc-entry ref-id="ch_1_2">2 ⠄⠄⠄⠄⠄⠄⠄⠄
                  <page-number ref-id="ch_1_2" number-format="default"/></toc-entry>
                </toc-block>
              </toc-block>
            </toc-block>
          </table-of-contents>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <toc-sequence master="main" range="document" toc="toc">
                <on-toc-start>
                  <block margin-bottom="1"> 0 </block>
                </on-toc-start>
              </toc-sequence>
            </pre-content>
          </volume-template>
          <sequence master="main">
            <block/>
            <block translate="pre-translated-text-css">
              <block translate="">
                <block>
                  <span id="ch_1"/>
                </block>
                1
              </block>
              <block translate="">
                <block>
                  <span id="ch_1_1"/>
                </block>
                1
              </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
              <block translate="">
                <block>
                  <span id="ch_1_2"/>
                </block>
                2
              </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠚</row>
                  <row/>
                  <row>⠼⠁⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠁</row>
                  <row>⠀⠼⠁⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠁</row>
                  <row>⠀⠼⠃⠀⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠉</row>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠼⠁</row>
                  <row>⠼⠁</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠃</row>
                </page>
                <page>
                  <row>⠼⠃</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠉</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠙</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_72">
    <x:documentation>
      Tests page-break-after on elements in named flows.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none; @volume { @begin { content: flow(foo, document) flow(bar, document); }}">
            <level1 style="display: block; page-break-after: always; flow: foo;">
              <p style="display: block">⠤⠤⠤</p>
            </level1>
            <level1 style="display: block; page-break-after: always; flow: foo;">
              <p style="display: block">⠤⠤⠤</p>
            </level1>
            <level1 style="display: block; page-break-after: right; flow: foo;">
              <p style="display: block">⠤⠤⠤</p>
            </level1>
            <level1 style="display: block; page-break-after: always; flow: bar;">
              <p style="display: block">⠤⠤⠤</p>
            </level1>
            <level1 style="display: block; page-break-after: always;">
              <p style="display: block">⠤⠤⠤</p>
            </level1>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="40" page-height="25">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <sequence master="main">
                <block>
                  <block>⠤⠤⠤</block>
                </block>
                <block break-before="page">
                  <block>⠤⠤⠤</block>
                </block>
                <block break-before="page">
                  <block>⠤⠤⠤</block>
                </block>
                <block break-before="sheet"/>
                <block>
                  <block>⠤⠤⠤</block>
                </block>
              </sequence>
            </pre-content>
          </volume-template>
          <sequence master="main">
            <block>
              <block>⠤⠤⠤</block>
            </block>
            <block break-before="page"/>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="40" rows="25" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
                <page/>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
                <page/>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_73">
    <x:documentation>
      Tests page-break-before on an element with display:-obfl-toc.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="@volume { @begin { content: flow(front, document); }}">
            <level1 style="display: block; flow: front; page-break-before: always;">
              <h1 style="display: block">⠿⠿⠿ 0</h1>
            </level1>
            <list style="display: -obfl-toc; flow: front; page-break-before: always;">
              <li style="display:block">
                <a href="ch_1" style="&amp;::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(href), page) }"> ⠿⠿⠿ 1 </a>
              </li>
            </list>
            <level1 style="display: block; page-break-before: always;">
              <h1 id="ch_1" style="display: block">⠿⠿⠿ 1</h1>
              <p style="display: block">⠤⠤⠤</p>
            </level1>
          </body>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="40" page-height="25">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <table-of-contents name="toc">
            <toc-block break-before="page">
              <toc-block> <toc-entry ref-id="a">⠿⠿⠿ 1 ⠄⠄⠄⠄⠄⠄⠄⠄⠄
              <page-number ref-id="a" number-format="default"/></toc-entry>
              </toc-block>
            </toc-block>
          </table-of-contents>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <sequence master="main">
                <block break-before="page">
                  <block>⠿⠿⠿ 0</block>
                </block>
              </sequence>
              <toc-sequence master="main" range="document" toc="toc"/>
            </pre-content>
          </volume-template>
          <sequence master="main">
            <block break-before="page">
              <block>
                <block>
                  <span id="a"/>
                </block>
                ⠿⠿⠿ 1
              </block>
              <block>⠤⠤⠤</block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="40" rows="25" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠀⠼⠚</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠿⠿⠿⠀⠼⠁⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠁</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠿⠿⠿⠀⠼⠁</row>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_74">
    <x:documentation>
      Tests @page within @begin area.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page {
                        size: 15 5;
                        @top-right {
                          content: counter(page); }}
                      @volume {
                        @begin {
                          content: flow(titlepage, document);
                          @page { size: 15 5 }}}">
            <front>
              <titlepage style="display: block; flow: titlepage">
                ⠿⠿⠿
              </titlepage>
            </front>
            <body style="display: block">
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="master_2" duplex="true" page-width="15" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <layout-master name="master_1" duplex="true" page-width="15" page-height="5">
            <default-template>
              <header>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </header>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <sequence master="master_2">
                <block translate="pre-translated-text-css"> ⠿⠿⠿ </block>
              </sequence>
            </pre-content>
          </volume-template>
          <sequence master="master_1">
            <block/>
            <block translate="pre-translated-text-css"> ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_75">
    <x:documentation>
      Tests max-height and border-top within @footnotes area.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none;
                       @page {
                         size: 10 6;
                         @footnotes {
                           content: flow(footnotes, page);
                           max-height: 4;
                           border-top-pattern: ⠒; }}">
            <p style="display:block">
              ⠤⠤⠤
              <note style="flow:footnotes; display:block; &amp;::footnote-call { content:'⠶' }">⠿⠿⠿</note>
              ⠤⠤⠤
              <note style="flow:footnotes; display:block; &amp;::footnote-call { content:'⠶' }">⠿⠿⠿</note>
              ⠤⠤⠤
            </p>
            <p style="display:block; page-break-before:always">
              ⠤⠤⠤
            </p>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" duplex="true" page-width="10" page-height="6">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="4" collection="footnotes">
              <before>
                <block translate="pre-translated-text-css">
                  <leader pattern="⠒" position="100%" align="right"/>⠒
                </block>
              </before>
            </page-area>
          </layout-master>
          <collection name="footnotes">
            <item id="a">
              <block>⠿⠿⠿</block>
            </item>
            <item id="b">
              <block>⠿⠿⠿</block>
            </item>
          </collection>
          <sequence master="body">
            <block>
              ⠤⠤⠤ ⠶
              <anchor item="a"/>
              ⠤⠤⠤ ⠶
              <anchor item="b"/>
              ⠤⠤⠤
            </block>
            <block break-before="page">
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="6" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠶⠀⠤⠤⠤</row>
                  <row>⠶⠀⠤⠤⠤</row>
                  <row/>
                  <row>⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒</row>
                  <row>⠿⠿⠿</row>
                  <row>⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_76" pending="true">
    <x:documentation>
      Tests combination of @page:left and @page:right with counter-set of 'page' to an even number.
      
      Broken: workaround for issue https://github.com/brailleapps/dotify/issues/134 was disabled.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page { size: 10 5; }
                         @page:right { margin-bottom: 1; @bottom-right { content: counter(page) }}">
              <p style="display:block">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </p>
              <p style="display:block; counter-set: page 10">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" duplex="true" page-width="10" page-height="5">
            <template use-when="(= (% $page 2) 1)">
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </template>
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <layout-master name="b" duplex="true" page-width="10" page-height="5">
            <template use-when="(= (% $page 2) 0)">
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </template>
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block> ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ </block>
          </sequence>
          <sequence master="b" initial-page-number="10">
            <block> ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠼⠁⠚</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_77">
    <x:documentation>
      Tests word-spacing.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none; @page { size: 15 5; }">
            <p style="display:block; word-spacing:2">
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
            </p>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="15" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="main">
            <block>
              <style name="word-spacing: 2">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </style>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠀⠤⠤⠤⠀⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠀⠤⠤⠤⠀⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠀⠤⠤⠤⠀⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_78">
    <x:documentation>
      Tests skip-margin-top-of-page parameter.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none; @page { size: 15 7; }">
            <div style="display: block">
              <p style="display: block; margin-top: 2; margin-bottom: 1">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </p>
              <p style="display: block; margin-top: 2; margin-bottom: 1">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </p>
              <p style="display: block; margin-top: 2; margin-bottom: 1">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </p>
            </div>
            <div style="display: block; page-break-before: always">
              <p style="display: block; margin-top: 2">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </p>
            </div>
            <div style="display: block; border-top-pattern: ⠒; page-break-before: always">
              <p style="display: block; margin-top: 2">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </p>
            </div>
            <div style="display: block; border-top-pattern: ⠒; page-break-before: always">
              <p style="display: block; border-top-pattern: ⠒; margin-top: 2">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </p>
            </div>
            <div style="display: block; page-break-before: always">
              <p style="display: block; padding-top: 2">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </p>
            </div>
            <div style="display: block; page-break-before: right">
              <p style="display: block"/>
              <p style="display: block; margin-top: 2">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </p>
            </div>
          </body>
        </x:document>
      </x:input>
      <x:option name="skip-margin-top-of-page" select="true()"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="15" page-height="7">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="main">
            <block margin-bottom="2">
              <block margin-bottom="2">
                <block display-when="(! $starts-at-top-of-page)" margin-top="2"/>
                <block>
                  ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                </block>
              </block>
              <block margin-bottom="2">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </block>
              <block margin-bottom="1">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </block>
            </block>
            <block break-before="page">
              <block>
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </block>
            </block>
            <block border-top-style="solid" border-top-align="center" break-before="page">
              <block>
                <block display-when="(! $starts-at-top-of-page)" margin-top="2"/>
                <block>
                  ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                </block>
              </block>
            </block>
            <block border-top-style="solid" border-top-align="center" break-before="page">
              <block>
                <block display-when="(! $starts-at-top-of-page)" margin-top="2"/>
                <block border-top-style="solid" border-top-align="center">
                  ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                </block>
              </block>
            </block>
            <block break-before="page">
              <block padding-top="2">
                ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
              </block>
            </block>
            <block break-before="sheet">
              <block/>
              <block>
                <block display-when="(! $starts-at-top-of-page)" margin-top="2"/>
                <block>
                  ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
                </block>
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒</row>
                  <row/>
                  <row/>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒</row>
                  <row/>
                  <row/>
                  <row>⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
                <page>
                  <row/>
                  <row/>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_79">
    <x:documentation>
      Tests block with border-top, margin-left and text-indent.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none; @page { size: 15 7; }">
            <p style="display: block; border-top-pattern: ⠒; margin-left: 2; text-indent: 2">
              ⠤⠤⠤
            </p>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="master_1" duplex="true" page-width="15" page-height="7">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="master_1">
            <block border-top-style="solid"
                   border-top-align="center"
                   margin-left="2"
                   first-line-indent="2"> ⠤⠤⠤ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠀⠀⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒</row>
                  <row>⠀⠀⠀⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_80">
    <x:documentation>
      Tests counter(page) with custom counter style.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none;
                       display:block;
                       @page {
                         size: 15 5;
                         margin-bottom: 1;
                         @bottom-right { content: counter(page, symbols(numeric '⠴' '⠂' '⠆' '⠒' '⠲' '⠢' '⠖' '⠶' '⠦' '⠔')) }}">
            ⠤⠤⠤
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="master_1" duplex="true" page-width="15" page-height="5">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"
                                text-style="text-transform: -dotify-counter; -dotify-counter-style: symbols(numeric '⠴' '⠂' '⠆' '⠒' '⠲' '⠢' '⠖' '⠶' '⠦' '⠔')"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="master_1">
            <block> ⠤⠤⠤ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠂</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_81">
    <x:documentation>
      Tests target-counter(page) with custom counter style.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none; display:block">
            <a href="#a" style="&amp;::after { content: target-counter(attr(href url), page, symbols(numeric '⠴' '⠂' '⠆' '⠒' '⠲' '⠢' '⠖' '⠶' '⠦' '⠔')) }"/>
            <div id="a" style="display: block; page-break-before: always">⠤⠤⠤</div>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="master_1" duplex="true" page-width="40" page-height="25">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="master_1">
            <block>
              <block>
                <style name="text-transform: -dotify-counter; -dotify-counter-style: symbols(numeric '⠴' '⠂' '⠆' '⠒' '⠲' '⠢' '⠖' '⠶' '⠦' '⠔')">
                  <page-number ref-id="a" number-format="default"/>
                </style>
              </block>
              <block break-before="page">
                <block>
                  <span id="a"/>
                </block>
                ⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="40" rows="25" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠆</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_82">
    <x:documentation>
      Tests variables "sheets-in-volume" and "sheets-in-document".
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none;
                       display: block;
                       @page { size: 15 5; }
                       @volume { max-length: 3; @begin { content: flow(pre, document) }}">
            <p style="display: block; text-transform: auto; flow: pre">
              <span style="&amp;::before { content: counter(-obfl-sheets-in-volume) ' ⠌ ' counter(-obfl-sheets-in-document) }"/>
            </p>
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
          </body>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="15" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="3">
            <pre-content>
              <sequence master="main">
                <block>
                  <evaluate expression="$sheets-in-volume"/> ⠌ <evaluate expression="$sheets-in-document"/>
                </block>
              </sequence>
            </pre-content>
          </volume-template>
          <sequence master="main">
            <block translate="pre-translated-text-css">
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠉⠀⠌⠀⠼⠑</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume cols="15" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠃⠀⠌⠀⠼⠑</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_83">
    <x:documentation>
      Tests footnotes without a ::footnote-call.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none; @page { size: 10 6; @footnotes { content: flow(footnotes, page) }}">
            <p style="display:block">
              ⠤⠤⠤
              <note style="flow:footnotes; display:block">⠿</note>
              ⠤⠤⠤
              <note style="flow:footnotes; display:block">⠿⠿</note>
              ⠤⠤⠤
            </p>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" duplex="true" page-width="10" page-height="6">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="3" collection="footnotes"/>
          </layout-master>
          <collection name="footnotes">
            <item id="a">
              <block>⠿</block>
            </item>
            <item id="b">
              <block>⠿⠿</block>
            </item>
          </collection>
          <sequence master="body">
            <block>
              ⠤⠤⠤
              <anchor item="a"/>
              ⠤⠤⠤
              <anchor item="b"/>
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row>⠿</row>
                  <row>⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_84">
    <x:documentation>
      Tests document scope table of contents in @begin area of last volume.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page { size: 15 7 }
                      @volume { max-length: 2 }
                      @volume:last { max-length: 2; @begin { content: flow(toc, document) }}">
            <toc style="display:-obfl-toc; flow:toc; text-transform:auto">
              <entry ref="ch_1"
                     style="display: block; &amp;::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 1 </entry>
              <entry ref="ch_2"
                     style="display: block; &amp;::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 2 </entry>
            </toc>
            <body style="display:block">
              <h1 id="ch_1" style="display:block; text-transform:auto"> 1 </h1>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              <h1 id="ch_2" style="display:block; text-transform:auto"> 2 </h1>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="15" page-height="7">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <table-of-contents name="toc">
            <toc-block>
              <toc-block>
                <toc-entry ref-id="ch_1">1 ⠄⠄⠄⠄⠄⠄⠄⠄⠄ <page-number ref-id="ch_1" number-format="default"/></toc-entry>
              </toc-block>
              <toc-block>
                <toc-entry ref-id="ch_2">2 ⠄⠄⠄⠄⠄⠄⠄⠄⠄ <page-number ref-id="ch_2" number-format="default"/></toc-entry>
              </toc-block>
            </toc-block>
          </table-of-contents>
          <volume-template sheets-in-volume-max="2" use-when="(! (= $volume $volumes))"/>
          <volume-template sheets-in-volume-max="2" use-when="(= $volume $volumes)">
            <pre-content>
              <toc-sequence toc="toc" master="main" range="document"/>
            </pre-content>
          </volume-template>
          <sequence master="main">
            <block translate="pre-translated-text-css">
              <block translate="">
                <block>
                  <span id="ch_1"/>
                </block>
                1
              </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
              <block translate="">
                <block>
                  <span id="ch_2"/>
                </block>
                2
              </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠁</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠼⠃</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                </page>
              </section>
            </volume>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠁⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠁</row>
                  <row>⠼⠃⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠙</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_85">
    <x:documentation>
      Tests document scope table of contents in @end area of last volume.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page { size: 15 7 }
                      @volume { max-length: 2 }
                      @volume:last { max-length: 2; @end { content: flow(toc, document) }}">
            <toc style="display:-obfl-toc; flow:toc; text-transform:auto">
              <entry ref="ch_1"
                     style="display: block; &amp;::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 1 </entry>
              <entry ref="ch_2"
                     style="display: block; &amp;::after { content: ' ⠄⠄⠄⠄⠄⠄⠄⠄⠄ ' target-counter(attr(ref), page) }"> 2 </entry>
            </toc>
            <body style="display:block">
              <h1 id="ch_1" style="display:block; text-transform:auto"> 1 </h1>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              <h1 id="ch_2" style="display:block; text-transform:auto"> 2 </h1>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="15" page-height="7">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <table-of-contents name="toc">
            <toc-block>
              <toc-block>
                <toc-entry ref-id="ch_1">1 ⠄⠄⠄⠄⠄⠄⠄⠄⠄ <page-number ref-id="ch_1" number-format="default"/></toc-entry>
              </toc-block>
              <toc-block>
                <toc-entry ref-id="ch_2">2 ⠄⠄⠄⠄⠄⠄⠄⠄⠄ <page-number ref-id="ch_2" number-format="default"/></toc-entry>
              </toc-block>
            </toc-block>
          </table-of-contents>
          <volume-template sheets-in-volume-max="2" use-when="(! (= $volume $volumes))"/>
          <volume-template sheets-in-volume-max="2" use-when="(= $volume $volumes)">
            <post-content>
              <toc-sequence toc="toc" master="main" range="document"/>
            </post-content>
          </volume-template>
          <sequence master="main">
            <block translate="pre-translated-text-css">
              <block translate="">
                <block>
                  <span id="ch_1"/>
                </block>
                1
              </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
              <block translate="">
                <block>
                  <span id="ch_2"/>
                </block>
                2
              </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠁</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠼⠃</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                </page>
              </section>
            </volume>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠼⠁⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠁</row>
                  <row>⠼⠃⠀⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠼⠙</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_86">
    <x:documentation>
      Tests @page on elements inside named flows.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page { size: 20 10 }
                      @volume:first { @begin { content: flow(front, document); @page { size: 10 5 }}}">
            <front style="display: block; flow: front">
              ⠤⠤⠤⠤⠤
              <toc style="display: block; @page { size: 10 10 }">
                ⠤⠤⠤⠤⠤
              </toc>
            </front>
            <body style="display: block">
              ⠤⠤⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="front" duplex="true" page-width="10" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <layout-master name="toc" duplex="true" page-width="10" page-height="10">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <layout-master name="body" duplex="true" page-width="20" page-height="10">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template use-when="(! (= $volume 1))" sheets-in-volume-max="1000"/>
          <volume-template use-when="(= $volume 1)" sheets-in-volume-max="1000">
            <pre-content>
              <sequence master="front">
                <block>
                  <block> ⠤⠤⠤⠤⠤ </block>
                </block>
              </sequence>
              <sequence master="toc">
                <block break-before="sheet">
                  <block> ⠤⠤⠤⠤⠤ </block>
                </block>
              </sequence>
            </pre-content>
          </volume-template>
          <sequence master="body">
            <block>
              ⠤⠤⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="10" rowgap="0" duplex="true">
              <section cols="10" rows="5">
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
              <section cols="10" rows="10">
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_87">
    <x:documentation>
      Tests nested inline elements with styles.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; display:block">
            <span style="text-transform:auto">
              1 2 3
              <span style="text-transform:none">⠿⠿⠿</span>
              4 5 6
            </span>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="master_1" duplex="true" page-width="40" page-height="25">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="master_1">
            <block>
              <span translate="">
                1 2 3
              </span>⠿⠿⠿<span translate="">
                4 5 6
              </span>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="40" rows="25" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠁⠀⠼⠃⠀⠼⠉⠀⠿⠿⠿⠀⠼⠙⠀⠼⠑⠀⠼⠋</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_88">
    <x:documentation>
      Tests text-transform:auto on -obfl-evaluate().
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; @volume { @begin { content: flow(titlepage, document) }}">
            <titlepage style="display: block; flow: titlepage">
              ⠤⠤⠤⠤⠤
              <span style="&amp;::before {
                             text-transform: auto;
                             content: -obfl-evaluate('$volume') }"/>
              ⠤⠤⠤⠤⠤
            </titlepage>
            <body style="display: block">
              ⠤⠤⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="40" page-height="25">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <sequence master="main">
                <block>
                  ⠤⠤⠤⠤⠤
                  <span translate="">
                    <style name="">
                      <evaluate expression="$volume"/>
                    </style>
                  </span>
                  ⠤⠤⠤⠤⠤
                </block>
              </sequence>
            </pre-content>
          </volume-template>
          <sequence master="main">
            <block>
              ⠤⠤⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="40" rows="25" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠼⠁⠀⠤⠤⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_89">
    <x:documentation>
      Tests text-transform ≠ auto|none on -obfl-evaluate().
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; @volume { @begin { content: flow(titlepage, document) }}">
            <titlepage style="display: block; flow: titlepage; text-transform: auto">
              1<span style="&amp;::after {
                              text-transform: downshift;
                              content: -obfl-evaluate('$volumes') }"/>
              <p style="&amp;::after {
                          display: block;
                          text-transform: downshift;
                          content: -obfl-evaluate('$volume') }"/>
            </titlepage>
            <body style="display: block">
              ⠤⠤⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="40" page-height="25">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <sequence master="main">
                <block>
                  <block>
                    1<style name="text-transform: downshift">
                    <evaluate expression="$volumes"/>
                  </style>
                  </block>
                  <block>
                    <style name="text-transform: downshift">
                      <evaluate expression="$volume"/>
                    </style>
                  </block>
                </block>
              </sequence>
            </pre-content>
          </volume-template>
          <sequence master="main">
            <block translate="pre-translated-text-css">
              ⠤⠤⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="40" rows="25" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠁⠂</row>
                  <row>⠂</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_90">
    <x:documentation>
      Tests -obfl-use-when-collection-not-empty.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none;
                       @page {
                         size: 20 10;
                         @footnotes {
                           content: flow(footnotes, page);
                           -obfl-fallback-collection: endnotes; }}
                       @volume {
                         @begin {
                           content: flow(front, document) }
                         @end {
                           content: flow(endnotes, volume); }}">
            <p style="display: block; flow: front; -obfl-use-when-collection-not-empty: footnotes">
              ⠌⠌⠌
            </p>
            <p style="display: block; flow: front; -obfl-use-when-collection-not-empty: endnotes">
              ⠡⠡⠡
            </p>
            <p style="display:block">
              ⠤⠤⠤
              <noteref ref="note_1" style="&amp;::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶
              </noteref>
              ⠤⠤⠤
              <noteref ref="note_2" style="&amp;::alternate { flow:footnotes; display:block; content:target-content(attr(ref)) }">
                ⠶⠶
              </noteref>
              ⠤⠤⠤
            </p>
            <note id="note_1" style="display:none">
              ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
            </note>
            <note id="note_2" style="display:none">
              ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
            </note>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="20" page-height="10">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="5" collection="footnotes">
              <fallback>
                <rename collection="footnotes" to="endnotes"/>
                <rename collection="meta/footnotes" to="meta/endnotes"/>
              </fallback>
            </page-area>
          </layout-master>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <dynamic-sequence master="main">
                <list-of-references collection="meta/footnotes" range="document">
                  <on-collection-start>
                    <block> ⠌⠌⠌ </block>
                  </on-collection-start>
                </list-of-references>
                <list-of-references collection="meta/endnotes" range="document">
                  <on-collection-start>
                    <block> ⠡⠡⠡ </block>
                  </on-collection-start>
                </list-of-references>
              </dynamic-sequence>
            </pre-content>
            <post-content>
              <dynamic-sequence master="main">
                <list-of-references collection="endnotes" range="volume"/>
              </dynamic-sequence>
            </post-content>
          </volume-template>
          <collection name="footnotes">
            <item id="a">
              <block>
                ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
              </block>
            </item>
            <item id="b">
              <block>
                ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤⠤
              </block>
            </item>
          </collection>
          <collection name="meta/footnotes">
            <item id="a">
              <block/>
            </item>
          </collection>
          <sequence master="main">
            <block>
              ⠤⠤⠤ ⠶
              <anchor item="a"/>
              ⠤⠤⠤ ⠶⠶
              <anchor item="b"/>
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠡⠡⠡</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠶⠀⠤⠤⠤⠀⠶⠶⠀⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_91">
    <x:documentation>
      Tests -obfl-underline.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none; @page { size: 10 10 }">
            <h1 style="display: block; -obfl-underline: ⠒">
              ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿
            </h1>
            <h2 style="display: block; -obfl-underline: ⠂">
              ⠿⠿⠿⠿⠿⠿⠿⠿
            </h2>
            <br style="display: block; page-break-before: always"/>
            <p style="display: block; -obfl-underline: ⠒" id="a">
              ⠿⠿⠿⠿⠿⠿
              <a href="a" style="&amp;::after { content: target-counter(attr(href), page) }"/>
            </p>
            <br style="display: block; page-break-before: always"/>
            <p style="display: block; -obfl-underline: ⠒; margin-top: 1">
              ⠿⠿⠿⠿⠿⠿
            </p>
          </body>
        </x:document>
      </x:input>
      <x:option name="skip-margin-top-of-page" select="true()"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="master_1" duplex="true" page-width="10" page-height="10">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="master_1">
            <block underline-pattern="⠒"> ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿ </block>
            <block underline-pattern="⠂"> ⠿⠿⠿⠿⠿⠿⠿⠿ </block>
            <block break-before="page"/>
            <block underline-pattern="⠒">
              <block>
                <span id="a"/>
              </block>
              ⠿⠿⠿⠿⠿⠿
              <page-number ref-id="a" number-format="default"/>
            </block>
            <block break-before="page"/>
            <block>
              <block margin-top="1" display-when="(! $starts-at-top-of-page)"/>
              <block underline-pattern="⠒"> ⠿⠿⠿⠿⠿⠿ </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿</row>
                  <row>⠒⠒⠒⠒⠒⠒⠒⠒</row>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠂⠂⠂⠂⠂⠂⠂⠂</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿⠿⠀2</row>
                  <row>⠒⠒⠒⠒⠒⠒⠒⠒</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿⠿</row>
                  <row>⠒⠒⠒⠒⠒⠒</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_92">
    <x:documentation>
      Tests combination of manual and automatic volume breaking.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="display: block;
                       text-transform: none;
                       @page { size: 10 5 }
                       @volume { max-length: 3 }">
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            <br style="display: block; volume-break-before: always"/>
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            <br style="display: block; volume-break-before: always"/>
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            <p style="display: block; volume-break-inside: -obfl-keep(1)">
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
            </p>
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            <br style="display: block; volume-break-before: always"/>
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            <br style="display: block; volume-break-before: always"/>
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            <br style="display: block; volume-break-before: always"/>
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="10" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="3"/>
          <volume-transition range="sheet"/>
          <sequence master="main">
            <block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
          <sequence master="main" break-before="volume">
            <block>
              <block/>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
          <sequence master="main" break-before="volume">
            <block>
              <block/>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
              <block volume-keep-priority="1">
                ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
          <sequence master="main" break-before="volume">
            <block>
              <block/>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
          <sequence master="main" break-before="volume">
            <block>
              <block/>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
          <sequence master="main" break-before="volume">
            <block>
              <block/>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_93">
    <x:documentation>
      Tests volume-break-inside: -obfl-keep(...)
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none;
                       @page { size: 10 5 }
                       @volume { max-length: 3 }">
            <section style="display: block; page-break-before: right; volume-break-inside: -obfl-keep(1)">
              ⠿⠿⠿⠿⠿ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </section>
            <section style="display: block; page-break-before: right; volume-break-inside: -obfl-keep(1)">
              ⠿⠿⠿⠿⠿ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </section>
            <section style="display: block; page-break-before: right; volume-break-inside: -obfl-keep(1)">
              ⠿⠿⠿⠿⠿ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </section>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="10" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="3"/>
          <volume-transition range="sheet"/>
          <sequence master="main">
            <block volume-keep-priority="1" break-before="sheet">
              ⠿⠿⠿⠿⠿ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
            <block volume-keep-priority="1" break-before="sheet">
              ⠿⠿⠿⠿⠿ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
            <block volume-keep-priority="1" break-before="sheet">
              ⠿⠿⠿⠿⠿ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_94">
    <x:documentation>
      Tests -obfl-keep-with-next-sheets.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none;
                       @page { size: 10 5 }
                       @volume { max-length: 3 }">
            <section style="display: block">
              <h1 style="display: block">
                ⠿⠿⠿⠿⠿
              </h1>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </section>
            <section style="display: block">
              <h1 style="display: block; -obfl-keep-with-next-sheets: 1">
                ⠿⠿⠿⠿⠿
              </h1>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </section>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="10" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="3"/>
          <sequence master="main">
            <block>
              <block>
                ⠿⠿⠿⠿⠿
              </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
            <block>
              <block keep-with-next-sheets="1">
                ⠿⠿⠿⠿⠿
              </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_95">
    <x:documentation>
      Tests truncating of long footer lines.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none;
                       @page {
                         size: 20 5
                         @bottom-center {
                           content: string(running-footer) }}">
            <h1 style="display: block;
                       string-set: running-footer content()">
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
            </h1>
            <p style="display: block">
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </p>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="master_1" duplex="true" page-width="20" page-height="5">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <compound-marker-reference>
                    <marker-reference marker="running-footer" direction="forward" scope="page"/>
                    <marker-reference marker="running-footer" direction="backward" scope="sequence"/>
                    <marker-reference marker="running-footer/entry" direction="backward" scope="sequence"/>
                  </compound-marker-reference>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="master_1">
            <block>
              <block>
                <marker class="running-footer" value="⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿"/>
              </block>
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
            </block>
            <block>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠀⠿⠿</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠀⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_96">
    <x:documentation>
      Tests counter-set: page on an element in a named flow.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page {
                        size: 15 5;
                        margin-bottom: 1;
                        @bottom-right {
                          content: counter(page) }}
                      @volume {
                        @begin {
                          content: flow(titlepage, document) }}">
            <front>
              <titlepage style="display: block; flow: titlepage; counter-set: pre-page 11">
                ⠿⠿⠿
              </titlepage>
            </front>
            <body style="display: block">
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" duplex="true" page-width="15" page-height="5">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <sequence master="a" initial-page-number="11">
                <block translate="pre-translated-text-css"> ⠿⠿⠿ </block>
              </sequence>
            </pre-content>
          </volume-template>
          <sequence master="a">
            <block/>
            <block translate="pre-translated-text-css"> ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁⠁</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_97">
    <x:documentation>
      Tests collapsing of margins of nested blocks, with and without the presence of an empty block
      that "collapses through". An block with only an OBFL expression that evaluates to an empty
      string is also tested.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <section style="display:block">
              <p style="display:block">
                ⠿
              </p>
            </section>
            <section style="display:block; margin-top:1">
              <p style="display:block; margin-top:1">
                ⠿
              </p>
            </section>
            <section style="display:block; margin-top:1">
              <p style="display:block; margin-top:1; margin-bottom: 1"/>
              <p style="display:block; margin-top:1">
                ⠿
              </p>
            </section>
            <section style="display:block; margin-top:1">
              <p style="display:block; margin-top:1; margin-bottom: 1"><span style="&amp;::after { content: -obfl-evaluate('&quot;&quot;')}"/></p>
              <p style="display:block; margin-top:1">
                ⠿
              </p>
            </section>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="40" page-height="25" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              <block>
                ⠿
              </block>
            </block>
            <block margin-top="1">
              <block margin-top="1">
                ⠿
              </block>
            </block>
            <block margin-top="1">
              <block margin-top="1" margin-bottom="1"/>
              <block margin-top="1">
                ⠿
              </block>
            </block>
            <block margin-top="1">
              <block margin-top="1" margin-bottom="1"><evaluate expression="&quot;&quot;"/></block>
              <block margin-top="1">
                ⠿
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿</row>
                  <row/>
                  <row>⠿</row>
                  <row/>
                  <row>⠿</row>
                  <row/>
                  <row>⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_98">
    <x:documentation>
      Tests rendering of the range of print pages covered on the current page when a print page
      break coincides with a braille page break and the first element on the new page has a top
      padding.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page {
                        size: 20 7;
                        margin-top: 1;
                        margin-bottom: 1;
                        @top-left {
                          content: string(print-page-dash, page-start-except-last)
                                   string(print-page, page-last); }}">
            <pagenum style="display: none;
                            string-set: print-page content(),
                                        dash-print-page '⠒' content(),
                                        print-page-dash content() '⠒'">1</pagenum>
            <!-- begin page -->
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <!-- begin page -->
            <pagenum style="display: none;
                            string-set: print-page content(),
                                        dash-print-page '⠒' content(),
                                        print-page-dash content() '⠒'">2</pagenum>
            <p style="display: block; page-break-before: always; padding-top: 1">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
            <p style="display: block">⠁⠁⠁</p>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="20" page-height="7" duplex="true">
            <default-template>
              <header>
                <field>
                  <marker-reference marker="print-page-dash/prev" direction="forward" scope="page-content"/>
                  <compound-marker-reference>
                    <marker-reference marker="print-page" direction="backward" scope="sequence"/>
                    <marker-reference marker="print-page/entry" direction="backward" scope="sequence"/>
                  </compound-marker-reference>
                </field>
                <field>
                  <string value=""/>
                </field>
              </header>
              <footer>
                <field>
                    <string value=""/>
                </field>
                <field>
                    <string value=""/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <!-- begin page -->
            <block>
              <block>
                <marker class="print-page" value="1"/>
              </block>
              ⠁⠁⠁
            </block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <!-- begin page -->
            <block break-before="page">
              <block>
                <marker class="print-page" value="2"/>
                <marker class="print-page-dash/prev" value="1⠒"/>
              </block>
              <block padding-top="1">
                ⠁⠁⠁
              </block>
            </block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
            <block>⠁⠁⠁</block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                </page>
                <page>
                  <row>⠼⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀</row>
                  <row/>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                  <row>⠁⠁⠁</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_99">
    <x:documentation>
      Tests document endnotes using flow() in @volume:last.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page { size: 10 6 }
                      @volume {
                        max-length: 3; }
                      @volume:last {
                        max-length: 3;
                        @end {
                          content: flow(endnotes, document) }}">
            <body>
              <p style="display:block">
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                <noteref ref="note_1" style="&amp;::alternate { flow:endnotes; display:block; content:target-content(attr(ref)) }">
                  ⠶
                </noteref>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </p>
              <p style="display:block">
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                <noteref ref="note_2" style="&amp;::alternate { flow:endnotes; display:block; content:target-content(attr(ref)) }">
                  ⠶
                </noteref>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </p>
            </body>
            <ul id="notes" style="display:none">
              <li id="note_1">
                ⠿⠿⠿
              </li>
              <li id="note_2">
                ⠿⠿⠿⠿⠿⠿
              </li>
            </ul>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="10" page-height="6">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="3" use-when="(! (= $volume $volumes))"/>
          <volume-template sheets-in-volume-max="3" use-when="(= $volume $volumes)">
            <post-content>
              <sequence master="main">
                <block> ⠿⠿⠿ </block>
                <block> ⠿⠿⠿⠿⠿⠿ </block>
              </sequence>
            </post-content>
          </volume-template>
          <sequence master="main">
            <block>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠶
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
            <block>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠶
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠶</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠶</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_100">
    <x:documentation>
      Tests document endnotes using flow() in @volume:last, but instead of flowing the notes
      directly to the @end area the notes are first flowed into an intermediary pseudo-element,
      through -obfl-collection(...). The purpose of the intermediary pseudo-element is that it can
      have ::-obfl-on-volume start and ::-obfl-on-volume-end pseudo-elements.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page { size: 10 6 }
                      @volume {
                        max-length: 2; }
                      @volume:last {
                        max-length: 3;
                        @end {
                          content: flow(endnotes-container, document) }}">
            <body style="&amp;::alternate {
                           display: -obfl-list-of-references;
                           flow: endnotes-container;
                           content: -obfl-collection(endnotes, document); }
                         &amp;::alternate::-obfl-on-volume-start {
                           display: block;
                           border-bottom-pattern: ⠒;
                           content: counter(-obfl-started-volume-number);
                           text-transform: auto; }">
              <p style="display:block">
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                <noteref ref="note_1" style="&amp;::alternate { flow:endnotes; display:block; content:target-content(attr(ref)) }">
                  ⠶
                </noteref>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </p>
              <p style="display:block">
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                <noteref ref="note_2" style="&amp;::alternate { flow:endnotes; display:block; content:target-content(attr(ref)) }">
                  ⠶
                </noteref>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </p>
            </body>
            <ul id="notes" style="display:none">
              <li id="note_1">
                ⠿⠿⠿
              </li>
              <li id="note_2">
                ⠿⠿⠿⠿⠿⠿
              </li>
            </ul>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="10" page-height="6">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="2" use-when="(! (= $volume $volumes))"/>
          <volume-template sheets-in-volume-max="3" use-when="(= $volume $volumes)">
            <post-content>
              <dynamic-sequence master="main">
                <list-of-references collection="endnotes" range="document">
                  <on-volume-start>
                    <block border-bottom-style="solid" border-bottom-align="center">
                      <evaluate expression="$started-volume-number"/>
                    </block>
                  </on-volume-start>
                </list-of-references>
              </dynamic-sequence>
            </post-content>
          </volume-template>
          <collection name="endnotes">
            <item id="a">
              <block translate="pre-translated-text-css"> ⠿⠿⠿ </block>
            </item>
            <item id="b">
              <block translate="pre-translated-text-css"> ⠿⠿⠿⠿⠿⠿ </block>
            </item>
          </collection>
          <sequence master="main">
            <block translate="pre-translated-text-css">
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠶
              <anchor item="a"/>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
            <block translate="pre-translated-text-css">
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠶
              <anchor item="b"/>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠶</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠶</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠼⠁</row>
                  <row>⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒</row>
                  <row>⠿⠿⠿</row>
                  <row>⠼⠃</row>
                  <row>⠒⠒⠒⠒⠒⠒⠒⠒⠒⠒</row>
                  <row>⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_101">
    <x:documentation>
      Tests concatenation of flow().
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page { size: 15 5 }
                      @volume { @begin { content: flow(titlepage1, document) flow(titlepage2, document) }}">
            <front>
              <titlepage style="display: block; flow: titlepage1">
                ⠿⠿⠿
              </titlepage>
              <titlepage style="display: block; flow: titlepage2; page-break-before: always">
                ⠿⠿⠿
              </titlepage>
            </front>
            <body style="display: block">
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" page-width="15" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <sequence master="main">
                <block translate="pre-translated-text-css">
                  ⠿⠿⠿
                </block>
                <block translate="pre-translated-text-css" break-before="page">
                  ⠿⠿⠿
                </block>
              </sequence>
            </pre-content>
          </volume-template>
          <sequence master="main">
            <block/>
            <block translate="pre-translated-text-css">
              ⠤⠤⠤ ⠤⠤⠤ ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_102">
    <x:documentation>
      Tests forced volume break before the first content.
      
      The sequences are chosen to be equal size in order to show that we work around a bug in Dotify
      (see "break-before-volume-first-sequence" in test_dotify.formatter.impl.xprocspec).
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="display: block;
                       text-transform: none;
                       @page { size: 10 5 }">
            <br style="display: block; volume-break-before: always"/>
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            <br style="display: block; volume-break-before: always"/>
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="10" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="main">
            <block>
              <block/>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
          <sequence master="main" break-before="volume">
            <block>
              <block/>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_103">
    <x:documentation>
      Tests render-table-by property and ::table-by() pseudo-elements
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="@page { size: 10 20 }">
            <table xmlns="http://www.daisy.org/z3986/2005/dtbook/"
                   style="display: block;
                          render-table-by: row, column;
                          text-transform: none;
                          &amp;::table-by(row)::list-item {
                            display:block;
                            margin-left:2; }
                          &amp;::table-by(column)::list-item {
                            display:block; }
                          &amp;::table-by(column)::list-item:first-child {
                            text-indent:-2; }">
              <thead>
                <tr>
                  <th colspan="2">⠿⠁</th>
                  <th>⠿⠉</th>
                </tr>
              </thead>
              <tfoot>
                <tr>
                  <td>⠶⠁</td>
                  <td>⠶⠃</td>
                  <td>⠶⠉</td>
                </tr>
              </tfoot>
              <tbody>
                <tr>
                  <td>⠤⠁⠤⠁</td>
                  <td>⠤⠁⠤⠃</td>
                  <td>⠤⠁⠤⠉</td>
                </tr>
                <tr>
                  <td>⠤⠃⠤⠁</td>
                  <td>⠤⠃⠤⠃</td>
                  <td>⠤⠃⠤⠉</td>
                </tr>
              </tbody>
              <tbody>
                <tr>
                  <td rowspan="2">⠤⠉⠤⠁</td>
                  <td>⠤⠉⠤⠃</td>
                  <td>⠤⠉⠤⠉</td>
                </tr>
                <tr>
                  <td>⠤⠙⠤⠃</td>
                  <td>⠤⠙⠤⠉</td>
                </tr>
              </tbody>
            </table>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" duplex="true" page-width="10" page-height="20">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              <block>
                <block first-line-indent="0" text-indent="2">⠿⠁⠤⠁⠤⠁</block>
                <block padding-left="2">⠤⠁⠤⠃</block>
                <block padding-left="2">⠿⠉⠤⠁⠤⠉</block>
              </block>
              <block>
                <block first-line-indent="0" text-indent="2">⠿⠁⠤⠃⠤⠁</block>
                <block padding-left="2">⠤⠃⠤⠃</block>
                <block padding-left="2">⠿⠉⠤⠃⠤⠉</block>
              </block>
              <block>
                <block first-line-indent="0" text-indent="2">⠿⠁⠤⠉⠤⠁</block>
                <block padding-left="2">⠤⠉⠤⠃</block>
                <block padding-left="2">⠿⠉⠤⠉⠤⠉</block>
              </block>
              <block>
                <block first-line-indent="0" text-indent="2">⠿⠁⠤⠉⠤⠁</block>
                <block padding-left="2">⠤⠙⠤⠃</block>
                <block padding-left="2">⠿⠉⠤⠙⠤⠉</block>
              </block>
              <block>
                <block first-line-indent="0" text-indent="2">⠿⠁⠶⠁</block>
                <block padding-left="2">⠶⠃</block>
                <block padding-left="2">⠿⠉⠶⠉</block>
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="20" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠁⠤⠁⠤⠁</row>
                  <row>⠀⠀⠤⠁⠤⠃</row>
                  <row>⠀⠀⠿⠉⠤⠁⠤⠉</row>
                  <row>⠿⠁⠤⠃⠤⠁</row>
                  <row>⠀⠀⠤⠃⠤⠃</row>
                  <row>⠀⠀⠿⠉⠤⠃⠤⠉</row>
                  <row>⠿⠁⠤⠉⠤⠁</row>
                  <row>⠀⠀⠤⠉⠤⠃</row>
                  <row>⠀⠀⠿⠉⠤⠉⠤⠉</row>
                  <row>⠿⠁⠤⠉⠤⠁</row>
                  <row>⠀⠀⠤⠙⠤⠃</row>
                  <row>⠀⠀⠿⠉⠤⠙⠤⠉</row>
                  <row>⠿⠁⠶⠁</row>
                  <row>⠀⠀⠶⠃</row>
                  <row>⠀⠀⠿⠉⠶⠉</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_104">
    <x:documentation>
      Tests line-height:1.3
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; @page { size: 40 25 }">
            <body>
              <p style="display: block; line-height: 1.3">
                ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
              </p>
              <p style="display: block; line-height: 1.3; margin-bottom: 1;">
                ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
              </p>
              <p style="display: block; line-height: 1.3">
                ⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿
              </p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="40" page-height="25" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block row-spacing="1.25">⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿</block>
            <block margin-bottom="1">
              <block row-spacing="1.25">⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿</block>
            </block>
            <block row-spacing="1.25">⠿⠿⠿⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿⠿⠿⠿</block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row rowgap="1">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row rowgap="1">⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row/>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠀⠿⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_105">
    <x:documentation>
      Tests custom page counters.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none">
            <body style="@page {
                           counter-increment: page;
                           size: 15 5;
                           margin-bottom: 1;
                           @bottom-right { content: counter(page); }}
                         @volume:first {
                           @begin {
                             counter-set: custom-page 11;
                             content: flow(begin, document);
                             @page {
                               counter-increment: custom-page;
                               size: 15 5;
                               margin-bottom: 1;
                               @bottom-right { content: counter(custom-page); }}}}">
              <section style="display: block; flow: begin">
                ⠿⠿⠿
              </section>
              <section style="display: block">
                ⠤⠤⠤
              </section>
              <section style="display: block; page-break-before: always">
                ⠤⠤⠤
              </section>
              <section style="display: block; page-break-before: always">
                ⠤⠤⠤
              </section>
              <section style="display: block;
                              @page {
                                counter-increment: custom-page;
                                size: 15 5;
                                margin-bottom: 1;
                                @bottom-right { content: counter(custom-page) }}">
                ⠉⠉⠉
              </section>
              <section style="display: block">
                ⠤⠤⠤
              </section>
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="c" duplex="true" page-width="15" page-height="5">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <layout-master name="a" duplex="true" page-width="15" page-height="5">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <layout-master name="b" duplex="true" page-width="15" page-height="5">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="1000" use-when="(! (= $volume 1))"/>
          <volume-template sheets-in-volume-max="1000" use-when="(= $volume 1)">
            <pre-content>
              <sequence master="c" page-number-counter="custom-page" initial-page-number="11">
                <block>
                  ⠿⠿⠿
                </block>
              </sequence>
            </pre-content>
          </volume-template>
          <sequence master="a">
            <block>
              ⠤⠤⠤
            </block>
            <block break-before="page">
              ⠤⠤⠤
            </block>
            <block break-before="page">
              ⠤⠤⠤
            </block>
          </sequence>
          <sequence master="b" page-number-counter="custom-page">
            <block break-before="sheet">
              ⠉⠉⠉
            </block>
          </sequence>
          <sequence master="a">
            <block break-before="sheet">
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁⠁</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠃</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠉</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠉⠉⠉</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁⠉</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠑</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_106">
    <x:documentation>
      Tests continuous numbering of pages throughout body and volume areas.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page {
                        counter-increment: page;
                        size: 10 5;
                        margin-bottom: 1;
                        @bottom-right {
                          content: counter(page) }}
                      @volume {
                        @begin { content: flow(titlepage, document) }}">
            <front>
              <titlepage style="display: block; flow: titlepage">
                ⠿⠿⠿
              </titlepage>
            </front>
            <body style="display: block">
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              <br style="display: block; volume-break-before: always"/>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="10" page-height="5">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <sequence master="main" page-number-counter="page">
                <block translate="pre-translated-text-css">
                  ⠿⠿⠿
                </block>
              </sequence>
            </pre-content>
          </volume-template>
          <sequence master="main" page-number-counter="page">
            <block/>
            <block translate="pre-translated-text-css">
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
          <sequence master="main" page-number-counter="page" break-before="volume">
            <block translate="pre-translated-text-css">
              <block/>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿
                  </row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁
                  </row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠼⠉</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠼⠑</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠼⠛</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠼⠓</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_107">
    <x:documentation>
      Tests keeping blocks in the same volume.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="display: block;
                       text-transform: none;
                       @page { size: 10 5 }
                       @volume { max-length: 6 }">
            <p style="display: block; volume-break-inside: -obfl-keep(1)">
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
            </p>
            <p style="display: block; volume-break-inside: -obfl-keep(1)">
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </p>
            <p style="display: block; volume-break-inside: -obfl-keep(1)">
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
            </p>
            <p style="display: block; volume-break-inside: -obfl-keep(1)">
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </p>
            <p style="display: block; volume-break-inside: -obfl-keep(1)">
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
            </p>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="10" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="6"/>
          <volume-transition range="sheet"/>
          <sequence master="main">
            <block>
              <block volume-keep-priority="1">
                ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              </block>
              <block volume-keep-priority="1">
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
              <block volume-keep-priority="1">
                ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              </block>
              <block volume-keep-priority="1">
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
              <block volume-keep-priority="1">
                ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <!-- right-hand page -->
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <!-- left-hand page -->
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_108" xfail="true">
    <x:documentation>
      Tests suppressing of hyphenation of the last line of a volume.
      
      Broken: see https://github.com/brailleapps/dotify.formatter.impl/issues/46
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="display: block;
                       text-transform: none;
                       @page { size: 10 5 }
                       @volume { max-length: 3 }">
            <p style="display: block; volume-break-inside: -obfl-keep(1)">
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁ ⠁⠁⠁⠁⠁ ⠁⠁⠁⠁⠁ ⠁⠁⠁⠁⠁ ⠿⠿­⠿⠿⠿⠿⠿
              ⠁⠁⠁⠁⠁ ⠁⠁⠁⠁⠁ ⠁⠁⠁⠁⠁ ⠁⠁⠁⠁⠁ ⠿⠿­⠿⠿⠿⠿⠿
              ⠁⠁⠁⠁⠁ ⠁⠁⠁⠁⠁ ⠁⠁⠁⠁⠁ ⠁⠁⠁⠁⠁ ⠿⠿­⠿⠿⠿⠿⠿
              ⠁⠁⠁⠁⠁ ⠁⠁⠁⠁⠁ ⠁⠁⠁⠁⠁ ⠁⠁⠁⠁⠁ ⠿⠿­⠿⠿⠿⠿⠿
              ⠁⠁⠁⠁⠁ ⠁⠁⠁⠁⠁ ⠁⠁⠁⠁⠁ ⠁⠁⠁⠁⠁ ⠿⠿­⠿⠿⠿⠿⠿
              ⠁⠁⠁⠁⠁ ⠁⠁⠁⠁⠁ ⠁⠁⠁⠁⠁ ⠁⠁⠁⠁⠁ ⠿⠿­⠿⠿⠿⠿⠿
              ⠁⠁⠁⠁⠁ ⠁⠁⠁⠁⠁ ⠁⠁⠁⠁⠁ ⠁⠁⠁⠁⠁ ⠿⠿
            </p>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="10" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="6"/>
          <volume-transition range="sheet"/>
          <sequence master="main">
            <block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁⠀⠿⠿⠤</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁⠀⠿⠿⠤</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁⠀⠿⠿⠤</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁⠀⠿⠿⠤</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁⠀⠿⠿⠤</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁⠀⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_109">
    <x:documentation>
      Tests string-set on ::after pseudo-element inside not-rendered element inside block.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page {
                        size: 10 6;
                        margin-bottom: 1;
                        @bottom-left {
                          content: string(print-page, page-first); }
                        @bottom-right {
                          content: string(print-page, page-last); }}">
            <p style="display: block">
              <pagenum style="display: none;
                              string-set: print-page content();
                              &amp;::after { string-set: print-page '⠿⠿⠿' }">1</pagenum>
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
              ⠁⠁⠁⠁⠁
            </p>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="master" duplex="true" page-width="10" page-height="6">
            <default-template>
              <header/>
              <footer>
                <field>
                  <compound-marker-reference>
                    <marker-reference marker="print-page" direction="forward" scope="page"/>
                    <marker-reference marker="print-page" direction="backward" scope="sequence"/>
                    <marker-reference marker="print-page/entry" direction="backward" scope="sequence"/>
                  </compound-marker-reference>
                </field>
                <field>
                  <compound-marker-reference>
                    <marker-reference marker="print-page" direction="backward" scope="sequence"/>
                    <marker-reference marker="print-page/entry" direction="backward" scope="sequence"/>
                  </compound-marker-reference>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="master">
            <block>
              <block>
                <marker class="print-page" value="1"/>
              </block>
              <block>
                <marker class="print-page" value="⠿⠿⠿"/>
              </block>
              ⠁⠁⠁⠁⠁ ⠁⠁⠁⠁⠁ ⠁⠁⠁⠁⠁
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row>⠁⠁⠁⠁⠁</row>
                  <row/>
                  <row/>
                  <row>⠼⠁⠀⠀⠀⠀⠀⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <x:scenario label="test_110">
    <x:documentation>
      Tests horizontal positioning with leader().
    </x:documentation>
      <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page { size: 20 5 }">
            <p style="display: block">
              ⠿⠿⠿
              <span style="&amp;::before {
                             text-transform: auto;
                             content: leader('⠀', 15, right); }">
                ⠿⠿⠿
              </span>
            </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="20" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              ⠿⠿⠿
              <leader pattern="⠀" position="15" align="right"/>
              ⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="20" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_111">
    <x:documentation>
      Tests negative text indent on the last line on the right side.
    </x:documentation>
      <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; @page { size: 20 5 }">
            <p style="display: block;
                      margin-left: 4;
                      text-indent: -4;
                      -obfl-right-text-indent: 4">
              ⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿
              <span style="&amp;::before {
                             text-transform: auto;
                             content: leader('⠀'); }">
                ⠿⠿⠿⠿⠿⠿⠿
              </span>
            </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="master_2" duplex="true" page-width="20" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="master_2">
            <block right-text-indent="4" first-line-indent="0" text-indent="4">
              ⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿​⠿
              <leader pattern="⠀" position="100%" align="right"/>
              ⠿⠿⠿⠿⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="20" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠀⠀⠀⠀⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠀⠀⠀⠀⠿⠿⠿⠿⠀⠀⠀⠀⠀⠿⠿⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_113">
    <x:documentation>
      Tests combination of volume-break-before:always and @page.
      
      This is related to the workaround shown in test_102 above.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="display: block;
                       text-transform: none;
                       @page { size: 10 5 }">
            <p style="display: block">
              ⠿⠿⠿⠿⠿
            </p>
            <p style="display: block; volume-break-before: always">
              ⠿⠿⠿⠿⠿
            </p>
            <p style="display: block; page-break-before: right">
              ⠿⠿⠿⠿⠿
            </p>
            <p style="display: block; page-break-before: right; volume-break-before: always">
              ⠿⠿⠿⠿⠿
            </p>
            <p style="display: block; volume-break-before: always; @page { size: 11 5 }">
              ⠿⠿⠿⠿⠿
            </p>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="10" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <layout-master name="last" duplex="true" page-width="11" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="main">
            <block>
              <block> ⠿⠿⠿⠿⠿ </block>
            </block>
          </sequence>
          <sequence master="main" break-before="volume">
            <block>
              <block> ⠿⠿⠿⠿⠿ </block>
              <block break-before="sheet"> ⠿⠿⠿⠿⠿ </block>
            </block>
          </sequence>
          <sequence master="main" break-before="volume">
            <block break-before="sheet">
              <block> ⠿⠿⠿⠿⠿ </block>
            </block>
          </sequence>
          <sequence master="last" break-before="volume">
            <block break-before="sheet">
              <block> ⠿⠿⠿⠿⠿ </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page/>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
            <volume cols="11" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_114">
    <x:documentation>
      Tests :-obfl-alternate-scenario pseudo-class.
      
      Also tests a rule relative to :-obfl-alternate-scenario.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none;
                       @page { size: 10 10 }">
            <table xmlns="http://www.daisy.org/z3986/2005/dtbook/"
                   style="padding-top: 1;
                          display: none;
                          &amp;:-obfl-alternate-scenario(1) {
                            display: table;
                            -obfl-table-col-spacing: 1;
                            -obfl-scenario-cost: -obfl-evaluate('$forced-break-count'); }
                          &amp;:-obfl-alternate-scenario(2) {
                            -obfl-scenario-cost: 2;
                            display: block;
                            render-table-by: row, column; }
                          &amp;:-obfl-alternate-scenario(2) td:blank::after {
                            content: '⠪⠕'; }
                          &amp;:-obfl-alternate-scenario(2)::table-by(row)::list-item {
                            display:block;
                            margin-left:2; }
                          &amp;:-obfl-alternate-scenario(2)::table-by(column)::list-item {
                            display:block; }
                          &amp;:-obfl-alternate-scenario(2)::table-by(column)::list-item:first-child {
                            text-indent:-2; }">
              <thead>
                <tr>
                  <th>⠿⠿⠿</th>
                  <th>⠿⠿⠿</th>
                  <th>⠿⠿⠿</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>⠤⠤⠤</td>
                  <td/>
                  <td>⠤⠤⠤</td>
                </tr>
                <tr>
                  <td>⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                </tr>
              </tbody>
            </table>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="10" page-height="10">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <xml-processor name="take-nth">
            <xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="2.0"
                            xmlns:d="http://www.daisy.org/ns/pipeline/data"
                            xmlns:xs="http://www.w3.org/2001/XMLSchema"
                            d:bogus="" xs:bogus="">
              <xsl:param name="n" as="xs:integer"/>
              <xsl:template match="/">
                <xml-processor-result>
                  <xsl:sequence select="/*/d:scenario[position()=$n]/node()"/>
                </xml-processor-result>
              </xsl:template>
            </xsl:stylesheet>
          </xml-processor>
          <renderer name="renderer_1">
            <rendering-scenario processor="take-nth" cost="2">
              <parameter name="n" value="2"/>
            </rendering-scenario>
            <rendering-scenario processor="take-nth" cost="$forced-break-count">
              <parameter name="n" value="1"/>
            </rendering-scenario>
          </renderer>
          <sequence master="main">
            <block>
            <xml-data renderer="renderer_1">
                <d:scenarios xmlns:d="http://www.daisy.org/ns/pipeline/data">
                    <d:scenario>
                        <block padding-top="1">
                            <table table-col-spacing="1">
                                <thead>
                                    <tr>
                                        <td>⠿⠿⠿</td>
                                        <td>⠿⠿⠿</td>
                                        <td>⠿⠿⠿</td>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>⠤⠤⠤</td>
                                        <td/>
                                        <td>⠤⠤⠤</td>
                                    </tr>
                                    <tr>
                                        <td>⠤⠤⠤</td>
                                        <td>⠤⠤⠤</td>
                                        <td>⠤⠤⠤</td>
                                    </tr>
                                </tbody>
                            </table>
                        </block>
                    </d:scenario>
                    <d:scenario>
                        <block padding-top="1">
                            <block>
                                <block first-line-indent="0" text-indent="2">⠿⠿⠿⠤⠤⠤</block>
                                <block padding-left="2">⠿⠿⠿⠪⠕</block>
                                <block padding-left="2">⠿⠿⠿⠤⠤⠤</block>
                            </block>
                            <block>
                                <block first-line-indent="0" text-indent="2">⠿⠿⠿⠤⠤⠤</block>
                                <block padding-left="2">⠿⠿⠿⠤⠤⠤</block>
                                <block padding-left="2">⠿⠿⠿⠤⠤⠤</block>
                            </block>
                        </block>
                    </d:scenario>
                </d:scenarios>
            </xml-data>
        </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="10" rowgap="0" duplex="true">
            <section>
                <page>
                  <row/>
                  <row>⠿⠿⠿⠀⠿⠿⠀⠿⠿⠿</row>
                  <row>⠀⠀⠀⠀⠿</row>
                  <row>⠤⠤⠤⠀⠀⠀⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠤⠤⠀⠤⠤⠤</row>
                  <row>⠀⠀⠀⠀⠤</row>
                </page>
            </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_115">
    <x:documentation>
      Tests @-obfl-volume-transition rule.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none;
                       @page { size: 10 5 }
                       @volume { max-length: 3 }
                       @-obfl-volume-transition {
                         @any-interrupted {
                           content: '⠒⠒⠒ ' counter(volume) ' ⠒⠒⠒'; }
                         @any-resumed {
                           content: '⠒⠒⠒ ' counter(volume) ' ⠒⠒⠒'; }}">
            <p style="display: block">
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
            </p>
          </body>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="10" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="3"/>
          <volume-transition range="sheet">
            <any-interrupted>
              <block>
                ⠒⠒⠒ <evaluate expression="$volume"/> ⠒⠒⠒
              </block>
            </any-interrupted>
            <any-resumed>
              <block>
                ⠒⠒⠒ <evaluate expression="$volume"/> ⠒⠒⠒
              </block>
            </any-resumed>
          </volume-transition>
          <sequence master="main">
            <block>
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠒⠒⠒⠀⠼⠁⠀⠒⠒⠒</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠒⠒⠒⠀⠼⠃⠀⠒⠒⠒</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_116">
    <x:documentation>
      Tests that tables do not inherit padding from container.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page { size: 20 15 }">
            <div style="display: block; padding-top: 2">
              ⠛⠛⠛
              <table xmlns="http://www.daisy.org/z3986/2005/dtbook/"
                     style="display:table">
                <tr>
                  <td>⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                </tr>
                <tr>
                  <td>⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                </tr>
                <tr>
                  <td>⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                </tr>
              </table>
            </div>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="20" page-height="15" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block padding-top="2">
              <block>⠛⠛⠛</block>
              <block>
                <table>
                  <tr>
                    <td>⠤⠤⠤</td>
                    <td>⠤⠤⠤</td>
                  </tr>
                  <tr>
                    <td>⠤⠤⠤</td>
                    <td>⠤⠤⠤</td>
                  </tr>
                  <tr>
                    <td>⠤⠤⠤</td>
                    <td>⠤⠤⠤</td>
                  </tr>
                </table>
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="15" cols="20" rowgap="0" duplex="true">
              <section>
                <page>
                  <row/>
                  <row/>
                  <row>⠛⠛⠛</row>
                  <row>⠤⠤⠤⠀⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_117">
    <x:documentation>
      Tests that captions do not inherit padding from table.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page { size: 20 15 }">
            <table xmlns="http://www.daisy.org/z3986/2005/dtbook/"
                   style="display:table; padding-bottom: 2">
              <caption style="display:block">⠛⠛⠛⠛⠛⠛</caption>
              <tr>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
              <tr>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
              <tr>
                <td>⠤⠤⠤</td>
                <td>⠤⠤⠤</td>
              </tr>
            </table>
            <p style="display:block">⠛⠛⠛</p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="20" page-height="15" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block padding-bottom="2">
              <block>⠛⠛⠛⠛⠛⠛</block>
              <table>
                <tr>
                  <td>⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                </tr>
                <tr>
                  <td>⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                </tr>
                <tr>
                  <td>⠤⠤⠤</td>
                  <td>⠤⠤⠤</td>
                </tr>
              </table>
            </block>
            <block>⠛⠛⠛</block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="15" cols="20" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠛⠛⠛⠛⠛⠛</row>
                  <row>⠤⠤⠤⠀⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠀⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠀⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row>⠛⠛⠛</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_118">
    <x:documentation>
      Tests bottom right margin box of height 2 inside page margin of height 0, which results in
      text being flowed into the whole footer.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page {
                        size: 15 5;
                        margin-bottom: 0;
                        @bottom-right {
                          content: '⠤⠤\A⠤⠤';
                          white-space: pre-wrap; }}">
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="15" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer>
                <field allow-text-flow="true"/>
                <field>
                  <string value="⠤⠤"/>
                </field>
              </footer>
              <footer>
                <field allow-text-flow="true"/>
                <field>
                  <string value="⠤⠤"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤</row>
                  <row>⠿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤</row>
                </page>
                <page>
                  <row>⠿</row>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_119">
    <x:documentation>
      Tests bottom right margin box of height 2 inside page margin of height 1, which results in
      text being partly flowed into whole footer.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page {
                        size: 15 5;
                        margin-bottom: 1;
                        @bottom-right {
                          content: '⠤⠤\A⠤⠤';
                          white-space: pre-wrap; }}">
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
            <p style="display: block"> ⠿ </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="15" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer>
                <field allow-text-flow="true"/>
                <field>
                  <string value="⠤⠤"/>
                </field>
              </footer>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value="⠤⠤"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
            <block> ⠿ </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row>⠿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤</row>
                </page>
                <page>
                  <row>⠿</row>
                  <row>⠿</row>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_120">
    <x:documentation>
      Tests that last sheet of volume is modified so that volume break occurs between blocks.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="display: block;
                       text-transform: none;
                       @page { size: 10 5 }
                       @volume { max-length: 5 }">
            <p style="display: block">
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
            </p>
            <p style="display: block">
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </p>
            <p style="display: block">
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
            </p>
            <!--
                this is just to make sure that a volume-transition element is created
            -->
            <p style="display:block; volume-break-inside: -obfl-keep(1)">⠤</p>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="10" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="5"/>
          <volume-transition range="sheet"/>
          <sequence master="main">
            <block>
              <block>
                ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
              <block>
                ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
                ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              </block>
              <block volume-keep-priority="1">⠤</block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_121">
    <x:documentation>
      Tests table of contents with "continuation entries".
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page {
                        size: 15 7;
                        margin-bottom: 1;
                        @bottom-right { content: counter(page) }}
                      @volume:first { @begin { content: flow(first-front, document) }}
                      @volume { @begin { content: flow(next-front, document) }}">
            <front>
              <ol style="display: -obfl-toc;
                         flow: first-front;
                         text-transform: auto;
                         &amp;::duplicate {
                           display:-obfl-toc;
                           -obfl-toc-range:volume;
                           flow:next-front;
                           text-transform:auto }">
                <li style="display: block">
                  <a href="ch_1" style="&amp;::after { content: ' ⠐⠐⠐⠐⠐⠐⠐⠐⠐ ' target-counter(attr(href), page) }
                                        &amp;::-obfl-on-resumed {
                                          display: block;
                                          content: '1 ⠄⠄⠄'}
                                        &amp;::-obfl-on-resumed::after {
                                          content: ' ⠐⠐⠐⠐⠐ ' counter(-obfl-started-volume-first-content-page) }"
                     >1</a>
                  <ol style="display: block; margin-left: 1">
                    <li style="display: block">
                      <a href="ch_1_1" style="&amp;::after { content: ' ⠐⠐⠐⠐⠐⠐ ' target-counter(attr(href), page) }"
                         >1.1</a>
                    </li>
                    <li style="display: block">
                      <a href="ch_1_2" style="&amp;::after { content: ' ⠐⠐⠐⠐⠐⠐ ' target-counter(attr(href), page) }"
                         >1.2</a>
                    </li>
                  </ol>
                </li>
                <li style="display: block">
                  <a href="ch_2" style="&amp;::after { content: ' ⠐⠐⠐⠐⠐⠐⠐⠐⠐ ' target-counter(attr(href), page) }
                                        &amp;::-obfl-on-resumed {
                                          display: block;
                                          content: '2 ⠄⠄⠄'}
                                        &amp;::-obfl-on-resumed::after {
                                          content: ' ⠐⠐⠐⠐⠐ ' counter(-obfl-started-volume-first-content-page) }"
                     >2</a>
                  <ol style="display: block; margin-left: 1">
                    <li style="display: block">
                      <a href="ch_2_1" style="&amp;::after { content: ' ⠐⠐⠐⠐⠐⠐ ' target-counter(attr(href), page) }
                                              &amp;::-obfl-on-resumed {
                                                display: block;
                                                content: '2.1 ⠄⠄⠄'}
                                              &amp;::-obfl-on-resumed::after {
                                                content: ' ⠐⠐ ' counter(-obfl-started-volume-first-content-page) }"
                         >2.1</a>
                    </li>
                    <li style="display: block">
                      <a href="ch_2_2" style="&amp;::after { content: ' ⠐⠐⠐⠐⠐⠐ ' target-counter(attr(href), page) }
                                              &amp;::-obfl-on-resumed {
                                                display: block;
                                                content: '2.2 ⠄⠄⠄'}
                                              &amp;::-obfl-on-resumed::after {
                                                content: ' ⠐⠐⠐⠐⠐ ' counter(-obfl-started-volume-first-content-page) }"
                         >2.2</a>
                    </li>
                  </ol>
                </li>
              </ol>
            </front>
            <body style="display: block">
              <h1 id="ch_1" style="display:block; text-transform:auto"> 1 </h1>
              <h2 id="ch_1_1" style="display:block; text-transform:auto"> 1.1 </h2>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              <br style="display: block; volume-break-before: always"/>
              <h2 id="ch_1_2" style="display:block; text-transform:auto"> 1.2 </h2>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              <br style="display: block; volume-break-before: always"/>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              <h1 id="ch_2" style="display:block; text-transform:auto"> 2 </h1>
              <br style="display: block; volume-break-before: always"/>
              <h2 id="ch_2_1" style="display:block; text-transform:auto"> 2.1 </h2>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              <h2 id="ch_2_2" style="display:block; text-transform:auto"> 2.2 </h2>
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            </body>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="15" page-height="7">
            <default-template>
              <header/>
              <footer>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <table-of-contents name="toc">
            <toc-block>
              <toc-block>
                <toc-block>
                  <toc-entry ref-id="ch_1">1 ⠐⠐⠐⠐⠐⠐⠐⠐⠐
                  <page-number ref-id="ch_1" number-format="default"/></toc-entry>
                </toc-block>
                <toc-block>
                  <toc-entry-on-resumed range="[ch_1,ch_2)">1 ⠄⠄⠄ ⠐⠐⠐⠐⠐
                  <evaluate expression="$started-volume-first-content-page"/></toc-entry-on-resumed>
                </toc-block>
                <toc-block>
                  <toc-block padding-left="1">
                    <toc-entry ref-id="ch_1_1">1.1 ⠐⠐⠐⠐⠐⠐
                    <page-number ref-id="ch_1_1" number-format="default"/></toc-entry>
                  </toc-block>
                  <toc-block padding-left="1">
                    <toc-entry ref-id="ch_1_2">1.2 ⠐⠐⠐⠐⠐⠐
                    <page-number ref-id="ch_1_2" number-format="default"/></toc-entry>
                  </toc-block>
                </toc-block>
              </toc-block>
              <toc-block>
                <toc-block>
                  <toc-entry ref-id="ch_2">2 ⠐⠐⠐⠐⠐⠐⠐⠐⠐
                  <page-number ref-id="ch_2" number-format="default"/></toc-entry>
                </toc-block>
                <toc-block>
                  <toc-entry-on-resumed range="[ch_2,ch_2_1)">2 ⠄⠄⠄ ⠐⠐⠐⠐⠐
                  <evaluate expression="$started-volume-first-content-page"/></toc-entry-on-resumed>
                </toc-block>
                <toc-block>
                  <toc-block>
                    <toc-block padding-left="1">
                      <toc-entry ref-id="ch_2_1">2.1 ⠐⠐⠐⠐⠐⠐
                      <page-number ref-id="ch_2_1" number-format="default"/></toc-entry>
                    </toc-block>
                    <toc-block padding-left="1">
                      <toc-entry-on-resumed range="[ch_2_1,ch_2_2)">2.1 ⠄⠄⠄ ⠐⠐
                      <evaluate expression="$started-volume-first-content-page"/></toc-entry-on-resumed>
                    </toc-block>
                  </toc-block>
                  <toc-block>
                    <toc-block padding-left="1">
                      <toc-entry ref-id="ch_2_2">2.2 ⠐⠐⠐⠐⠐⠐
                      <page-number ref-id="ch_2_2" number-format="default"/></toc-entry>
                    </toc-block>
                    <toc-block padding-left="1">
                      <toc-entry-on-resumed range="[ch_2_2,)">2.2 ⠄⠄⠄ ⠐⠐⠐⠐⠐
                      <evaluate expression="$started-volume-first-content-page"/></toc-entry-on-resumed>
                    </toc-block>
                  </toc-block>
                </toc-block>
              </toc-block>
            </toc-block>
          </table-of-contents>
          <volume-template sheets-in-volume-max="1000" use-when="(! (= $volume 1))">
            <pre-content>
              <toc-sequence toc="toc" master="main" range="volume"/>
            </pre-content>
          </volume-template>
          <volume-template sheets-in-volume-max="1000" use-when="(= $volume 1)">
            <pre-content>
              <toc-sequence toc="toc" master="main" range="document"/>
            </pre-content>
          </volume-template>
          <sequence master="main">
            <block/>
            <block translate="pre-translated-text-css">
              <block translate="">
                <block>
                  <span id="ch_1"/>
                </block>
                1
              </block>
              <block translate="">
                <block>
                  <span id="ch_1_1"/>
                </block>
                1.1
              </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
          <sequence master="main" break-before="volume">
            <block translate="pre-translated-text-css">
              <block/>
              <block translate="">
                <block>
                  <span id="ch_1_2"/>
                </block>
                1.2
              </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
          <sequence master="main" break-before="volume">
            <block translate="pre-translated-text-css">
              <block/>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
              <block translate="">
                <block>
                  <span id="ch_2"/>
                </block>
                2
              </block>
            </block>
          </sequence>
          <sequence master="main" break-before="volume">
            <block translate="pre-translated-text-css">
              <block/>
              <block translate="">
                <block>
                  <span id="ch_2_1"/>
                </block>
                2.1
              </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
              <block translate="">
                <block>
                  <span id="ch_2_2"/>
                </block>
                2.2
              </block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠁⠀⠐⠐⠐⠐⠐⠐⠐⠐⠐⠀⠼⠁</row>
                  <row>⠀⠼⠁⠲⠁⠀⠐⠐⠐⠐⠐⠐⠀⠼⠁</row>
                  <row>⠼⠁⠀⠄⠄⠄⠀⠐⠐⠐⠐⠐⠀⠼⠉</row>
                  <row>⠀⠼⠁⠲⠃⠀⠐⠐⠐⠐⠐⠐⠀⠼⠉</row>
                  <row>⠼⠁⠀⠄⠄⠄⠀⠐⠐⠐⠐⠐⠀⠼⠑</row>
                  <row>⠼⠃⠀⠐⠐⠐⠐⠐⠐⠐⠐⠐⠀⠼⠑</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
                <page>
                  <row>⠀⠼⠃⠲⠁⠀⠐⠐⠐⠐⠐⠐⠀⠼⠛</row>
                  <row>⠀⠼⠃⠲⠃⠀⠐⠐⠐⠐⠐⠐⠀⠼⠓</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠃</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠼⠁</row>
                  <row>⠼⠁⠲⠁</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠃</row>
                </page>
              </section>
            </volume>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠁⠀⠄⠄⠄⠀⠐⠐⠐⠐⠐⠀⠼⠉</row>
                  <row>⠀⠼⠁⠲⠃⠀⠐⠐⠐⠐⠐⠐⠀⠼⠉</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠼⠁⠲⠃</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠉</row>
                </page>
              </section>
            </volume>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠼⠁⠀⠄⠄⠄⠀⠐⠐⠐⠐⠐⠀⠼⠑</row>
                  <row>⠼⠃⠀⠐⠐⠐⠐⠐⠐⠐⠐⠐⠀⠼⠑</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠼⠃</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠑</row>
                </page>
              </section>
            </volume>
            <volume cols="15" rows="7" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠀⠼⠃⠲⠁⠀⠐⠐⠐⠐⠐⠐⠀⠼⠛</row>
                  <row>⠀⠼⠃⠲⠃⠀⠐⠐⠐⠐⠐⠐⠀⠼⠓</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠼⠃⠲⠁</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠛</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠼⠃⠲⠃</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠓</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠊</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤⠀⠤⠤⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠼⠁⠚</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_122">
    <x:documentation>
      Tests string(..., start-except-first).
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page {
                        size: 10 5;
                        @bottom-left { content: string(foo, start-except-first) }}">
            <section style="display: block;
                            string-set: foo '⠿'">
              ⠤⠤⠤
            </section>
            <section style="display: block;
                            page-break-before: right">
              ⠤⠤⠤
              <_ style="display: none; string-set: foo '⠿⠿'"/>
              ⠤⠤⠤
            </section>
            <section style="display: block;
                            page-break-before: right">
              <_ style="display: none; string-set: foo '⠿⠿⠿'"/>
              ⠤⠤⠤
            </section>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="10" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer>
                <field>
                  <compound-marker-reference>
                    <marker-reference marker="foo/if-not-set-next/prev" direction="forward" scope="page-content"/>
                    <marker-reference marker="foo/if-not-set-next" direction="backward" scope="sequence" offset="-1"/>
                    <marker-reference marker="foo/entry" direction="backward" scope="sequence"/>
                  </compound-marker-reference>
                </field>
                <field>
                  <string value=""/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              <block>
                <marker class="foo/if-not-set-next" value="​"/>
              </block>
              <marker class="foo/if-not-set-next/prev" value="​"/>
              <marker class="foo/if-not-set-next" value="⠿"/>
              ⠤⠤⠤
            </block>
            <block break-before="sheet">
              ⠤⠤⠤
              <marker class="foo/if-not-set-next/prev" value="⠿"/>
              <marker class="foo/if-not-set-next" value="⠿⠿"/>
              ⠤⠤⠤
            </block>
            <block break-before="sheet">
              <block>
                <marker class="foo/if-not-set-next/prev" value="⠿⠿"/>
                <marker class="foo/if-not-set-next" value="​"/>
              </block>
              <marker class="foo/if-not-set-next/prev" value="​"/>
              <marker class="foo/if-not-set-next" value="⠿⠿⠿"/>
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                </page>
                <page>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠿</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠀⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠿</row>
                </page>
                <page>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠿⠿</row>
                </page>
                <page>
                  <row>⠤⠤⠤</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_123">
    <x:documentation>
      Tests white-space on string(), target-string() and counter() and target-counter().
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform:none;
                      @page {
                        size: 10 6;
                        @bottom-right {
                          white-space: pre-wrap;
                          text-transform: auto;
                          content: string(foo) ' ' counter(page); }}">
            <p style="display: block;">
              <a href="#x"
                 style="&amp;::before {
                          white-space: pre-wrap;
                          text-transform: auto;
                          content: target-string(attr(href), foo) ' ' target-counter(attr(href), page);  }"/>
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
            </p>
            <p id="x" style="display: block; string-set: foo '⠤  ⠤'">
              ⠿⠿⠿⠿⠿
            </p>
          </doc>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="master" duplex="true" page-width="10" page-height="6">
            <default-template>
              <header/>
              <footer>
                <field allow-text-flow="true"/>
                <field>
                  <compound-marker-reference>
                    <marker-reference marker="foo" direction="forward" scope="page" text-style="white-space: pre-wrap"/>
                    <marker-reference marker="foo" direction="backward" scope="sequence" text-style="white-space: pre-wrap"/>
                    <marker-reference marker="foo/entry" direction="backward" scope="sequence" text-style="white-space: pre-wrap"/>
                  </compound-marker-reference>
                  <string value=" "/>
                  <current-page number-format="default" text-style="white-space: pre-wrap"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="master">
            <block>
              <span translate="">
                ⠤  ​⠤ ​<style name="white-space: pre-wrap">
                <page-number ref-id="x" number-format="default"/>
              </style>
              </span>
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
            </block>
            <block>
              <block>
                <span id="x"/>
              </block>
              <block>
                <marker class="foo" value="⠤  ⠤"/>
              </block>
              ⠿⠿⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="6" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠀⠀⠤⠀⠼⠃⠀</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿⠀⠀⠀⠼⠁</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row/>
                  <row/>
                  <row>⠀⠀⠀⠤⠀⠀⠤⠀⠼⠃</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_124">
    <x:documentation>
      Tests string() inside @-obfl-volume-transition rule.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none;
                       @page { size: 8 4 }
                       @volume { max-length: 2 }
                       @-obfl-volume-transition {
                         @any-resumed {
                           content: string(foo, start-except-first) }}">
            <h1 style="display: block;
                       string-set: foo '⠤ ⠿'">
              ⠤
            </h1>
            <p style="display: block">⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿</p>
            <p style="display: block">⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿</p>
            <p style="display: block">⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿</p>
            <p style="display: block">⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿</p>
            <p style="display: block">⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿</p>
            <h1 style="display: block;
                       string-set: foo '⠤⠤ ⠿';
                       page-break-before: right">
              ⠤⠤
            </h1>
            <p style="display: block">⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿</p>
            <h1 style="display: block;
                       string-set: foo '⠤⠤⠤ ⠿';
                       page-break-before: right">
              ⠤⠤⠤
            </h1>
            <p style="display: block">⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿</p>
            <p style="display: block">⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿</p>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="master" duplex="true" page-width="8" page-height="4">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="2"/>
          <volume-transition range="sheet">
            <any-resumed>
              <block>
                <compound-marker-reference>
                  <marker-reference marker="foo/if-not-set-next/prev" direction="forward" scope="page-content"/>
                  <marker-reference marker="foo/if-not-set-next" direction="backward" scope="sequence" offset="-1"/>
                  <marker-reference marker="foo/entry" direction="backward" scope="sequence"/>
                </compound-marker-reference>
              </block>
            </any-resumed>
          </volume-transition>
          <sequence master="master">
            <block>
              <block>
                <marker class="foo/if-not-set-next" value="​"/>
              </block>
              <marker class="foo/if-not-set-next/prev" value="​"/>
              <marker class="foo/if-not-set-next" value="⠤ ⠿"/>
              ⠤
            </block>
            <block>⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿</block>
            <block>⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿</block>
            <block>⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿</block>
            <block>⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿</block>
            <block>⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿</block>
            <block break-before="sheet">
              <block>
                <marker class="foo/if-not-set-next/prev" value="⠤ ⠿"/>
                <marker class="foo/if-not-set-next" value="​"/>
              </block>
              <marker class="foo/if-not-set-next/prev" value="​"/>
              <marker class="foo/if-not-set-next" value="⠤⠤ ⠿"/>
              ⠤⠤
            </block>
            <block>⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿</block>
            <block break-before="sheet">
              <block>
                <marker class="foo/if-not-set-next/prev" value="⠤⠤ ⠿"/>
                <marker class="foo/if-not-set-next" value="​"/>
              </block>
              <marker class="foo/if-not-set-next/prev" value="​"/>
              <marker class="foo/if-not-set-next" value="⠤⠤⠤ ⠿"/>
              ⠤⠤⠤
            </block>
            <block>⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿</block>
            <block>⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿</block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="8" rows="4" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
            <volume cols="8" rows="4" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠀⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
            <volume cols="8" rows="4" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠀⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠤⠤</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
            <volume cols="8" rows="4" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_125">
    <x:documentation>
      Tests that white space after leader() is not collapsed with white space before it (see issue
      https://github.com/mtmse/dotify.formatter.impl/issues/14).
    </x:documentation>
      <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; @page { size: 20 5 }">
            <p style="display: block">
              <span style="&amp;::before {
                             content: '⠿⠿⠿⠿ ' leader('⠁') ' '; }">
                ⠿⠿⠿⠿
              </span>
            </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="20" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              ⠿⠿⠿⠿ <leader pattern="⠁" position="100%" align="right"/> ⠿⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="20" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠀⠁⠁⠁⠁⠁⠁⠁⠁⠁⠁⠀⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_126">
    <x:documentation>
      Tests margin-bottom inside @any-resumed. The margin is not collapsed margins in the body
      content (in other words, it behaves like padding.)
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none;
                       @page { size: 8 4 }
                       @volume { max-length: 2 }
                       @-obfl-volume-transition {
                         @any-resumed {
                           margin-bottom: 1;
                           content: '⠒⠒⠒'; }}">
            <p style="display: block; margin-top: 1">
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
            </p>
            <p style="display: block; page-break-before: always; margin-top: 1">
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
            </p>
            <p style="display: block">
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
            </p>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="master" duplex="true" page-width="8" page-height="4">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="2"/>
          <volume-transition range="sheet">
            <any-resumed>
              <block margin-bottom="1">
                <block>⠒⠒⠒</block>
              </block>
            </any-resumed>
          </volume-transition>
          <sequence master="master">
            <block margin-top="1">
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
            </block>
            <block break-before="page" margin-top="1">
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
            </block>
            <block>
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
              ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿ ⠿⠿⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="8" rows="4" rowgap="0" duplex="true">
              <section>
                <page>
                  <row/>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
            <volume cols="8" rows="4" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠒⠒⠒</row>
                  <row/>
                  <row/>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
            <volume cols="8" rows="4" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠒⠒⠒</row>
                  <row/>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
                <page>
                  <row>⠿⠿⠿⠿⠿</row>
                  <row>⠿⠿⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <x:scenario label="test_127">
    <x:documentation>
      Tests manual volume breaking with volume-break-after.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="display: block;
                       text-transform: none;
                       @page { size: 10 5 }">
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            <br style="display: block; volume-break-after: always"/>
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="10" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="main">
            <block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
              <block/>
            </block>
          </sequence>
          <sequence master="main" break-before="volume">
            <block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_128">
    <x:documentation>
      Tests :top-of-page pseudo class.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="display: block;
                       text-transform: none;
                       @page { size: 10 5 }">
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            <pagenum style="display: block; &amp;:top-of-page { display: none; }">⠿</pagenum>
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
            <pagenum style="display: block; &amp;:top-of-page { display: none; }">⠿</pagenum>
            ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="main" duplex="true" page-width="10" page-height="5">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="main">
            <block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
              <block display-when="(! $starts-at-top-of-page)">⠿</block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
              <block display-when="(! $starts-at-top-of-page)">⠿</block>
              <block>
                ⠤⠤⠤⠤⠤ ⠤⠤⠤⠤⠤
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="5" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠿</row>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <x:scenario label="test_129">
    <x:documentation>
      Tests empty table of contents.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none;
                       @volume { @begin { content: flow(front, document); }}">
            <list style="display: -obfl-toc; flow: front"/>
            <h1 style="display: block">⠿⠿⠿</h1>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="master" duplex="true" page-width="40" page-height="25">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <table-of-contents name="toc">
            <toc-block/>
          </table-of-contents>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <toc-sequence master="master" range="document" toc="toc"/>
            </pre-content>
          </volume-template>
          <sequence master="master">
            <block>⠿⠿⠿</block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="40" rows="25" rowgap="0" duplex="true">
            <section>
                <page>
                    <row>⠿⠿⠿</row>
                </page>
            </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <x:scenario label="test_130">
    <x:documentation>
      Tests omitting of an empty table of contents entry.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <body style="text-transform: none;
                       @volume { @begin { content: flow(front, document); }}">
            <list style="display: -obfl-toc; flow: front">
              <li style="display: block"/>
              <li style="display: block">
                <a href="chapter" style="&amp;::after {
                                      text-transform: auto;
                                      content: ' ' target-counter(attr(href), page) }">⠿⠿⠿</a>
              </li>
            </list>
            <h1 id="chapter" style="display: block">⠿⠿⠿</h1>
          </body>
        </x:document>
      </x:input>
      <x:option name="text-transform" select="'(number-translator)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="master" duplex="true" page-width="40" page-height="25">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <table-of-contents name="toc">
            <toc-block>
              <toc-block/>
              <toc-block>
                <toc-entry ref-id="chapter">
                  ⠿⠿⠿
                  <span translate="">
                    <style name="">
                      <page-number ref-id="chapter" number-format="default"/>
                    </style>
                  </span>
                </toc-entry>
              </toc-block>
            </toc-block>
          </table-of-contents>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <toc-sequence master="master" range="document" toc="toc"/>
            </pre-content>
          </volume-template>
          <sequence master="master">
            <block>
              <block>
                <span id="chapter"/>
              </block>
              ⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="40" rows="25" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠀⠼⠁</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <x:scenario label="test_131">
    <x:documentation>
      Tests leader on a line with reduced width. It should work also if there is a soft wrap before
      the leader.

      See https://github.com/mtmse/dotify.formatter.impl/pull/37.
    </x:documentation>
      <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page {
                        size: 10 2;
                        @bottom-right { content: '⠉⠉⠉' }}">
            <p style="display: block">
              ⠤⠤⠤⠤⠤⠤⠤⠤ <span style="&amp;::before { content: leader('⠁') }">⠿⠿</span>
            </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="10" page-height="2" duplex="true">
            <default-template>
              <header/>
              <footer>
                <field allow-text-flow="true"/>
                <field>
                  <string value="⠉⠉⠉"/>
                </field>
              </footer>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              ⠤⠤⠤⠤⠤⠤⠤⠤ <leader pattern="⠁" position="100%" align="right"/>⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="2" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠁⠁⠁⠁⠁⠿⠿⠉⠉⠉</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <x:scenario label="test_132">
    <x:documentation>
      Tests keeping a leader together with the preceding word.

      Broken: see https://github.com/mtmse/dotify.formatter.impl/issues/41.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; @page { size: 10 5 }">
            <p style="display: block">
              ⠤⠤⠤ ⠤⠤⠤⠤<span style="&amp;::before { content: leader('⠁') }">⠿⠿⠿</span>
            </p>
            <p style="display: block">
              ⠤⠤⠤ ⠤⠤⠤⠤<span style="&amp;::before { content: leader('⠁') ' '}">⠿⠿⠿</span>
            </p>
            <p style="display: block">
              ⠤⠤⠤ ⠤⠤⠤<span style="&amp;::before { content: leader('⠁') ' ' }">⠿⠿⠿</span>
            </p>
            <p style="display: block">
              ⠤⠤⠤ ⠤⠤⠤ <span style="&amp;::before { content: leader('⠁') ' ' }">⠿⠿⠿</span>
            </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="10" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              ⠤⠤⠤ ⠤⠤⠤⠤<leader pattern="⠁" position="100%" align="right"/>⠿⠿⠿
            </block>
            <block>
              ⠤⠤⠤ ⠤⠤⠤⠤<leader pattern="⠁" position="100%" align="right"/> ⠿⠿⠿
            </block>
            <block>
              ⠤⠤⠤ ⠤⠤⠤<leader pattern="⠁" position="100%" align="right"/> ⠿⠿⠿
            </block>
            <block>
              ⠤⠤⠤ ⠤⠤⠤ <leader pattern="⠁" position="100%" align="right"/> ⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare"
              xfail="https://github.com/mtmse/dotify.formatter.impl/issues/41">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠁⠁⠁⠿⠿⠿</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤⠤⠁⠁⠀⠿⠿⠿</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤⠁⠁⠁⠀⠿⠿⠿</row>
                  <row>⠤⠤⠤</row>
                  <row>⠤⠤⠤⠀⠁⠁⠀⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <x:scenario label="test_133">
    <x:documentation>
      Tests -obfl-right-text-indent with leader and left aligned text.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none; @page { size: 10 5 }">
            <p style="display: block; -obfl-right-text-indent: 3; page-break-before: always">
              ⠤⠤⠤⠤⠤⠤⠤ <span style="&amp;::before { content: leader('⠁', 7, left) }">⠿⠿</span>
            </p>
            <p style="display: block; -obfl-right-text-indent: 3; page-break-before: always">
              ⠤⠤⠤⠤⠤⠤ <span style="&amp;::before { content: leader('⠁', 7, left) }">⠿⠿</span>
            </p>
            <p style="display: block; -obfl-right-text-indent: 3; page-break-before: always">
              ⠤⠤⠤⠤⠤ <span style="&amp;::before { content: leader('⠁', 7, left) }">⠿⠿</span>
            </p>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="body" page-width="10" page-height="5" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block break-before="page" right-text-indent="3">
              ⠤⠤⠤⠤⠤⠤⠤ <leader pattern="⠁" position="7" align="left"/>⠿⠿
            </block>
            <block break-before="page" right-text-indent="3">
              ⠤⠤⠤⠤⠤⠤ <leader pattern="⠁" position="7" align="left"/>⠿⠿
            </block>
            <block break-before="page" right-text-indent="3">
              ⠤⠤⠤⠤⠤ <leader pattern="⠁" position="7" align="left"/>⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠤</row>
                  <row>⠁⠁⠁⠁⠁⠁⠁⠿⠿</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠤⠀⠿⠿</row>
                </page>
                <page>
                  <row>⠤⠤⠤⠤⠤⠀⠁⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <x:scenario label="test_134">
    <x:documentation>
      Tests white-space:pre-line on -obfl-evaluate().
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      &amp;::before {
                        display: block;
                        white-space: pre-line;
                        content: -obfl-evaluate('&quot;⠤⠤⠤⠤⠤\A\A⠤⠤⠤⠤⠤&quot;') }"/>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="master" duplex="true" page-width="40" page-height="25">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="master">
            <block>
              <style name="white-space: pre-line">
                <evaluate expression="&quot;⠤⠤⠤⠤⠤&#xA;&#xA;⠤⠤⠤⠤⠤&quot;"/>
              </style>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="40" rows="25" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠤⠤</row>
                  <row/>
                  <row>⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_135">
    <x:documentation>
      Tests note in repeated table header.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline" xmlns="http://www.daisy.org/z3986/2005/dtbook/">
          <body style="text-transform: none;
                       @page {
                         size: 10 10;
                         @footnotes { content: flow(footnotes, page) }}">
            <table style="display: block;
                          render-table-by: row, column;
                          &amp;::table-by(row)::list-item {
                            display: block; }
                          &amp;::table-by(column)::list-item {
                            display: block; }">
              <tr>
                <th>⠛</th>
                <th><note style="flow: footnotes;
                               display: block;
                               &amp;::footnote-call { content: '⠶' }">⠤⠤⠤</note></th>
              </tr>
              <tr>
                <td>⠁⠁⠁</td>
                <td>⠄⠄⠄</td>
              </tr>
              <tr>
                <td>⠁⠁⠁</td>
                <td>⠄⠄⠄</td>
              </tr>
            </table>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="master" duplex="true" page-width="10" page-height="10">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="5" collection="footnotes"/>
          </layout-master>
          <collection name="footnotes">
            <item id="item">
              <block>⠤⠤⠤</block>
            </item>
          </collection>
          <sequence master="master">
            <block>
              <block>
                <block>⠛⠁⠁⠁</block>
                <block>⠶<anchor item="item"/>⠄⠄⠄</block>
              </block>
              <block>
                <block>⠛⠁⠁⠁</block>
                <block>⠶<anchor item="item"/>⠄⠄⠄</block>
              </block>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="10" rows="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠛⠁⠁⠁</row>
                  <row>⠶⠄⠄⠄</row>
                  <row>⠛⠁⠁⠁</row>
                  <row>⠶⠄⠄⠄</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>

  <x:scenario label="test_136">
    <x:documentation>
      Tests @text-transform rule.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @text-transform number {
                        system: braille-translator;
                        number-translator: true }">
            ⠤⠤⠤ <span style="text-transform: downshift number">1</span>
          </doc>
        </x:document>
      </x:input>
       <!--
           Trick to select UnityBrailleTranslator as main translator while still being able to
           select NumberBrailleTranslator using @text-transform. We can't do this with
           "(input:braille)".
       -->
      <x:option name="text-transform" select="'(document-locale:und-Brai)'"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
            <dp2:css-text-transform-definitions>
              @text-transform number {
                system: braille-translator;
                number-translator: true
              }
            </dp2:css-text-transform-definitions>
          </meta>
          <layout-master name="body" page-width="40" page-height="25" duplex="true">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="body">
            <block>
              <span translate="pre-translated-text-css">⠤⠤⠤ </span><style name="text-transform: downshift number">1</style>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="25" cols="40" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠤⠤⠤⠀⠂</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_137">
    <x:documentation>
      Tests @counter-style.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <ul style="text-transform: none;
                     list-style-type: dice;
                     @counter-style dice {
                       system: additive;
                       additive-symbols: 6 '⠿', 5 '⠻', 4 '⠛', 3 '⠙', 2 '⠉', 1 '⠈';
                       suffix: ' ';
                       text-transform: none; }
                     @page {
                       size: 15 5;
                       @top-right {
                         content: counter(page, dice); }}
                     @volume {
                       @begin {
                         content: flow(begin, document); }}
                     &amp;::before {
                       display: block;
                       flow: begin;
                       content: counter(volume, dice); }">
            <li style="display: list-item">⠤⠤⠤</li>
            <li style="display: list-item">⠤⠤⠤</li>
            <li style="display: list-item">⠤⠤⠤</li>
            <li style="display: list-item">⠤⠤⠤</li>
            <li style="display: list-item">⠤⠤⠤</li>
            <li style="display: list-item">⠤⠤⠤</li>
            <li style="display: list-item">⠤⠤⠤</li>
          </ul>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
            <dp2:css-counter-style-definitions>
              @counter-style dice {
                system: additive;
                additive-symbols: 6 '⠿', 5 '⠻', 4 '⠛', 3 '⠙', 2 '⠉', 1 '⠈';
                suffix: ' ';
                text-transform: none
              }
            </dp2:css-counter-style-definitions>
          </meta>
          <layout-master name="master" page-width="15" page-height="5" duplex="true">
            <default-template>
              <header>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <current-page number-format="default" text-style="text-transform: -dotify-counter; -dotify-counter-style: dice"/>
                </field>
              </header>
              <footer/>
            </default-template>
          </layout-master>
          <volume-template sheets-in-volume-max="1000">
            <pre-content>
              <sequence master="master">
                <block>
                  <style name="text-transform: -dotify-counter; -dotify-counter-style: dice">
                    <evaluate expression="$volume"/>
                  </style>
                </block>
              </sequence>
            </pre-content>
          </volume-template>
          <sequence master="master">
            <block>⠈ ⠤⠤⠤</block>
            <block>⠉ ⠤⠤⠤</block>
            <block>⠙ ⠤⠤⠤</block>
            <block>⠛ ⠤⠤⠤</block>
            <block>⠻ ⠤⠤⠤</block>
            <block>⠿ ⠤⠤⠤</block>
            <block>⠿⠈ ⠤⠤⠤</block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="5" cols="15" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈</row>
                  <row>⠈</row>
                </page>
              </section>
              <section>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈</row>
                  <row>⠈⠀⠤⠤⠤</row>
                  <row>⠉⠀⠤⠤⠤</row>
                  <row>⠙⠀⠤⠤⠤</row>
                  <row>⠛⠀⠤⠤⠤</row>
                </page>
                <page>
                  <row>⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉</row>
                  <row>⠻⠀⠤⠤⠤</row>
                  <row>⠿⠀⠤⠤⠤</row>
                  <row>⠿⠈⠀⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_138">
    <x:documentation>
      Tests that noterefs without content also generate anchors. Under certain conditions
      consecutive anchors collapse into one and the corresponding items are merged.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline" xmlns="http://www.daisy.org/z3986/2005/dtbook/">
          <body style="text-transform: none;
                       @page {
                         size: 20 10;
                         @footnotes { content: flow(footnotes, page) }}">
            <p>
              <a href="#note_1"
                 style="display: none
                        &amp;::alternate {
                          display: block;
                          flow: footnotes;
                          content: target-content(attr(href)); }"/>
              <a href="#note_2"
                 style="display: none;
                        &amp;::alternate {
                          display: block;
                          flow: footnotes;
                          content: target-content(attr(href)); }"/>
            </p>
            <a href="#note_3"
               style="display: none
                      &amp;::alternate {
                        display: block;
                        flow: footnotes;
                        content: target-content(attr(href)); }"/>
            <a href="#note_4"
               style="display: none;
                      &amp;::alternate {
                        display: block;
                        flow: footnotes;
                        content: target-content(attr(href)); }"/>
            <p style="display: block">
              ⠉⠉⠉
            </p>
            <aside id="note_1" style="display: none">
              ⠿⠿⠿
            </aside>
            <aside id="note_2" style="display: none">
              ⠿⠿⠿ ⠿⠿⠿
            </aside>
            <aside id="note_3" style="display: none">
              ⠿⠿⠿ ⠿⠿⠿ ⠿⠿⠿
            </aside>
            <aside id="note_4" style="display: none">
              ⠿⠿⠿ ⠿⠿⠿ ⠿⠿⠿ ⠿⠿⠿
            </aside>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="master" duplex="true" page-width="20" page-height="10">
            <default-template>
              <header/>
              <footer/>
            </default-template>
            <page-area align="bottom" max-height="5" collection="footnotes"/>
          </layout-master>
          <collection name="footnotes">
            <item id="item_1">
              <block translate="pre-translated-text-css">
                ⠿⠿⠿
              </block>
            </item>
            <item id="item_2">
              <block translate="pre-translated-text-css">
                ⠿⠿⠿ ⠿⠿⠿
              </block>
            </item>
            <item id="item_3">
              <block translate="pre-translated-text-css">
                ⠿⠿⠿ ⠿⠿⠿ ⠿⠿⠿
              </block>
              <block translate="pre-translated-text-css">
                ⠿⠿⠿ ⠿⠿⠿ ⠿⠿⠿ ⠿⠿⠿
              </block>
            </item>
          </collection>
          <sequence master="master">
            <block>
              <anchor item="item_1"/>
              <anchor item="item_2"/>
              <anchor item="item_3"/>
            </block>
            <block translate="pre-translated-text-css">
              ⠉⠉⠉
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="20" rows="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠉⠉⠉</row>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row/>
                  <row>⠿⠿⠿</row>
                  <row>⠿⠿⠿⠀⠿⠿⠿</row>
                  <row>⠿⠿⠿⠀⠿⠿⠿⠀⠿⠿⠿</row>
                  <row>⠿⠿⠿⠀⠿⠿⠿⠀⠿⠿⠿⠀⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_139">
    <x:documentation>
      Tests "braille-charset" option.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline" xmlns="http://www.daisy.org/z3986/2005/dtbook/">
          <body style="text-transform: none">
            <p style="display: block;
                      border-top-pattern: ⠉;
                      border-bottom-pattern: ⠤;
                      &amp;::before {
                        content: leader('⠄') '⠀'; }">⠿⠿⠿</p>
          </body>
        </x:document>
      </x:input>
      <x:option name="braille-charset" select="resolve-uri('../resources/braille-charset.dis')"/>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="master" duplex="true" page-width="40" page-height="25">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="master">
            <block border-top-style="solid" border-top-align="outer"
                   border-bottom-style="solid" border-bottom-align="outer">
              <leader pattern="." position="100%" align="right"/>⠀<style name="braille-charset: unicode">⠿⠿⠿</style>
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="40" rows="25" rowgap="0" duplex="true">
              <section>
                <page>
                  <row dp2:ascii="‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾">⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉</row>
                  <row dp2:ascii=".................................... XXX">⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠀⠿⠿⠿</row>
                  <row dp2:ascii="________________________________________">⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_140">
    <x:documentation>
      Tests "hyphenate-character" property.
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline" xmlns="http://www.daisy.org/z3986/2005/dtbook/">
          <body style="text-transform: none;
                       @page { size: 5 10 }">
            <p style="display: block">
              ⠿⠿⠿­⠿⠿⠿
              ⠿⠿⠿­⠿⠿⠿
              <span style="hyphenate-character: '⠈'">⠿⠿⠿­⠿⠿⠿</span>
              ⠿⠿⠿­⠿⠿⠿
              ⠿⠿⠿­⠿⠿⠿
            </p>
          </body>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="master" duplex="true" page-width="5" page-height="10">
            <default-template>
              <header/>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="master">
            <block>
              ⠿⠿⠿­⠿⠿⠿
              ⠿⠿⠿­⠿⠿⠿
              <style name="hyphenate-character: '⠈'">⠿⠿⠿­⠿⠿⠿</style>
              ⠿⠿⠿­⠿⠿⠿
              ⠿⠿⠿­⠿⠿⠿
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head>
            <meta xmlns:dc="http://purl.org/dc/elements/1.1/">
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume cols="5" rows="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠤</row>
                  <row>⠿⠿⠿</row>
                  <row>⠿⠿⠿⠤</row>
                  <row>⠿⠿⠿</row>
                  <row>⠿⠿⠿⠈</row>
                  <row>⠿⠿⠿</row>
                  <row>⠿⠿⠿⠤</row>
                  <row>⠿⠿⠿</row>
                  <row>⠿⠿⠿⠤</row>
                  <row>⠿⠿⠿</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
  <x:scenario label="test_142">
    <x:documentation>
      Tests that content in top margin is trimmed when needed. (Note that if
      allow-text-overflow-trimming is set to false, this would result in an error.)
    </x:documentation>
    <x:call step="dotify:format">
      <x:input port="source">
        <x:document type="inline">
          <doc style="text-transform: none;
                      @page {
                        size: 10 10;
                        margin-top: 1;
                        @top-center { content: '⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿'; text-transform: none } }">
            <body>
              <p style="display:block">⠤⠤⠤</p>
            </body>
          </doc>
        </x:document>
      </x:input>
    </x:call>
    <x:context label="obfl">
      <x:document type="port" port="obfl"/>
    </x:context>
    <x:expect label="obfl" type="custom" href="http://www.daisy.org/pipeline/modules/braille/obfl-utils/library.xpl" step="x:obfl-compare">
      <x:document type="inline">
        <obfl xmlns="http://www.daisy.org/ns/2011/obfl" version="2011-1" xml:lang="und" hyphenate="false" translate="pre-translated-text-css">
          <meta xmlns:dp2="http://www.daisy.org/ns/pipeline/">
            <dp2:style-type>text/css</dp2:style-type>
          </meta>
          <layout-master name="a" page-width="10" page-height="10" duplex="true">
            <default-template>
              <header>
                <field>
                  <string value=""/>
                </field>
                <field>
                  <string value="⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿" text-style="text-transform:none"/>
                </field>
                <field>
                  <string value=""/>
                </field>
              </header>
              <footer/>
            </default-template>
          </layout-master>
          <sequence master="a">
            <block>
              ⠤⠤⠤
            </block>
          </sequence>
        </obfl>
      </x:document>
    </x:expect>
    <x:context label="pef">
      <x:document type="port" port="result"/>
    </x:context>
    <x:expect label="pef" type="custom" href="http://www.daisy.org/pipeline/modules/braille/pef-utils/library.xpl" step="x:pef-compare">
      <x:document type="inline">
        <pef xmlns="http://www.daisy.org/ns/2008/pef" version="2008-1">
          <head xmlns:dc="http://purl.org/dc/elements/1.1/">
            <meta>
              <dc:format>application/x-pef+xml</dc:format>
            </meta>
          </head>
          <body>
            <volume rows="10" cols="10" rowgap="0" duplex="true">
              <section>
                <page>
                  <row>⠿⠿⠿⠿⠿⠿⠿⠿⠿⠿</row>
                  <row>⠤⠤⠤</row>
                </page>
              </section>
            </volume>
          </body>
        </pef>
      </x:document>
    </x:expect>
  </x:scenario>
  
</x:description>
