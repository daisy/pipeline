<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html vocab="http://www.daisy.org/ns/pipeline/" typeof="source">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta charset="utf-8">
<meta http-equiv="content-language" content="en">
<link rel="stylesheet" type="text/css" href="/pipeline/css/nxml-mode.css">
<link rel="shortcut icon" href="http://www.daisy.org/sites/default/files/favicon_0.ico">
<link rev="doc" href="../obfl-css-definition.xsl">
</head>
<body><div class="code" about="../obfl-css-definition.xsl">&lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">stylesheet</span> <span class="code-xml-attribute-prefix">xmlns:</span><span class="code-xml-attribute-local-name">xsl</span>=<span class="code-xml-attribute-value">"http://www.w3.org/1999/XSL/Transform"</span> <span class="code-xml-attribute-prefix">xmlns:</span><span class="code-xml-attribute-local-name">xs</span>=<span class="code-xml-attribute-value">"http://www.w3.org/2001/XMLSchema"</span> <span class="code-xml-attribute-prefix">xmlns:</span><span class="code-xml-attribute-local-name">new</span>=<span class="code-xml-attribute-value">"css:new-definition"</span> <span class="code-xml-attribute-prefix">xmlns:</span><span class="code-xml-attribute-local-name">css</span>=<span class="code-xml-attribute-value">"http://www.daisy.org/ns/pipeline/braille-css"</span> <span class="code-xml-attribute-prefix">xmlns:</span><span class="code-xml-attribute-local-name">re</span>=<span class="code-xml-attribute-value">"regex-utils"</span> <span class="code-xml-attribute-local-name">version</span>=<span class="code-xml-attribute-value">"2.0"</span>&gt;
    
    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"initial-braille-charset"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"'unicode'"</span>/&gt;

    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"new:properties"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string*"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"('margin-left',           'page-break-before', 'text-indent', 'text-transform',      '-obfl-vertical-align',                            'margin-right',          'page-break-after',  'text-align',  'braille-charset',     '-obfl-vertical-position',                            'margin-top',            'page-break-inside', 'line-height', 'hyphens',             '-obfl-toc-range',                            'margin-bottom',         'orphans',                          'hyphenate-character',                            'padding-left',          'widows',                           'white-space',         '-obfl-table-col-spacing',                            'padding-right',         'volume-break-before',              'word-spacing',        '-obfl-table-row-spacing',                            'padding-top',           'volume-break-after',               'letter-spacing',      '-obfl-preferred-empty-space',                            'padding-bottom',        'volume-break-inside',                                     '-obfl-use-when-collection-not-empty',                            'border-left-pattern',   'border-left-style',                                       '-obfl-underline',                            'border-right-pattern',  'border-right-style',                                      '-obfl-keep-with-previous-sheets',                            'border-top-pattern',    'border-top-style',                                        '-obfl-keep-with-next-sheets',                            'border-bottom-pattern', 'border-bottom-style',                                     '-obfl-scenario-cost',                                                                                                                '-obfl-right-text-indent'                            )"</span>/&gt;
    
    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"_OBFL_KEEP_FN_RE"</span>&gt;-obfl-keep\(\s*[1-9]\s*\)&lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span>&gt;
    
    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">function</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"new:is-valid"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:boolean"</span>&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"css:property"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"element()"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"context"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"element()"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"valid"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:boolean"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"new:applies-to($css:property/@name, $context)                               and (                                 if ($css:property/@name='-obfl-vertical-align')                                 then $css:property/@value=('before','center','after')                                 else if ($css:property/@name=('-obfl-vertical-position',                                                               '-obfl-table-col-spacing',                                                               '-obfl-table-row-spacing',                                                               '-obfl-preferred-empty-space'))                                 then matches($css:property/@value,'^auto|0|[1-9][0-9]*$')                                 else if ($css:property/@name='-obfl-toc-range')                                 then ($context/@css:_obfl-toc and $css:property/@value=('document','volume'))                                 else if ($css:property/@name='-obfl-use-when-collection-not-empty')                                 then matches($css:property/@value,re:exact($css:IDENT_RE))                                 else if ($css:property/@name='-obfl-underline')                                 then matches($css:property/@value,re:exact(re:or(($css:BRAILLE_CHAR_RE,'none'))))                                 else if ($css:property/@name=('-obfl-keep-with-previous-sheets',                                                               '-obfl-keep-with-next-sheets'))                                 then matches($css:property/@value,'^[0-9]$')                                 else if ($css:property/@name='volume-break-inside')                                 then matches($css:property/@value,re:exact(re:or(('auto',$_OBFL_KEEP_FN_RE))))                                 else if ($css:property/@name='-obfl-scenario-cost')                                 then matches($css:property/@value,re:exact(re:or(('none',$css:INTEGER_RE,$css:VENDOR_PRF_FN_RE))))                                 else if ($css:property/@name=('volume-break-after',                                                               'volume-break-before'))                                 then $css:property/@value=('auto','always')                                 else (                                   css:is-valid($css:property)                                   and not($css:property/@value=('inherit','initial'))                                 )                               )"</span>/&gt;
        
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">if</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"not($valid)                       and not($css:property/@value=('inherit','initial'))                       and not(css:is-inherited($css:property/@name))"</span>&gt;
            &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">message</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"concat($css:property/@name,': ',$css:property/@value,' not supported (display: ',$context/@type,')')"</span>/&gt;
        &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">if</span>&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"$valid"</span>/&gt;
    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">function</span>&gt;
    
    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">function</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"new:initial-value"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string"</span>&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"property"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"context"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"element()"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"if ($property='-obfl-vertical-align')                               then 'after'                               else if ($property='-obfl-vertical-position')                               then 'auto'                               else if ($property='-obfl-toc-range')                               then 'document'                               else if ($property=('-obfl-table-col-spacing','-obfl-table-row-spacing'))                               then '0'                               else if ($property='-obfl-preferred-empty-space')                               then '2'                               else if ($property='-obfl-use-when-collection-not-empty')                               then 'normal'                               else if ($property='-obfl-underline')                               then 'none'                               else if ($property=('-obfl-keep-with-previous-sheets','-obfl-keep-with-next-sheets'))                               then '0'                               else if ($property='-obfl-scenario-cost')                               then 'none'                               else if ($property='braille-charset')                               then $initial-braille-charset                               else css:initial-value($property)"</span>/&gt;
    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">function</span>&gt;
    
    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">function</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"new:is-inherited"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:boolean"</span>&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"property"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"context"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"element()"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"$property=('text-transform','hyphens','word-spacing')"</span>/&gt;
    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">function</span>&gt;
    
    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">function</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"new:applies-to"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:boolean"</span>&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"property"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"context"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"element()"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"$property=('text-transform','braille-charset','hyphens','hyphenate-character','word-spacing')                               or (                                 if (matches($property,'^(border|margin|padding)-'))                                 then $context/@type=('block','table','table-cell')                                 else if ($property='line-height')                                 then $context/@type=('block','table')                                 else if ($property=('text-indent','text-align'))                                 then $context/@type=('block','table-cell')                                 else if ($property=('-obfl-table-col-spacing',                                                     '-obfl-table-row-spacing',                                                     '-obfl-preferred-empty-space'))                                 then $context/@type='table'                                 else if ($property='-obfl-use-when-collection-not-empty')                                 then exists($context/parent::css:_[@css:flow])                                 else $context/@type='block'                               )"</span>/&gt;
    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">function</span>&gt;
    
&lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">stylesheet</span>&gt;</div></body>
</html>
