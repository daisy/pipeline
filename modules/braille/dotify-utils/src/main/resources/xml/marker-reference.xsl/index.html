<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html vocab="http://www.daisy.org/ns/pipeline/" typeof="source">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta charset="utf-8">
<meta http-equiv="content-language" content="en">
<link rel="stylesheet" type="text/css" href="/pipeline/css/nxml-mode.css">
<link rel="shortcut icon" href="http://www.daisy.org/sites/default/files/favicon_0.ico">
<link rev="doc" href="../marker-reference.xsl">
</head>
<body><div class="code" about="../marker-reference.xsl">&lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">stylesheet</span> <span class="code-xml-attribute-prefix">xmlns:</span><span class="code-xml-attribute-local-name">xsl</span>=<span class="code-xml-attribute-value">"http://www.w3.org/1999/XSL/Transform"</span> <span class="code-xml-attribute-prefix">xmlns:</span><span class="code-xml-attribute-local-name">xs</span>=<span class="code-xml-attribute-value">"http://www.w3.org/2001/XMLSchema"</span> <span class="code-xml-attribute-prefix">xmlns:</span><span class="code-xml-attribute-local-name">css</span>=<span class="code-xml-attribute-value">"http://www.daisy.org/ns/pipeline/braille-css"</span> <span class="code-xml-attribute-prefix">xmlns:</span><span class="code-xml-attribute-local-name">pf</span>=<span class="code-xml-attribute-value">"http://www.daisy.org/ns/pipeline/functions"</span> <span class="code-xml-attribute-prefix">xmlns:</span><span class="code-xml-attribute-local-name">obfl</span>=<span class="code-xml-attribute-value">"http://www.daisy.org/ns/2011/obfl"</span> <span class="code-xml-attribute-prefix">xmlns</span>=<span class="code-xml-attribute-value">"http://www.daisy.org/ns/2011/obfl"</span> <span class="code-xml-attribute-local-name">version</span>=<span class="code-xml-attribute-value">"2.0"</span> <span class="code-xml-attribute-local-name">exclude-result-prefixes</span>=<span class="code-xml-attribute-value">"#all"</span>&gt;

    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">template</span> <span class="code-xml-attribute-local-name">match</span>=<span class="code-xml-attribute-value">"css:string[@name][not(@target)]"</span> <span class="code-xml-attribute-local-name">mode</span>=<span class="code-xml-attribute-value">"marker-reference"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"element()"</span>&gt; 
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"white-space"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string?"</span> <span class="code-xml-attribute-local-name">tunnel</span>=<span class="code-xml-attribute-value">"yes"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"()"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"text-transform"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string"</span> <span class="code-xml-attribute-local-name">tunnel</span>=<span class="code-xml-attribute-value">"yes"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"'auto'"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"page-side"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string"</span> <span class="code-xml-attribute-local-name">tunnel</span>=<span class="code-xml-attribute-value">"yes"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"'both'"</span>/&gt; 
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"allow-style-element"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:boolean"</span> <span class="code-xml-attribute-local-name">tunnel</span>=<span class="code-xml-attribute-value">"yes"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"false()"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"scope"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"(@scope,'first')[1]"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"marker-reference"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"element()"</span>&gt; 
            &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">choose</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$scope=('first','page-first')"</span>&gt;
                    &lt;<span class="code-xml-element-local-name">compound-marker-reference</span>&gt;
                        &lt;<span class="code-xml-element-local-name">marker-reference</span> <span class="code-xml-attribute-local-name">marker</span>=<span class="code-xml-attribute-value">"{@name}"</span> <span class="code-xml-attribute-local-name">direction</span>=<span class="code-xml-attribute-value">"forward"</span> <span class="code-xml-attribute-local-name">scope</span>=<span class="code-xml-attribute-value">"page"</span>/&gt;
                        &lt;<span class="code-xml-element-local-name">marker-reference</span> <span class="code-xml-attribute-local-name">marker</span>=<span class="code-xml-attribute-value">"{@name}"</span> <span class="code-xml-attribute-local-name">direction</span>=<span class="code-xml-attribute-value">"backward"</span> <span class="code-xml-attribute-local-name">scope</span>=<span class="code-xml-attribute-value">"document"</span>/&gt;
                    &lt;/<span class="code-xml-element-local-name">compound-marker-reference</span>&gt;
                &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$scope=('start','page-start')"</span>&gt;
                    &lt;<span class="code-xml-element-local-name">compound-marker-reference</span>&gt;
                        
                        &lt;<span class="code-xml-element-local-name">marker-reference</span> <span class="code-xml-attribute-local-name">marker</span>=<span class="code-xml-attribute-value">"{@name}/prev"</span> <span class="code-xml-attribute-local-name">direction</span>=<span class="code-xml-attribute-value">"forward"</span> <span class="code-xml-attribute-local-name">scope</span>=<span class="code-xml-attribute-value">"page-content"</span>/&gt;
                        
                        &lt;<span class="code-xml-element-local-name">marker-reference</span> <span class="code-xml-attribute-local-name">marker</span>=<span class="code-xml-attribute-value">"{@name}"</span> <span class="code-xml-attribute-local-name">direction</span>=<span class="code-xml-attribute-value">"backward"</span> <span class="code-xml-attribute-local-name">scope</span>=<span class="code-xml-attribute-value">"document"</span>/&gt;
                    &lt;/<span class="code-xml-element-local-name">compound-marker-reference</span>&gt;
                &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$scope=('start-except-last','page-start-except-last')"</span>&gt;
                    
                    &lt;<span class="code-xml-element-local-name">marker-reference</span> <span class="code-xml-attribute-local-name">marker</span>=<span class="code-xml-attribute-value">"{@name}/prev"</span> <span class="code-xml-attribute-local-name">direction</span>=<span class="code-xml-attribute-value">"forward"</span> <span class="code-xml-attribute-local-name">scope</span>=<span class="code-xml-attribute-value">"page-content"</span>/&gt;
                &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span>&gt;
                
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$scope=('start-except-first','page-start-except-first','volume-start-except-first')"</span>&gt;
                    &lt;<span class="code-xml-element-local-name">compound-marker-reference</span>&gt;
                        &lt;<span class="code-xml-element-local-name">marker-reference</span> <span class="code-xml-attribute-local-name">marker</span>=<span class="code-xml-attribute-value">"{@name}/if-not-set-next/prev"</span> <span class="code-xml-attribute-local-name">direction</span>=<span class="code-xml-attribute-value">"forward"</span> <span class="code-xml-attribute-local-name">scope</span>=<span class="code-xml-attribute-value">"page-content"</span>/&gt;
                        &lt;<span class="code-xml-element-local-name">marker-reference</span> <span class="code-xml-attribute-local-name">marker</span>=<span class="code-xml-attribute-value">"{@name}/if-not-set-next"</span> <span class="code-xml-attribute-local-name">direction</span>=<span class="code-xml-attribute-value">"backward"</span> <span class="code-xml-attribute-local-name">scope</span>=<span class="code-xml-attribute-value">"document"</span> <span class="code-xml-attribute-local-name">offset</span>=<span class="code-xml-attribute-value">"-1"</span>/&gt;
                    &lt;/<span class="code-xml-element-local-name">compound-marker-reference</span>&gt;
                &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$scope=('last','page-last')"</span>&gt;
                    &lt;<span class="code-xml-element-local-name">marker-reference</span> <span class="code-xml-attribute-local-name">marker</span>=<span class="code-xml-attribute-value">"{@name}"</span> <span class="code-xml-attribute-local-name">direction</span>=<span class="code-xml-attribute-value">"backward"</span> <span class="code-xml-attribute-local-name">scope</span>=<span class="code-xml-attribute-value">"document"</span>/&gt;
                &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$scope=('last-except-start','page-last-except-start')"</span>&gt;
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">message</span> <span class="code-xml-attribute-local-name">terminate</span>=<span class="code-xml-attribute-value">"yes"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"concat('string(',@name,', ',$scope,') currently not supported. If you want to use it in combination with string(start), please consider using the combination start-except-last/last instead.')"</span>/&gt;
                &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$scope='spread-first'"</span>&gt;
                    &lt;<span class="code-xml-element-local-name">compound-marker-reference</span>&gt;
                        &lt;<span class="code-xml-element-local-name">marker-reference</span> <span class="code-xml-attribute-local-name">marker</span>=<span class="code-xml-attribute-value">"{@name}"</span> <span class="code-xml-attribute-local-name">direction</span>=<span class="code-xml-attribute-value">"forward"</span> <span class="code-xml-attribute-local-name">scope</span>=<span class="code-xml-attribute-value">"spread"</span>&gt;
                            &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">if</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$page-side='right'"</span>&gt;
                                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">attribute</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"start-offset"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"'-1'"</span>/&gt;
                            &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">if</span>&gt;
                        &lt;/<span class="code-xml-element-local-name">marker-reference</span>&gt;
                        &lt;<span class="code-xml-element-local-name">marker-reference</span> <span class="code-xml-attribute-local-name">marker</span>=<span class="code-xml-attribute-value">"{@name}"</span> <span class="code-xml-attribute-local-name">direction</span>=<span class="code-xml-attribute-value">"backward"</span> <span class="code-xml-attribute-local-name">scope</span>=<span class="code-xml-attribute-value">"document"</span>&gt;
                            &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">if</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$page-side='right'"</span>&gt;
                                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">attribute</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"start-offset"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"'-1'"</span>/&gt;
                            &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">if</span>&gt;
                        &lt;/<span class="code-xml-element-local-name">marker-reference</span>&gt;
                    &lt;/<span class="code-xml-element-local-name">compound-marker-reference</span>&gt;
                &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$scope='spread-start'"</span>&gt;
                    &lt;<span class="code-xml-element-local-name">compound-marker-reference</span>&gt;
                        
                        &lt;<span class="code-xml-element-local-name">marker-reference</span> <span class="code-xml-attribute-local-name">marker</span>=<span class="code-xml-attribute-value">"{@name}/prev"</span> <span class="code-xml-attribute-local-name">direction</span>=<span class="code-xml-attribute-value">"forward"</span> <span class="code-xml-attribute-local-name">scope</span>=<span class="code-xml-attribute-value">"spread-content"</span>&gt;
                            &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">if</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$page-side='right'"</span>&gt;
                                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">attribute</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"start-offset"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"'-1'"</span>/&gt;
                            &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">if</span>&gt;
                        &lt;/<span class="code-xml-element-local-name">marker-reference</span>&gt;
                        
                        &lt;<span class="code-xml-element-local-name">marker-reference</span> <span class="code-xml-attribute-local-name">marker</span>=<span class="code-xml-attribute-value">"{@name}"</span> <span class="code-xml-attribute-local-name">direction</span>=<span class="code-xml-attribute-value">"backward"</span> <span class="code-xml-attribute-local-name">scope</span>=<span class="code-xml-attribute-value">"document"</span>&gt;
                            &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">if</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$page-side='left'"</span>&gt;
                                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">attribute</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"start-offset"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"'1'"</span>/&gt;
                            &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">if</span>&gt;
                        &lt;/<span class="code-xml-element-local-name">marker-reference</span>&gt;
                    &lt;/<span class="code-xml-element-local-name">compound-marker-reference</span>&gt;
                &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$scope='spread-start-except-last'"</span>&gt;
                    
                    &lt;<span class="code-xml-element-local-name">marker-reference</span> <span class="code-xml-attribute-local-name">marker</span>=<span class="code-xml-attribute-value">"{@name}/prev"</span> <span class="code-xml-attribute-local-name">direction</span>=<span class="code-xml-attribute-value">"forward"</span> <span class="code-xml-attribute-local-name">scope</span>=<span class="code-xml-attribute-value">"spread-content"</span>&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">if</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$page-side='right'"</span>&gt;
                            &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">attribute</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"start-offset"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"'-1'"</span>/&gt;
                        &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">if</span>&gt;
                    &lt;/<span class="code-xml-element-local-name">marker-reference</span>&gt;
                &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$scope='spread-last'"</span>&gt;
                    &lt;<span class="code-xml-element-local-name">marker-reference</span> <span class="code-xml-attribute-local-name">marker</span>=<span class="code-xml-attribute-value">"{@name}"</span> <span class="code-xml-attribute-local-name">direction</span>=<span class="code-xml-attribute-value">"backward"</span> <span class="code-xml-attribute-local-name">scope</span>=<span class="code-xml-attribute-value">"document"</span>&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">if</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$page-side='left'"</span>&gt;
                            &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">attribute</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"start-offset"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"'1'"</span>/&gt;
                        &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">if</span>&gt;
                    &lt;/<span class="code-xml-element-local-name">marker-reference</span>&gt;
                &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$scope='spread-last-except-start'"</span>&gt;
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">message</span> <span class="code-xml-attribute-local-name">terminate</span>=<span class="code-xml-attribute-value">"yes"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"concat('string(',@name,', ',$scope,') currently not supported. If you want to use it in combination with string(start), please consider using the combination start-except-last/last instead.')"</span>/&gt;
                &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">otherwise</span>&gt;
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">call-template</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"pf:error"</span>&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">with-param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"msg"</span>&gt;in function string({}, {}): unknown keyword "{}"&lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">with-param</span>&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">with-param</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"args"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"(@name,                                                             $scope)"</span>/&gt;
                    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">call-template</span>&gt;
                &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">otherwise</span>&gt;
            &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">choose</span>&gt;
        &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span>&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"text-style"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string*"</span>&gt;
            &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">if</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"not($text-transform=('none','auto'))"</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"concat('text-transform: ',$text-transform)"</span>/&gt;
            &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">if</span>&gt;
            &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">if</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$white-space[not(.='normal')]"</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"concat('white-space: ',$white-space)"</span>/&gt;
            &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">if</span>&gt;
        &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span>&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"text-style"</span> <span class="code-xml-attribute-local-name">as</span>=<span class="code-xml-attribute-value">"xs:string?"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"string-join($text-style,'; ')[not(.='')]"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">for-each</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"$marker-reference"</span>&gt;
            &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">choose</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"not(exists($text-style))"</span>&gt;
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"."</span>/&gt;
                &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"$allow-style-element"</span>&gt;
                    &lt;<span class="code-xml-element-local-name">style</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"{$text-style}"</span>&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"."</span>/&gt;
                    &lt;/<span class="code-xml-element-local-name">style</span>&gt;
                &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span> <span class="code-xml-attribute-local-name">test</span>=<span class="code-xml-attribute-value">"self::obfl:marker-reference"</span>&gt;
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">copy</span>&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"@*"</span>/&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">attribute</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"text-style"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"$text-style"</span>/&gt;
                    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">copy</span>&gt;
                &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">when</span>&gt;
                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">otherwise</span>&gt; 
                    &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">copy</span>&gt;
                        &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">for-each</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"*"</span>&gt;
                            &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">copy</span>&gt;
                                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">sequence</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"@*"</span>/&gt;
                                &lt;<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">attribute</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"text-style"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"$text-style"</span>/&gt;
                            &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">copy</span>&gt;
                        &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">for-each</span>&gt;
                    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">copy</span>&gt;
                &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">otherwise</span>&gt;
            &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">choose</span>&gt;
        &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">for-each</span>&gt;
    &lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">template</span>&gt;

&lt;/<span class="code-xml-element-prefix">xsl:</span><span class="code-xml-element-local-name">stylesheet</span>&gt;</div></body>
</html>
