<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html vocab="http://www.daisy.org/ns/pipeline/" typeof="source">
<head><link rev="doc" href="../resolve-links.create-mapping.xpl"></head>
<body><div class="code" about="../resolve-links.create-mapping.xpl">&lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">declare-step</span> <span class="code-xml-attribute-local-name">type</span>=<span class="code-xml-attribute-value">"pxi:daisy202-to-epub3-resolve-links-create-mapping"</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"resolve-links-create-mapping"</span> <span class="code-xml-attribute-local-name">version</span>=<span class="code-xml-attribute-value">"1.0"</span>&gt;

    &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">documentation</span>&gt;
        &lt;<span class="code-xml-element-local-name">h1</span> <span class="code-xml-attribute-prefix">px:</span><span class="code-xml-attribute-local-name">role</span>=<span class="code-xml-attribute-value">"desc"</span>&gt;Creates a reusable mapping for pxi:daisy202-to-epub3-resolve-links&lt;/<span class="code-xml-element-local-name">h1</span>&gt;
    &lt;/<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">documentation</span>&gt;

    &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">input</span> <span class="code-xml-attribute-local-name">port</span>=<span class="code-xml-attribute-value">"daisy-smil"</span> <span class="code-xml-attribute-local-name">sequence</span>=<span class="code-xml-attribute-value">"true"</span> <span class="code-xml-attribute-local-name">primary</span>=<span class="code-xml-attribute-value">"true"</span>&gt;
        &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">documentation</span>&gt;
            &lt;<span class="code-xml-element-local-name">p</span> <span class="code-xml-attribute-prefix">px:</span><span class="code-xml-attribute-local-name">role</span>=<span class="code-xml-attribute-value">"desc"</span>&gt;The DAISY 2.02 SMIL documents.&lt;/<span class="code-xml-element-local-name">p</span>&gt;
            &lt;<span class="code-xml-element-local-name">pre</span>&gt;&lt;<span class="code-xml-element-local-name">code</span> <span class="code-xml-attribute-local-name">class</span>=<span class="code-xml-attribute-value">"example"</span>&gt;
                &lt;<span class="code-xml-element-local-name">smil</span> <span class="code-xml-attribute-prefix">xml:</span><span class="code-xml-attribute-local-name">base</span>=<span class="code-xml-attribute-value">"file:/home/user/daisy202/a.smil"</span>&gt;
                    &lt;<span class="code-xml-element-local-name">head</span>&gt;...&lt;/<span class="code-xml-element-local-name">head</span>&gt;
                    &lt;<span class="code-xml-element-local-name">seq</span> <span class="code-xml-attribute-local-name">dur</span>=<span class="code-xml-attribute-value">"10s"</span>&gt;
                        &lt;<span class="code-xml-element-local-name">par</span> <span class="code-xml-attribute-local-name">endsync</span>=<span class="code-xml-attribute-value">"last"</span>&gt;
                            &lt;<span class="code-xml-element-local-name">text</span> <span class="code-xml-attribute-local-name">id</span>=<span class="code-xml-attribute-value">"fragment"</span> <span class="code-xml-attribute-local-name">src</span>=<span class="code-xml-attribute-value">"a.html#id"</span>/&gt;
                        &lt;/<span class="code-xml-element-local-name">par</span>&gt;
                    &lt;/<span class="code-xml-element-local-name">seq</span>&gt;
                &lt;/<span class="code-xml-element-local-name">smil</span>&gt;
                &lt;<span class="code-xml-element-local-name">smil</span> <span class="code-xml-attribute-prefix">xml:</span><span class="code-xml-attribute-local-name">base</span>=<span class="code-xml-attribute-value">"file:/home/user/daisy202/b.smil"</span>&gt;...&lt;/<span class="code-xml-element-local-name">smil</span>&gt;
                &lt;<span class="code-xml-element-local-name">smil</span> <span class="code-xml-attribute-prefix">xml:</span><span class="code-xml-attribute-local-name">base</span>=<span class="code-xml-attribute-value">"file:/home/user/daisy202/c.smil"</span>&gt;...&lt;/<span class="code-xml-element-local-name">smil</span>&gt;
            &lt;/<span class="code-xml-element-local-name">code</span>&gt;&lt;/<span class="code-xml-element-local-name">pre</span>&gt;
        &lt;/<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">documentation</span>&gt;
    &lt;/<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">input</span>&gt;

    &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">output</span> <span class="code-xml-attribute-local-name">port</span>=<span class="code-xml-attribute-value">"result"</span>&gt;
        &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">documentation</span>&gt;
            &lt;<span class="code-xml-element-local-name">p</span> <span class="code-xml-attribute-prefix">px:</span><span class="code-xml-attribute-local-name">role</span>=<span class="code-xml-attribute-value">"desc"</span>&gt;A map of all the links in the SMIL files.&lt;/<span class="code-xml-element-local-name">p</span>&gt;
            &lt;<span class="code-xml-element-local-name">pre</span>&gt;&lt;<span class="code-xml-element-local-name">code</span> <span class="code-xml-attribute-local-name">class</span>=<span class="code-xml-attribute-value">"example"</span>&gt;
                &lt;<span class="code-xml-element-prefix">di:</span><span class="code-xml-element-local-name">mapping</span>&gt;
                    &lt;<span class="code-xml-element-prefix">di:</span><span class="code-xml-element-local-name">smil</span> <span class="code-xml-attribute-prefix">xml:</span><span class="code-xml-attribute-local-name">base</span>=<span class="code-xml-attribute-value">"file:/home/user/a.smil"</span>&gt;
                        &lt;<span class="code-xml-element-prefix">di:</span><span class="code-xml-element-local-name">text</span> <span class="code-xml-attribute-local-name">par-id</span>=<span class="code-xml-attribute-value">"fragment1"</span> <span class="code-xml-attribute-local-name">text-id</span>=<span class="code-xml-attribute-value">"frg1"</span> <span class="code-xml-attribute-local-name">src</span>=<span class="code-xml-attribute-value">"a.html#txt1"</span>/&gt;
                        &lt;<span class="code-xml-element-prefix">di:</span><span class="code-xml-element-local-name">text</span> <span class="code-xml-attribute-local-name">par-id</span>=<span class="code-xml-attribute-value">"fragment2"</span> <span class="code-xml-attribute-local-name">text-id</span>=<span class="code-xml-attribute-value">"frg2"</span> <span class="code-xml-attribute-local-name">src</span>=<span class="code-xml-attribute-value">"a.html#txt2"</span>/&gt;
                    &lt;/<span class="code-xml-element-prefix">di:</span><span class="code-xml-element-local-name">smil</span>&gt;
                    &lt;<span class="code-xml-element-prefix">di:</span><span class="code-xml-element-local-name">smil</span> <span class="code-xml-attribute-prefix">xml:</span><span class="code-xml-attribute-local-name">base</span>=<span class="code-xml-attribute-value">"file:/home/user/b.smil"</span>&gt;
                        &lt;<span class="code-xml-element-prefix">di:</span><span class="code-xml-element-local-name">text</span> <span class="code-xml-attribute-local-name">par-id</span>=<span class="code-xml-attribute-value">"fragment1"</span> <span class="code-xml-attribute-local-name">text-id</span>=<span class="code-xml-attribute-value">"frg1"</span> <span class="code-xml-attribute-local-name">src</span>=<span class="code-xml-attribute-value">"b.html#txt1"</span>/&gt;
                        &lt;<span class="code-xml-element-prefix">di:</span><span class="code-xml-element-local-name">text</span> <span class="code-xml-attribute-local-name">par-id</span>=<span class="code-xml-attribute-value">"fragment2"</span> <span class="code-xml-attribute-local-name">text-id</span>=<span class="code-xml-attribute-value">"frg2"</span> <span class="code-xml-attribute-local-name">src</span>=<span class="code-xml-attribute-value">"b.html#txt2"</span>/&gt;
                    &lt;/<span class="code-xml-element-prefix">di:</span><span class="code-xml-element-local-name">smil</span>&gt;
                &lt;/<span class="code-xml-element-prefix">di:</span><span class="code-xml-element-local-name">mapping</span>&gt;
            &lt;/<span class="code-xml-element-local-name">code</span>&gt;&lt;/<span class="code-xml-element-local-name">pre</span>&gt;
        &lt;/<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">documentation</span>&gt;
    &lt;/<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">output</span>&gt;

    &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">import</span> <span class="code-xml-attribute-local-name">href</span>=<span class="code-xml-attribute-value">"<a href="../http://www.daisy.org/pipeline/modules/common-utils/library.xpl" class="source broken-link">http://www.daisy.org/pipeline/modules/common-utils/library.xpl</a>"</span>/&gt;

    &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">for-each</span>&gt;
        &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">documentation</span>&gt;For each SMIL&lt;/<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">documentation</span>&gt;
        &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"smil-base"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"base-uri(/*)"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">add-xml-base</span> <span class="code-xml-attribute-local-name">all</span>=<span class="code-xml-attribute-value">"true"</span> <span class="code-xml-attribute-local-name">relative</span>=<span class="code-xml-attribute-value">"false"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">documentation</span>&gt;For each text element where the a@fragment matches the text@id or text/parent@id&lt;/<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">documentation</span>&gt;
        
        
        
        
        &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">for-each</span>&gt;
            &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">iteration-source</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"//*[local-name()='par']"</span>/&gt;
            &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"par-id"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"/*/@id"</span>/&gt;
            &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"text-id"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"/*/*[local-name()='text']/@id"</span>/&gt;
            &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">variable</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"text-src"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"/*/*[local-name()='text']/resolve-uri(@src,base-uri(.))"</span>/&gt;
            &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">identity</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"current-smil"</span>/&gt;
            &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">in-scope-names</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"vars"</span>/&gt;
            &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">template</span>&gt;
                &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">input</span> <span class="code-xml-attribute-local-name">port</span>=<span class="code-xml-attribute-value">"template"</span>&gt;
                    &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">inline</span> <span class="code-xml-attribute-local-name">exclude-inline-prefixes</span>=<span class="code-xml-attribute-value">"#all"</span>&gt;
                        &lt;<span class="code-xml-element-prefix">di:</span><span class="code-xml-element-local-name">text</span> <span class="code-xml-attribute-local-name">par-id</span>=<span class="code-xml-attribute-value">"{$par-id}"</span> <span class="code-xml-attribute-local-name">text-id</span>=<span class="code-xml-attribute-value">"{$text-id}"</span> <span class="code-xml-attribute-local-name">src</span>=<span class="code-xml-attribute-value">"{$text-src}"</span>/&gt;
                    &lt;/<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">inline</span>&gt;
                &lt;/<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">input</span>&gt;
                &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">input</span> <span class="code-xml-attribute-local-name">port</span>=<span class="code-xml-attribute-value">"source"</span>&gt;
                    &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">pipe</span> <span class="code-xml-attribute-local-name">port</span>=<span class="code-xml-attribute-value">"result"</span> <span class="code-xml-attribute-local-name">step</span>=<span class="code-xml-attribute-value">"current-smil"</span>/&gt;
                &lt;/<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">input</span>&gt;
                &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">input</span> <span class="code-xml-attribute-local-name">port</span>=<span class="code-xml-attribute-value">"parameters"</span>&gt;
                    &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">pipe</span> <span class="code-xml-attribute-local-name">step</span>=<span class="code-xml-attribute-value">"vars"</span> <span class="code-xml-attribute-local-name">port</span>=<span class="code-xml-attribute-value">"result"</span>/&gt;
                &lt;/<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">input</span>&gt;
            &lt;/<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">template</span>&gt;
        &lt;/<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">for-each</span>&gt;
        &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">wrap-sequence</span> <span class="code-xml-attribute-local-name">wrapper</span>=<span class="code-xml-attribute-value">"di:smil"</span>/&gt;
        &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">add-attribute</span> <span class="code-xml-attribute-local-name">attribute-name</span>=<span class="code-xml-attribute-value">"xml:base"</span> <span class="code-xml-attribute-local-name">match</span>=<span class="code-xml-attribute-value">"/*"</span>&gt;
            &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">with-option</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"attribute-value"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"$smil-base"</span>/&gt;
        &lt;/<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">add-attribute</span>&gt;
        &lt;<span class="code-xml-element-prefix">px:</span><span class="code-xml-element-local-name">message</span>&gt;
            &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">with-option</span> <span class="code-xml-attribute-local-name">name</span>=<span class="code-xml-attribute-value">"message"</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"concat('created a map of links from the SMIL file ',$smil-base)"</span>/&gt;
        &lt;/<span class="code-xml-element-prefix">px:</span><span class="code-xml-element-local-name">message</span>&gt;
    &lt;/<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">for-each</span>&gt;
    &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">wrap-sequence</span> <span class="code-xml-attribute-local-name">wrapper</span>=<span class="code-xml-attribute-value">"di:mapping"</span>/&gt;
    &lt;<span class="code-xml-element-prefix">px:</span><span class="code-xml-element-local-name">message</span> <span class="code-xml-attribute-local-name">message</span>=<span class="code-xml-attribute-value">"created a map of links from all the SMIL files"</span>/&gt;

&lt;/<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">declare-step</span>&gt;</div></body>
</html>
