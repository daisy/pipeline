<!DOCTYPE html>
<html lang="en" prefix="dc: http://purl.org/dc/elements/1.1/
              dp2: http://www.daisy.org/ns/pipeline/">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta charset="utf-8">
    <meta http-equiv="content-language" content="en">
    <title>Text-To-Speech Configuration</title>
    
  <meta prefix="dc: http://purl.org/dc/elements/1.1/" property="dc:title" content="Text-To-Speech Configuration">


    <link rel="stylesheet" href="/pipeline/css/default.css">
    <link rel="stylesheet" href="/pipeline/css/coderay.css">
    <link rel="shortcut icon" href="http://www.daisy.org/sites/default/files/favicon_0.ico">

  </head>
  <body>
    <div id="body">
      <nav id="nav-sitemap">
  
  <ul class="spine">
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline" tabindex="1">
      
      Home
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/Download.html" tabindex="2">
      
      Download
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      <a href="/pipeline/Get-Help" tabindex="3">
      Help
      </a>
      
      <ul class="spine">
  
    
      
        <li class="spine-item">
      
      <a href="/pipeline/Get-Help/User-Guide" tabindex="6">
      User Guide
      </a>
      
      <ul class="spine">
  
    
      
        <li class="spine-item">
      
      <a href="/pipeline/Get-Help/User-Guide/Installation" tabindex="7">
      Installation
      </a>
      
      <ul class="spine">
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/Get-Help/User-Guide/Web-Application/Installation-and-configuation" tabindex="8">
      
      Web Application
      </a>
    
    </li>
  
</ul>

    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/Get-Help/User-Guide/Desktop-Application/DAISY-Pipeline-2-User-Guide" tabindex="9">
      
      Desktop Application
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      <a href="/pipeline/Get-Help/User-Guide/Web-Application/User-Guide" tabindex="10">
      Web Application
      </a>
      
      <ul class="spine">
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/Get-Help/User-Guide/Web-Application/Templating" tabindex="11">
      
      Templating
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/Get-Help/User-Guide/Web-Application/Administrator-settings" tabindex="12">
      
      Administrator Settings
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/Get-Help/User-Guide/Web-Application/Branding" tabindex="13">
      
      Branding
      </a>
    
    </li>
  
</ul>

    
    </li>
  
    
      
        <li class="spine-item">
      
      <a href="/pipeline/Get-Help/User-Guide/Pipeline-as-Service" tabindex="14">
      Pipeline as a Service
      </a>
      
      <ul class="spine">
  
    
      
        <li class="spine-item">
      
      <a href="/pipeline/Configuration-Files" tabindex="15">
      Configuration Files
      </a>
      
      <ul class="spine">
  
    
      
        <li class="spine-item">
      
      
        <a href="https://daisy.github.io/pipeline/modules/tts-common/doc/tts-config.html" class="external-link" target="_blank" tabindex="16">
      
      Text-To-Speech Configuration
      </a>
    
    </li>
  
</ul>

    
    </li>
  
</ul>

    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/Get-Help/User-Guide/Command-Line" tabindex="17">
      
      Command Line
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      <a href="/pipeline/Get-Help/User-Guide/Scripts" tabindex="18">
      Scripts
      </a>
      
      <ul class="spine">
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/modules/daisy202-validator/doc" tabindex="19">
      
      DAISY 2.02 Validator
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/modules/daisy202-to-epub3/doc" tabindex="20">
      
      DAISY 2.02 to EPUB 3
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/modules/daisy3-to-daisy202/doc" tabindex="21">
      
      DAISY 3 to DAISY 2.02
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/modules/daisy3-to-epub3/doc" tabindex="22">
      
      DAISY 3 to EPUB 3
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/modules/dtbook-validator/doc" tabindex="23">
      
      DTBook Validator
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/modules/dtbook-to-daisy3/doc" tabindex="24">
      
      DTBook to DAISY 3
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/modules/dtbook-to-epub3/doc" tabindex="25">
      
      DTBook to EPUB3
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/modules/dtbook-to-html/doc" tabindex="26">
      
      DTBook to HTML
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/modules/dtbook-to-odt/doc" tabindex="27">
      
      DTBook to ODT
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/modules/braille/dtbook-to-pef/doc" tabindex="28">
      
      DTBook to PEF
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/modules/dtbook-to-rtf/doc" tabindex="29">
      
      DTBook to RTF
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/modules/dtbook-to-zedai/doc" tabindex="30">
      
      DTBook to ZedAI
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/modules/epub2-to-epub3/doc" tabindex="31">
      
      EPUB 2 to EPUB 3
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/modules/epub3-to-epub3/doc" tabindex="32">
      
      EPUB 3 Enhancer
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/modules/epub3-validator/doc" tabindex="33">
      
      EPUB 3 Validator
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/modules/epub3-to-daisy202/doc" tabindex="34">
      
      EPUB 3 to DAISY 2.02
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/modules/epub3-to-daisy3/doc" tabindex="35">
      
      EPUB 3 to DAISY 3
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/modules/braille/epub3-to-pef/doc" tabindex="36">
      
      EPUB 3 to PEF
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/modules/epub-to-daisy/doc" tabindex="37">
      
      EPUB to DAISY
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/modules/html-to-dtbook/doc" tabindex="38">
      
      HTML to DTBook
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/modules/html-to-epub3/doc" tabindex="39">
      
      HTML to EPUB3
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/modules/braille/html-to-pef/doc" tabindex="40">
      
      HTML to PEF
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/modules/nimas-fileset-validator/doc" tabindex="41">
      
      NIMAS Fileset Validator
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/modules/zedai-to-epub3/doc" tabindex="42">
      
      ZedAI to EPUB 3
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/modules/zedai-to-html/doc" tabindex="43">
      
      ZedAI to HTML
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/modules/braille/zedai-to-pef/doc" tabindex="44">
      
      ZedAI to PEF
      </a>
    
    </li>
  
</ul>

    
    </li>
  
</ul>

    
    </li>
  
    
      
        <li class="spine-item">
      
      <a href="/pipeline/Get-Help/API-Documentation" tabindex="45">
      API Documentation
      </a>
      
      <ul class="spine">
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/WebServiceAPI" tabindex="46">
      
      Web Service API
      </a>
    
    </li>
  
</ul>

    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/Get-Help/Issue-Tracker.html" tabindex="47">
      
      Issue Tracker
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      <a href="/pipeline/Get-Help/Troubleshooting" tabindex="48">
      Troubleshooting
      </a>
      
      <ul class="spine">
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/Get-Help/Troubleshooting/Common-Errors-Windows" tabindex="49">
      
      Troubleshooting on Windows
      </a>
    
    </li>
  
</ul>

    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="mailto:daisy-pipeline@mail.daisy.org" tabindex="50">
      
      Contact
      </a>
    
    </li>
  
</ul>

    
    </li>
  
    
      
        <li class="spine-item">
      
      <a href="/pipeline/Contribute" tabindex="4">
      Contribute​
      </a>
      
      <ul class="spine">
  
    
      
        <li class="spine-item">
      
      
        <a href="https://github.com/daisy/pipeline" class="external-link" target="_blank" tabindex="51">
      
      Source Code
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="https://groups.google.com/forum/#!forum/daisy-pipeline-dev" class="external-link" target="_blank" tabindex="52">
      
      Developers Mailing List
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      <a href="/pipeline/Contribute/Developer-Guide" tabindex="53">
      Developer Guide
      </a>
      
      <ul class="spine">
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/Contribute/Developer-Guide/Sources" tabindex="54">
      
      Source Code
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/Contribute/Developer-Guide/Building" tabindex="55">
      
      Build System
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      <a href="/pipeline/Contribute/Developer-Guide/XProc" tabindex="56">
      XProc
      </a>
      
      <ul class="spine">
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/XProcExtensions" tabindex="57">
      
      XProc Extensions
      </a>
    
    </li>
  
</ul>

    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/Contribute/Developer-Guide/Testing" tabindex="58">
      
      Testing
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/Contribute/Developer-Guide/Debugging" tabindex="59">
      
      Debugging
      </a>
    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/Contribute/Developer-Guide/Releasing" tabindex="60">
      
      Release Management
      </a>
    
    </li>
  
</ul>

    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="/pipeline/Contribute/Easy-Hacks.html" tabindex="61">
      
      Easy Hacks
      </a>
    
    </li>
  
</ul>

    
    </li>
  
    
      
        <li class="spine-item">
      
      
        <a href="http://www.daisy.org" class="external-link" target="_blank" tabindex="5">
      
      DAISY Home
      </a>
    
    </li>
  
</ul>

</nav>



<script type="text/javascript">
var onload = function() {
  var nav = document.getElementById('nav-sitemap');
  var navTopBefore = nav.offsetTop;
  var fixed = (navTopBefore < window.pageYOffset);
  if (fixed) {
    nav.classList.add('fixed');
  }
  // FIXME: this is a hack! styling should not be handled here!
  var body = document.getElementsByTagName('body')[0];
  var leftNav = document.getElementById('nav-sitemap-left');
  var setLeftNavHeight = function() {
    if (fixed) {
      leftNav.style.height = (window.innerHeight - 34) + "px";
    } else {
      leftNav.style.height = Math.max(window.innerHeight - 219, body.offsetHeight - 175) + "px";
	  // "height: auto" doesn't work if the auto height of leftNav is greater
	  // than window.innerHeight and body.offsetHeight: it would mess up the
	  // transition because the transition would influence the pageYOffset
	  // and thereby canceling itself, making it impossible to scroll down.
    }
  }
  setLeftNavHeight();
  window.onscroll = function(e) {
    if (fixed && window.pageYOffset < navTopBefore) {
      nav.classList.remove('fixed');
	  fixed = false;
      setLeftNavHeight();
    } else if (!fixed && window.pageYOffset > navTopBefore) {
      nav.classList.add('fixed');
	  fixed = true;
      setLeftNavHeight();
    }
  }
  window.onresize = setLeftNavHeight;
};
if (window.addEventListener) {
  window.addEventListener('load', onload);
} else {
  window.attachEvent('onload', onload);
}
</script>


      <link rel="dp2:permalink" href="http://daisy.github.io/pipeline/Get-Help/User-Guide/Text-To-Speech/">

<h1 id="text-to-speech-configuration">Text-To-Speech Configuration</h1>

<p>The following scripts support the production of an aural presentation
of the document via speech synthesis, or “text-to-speech” (TTS):</p>

<ul>
  <li>
<a href="/pipeline/Get-Help/User-Guide/Scripts/dtbook-to-daisy3">DTBook to DAISY 3</a>,</li>
  <li>
<a href="/pipeline/Get-Help/User-Guide/Scripts/dtbook-to-epub3">DTBOOK to EPUB 3</a>,</li>
  <li>
<a href="/pipeline/Get-Help/User-Guide/Scripts/zedai-to-epub3">ZedAI to EPUB 3</a>,</li>
  <li>
<a href="/pipeline/Get-Help/User-Guide/Scripts/epub3-to-epub3">EPUB 3 enhancer</a> and</li>
  <li><a href="/pipeline/Get-Help/User-Guide/Scripts/epub-to-daisy">EPUB to DAISY</a></li>
</ul>

<p>The result is either an audio-only version of the document, or the
combination of a text layer and an audio layer synchronized with each
other.</p>

<p>The way text-to-speech is configured is common to all scripts. Speech
engines are configured with properties, and the exact aural rendering
of the document (TTS voices, pronunciations, speech pitch, speech
rates, speech levels, etc.) is controlled with CSS style sheets and
PLS lexicons.</p>

<p>The following two properties must be set through the
<a href="/pipeline/Configuration-Files#user-properties">pipeline.properties
file</a>.</p>

<dl>
  <dt><code>org.daisy.pipeline.tts.config</code></dt>
  <dd>File to load TTS configuration properties from at start-up</dd>
  <dd>Defaults to the file “tts-default-config.xml” located in the “etc/”
directory in the base directory of the Pipeline installation, or
“/etc/opt/daisy-pipeline2/tts-default-config.xml” on Debian/Ubuntu.</dd>
  <dt><code>org.daisy.pipeline.tts.host.protection</code></dt>
  <dd>Allow dynamic setting of properties</dd>
  <dd>Defaults to “true”</dd>
</dl>

<p>All other TTS properties may be specified through either the
<a href="/pipeline/Configuration-Files#user-properties">pipeline.properties
file</a>
or special TTS configuration files. Aural CSS style sheets and PLS
lexicons must be specified in TTS configuration files.</p>

<p>Configuration files may either be specified “statically”, through the
user property <code>org.daisy.pipeline.tts.config</code> or “dynamically” through
the optional script input. If <code>org.daisy.pipeline.tts.host.protection</code>
is true, properties in dynamic configuration files are ignored. The
configuration file format is as follows:</p>

<div class="language-xml highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span class="tag">&lt;config&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">"</span><span class="content">org.daisy.pipeline.tts.acapela.samplerate</span><span class="delimiter">"</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">44100</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">"</span><span class="content">org.daisy.pipeline.tts.log</span><span class="delimiter">"</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;voice</span> <span class="attribute-name">engine</span>=<span class="string"><span class="delimiter">"</span><span class="content">acapela</span><span class="delimiter">"</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">claire</span><span class="delimiter">"</span></span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">"</span><span class="content">fr</span><span class="delimiter">"</span></span> <span class="attribute-name">gender</span>=<span class="string"><span class="delimiter">"</span><span class="content">female-adult</span><span class="delimiter">"</span></span> <span class="attribute-name">priority</span>=<span class="string"><span class="delimiter">"</span><span class="content">12</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;css</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">"</span><span class="content">css/aural.css</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;lexicon</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">"</span><span class="content">lexicons/fr.pls</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/config&gt;</span>
</pre></div>
</div>
</div>

<!--
TODO: what about <annotations type="" href="">
                    ...
                 </annotations>
-->

<p>Both relative and absolute paths are accepted as a value of the “href”
attributes. Relative paths are relative to the configuration file’s
location.</p>

<!-- Absolute paths work only when the Pipeline is running in "local
mode" (true by default, see
[Pipeline as a Service](http://daisy.github.io/pipeline/Get-Help/User-Guide/Pipeline-as-Service/)). -->

<!-- The elements can be put in any namespace since namespaces aren’t
checked. If there is any syntax error in the file, you will be
notified in the server’s logs. -->

<!-- TODO: invent a media type, for example:
`application/vnd.pipeline.tss-config+xml` -->

<h2 id="engine-configuration">Engine configuration</h2>

<p>The audio encoder LAME must be installed.
<!-- LAME's location must be in the system PATH (i.e. $PATH on Unix,
%PATH% on Windows), unless it is provided via the 'lame.path' system
property. -->
In addition, one of the following text-to-speech processors must be
installed.</p>

<p>For Unix users,</p>

<ul>
  <li>
<a href="http://www.acapela-group.com" class="external-link" target="_blank">Acapela</a>;</li>
  <li>
<a href="http://espeak.sourceforge.net/" class="external-link" target="_blank">eSpeak</a>.</li>
</ul>

<p>For Windows users,</p>

<ul>
  <li>
<a href="http://espeak.sourceforge.net/" class="external-link" target="_blank">eSpeak</a>;</li>
  <li>
<a href="https://en.wikipedia.org/wiki/Microsoft_Speech_API" class="external-link" target="_blank">SAPI</a> with adequate voices.</li>
</ul>

<p>For MacOS users,</p>

<ul>
  <li>
<a href="https://developer.apple.com/legacy/library/documentation/Darwin/Reference/ManPages/man1/say.1.html" class="external-link" target="_blank">say</a>.</li>
</ul>

<p>The following online text-to-speech processor can also be used for
all users, given they have an account for the service 
and the appropriate plan or license :</p>

<ul>
  <li><a href="https://cloud.google.com/text-to-speech" class="external-link" target="_blank">Google Cloud Text-To-Speech</a></li>
</ul>

<p>It is strongly recommended to install eSpeak anyway, as it can handle
almost any language out there.
<!-- Just as Lame’s directory must be in the system PATH if it were
installed in a dedicated subdirectory, you may need to append eSpeak’s
installation directory to your PATH as well. On Unix systems, 'apt-get
install' already takes care of installing eSpeak to a known
location. On Windows, however, the PATH variable must be changed
manually using the 'environment variables' panel.--></p>

<p>The audio encoder and the TTS processors are configured with
properties. The following properties are available:</p>

<h3 id="common-settings">Common settings</h3>

<dl>
  <dt><code>org.daisy.pipeline.tts.audio.tmpdir</code></dt>
  <dd>Temporary directory used during audio synthesis</dd>
  <dd>Defaults to “${java.io.tmpdir}”</dd>
  <dt><code>org.daisy.pipeline.tts.maxmem</code></dt>
  <dd>Maximum amount of memory in Mb to be used by TTS and audio encoding</dd>
  <dd>Defaults to 50% of the total amount of memory that the JVM will
attempt to use, or 500 Mb if there is no such limit</dd>
  <dd>FIXME</dd>
  <dt><code>org.daisy.pipeline.tts.threads.number</code></dt>
  <dd>Number of threads for audio encoding and regular text-to-speech</dd>
  <dd>Defaults to the number of processors available to the JVM</dd>
  <dt><code>org.daisy.pipeline.tts.threads.encoding.number</code></dt>
  <dd>Number of audio encoding threads</dd>
  <dd>Defaults to “${org.daisy.pipeline.tts.threads.number}”</dd>
  <dt><code>org.daisy.pipeline.tts.threads.speaking.number</code></dt>
  <dd>Number of regular text-to-speech threads</dd>
  <dd>Defaults to “${org.daisy.pipeline.tts.threads.number}”</dd>
  <dt><code>org.daisy.pipeline.tts.threads.each.memlimit</code></dt>
  <dd>Maximum amount of memory consumed by each text-to-speech thread (in Mb)</dd>
  <dd>Defaults to “20”</dd>
  <dt><code>org.daisy.pipeline.tts.encoding.speed</code></dt>
  <dd>Maximum number of seconds of encoded audio per seconds of encoding</dd>
  <dd>Defaults to “2.0”</dd>
  <dt><code>org.daisy.pipeline.tts.log</code></dt>
  <dd>If set to “true”, will result in the Pipeline logging stuff in the
output directory in a file named ‘tts-log.xml’. The Pipeline will
log a great deal of information to this file, which can be quite
helpful for troubleshooting. Most of the log entries concern
particular chunks of text of the input document. For more general
errors, see the main server’s logs.</dd>
  <dd>Defaults to “false”</dd>
  <dd>dtbook-to-daisy3 only</dd>
</dl>

<h3 id="acapela">Acapela</h3>

<dl>
  <dt><code>org.daisy.pipeline.tts.acapela.samplerate</code></dt>
  <dd>Sample rate (in Hz)</dd>
  <dd>Defaults to “22050”</dd>
  <dt><code>org.daisy.pipeline.tts.acapela.threads.reserved</code></dt>
  <dd>Number of reserved text-to-speech threads</dd>
  <dd>Defaults to “3”</dd>
  <dt><code>org.daisy.pipeline.tts.acapela.speed</code></dt>
  <dd>Defaults to “300”</dd>
  <dt><code>org.daisy.pipeline.tts.acapela.servers</code></dt>
  <dd>Defaults to “localhost:0”</dd>
  <dt><code>org.daisy.pipeline.tts.acapela.priority</code></dt>
  <dd>This engine is chosen over another engine that serves the same voice
if this one has a higher priority.</dd>
  <dd>Defaults to “15”</dd>
</dl>

<!--
### AT&T

tts-adapter-attnative:

`org.daisy.pipeline.tts.att.servers`
: Address of the AT&T server
: Defaults to "localhost:8888"

`org.daisy.pipeline.tts.att.priority`
: Priority with which the AT&T engine is chosen over other TTS engines
  that serve the same voice.
: Defaults to "10"


tts-adapter-attbin:

`org.daisy.pipeline.tts.att.servers`
: Address of the AT&T server
: Defaults to "localhost:8888"

`org.daisy.pipeline.tts.att.client.path`
: Path to the "TTSClientFile" executable
: If not specified, Pipeline will automatically look for
  "TTSClientFile" in the directories specified by the "PATH"
  environment variable.

`org.daisy.pipeline.tts.att.bin.priority`
: Priority with which the AT&T engine is chosen over other TTS engines
  that serve the same voice.
: Defaults to "5"

-->

<h3 id="espeak">eSpeak</h3>

<dl>
  <dt><code>org.daisy.pipeline.tts.espeak.path</code></dt>
  <dd>Path to eSpeak executable</dd>
  <dd>If not specified, Pipeline will automatically look for “espeak” in
the directories specified by the “PATH” environment variable.</dd>
  <dt><code>org.daisy.pipeline.tts.espeak.priority</code></dt>
  <dd>This engine is chosen over another engine that serves the same voice
if this one has a higher priority.</dd>
  <dd>Defaults to “2”</dd>
</dl>

<h3 id="mac-os">Mac OS</h3>

<dl>
  <dt><code>org.daisy.pipeline.tts.osxspeech.path</code></dt>
  <dd>Alternative path to OSX’s command line program “say”</dd>
  <dd>Defaults to “/usr/bin/say”</dd>
  <dt><code>org.daisy.pipeline.tts.osxspeech.priority</code></dt>
  <dd>This engine is chosen over another engine that serves the same voice
if this one has a higher priority.</dd>
  <dd>Defaults to “2”</dd>
</dl>

<h3 id="sapi">SAPI</h3>

<dl>
  <dt><code>org.daisy.pipeline.tts.sapi.samplerate</code></dt>
  <dd>Sample rate (in Hz)</dd>
  <dd>Defaults to “22050”</dd>
  <dd>Can not be overridden at runtime. The server must be restarted to
change this property.</dd>
  <dt><code>org.daisy.pipeline.tts.sapi.bytespersample</code></dt>
  <dd>Defaults to “2”</dd>
  <dd>Can not be overridden at runtime. The server must be restarted to
change this property.</dd>
  <dt><code>org.daisy.pipeline.tts.sapi.priority</code></dt>
  <dd>This engine is chosen over another engine that serves the same voice
if this one has a higher priority.</dd>
  <dd>Defaults to “7”</dd>
</dl>

<h3 id="qfrency">Qfrency</h3>

<dl>
  <dt><code>org.daisy.pipeline.tts.qfrency.path</code></dt>
  <dd>Path to “synth” executable</dd>
  <dd>If not specified, will automatically look for “synth” in the
directories specified by the environment variable “PATH”.</dd>
  <dt><code>org.daisy.pipeline.tts.qfrency.address</code></dt>
  <dd>Address of the Qfrency server</dd>
  <dd>Defaults to “localhost”</dd>
  <dt><code>org.daisy.pipeline.tts.qfrency.priority</code></dt>
  <dd>This engine is chosen over another engine that serves the same voice
if this one has a higher priority.</dd>
  <dd>Defaults to “2”</dd>
</dl>

<h3 id="google-cloud-text-to-speech">Google Cloud Text-to-speech</h3>

<dl>
  <dt><code>org.daisy.pipeline.tts.google.apikey</code></dt>
  <dd>(Mandatory) API key to connect to Google Text-To-Speech service</dd>
  <dd>See <a href="https://cloud.google.com/docs/authentication/api-keys" class="external-link" target="_blank">Google API key page</a>
for more information.</dd>
  <dt><code>org.daisy.pipeline.tts.google.samplerate</code></dt>
  <dd>Sample rate (in Hz)</dd>
  <dd>Defaults to “22050”</dd>
  <dt><code>org.daisy.pipeline.tts.google.priority</code></dt>
  <dd>This engine is chosen over another engine that serves the same voice
if this one has a higher priority.</dd>
  <dd>Defaults to “15”</dd>
</dl>

<h3 id="cereproc">CereProc</h3>

<dl>
  <dt><code>org.daisy.pipeline.tts.cereproc.server</code></dt>
  <dd>Host address of CereProc server</dd>
  <dd>Defaults to “localhost”</dd>
  <dt><code>org.daisy.pipeline.tts.cereproc.port</code></dt>
  <dd>Port of CereProc server for regular voices</dd>
  <dd>Mandatory</dd>
  <dt><code>org.daisy.pipeline.tts.cereproc.client</code></dt>
  <dd>Location of client program for communicating with CereProc server</dd>
  <dd>Defaults to “/usr/bin/cspeechclient”</dd>
  <dt><code>org.daisy.pipeline.tts.cereproc.priority</code></dt>
  <dd>This engine is chosen over another engine that serves the same voice
if this one has a higher priority.</dd>
  <dd>Defaults to “15”</dd>
  <dt><code>org.daisy.pipeline.tts.cereproc.dnn.port</code></dt>
  <dd>Port of CereProc server for DNN voices</dd>
  <dd>Mandatory</dd>
  <dt><code>org.daisy.pipeline.tts.cereproc.dnn.priority</code></dt>
  <dd>This engine is chosen over another engine that serves the same voice
if this one has a higher priority.</dd>
  <dd>Defaults to “15”</dd>
</dl>

<h3 id="lame-encoder">LAME encoder</h3>

<dl>
  <dt><code>org.daisy.pipeline.tts.lame.path</code></dt>
  <dd>Path to LAME executable</dd>
  <dd>If not specified, will automatically look for “lame” in the
directories specified by the environment variable “PATH”.</dd>
  <dt><code>org.daisy.pipeline.tts.lame.cli.options</code></dt>
  <dd>Additional command line options passed to lame</dd>
</dl>

<h2 id="css">CSS</h2>

<p>The text-to-speech voices and prosody can be configured with Aural
CSS. To do so, add one or more “css” elements to the configuration
file. If the “href” attribute is missing, the CSS stylesheets will be
interpreted as inlined in the configuration file:</p>

<div class="language-xml highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span class="tag">&lt;config&gt;</span>
  <span class="tag">&lt;css&gt;</span>
    p {
      volume: soft;
      voice-family: female;
    }
  <span class="tag">&lt;/css&gt;</span>
<span class="tag">&lt;/config&gt;</span>
</pre></div>
</div>
</div>

<p>In addition to the configuration option, local CSS stylesheets
referenced in
<a href="https://www.w3.org/TR/xml-stylesheet" class="external-link" target="_blank">‘xml-stylesheet’ processing instructions</a>
and by <a href="https://www.w3.org/Style/styling-XML#External" class="external-link" target="_blank">‘links’</a> in the
header will be loaded too.</p>

<p>The CSS properties that are supported by DAISY Pipeline are a subset
of <a href="https://www.w3.org/TR/CSS2/aural.html" class="external-link" target="_blank">Aural CSS 2.1</a> (and partly
inspired by <a href="https://www.w3.org/TR/css3-speech" class="external-link" target="_blank">CSS 3 Speech</a>):</p>

<!-- TODO: update completely to CSS 3 -->

<dl>
  <dt><a href="https://www.w3.org/TR/CSS2/aural.html#propdef-voice-family" class="external-link" target="_blank"><code>voice-family</code></a></dt>
  <dd>Used for selecting a voice based on gender, age, name and/or vendor.</dd>
  <dd>See text below.
<!-- see also <ssml:voice> -->
</dd>
  <dt><a href="https://www.w3.org/TR/CSS2/aural.html#propdef-speak" class="external-link" target="_blank"><code>speak</code></a></dt>
  <dd>“none” or “spell-out”</dd>
  <dd>Used for preventing certain text to be rendered aurally, or for
spelling text one letter at a time.
<!-- see also CSS3 "speak" and "speak-as" properties -->
<!-- see also <ssml:say-as interpret-as="..."> -->
</dd>
  <dt><a href="https://www.w3.org/TR/CSS2/aural.html#propdef-volume" class="external-link" target="_blank"><code>volume</code></a></dt>
  <dd>A number, “silent”, “x-soft”, “soft”, “medium”, “loud” or “x-loud”</dd>
  <dd>Used for controlling the loudness of the speech.
<!-- see also CSS3 "voice-volume" property -->
<!-- see also <ssml:prosody volume="..."> -->
</dd>
  <dt><a href="https://www.w3.org/TR/CSS2/aural.html#propdef-pitch" class="external-link" target="_blank"><code>pitch</code></a></dt>
  <dd>“x-low”, “low”, “medium”, “high” or “x-high”</dd>
  <dd>Used for controlling the average pitch of the speech.
<!-- see also CSS3 "voice-pitch" property -->
<!-- see also <ssml:prosody pitch="..."> -->
</dd>
  <dt><a href="https://www.w3.org/TR/CSS2/aural.html#propdef-speech-rate" class="external-link" target="_blank"><code>speech-rate</code></a></dt>
  <dd>A number, “x-slow”, “slow”, “medium”, “fast” or “x-fast”</dd>
  <dd>Used for controlling the rate of the speech in terms of words per
minute.
<!-- see also CSS3 "voice-rate" property -->
<!-- see also <ssml:prosody rate="..."> -->
</dd>
  <dt><a href="https://www.w3.org/TR/CSS2/aural.html#propdef-pitch-range" class="external-link" target="_blank"><code>pitch-range</code></a></dt>
  <dd>A number</dd>
  <dd>Used for controlling the variation in average pitch of the speech.
<!-- see also CSS3 "voice-range" property -->
<!-- see also <ssml:prosody range="..."> -->
</dd>
  <dt><a href="https://www.w3.org/TR/CSS2/aural.html#propdef-speak-numeral" class="external-link" target="_blank"><code>speak-numeral</code></a></dt>
  <dd>“digits” or “continuous”</dd>
  <dd>Used for speaking out numbers one digit at a time.
<!-- see also CSS3 "speak-as" property -->
<!-- see also <ssml:say-as interpret-as="..."> -->
</dd>
  <dt>
<a href="https://www.w3.org/TR/CSS2/aural.html#propdef-pause-before" class="external-link" target="_blank"><code>pause-before</code></a>, <a href="https://www.w3.org/TR/CSS2/aural.html#propdef-pause-after" class="external-link" target="_blank"><code>pause-after</code></a> and <a href="https://www.w3.org/TR/CSS2/aural.html#propdef-pause" class="external-link" target="_blank"><code>pause</code></a>
</dt>
  <dd>A duration</dd>
  <dd>Used for specifying silences with a certain duration before or
after an element.
<!-- see also <ssml:break time="..."> -->
</dd>
  <dt>
<a href="https://www.w3.org/TR/CSS2/aural.html#propdef-cue-before" class="external-link" target="_blank"><code>cue-before</code></a>, <a href="https://www.w3.org/TR/CSS2/aural.html#propdef-cue-after" class="external-link" target="_blank"><code>cue-after</code></a> and <a href="https://www.w3.org/TR/CSS2/aural.html#propdef-cue" class="external-link" target="_blank"><code>cue</code></a>
</dt>
  <dd>A URL</dd>
  <dd>Used for playing pre-recorded sound clips before or after an
element.
<!-- see also <ssml:audio src="..."> -->
</dd>
</dl>

<!--
- [`stress`](https://www.w3.org/TR/CSS2/aural.html#propdef-stress)
- [`richness`](https://www.w3.org/TR/CSS2/aural.html#propdef-richness)
- [`azimuth`](https://www.w3.org/TR/CSS2/aural.html#propdef-azimuth)
- [`play-during`](https://www.w3.org/TR/CSS2/aural.html#propdef-play-during)
- [`elevation`](https://www.w3.org/TR/CSS2/aural.html#propdef-elevation)
- [`speak-punctuation`](https://www.w3.org/TR/CSS2/aural.html#propdef-speak-punctuation)
- [`speak-header`](https://www.w3.org/TR/CSS2/aural.html#propdef-speak-header)
-->

<p><code>voice-family</code> is a comma-separated list of voice characteristics that
place conditions on the voice selection. It is inspired by (but not
the same as) the specification of the
<a href="https://www.w3.org/TR/css3-speech#voice-family" class="external-link" target="_blank">voice-family property in CSS 3</a>.</p>

<p>If a full voice name is provided, e.g. “acapela, alice”, this voice
will be selected regardless of the document language. If this voice is
not available, a fallback voice will be chosen such that it will match
with the same characteristics as those of the requested voice: same
language, same engine, same gender. If none is available, the pipeline
broadens its search by relaxing the criteria: first the gender is
relaxed and then the engine.</p>

<p>If no voice name is provided, e.g. “acapela”, “female” or “female,
old”, the selection algorithm will take into consideration only the
voices that match the current language. It starts by looking for a
voice with the specified gender and supplied by the specified engine,
and will broaden to any gender if the first search yielded no
results. If neither the gender nor the engine match, language will be
the only criterion.</p>

<p>When multiple voices match the criteria, the algorithm chooses the
voice with the highest priority. Each voice has a default priority,
though they can be overridden via the “voice” entries of the
configuration file, as follows:</p>

<div class="language-xml highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span class="tag">&lt;config&gt;</span>
  <span class="tag">&lt;voice</span> <span class="attribute-name">engine</span>=<span class="string"><span class="delimiter">"</span><span class="content">sapi</span><span class="delimiter">"</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">Microsoft Todd</span><span class="delimiter">"</span></span> <span class="attribute-name">gender</span>=<span class="string"><span class="delimiter">"</span><span class="content">male-adult</span><span class="delimiter">"</span></span> <span class="attribute-name">priority</span>=<span class="string"><span class="delimiter">"</span><span class="content">100</span><span class="delimiter">"</span></span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">"</span><span class="content">en</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/config&gt;</span>
</pre></div>
</div>
</div>

<!-- TODO: "marks" attribute: you may set this attribute to "false" if
you have installed a new voice that can’t interpret SSML or mark-based
audio synchronization, which may compromise SAPI’s
initialization. Microsoft’s built-in voices do handle SSML and marks.
-->

<p>Notice that it is also a convenient way to add voices that are not
natively supported by the Pipeline. In the example above, Todd is now
a registered voice and, as such, can be selected automatically by the
Pipeline when the document is written in English.</p>

<p>AT&amp;T, eSpeak and Acapela’s voice names can be found in their
corresponding documentation. For Windows users, SAPI voices are
enumerated in the system settings (Start &gt; All Control Panel Items &gt;
Speech Recognition &gt; Advanced Speech Options). You will also need to
know the value of the “engine” attribute. This attribute must take as
value one of the following:</p>

<ul>
  <li>“att” for AT&amp;T voices;</li>
  <li>“espeak” for eSpeak voices;</li>
  <li>“acapela” for Acapela voices;</li>
  <li>“osx-speech” for Apple voices;</li>
  <li>“sapi” for Microsoft voices or for any other voice installed to work
with the SAPI engine, including some versions of AT&amp;T and Acapela’s
products.</li>
</ul>

<p>In case of any doubt, engines and voice names can be retrieved from
the server’s log in which all the voices are enumerated:</p>

<div class="language-plaintext highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre>Available voices:
* {engine:'sapi', name:'NTMNTTS Voice (Male)'} by sapi-native
* {engine:'acapela', name:'alice'} by acapela-jna
</pre></div>
</div>
</div>

<h2 id="pls">PLS</h2>

<p>PLS lexicons allow you to define custom pronunciations of words. It is
meant to help TTS processors deal with ambiguous abbreviations and
pronunciation of proper names. When a word is defined in a lexicon the
processor will use the provided pronunciation in place of the default
rendering.</p>

<p>Lexicons are configured using the “lexicon” elements in the
configuration file. If the “href” attribute is missing, the pipeline
will read the lexicons inside the config nodes, as in this example:</p>

<div class="language-xml highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span class="tag">&lt;config&gt;</span>
  <span class="tag">&lt;lexicon</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://www.w3.org/2005/01/pronunciation-lexicon</span><span class="delimiter">"</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">"</span><span class="content">1.0</span><span class="delimiter">"</span></span>
           <span class="attribute-name">alphabet</span>=<span class="string"><span class="delimiter">"</span><span class="content">ipa</span><span class="delimiter">"</span></span> <span class="attribute-name">xml:lang</span>=<span class="string"><span class="delimiter">"</span><span class="content">en</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;lexeme&gt;</span>
      ...
    <span class="tag">&lt;/lexeme&gt;</span>
  <span class="tag">&lt;/lexicon&gt;</span>
<span class="tag">&lt;/config&gt;</span>
</pre></div>
</div>
</div>

<p>The syntax of a PLS lexicon is defined in
<a href="https://www.w3.org/TR/pronunciation-lexicon" class="external-link" target="_blank">Pronunciation Lexicon Specification Version 1.0</a>,
extended with regular expression matching. To enable regular
expression matching, add the “regex” attribute, as follows:</p>

<div class="language-xml highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span class="tag">&lt;lexicon</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://www.w3.org/2005/01/pronunciation-lexicon</span><span class="delimiter">"</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">"</span><span class="content">1.0</span><span class="delimiter">"</span></span>
         <span class="attribute-name">alphabet</span>=<span class="string"><span class="delimiter">"</span><span class="content">ipa</span><span class="delimiter">"</span></span> <span class="attribute-name">xml:lang</span>=<span class="string"><span class="delimiter">"</span><span class="content">en</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;lexeme</span> <span class="attribute-name">regex</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;grapheme&gt;</span>([0-9]+)-([0-9]+)<span class="tag">&lt;/grapheme&gt;</span>
    <span class="tag">&lt;alias&gt;</span>between $1 and $2<span class="tag">&lt;/alias&gt;</span>
  <span class="tag">&lt;/lexeme&gt;</span>
<span class="tag">&lt;/lexicon&gt;</span>
</pre></div>
</div>
</div>

<p>The regex feature works only with alias-based substitutions. The regex
syntax used is that from
<a href="https://www.w3.org/TR/xpath-functions/#regex-syntax" class="external-link" target="_blank">XQuery 1.0 and XPath 2.0</a>.</p>

<p>Whether or not the regex attribute is set to “true”, the grapheme
matching can be made more accurate by specifying the
“positive-lookahead” and “negative-lookahead” attributes:</p>

<div class="language-xml highlighter-coderay">
<div class="CodeRay">
  <div class="code"><pre><span class="tag">&lt;lexicon</span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">"</span><span class="content">1.0</span><span class="delimiter">"</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://www.w3.org/2005/01/pronunciation-lexicon</span><span class="delimiter">"</span></span>
         <span class="attribute-name">alphabet</span>=<span class="string"><span class="delimiter">"</span><span class="content">ipa</span><span class="delimiter">"</span></span> <span class="attribute-name">xml:lang</span>=<span class="string"><span class="delimiter">"</span><span class="content">en</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;lexeme&gt;</span>
    <span class="tag">&lt;grapheme</span> <span class="attribute-name">positive-lookahead</span>=<span class="string"><span class="delimiter">"</span><span class="content">[ ]+is</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>SB<span class="tag">&lt;/grapheme&gt;</span>
    <span class="tag">&lt;alias&gt;</span>somebody<span class="tag">&lt;/alias&gt;</span>
  <span class="tag">&lt;/lexeme&gt;</span>
  <span class="tag">&lt;lexeme&gt;</span>
    <span class="tag">&lt;grapheme&gt;</span>SB<span class="tag">&lt;/grapheme&gt;</span>
    <span class="tag">&lt;alias&gt;</span>should be<span class="tag">&lt;/alias&gt;</span>
  <span class="tag">&lt;/lexeme&gt;</span>
  <span class="tag">&lt;lexeme</span> <span class="attribute-name">xml:lang</span>=<span class="string"><span class="delimiter">"</span><span class="content">fr</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;grapheme</span> <span class="attribute-name">positive-lookahead</span>=<span class="string"><span class="delimiter">"</span><span class="content">[ ]+[cC]ity</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>boston<span class="tag">&lt;/grapheme&gt;</span>
    <span class="tag">&lt;phoneme&gt;</span>bɔstøn<span class="tag">&lt;/phoneme&gt;</span>
  <span class="tag">&lt;/lexeme&gt;</span>
<span class="tag">&lt;/lexicon&gt;</span>
</pre></div>
</div>
</div>

<p>Graphemes with “positive-lookahead” will match if the beginning of
what follows matches the “position-lookahead” pattern. Graphemes with
“negative-lookahead” will match if the beginning of what follows does
not match the “negative-lookahead” pattern. The lookaheads are
case-sensitive while the grapheme contents are not.</p>

<p>The lexemes are reorganized so as to be matched in this order:</p>

<ol>
  <li>Graphemes with regex=”false” come first, no matter if there is a lookahead or not;</li>
  <li>Graphemes with regex=”true” and no lookahead;</li>
  <li>Graphemes with regex=”true” and one or two lookaheads.</li>
</ol>

<p>Within these categories, lexemes are matched in the same order as they
appear in the lexicons.</p>


    </div>
  </body>
</html>
